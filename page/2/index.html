<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="dns-prefetch" href="http://jiangmoting.com">
  <title>TT ❤ LL 印迹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="生长的印迹">
<meta name="keywords" content="绛墨铤的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="TT ❤ LL 印迹">
<meta property="og:url" content="http://jiangmoting.com/page/2/index.html">
<meta property="og:site_name" content="TT ❤ LL 印迹">
<meta property="og:description" content="生长的印迹">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TT ❤ LL 印迹">
<meta name="twitter:description" content="生长的印迹">
  
    <link rel="alternative" href="/atom.xml" title="TT ❤ LL 印迹" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>
</html>
<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/">绛墨铤</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔/">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">绛墨铤</h1>
			</hgroup>
			
			
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="rss" target="_blank" href="#" title="rss"><i class="icon-rss"></i></a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu"><i class="icon-zhihu"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 50%">
				
				
					<li style="width: 50%"><a href="/">主页</a></li>
		        
					<li style="width: 50%"><a href="/tags/随笔/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-VBA常用技巧2--Worksheet(工作表对象)" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/07/VBA常用技巧2--Worksheet(工作表对象)/">VBA常用技巧2--Worksheet(工作表对象)</a>
    </h1>
  

        
        <a href="/2018/05/07/VBA常用技巧2--Worksheet(工作表对象)/" class="archive-article-date">
  	<time datetime="2018-05-06T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-05-07</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第2章-Worksheet（工作表）对象"><a href="#第2章-Worksheet（工作表）对象" class="headerlink" title="第2章     Worksheet（工作表）对象"></a>第2章     Worksheet（工作表）对象</h2><h3 id="技巧21-引用工作表的方式"><a href="#技巧21-引用工作表的方式" class="headerlink" title="技巧21     引用工作表的方式"></a>技巧21     引用工作表的方式</h3><p>VBA中，在不同的工作表之间转换或者对不同工作表中的单元格区域进行操作时，需要指定引用的工作表，通常有下面几种方法：</p>
<h4 id="21-1-使用工作表的名称"><a href="#21-1-使用工作表的名称" class="headerlink" title="21-1    使用工作表的名称"></a>21-1    使用工作表的名称</h4><p>工作表名称是指显示在工作表标签中的文本，工作表名称可以使用WorkSheets集合和Sheets集合两种引用方式，如下面的代码所示。</p>
<pre><code class="vb">Sub ShActivate()
    Worksheets(&quot;索引号&quot;).Activate
    &#39;Sheets(&quot;索引号&quot;).Activate
End Sub
第3、4行代码都激活工作簿中名称为“索引号”的工作表，激活后“索引号”工作表将成为活动工作表。
WorkSheets集合包含所有的工作表，而Sheets集合不仅包含工作表集合WorkSheets，还包含图表集合Charts、宏表集合Excel4MacroSheets与MS Excel 5.0对话框集合DialogSheets等。
任何时刻工作簿中只有一个工作表是活动工作表。</code></pre>
<h4 id="21-2-使用工作表的索引号"><a href="#21-2-使用工作表的索引号" class="headerlink" title="21-2    使用工作表的索引号"></a>21-2    使用工作表的索引号</h4><p>工作表索引号是指工作表在工作簿中的位置，Excel根据工作表在工作表标签中的位置以1开始从左向右进行编号。下面的代码选中并激活当前工作簿中第1个工作表：</p>
<pre><code class="vb">Sub ShIndex()
    Worksheets(1).Select
End Sub
单个WorkSheet对象的Select方法与Activate方法的主要区别在于Select方法要求工作表可视。
注意 当工作簿包括工作表、宏表、图表等时，使用索引号引用工作表如Sheets(1)与WorkSheets(1)引用的可能不是同一个表。
使用Worksheet对象的Index属性可以返回工作表的索引号，如下面的代码所示。</code></pre>
<pre><code class="vb">Sub ShInde()
    MsgBox Worksheets(&quot;索引号&quot;).Index
End Sub</code></pre>
<h4 id="21-3-使用工作表的代码名称"><a href="#21-3-使用工作表的代码名称" class="headerlink" title="21-3    使用工作表的代码名称"></a>21-3    使用工作表的代码名称</h4><p>使用Worksheet对象的CodeName属性可以返回工作表的代码名称，如下面的代码所示。</p>
<pre><code class="vb">Sub ShCodeName()
    MsgBox Sheets(1).CodeName
End Sub
工作表的代码名称显示在VBE工程资源管理器窗口中，在属性窗口中能够修改工作表代码名称
在VBA中能够直接使用工作表的代码名称引用工作表，即使工作表的名称被修改，代码仍然能够正常运行。</code></pre>
<h4 id="21-4-使用ActiveSheet属性引用活动工作表"><a href="#21-4-使用ActiveSheet属性引用活动工作表" class="headerlink" title="21-4    使用ActiveSheet属性引用活动工作表"></a>21-4    使用ActiveSheet属性引用活动工作表</h4><p>使用ActiveSheet属性可以返回活动工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub ShActive()
    MsgBox ActiveSheet.Name
End Sub
ActiveSheet属性应用于AppActivate对象、Window对象和Workbook对象时，如果未给出对象识别符，返回活动工作簿中的活动工作表。</code></pre>
<h3 id="技巧22-选择工作表的方法"><a href="#技巧22-选择工作表的方法" class="headerlink" title="技巧22     选择工作表的方法"></a>技巧22     选择工作表的方法</h3><p>在VBA中需要激活或者选择某个工作表时使用Select方法或Activate方法，如下面的代码所示。</p>
<pre><code class="vb">Sub SelectSh()
    Worksheets(&quot;Sheet2&quot;).Select
End Sub
Sub ActivateSh()
    Worksheets(&quot;Sheet2&quot;).Activate
End Sub
代码解析：
SelectSh过程使用Select方法选择“Sheet2”工作表，而ActivateSh过程则使用Activate方法选择“Sheet2”工作表，从表面看两者的作用是相同的，但是如果“Sheet2”工作表是隐藏的，Activate方法可以正常运行，而Select方法将会出现错误</code></pre>
<p>如果需要同时选中工作簿中的所有工作表，则只能使用Select方法而不能使用Activate方法，如下面的代码所示。</p>
<pre><code class="vb">Sub SelectShs() &#39;遍历工作表并使用带参数的Select方法选中所有工作表
    Dim Shs As Worksheet
    For Each Shs In Worksheets
        Shs.Select False
    Next
End Sub
Sub SelectSheets() &#39;使用Worksheets集合的Select方法选中集合中所有的对象
    Worksheets.Select
End Sub
Sub ArraySheets()
    Worksheets(Array(1, 2, 3)).Select
End Sub
应用于Worksheet对象的Select方法的语法如下：
Select(Replace)
参数Replace是可选的,如果该值为True，则用指定对象替代当前选定对象。如果该值为False，则延伸当前选定对象以包括任何以前选定的对象。
ArraySheets过程使用Array 函数返回工作簿中的前三张工作表并使用Worksheets集合的Select方法选中前三张工作表。</code></pre>
<h3 id="技巧23-遍历工作表的方法"><a href="#技巧23-遍历工作表的方法" class="headerlink" title="技巧23     遍历工作表的方法"></a>技巧23     遍历工作表的方法</h3><p>在Excel应用中经常需要遍历工作簿中所有的工作表，有以下两种方法可以实现。</p>
<h4 id="23-1-使用For…Next-语句"><a href="#23-1-使用For…Next-语句" class="headerlink" title="23-1    使用For…Next 语句"></a>23-1    使用For…Next 语句</h4><p>使用For…Next 语句遍历工作簿中所有的工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub ShCount1()
    Dim c As Integer
    Dim i As Integer
    Dim s As String
    c = Worksheets.Count
    For i = 1 To c
        s = s &amp; Worksheets(i).Name &amp; Chr(13)
    Next
    MsgBox &quot;工作簿中含有以下工作表:&quot; &amp; Chr(13) &amp; s
End Sub
代码解析：
ShCount1过程使用For...Next 语句遍历工作簿中所有的工作表，并用消息框显示所有的工作表名称。
       第5行代码根据Worksheet对象的Count属性返回工作簿中工作表的数量赋给变量c。应用于Worksheet对象的Count属性返回Worksheets集合中工作表的数量，语法如下：
expression.Count
第6行代码开始For...Next 语句循环。For...Next 语句以指定次数来重复执行一组语句，语法如下：
For counter = start To end [Step step]
    [statements]
    [Exit For]
    [statements]
Next [counter]
参数counter是必需的，用做循环计数器的数值变量。
参数start是必需的，循环计数器的初值。
      参数end是必需的，循环计数器的终值。
      参数step是可选的，环计数器的步长，缺省值为 1。
      参数statements是可选的，放在For和Next之间的一条或多条语句，它们将被执行指定的次数。
      第7行代码在For...Next循环中根据工作表的索引号取得所有工作表的名称赋给字符串变量s。
运行ShCount过程结果如图 23 1所示。</code></pre>
<h4 id="23-2-使用For-Each…Next-语句"><a href="#23-2-使用For-Each…Next-语句" class="headerlink" title="23-2    使用For Each…Next 语句"></a>23-2    使用For Each…Next 语句</h4><p>使用For Each…Next语句遍历工作簿中所有的工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub ShCount2()
    Dim Sh As Worksheet
    Dim s As String
    For Each Sh In Worksheets
        s = s &amp; Sh.Name &amp; Chr(13)
    Next
    MsgBox &quot;工作簿中含有以下工作表:&quot; &amp; Chr(13) &amp; s
End Sub
代码解析：
ShCount2过程使用For Each...Next语句遍历工作簿中所有的工作表，并用消息框显示所有工作表名称。
第4行代码使用For Each...Next语句遍历Worksheets集合中所有元素。For Each...Next语句针对一个数组或集合中的每个元素，重复执行一组语句，语法如下：
For Each element In Group
    [statements]
    [Exit For]
    [statements]
Next [element]
参数element是必需的，用来遍历集合或数组中所有元素的变量。
参数group是必需的，对象集合或数组的名称。
参数statements是可选的，针对对象集合或数组中的每一项执行的一条或多条语句。
第5行代码将返回的工作表的名称赋给字符串变量s。
运行ShCount2过程结果如图 23 1所示。</code></pre>
<h3 id="技巧24-在工作表中上下翻页"><a href="#技巧24-在工作表中上下翻页" class="headerlink" title="技巧24     在工作表中上下翻页"></a>技巧24     在工作表中上下翻页</h3><p>如果需要在工作簿的工作表中进行上下翻页，可以使用下面的代码。</p>
<pre><code class="vb">Sub DownSheet()
    Dim i As Integer
    i = Worksheets.Count
    If ActiveSheet.Index &lt; i Then
        Worksheets(ActiveSheet.Index + 1).Activate
    Else
        Worksheets(1).Activate
    End If
End Sub
Sub UpSheet()
    Dim i As Integer
    i = Worksheets.Count
    If ActiveSheet.Index &gt; 1 Then
        Worksheets(ActiveSheet.Index - 1).Activate
    Else
        Worksheets(i).Activate
    End If
End Sub
代码解析：
DownSheet过程向下翻页，第3、12行代码使用Worksheets对象的Count属性取得工作表的数目，第4行到第7行代码根据Index属性判断活动工作表是否是工作簿中的最后一张工作表。如果活动工作表不是最后一张工作表则激活活动工作表的下一张工作表，否则激活第一张工作表。
UpSheet过程向上翻页，第13行到第16行代码根据Index属性判断活动工作表是否是工作簿中的第一张工作表。如果活动工作表不是第一张工作表则激活活动工作表的上一张工作表，否则激活最后一张工作表。</code></pre>
<h3 id="技巧25-工作表的添加与删除"><a href="#技巧25-工作表的添加与删除" class="headerlink" title="技巧25     工作表的添加与删除"></a>技巧25     工作表的添加与删除</h3><p>在工作簿中添加工作表使用Add方法，如下面的代码所示。</p>
<pre><code class="vb">Sub Addsh() &#39;Addsh过程使用Add方法在工作簿中新建“数据”工作表
    Dim Sh As Worksheet &#39;声明变量Sh为工作表对象
    With Worksheets
        Set Sh = .Add(after:=Worksheets(.Count)) &#39;使用Add方法在工作簿的最后新建“数据”工作表
        Sh.Name = &quot;数据&quot;
    End With
End Sub
Add 方法应用于Sheets和Worksheets对象时新建工作表、图表或宏表，语法如下：
expression.Add(Before, After, Count, Type)
参数Before是可选的，指定工作表对象，新建的工作表将置于此工作表之前。
参数After是可选的，指定工作表对象，新建的工作表将置于此工作表之后。
如果Before和 After两者均省略，则新建的工作表将插入到活动工作表之前。
参数Count可选，要新建的工作表的数目。默认值为 1。
参数Type可选，指定新建的工作表类型。
第5行代码将添加的工作表重命名为“数据”。</code></pre>
<p>如果需要在工作簿中批量添加工作表，可以使用下面的代码。</p>
<pre><code class="vb">Sub Addsh_2()
    Dim i As Integer
    Dim sh As Worksheet
    For i = 1 To 10
        Set sh = Sheets.Add(after:=Sheets(Sheets.Count))
        sh.Name = i
    Next
End Sub
代码解析：
Addsh_2过程使用For...Next 语句和Add方法在工作簿中添加10张工作表并将添加的工作表依次重命名。
在使用以上代码往工作簿中添加工作表时，如果工作簿中已存在相同名称的工作表，运行时会发生错误，代码中断，如图 25 1所示。</code></pre>
<p>图 25 1    运行错误提示<br>为了避免此错误的发生，可以在添加前先删除所有的工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub Delsh()
    Dim sh As Worksheet
    For Each sh In ThisWorkbook.Sheets
        If sh.Name &lt;&gt; &quot;工作表的添加与删除&quot; Then
            Application.DisplayAlerts = False
            sh.Delete
            Application.DisplayAlerts = True
        End If
    Next
End Sub
代码解析：
Delsh过程使用Delete方法删除工作簿中除了“工作表的添加与删除”工作表以外所有的工作表。
第3行代码使用For Each...Next语句遍历代码所在工作簿中所有的工作表。
第4行到第7行代码判断工作表名称是否为“工作表的添加与删除”,如果不是则使用Delete方法删除。其中第5行代码将Application对象的DisplayAlerts属性设置为False，使删除时不显示如图 25 2所示系统警告对话框。
第6行代码使用Delete方法删除工作表，应用于工作表对象的Delete方法删除指定的对象，语法如下：
expression.Delete
参数expression是必需的，该表达式返回“应用于”列表中的对象之一。
在运行添加工作表代码前先删除工作簿中的工作表虽然可以避免同名错误,但也可能误删除有用的工作表,因此更为严谨的方法是在添加前先判断工作簿中是否存在相同名称的工作表,然后再进行下一步的操作。</code></pre>
<p>对于单张工作表可以使用下面的代码。</p>
<pre><code class="vb">Sub Addsh_3()
    Dim Sh As Worksheet
    For Each Sh In Worksheets
        If Sh.Name = &quot;数据&quot; Then
            MsgBox &quot;工作簿中已有&quot;&quot;数据&quot;&quot;工作表,不能重复添加!&quot;
            Exit Sub
        End If
    Next
    With Worksheets
        Set Sh = .Add(after:=Worksheets(.Count))
        Sh.Name = &quot;数据&quot;
    End With
End Sub
代码解析：
Addsh_3过程在使用Add方法在工作簿中新建“数据”工作表时首先判断工作簿中是否存在“数据”工作表，如果已存在“数据”工作表则不运行添加工作表的代码而只显示一个消息框进行提示。

还可以使用错误处理语句来绕过错误，如下面的代码所示。

​```vb
Sub Addsh_4()
    Dim sh As Worksheet
    On Error GoTo line
    With Worksheets
        Set sh = .Add(after:=Worksheets(.Count))
        sh.Name = &quot;数据&quot;
    End With
    Exit Sub
line:
    MsgBox &quot;工作簿中已有&quot;&quot;数据&quot;&quot;工作表,不能重复添加!&quot;
    Application.DisplayAlerts = False
    Worksheets(Worksheets.Count).Delete
    Application.DisplayAlerts = True
End Sub
代码解析：
Addsh_4过程是先使用Add方法在工作簿中新建“数据”工作表，如果工作簿中已存在同名的工作表则使用GoTo语句转移到指定的line行处进行提示并删除已添加还没有重命名的工作表，也就是工作簿中最后一张工作表。</code></pre>
<p>如果是批量添加工作表，使用上述方法时，添加工作表和已有工作表重名时，后面即使没有重名的工作表也不能添加，所以应先使用错误处理语句忽略错误，待全部添加好以后再删除多余的工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub Addsh_5()
    Dim i As Integer, arr
    Dim sh As Worksheet
    On Error Resume Next
    arr = Array(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
    For i = 0 To UBound(arr)
        With Worksheets
            Set sh = .Add(after:=Sheets(.Count))
            sh.Name = arr(i)
        End With
    Next
    Application.DisplayAlerts = False
    For Each sh In Worksheets
        If sh.Name Like &quot;Sheet*&quot; Then sh.Delete
    Next
    Application.DisplayAlerts = True
End Sub
代码解析：
Addsh_5过程使用Add方法在工作簿中添加10张工作表并重新命名为1到10，如果工作簿中已有相同名称的工作表则不添加。
第4行代码错误处理语句，当发生重名错误时忽略错误，继续添加工作表。
第5行到第11行代码在工作簿中添加10张工作表并重新命名为1到10，如果工作簿中已有相同名称的工作表则忽略错误重命名时发生的错误，此时工作簿中添加的工作表会以系统赋与的名称命名，如“Sheet1”。
第12行到第15行代码使用For Each...Next语句遍历工作簿中所有的工作表，将工作簿中凡是以“Sheet”开头的工作表删除。</code></pre>
<h3 id="技巧26-禁止删除指定工作表"><a href="#技巧26-禁止删除指定工作表" class="headerlink" title="技巧26     禁止删除指定工作表"></a>技巧26     禁止删除指定工作表</h3><p>在工作表事件中是没有工作表删除事件的，为了防止用户误删除重要的工作表，除了使用保护工作簿方法外，还可以使用下面的代码。</p>
<pre><code class="vb">Public Ctl As CommandBarControl
Sub DelSht()
    Set Ctl = Application.CommandBars.FindControl(ID:=847)
    Ctl.OnAction = &quot;MyDelSht&quot;
End Sub
Sub ResSht()
    Set Ctl = Application.CommandBars.FindControl(ID:=847)
    Ctl.OnAction = &quot;&quot;
End Sub
Sub MyDelSht()
    If VBA.UCase$(ActiveSheet.CodeName) = &quot;SHEET2&quot; Then
        MsgBox &quot;禁止删除&quot; &amp; ActiveSheet.Name &amp; &quot;工作表!&quot;
    Else
        ActiveSheet.Delete
    End If
End Sub
代码解析：
DelSht过程将工作表标签右键菜单中的“删除工作表”菜单的OnAction属性设置为“MyDelSht”。
第3行代码使用Set语句将工作表标签右键菜单中的“删除工作表”菜单赋给变量Ctl，并将其OnAction属性设置为MyDelSht过程，该菜单被单击时将运行“MyDelSht”过程而不是系统默认的设置。OnAction属性返回或设置一个VBA的过程名，该过程在用户单击或更改某命令栏控件的值时运行。
ResSht过程将工作表标签右键菜单中的“删除工作表”菜单的OnAction属性恢复为默认设置。
MyDelSht过程判断所要删除的工作表的代码名称是否是“SHEET2”，如果是则禁止删除该表而只显示一个提示消息框。</code></pre>
<p>为了不影响其他工作簿的使用，在VBE中双击ThisWorkbook写入下面的代码。</p>
<pre><code class="vb">Private Sub Workbook_Activate()
    Call DelSht
End Sub
Private Sub Workbook_Deactivate()
    Call ResSht
End Sub
代码解析：
工作簿的Activate事件和Deactivate事件代码，在工作簿激活时运行DelSht过程，在关闭或打开其他工作簿时运行ResSht过程，这样只禁止删除本工作簿中“SHEET2”工作表，并不影响其他工作簿。
当删除本工作簿中的“SHEET2”工作表时，并不会显示如图 26 1所示的消息框，而只会显示如图 26 2所示的禁止删除工作表的消息框。</code></pre>
<p>图 26 2    禁止删除工作表</p>
<h3 id="技巧27-自动建立工作表目录"><a href="#技巧27-自动建立工作表目录" class="headerlink" title="技巧27     自动建立工作表目录"></a>技巧27     自动建立工作表目录</h3><p>如果在工作簿中有许多工作表，使用时往往会建立一张目录表并插入超链接以方便选择工作表。但是如果工作簿中的工作表经常添加和删除，使用手工建立目录很不方便，此时可以使用工作表的Activate事件自动建立工作表的目录，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_Activate()
    Dim sh As Worksheet
    Dim a As Integer
    Dim R As Integer
    R = Sheet1.[A65536].End(xlUp).Row
    a = 2
    If Sheet1.Cells(2, 1) &lt;&gt; &quot;&quot; Then
        Sheet1.Range(&quot;A2:A&quot; &amp; R).ClearContents
    End If
    For Each sh In Worksheets
        If sh.CodeName &lt;&gt; &quot;Sheet1&quot; Then
            Sheet1.Cells(a, 1).Value = sh.Name
            a = a + 1
        End If
    Next
End Sub
代码解析：
工作表的Activate事件，在“目录”工作表激活时自动建立工作簿中除“目录”工作表外所有工作表的目录。
第2、3、4行代码声明变量类型。
第5行代码取得A列最后非空单元格的行号。
第6行代码设置变量a的初始值为2，从A2单元格开始建立工作表目录。
第7行到第9行代码判断是否存在工作表目录，如果存在先清空原来的目录，以便更新目录。
第10行到第15代码遍历工作簿的所有工作表，将除“目录”工作表外所有工作表的名称写入到A列单元格中。</code></pre>
<p>为了建立到各工作表的链接，使用工作表的SelectionChange事件，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    Dim R As Integer
    R = Sheet1.[A65500].End(xlUp).Row
    On Error Resume Next
    If Target.Count = 1 Then
       If Target.Column = 1 Then
            If Target.Row &gt; 1 And Target.Row &lt;= R Then
                Sheets(Target.Value).Select
            end if
        end if
    end if
end sub
代码解析：
工作表的selectionchange事件，当选择a列工作表目录中工作表名称时自动选择该单元格所对应的工作表。
第5、6、7行代码限制该事件触发的条件。
第8行代码选择单元格所对应的工作表。
“目录”工作表激活后自动在a列建立工作簿中除“目录”工作表以外所有表的目录，如图 27 1所示。</code></pre>
<p>图 27 1    自动建立工作表目录</p>
<h3 id="技巧28-工作表的深度隐藏"><a href="#技巧28-工作表的深度隐藏" class="headerlink" title="技巧28     工作表的深度隐藏"></a>技巧28     工作表的深度隐藏</h3><p>在使用vba开发的工作簿文件完成交与用户使用后，我们往往希望用户在打开工作簿时启用宏，此时除了使用“禁用宏则关闭工作簿”的功能外，还可以隐藏所有有数据的工作表，如果用户在打开工作簿时禁用宏则只显示一张空白的工作表，达到强制启用宏的效果，代码如下：</p>
<pre><code class="vb">dim sh as worksheet
private sub workbook_beforeclose(cancel as boolean)
    sheet1.visible = true
    for each sh in thisworkbook.sheets
        if sh.name &lt;&gt; &quot;空白&quot; then
            sh.visible = xlsheetveryhidden
        end if
    next
    activeworkbook.save
end sub
private sub workbook_open()
    for each sh in thisworkbook.sheets
        if sh.name &lt;&gt; &quot;空白&quot; then
              sh.Visible = xlSheetVisible
        End If
    Next
    Sheet1.Visible = xlSheetVeryHidden
End Sub
代码解析：
第2行到第10行代码是工作簿的BeforeClose事件过程，在工作簿关闭前隐藏除“空白”表以外的所有的工作表。
第3行代码将“空白”表的Visible属性设置为True，使其可见。
应用于Charts和Worksheets对象的Visible属性决定对象是否可见，语法如下：
expression.Visible
参数expression是必需的，该表达式返回上面的对象之一。
Visible属性可以设置为表格 28 1所示的XlSheetVisibility常量之一。</code></pre>
<p>常量    值    描述<br>xlSheetHidden    0    隐藏对象，可以通过“格式”→“工作表”→“取消隐藏”菜单使对象重新可见，等同于设置为False。<br>xlSheetVisible    -1    使对象重新可见，等同于设置为True。<br>xlSheetVeryHidden    2    隐藏对象，使该对象重新可见的唯一方法是将此属性设置为True或xlSheetVisible。<br>表格 28 1    XlSheetVisibility常量<br>第4行到第8行代码使用For Each…Next语句遍历工作簿中所有的工作表，将除“空白”表以外的所有工作表的Visible属性设置为xlSheetVeryHidden，使之隐藏。<br>Visible属性设置为xlSheetVeryHidden后工作表不能通过“格式”→“工作表”→“取消隐藏”菜单来显示隐藏的工作表。<br>第9行代码使用Save方法保存代码所在工作簿的更改，在关闭工作簿时不显示如图 28 1所示的消息框。</p>
<p>图 28 1    工作簿保存提示<br>第10行到第18行代码是工作簿的Open事件过程，在打开工作簿时将除“空白”表以外的所有工作表的Visible属性设置为xlSheetVisible，取消隐藏。如果打开工作簿时禁用宏，则工作簿中除了“空白”表以外，其他的工作表还处于深度隐藏的状态，如图 28 2所示，这样就达到强制用户启用宏的效果，当然这还需要VBA工程保护的配合。</p>
<p>图 28 2    工作表深度隐藏</p>
<h3 id="技巧29-防止更改工作表的名称"><a href="#技巧29-防止更改工作表的名称" class="headerlink" title="技巧29     防止更改工作表的名称"></a>技巧29     防止更改工作表的名称</h3><p>工作表的名称显示在工作表标签上，除了在相应的功能菜单中可以对其进行重命名操作外，在工作表标签上双击鼠标也能修改工作表名称。一旦修改了工作表名称，可能就会产生一连串的问题，例如在其他工作簿中对该工作表的引用将会失效，通过工作表名称引用工作表的代码也将出错。<br>Excel没有提供修改工作表名称的相关事件，要禁止用户修改工作表名称，需采取其他一些技巧。比如在工作表BeforeClose事件中检验工作表名称，如果工作表名称不是指定的字符串，则将其修改为指定字符串，即保持工作表名称不变，代码如下。</p>
<pre><code class="vb">Private Sub Workbook_BeforeClose(Cancel As Boolean)
    If Sheet1.Name &lt;&gt; &quot;Excel Home&quot; Then Sheet1.Name = &quot;Excel Home&quot;
    ThisWorkbook.Save
End Sub
代码解析：
工作簿的BeforeClose事件过程，在关闭当前工作簿时判断Sheet1工作表名称，如果不是指定的字符串“Excel Home”，则将其恢复为“Excel Home”后保存工作簿，从而避免更改Sheet1工作表名称。</code></pre>
<h3 id="技巧30-工作表中一次插入多行"><a href="#技巧30-工作表中一次插入多行" class="headerlink" title="技巧30     工作表中一次插入多行"></a>技巧30     工作表中一次插入多行</h3><p>在工作表的中插入多行空行，需要使用Insert方法，如下面的代码所示。</p>
<pre><code class="vb">Sub InSertRows_1()
    Dim i As Integer
    For i = 1 To 3
        Sheet1.Rows(3).Insert
    Next
End Sub
代码解析：
InSertRows_1过程使用Insert方法在如图 30 1所示的数据区域的第2行和第3行之间插入三行空行。
Insert方法应用于Range对象时在工作表或宏表中插入一个单元格或单元格区域，其他单元格作相应移位以腾出空间，语法如下：
expression.Insert(Shift, CopyOrigin)
参数expression是必需的，该表达式返回一个Range对象。
参数Shift是可选的，指定单元格的移动方向。可为以下XlInsertShiftDirection常量之一：xlShiftToRight或xlShiftDown。如果省略本参数，Microsoft Excel将依据该区域的形状决定移动方向。
参数CopyOrigin是可选的，复制的起点。</code></pre>
<p>还可以使用引用多行的方法，如下面的代码所示。</p>
<pre><code class="vb">Sub InSertRows_2()
    Sheet2.Range(&quot;A3&quot;).EntireRow.Resize(3).Insert
End Sub
代码解析：
InSertRows_2过程通过引用多行区域的方法实现一次插入多行。
第2行代码中的Range(“A3”).EntireRow属性返回Range(“A3”)单元格所在的一整行，然后使用Resize属性调整行数后插入三行空行。
也可以直接指定相应行再调整行数后插入空行，如下面的示例代码：
Sub InSertRows_3()
    Sheet3.Rows(3).Resize(3).Insert
End Sub
运行以上过程，工作表中如图 30 2所示。</code></pre>
<p>图 30 2    插入三行空行</p>
<h3 id="技巧31-删除工作表中的空行"><a href="#技巧31-删除工作表中的空行" class="headerlink" title="技巧31     删除工作表中的空行"></a>技巧31     删除工作表中的空行</h3><p>如果需要删除如图 31 1所示的工作表中所有的空行，可以使用下面的代码。</p>
<p>图 31 1    需删除空行的工作表区域</p>
<pre><code class="vb">Sub DelBlankRow() &#39;DelBlankRow过程删除工作表中已使用的区域的所有空行。
    Dim rRow As Long
    Dim LRow As Long
    Dim i As Long
    rRow = Sheet1.UsedRange.Row &#39;获得工作表中已使用区域的首行行号，其中使用UsedRange属性返回工作表中已使用的区域
    LRow = rRow + Sheet1.UsedRange.Rows.Count - 1 &#39;获得工作表中已使用区域的最后一行行号
    For i = LRow To rRow Step -1 &#39;从最大行数至最小行数循环判断指定行是否为空行，若为空行则删除该行
        If Application.WorksheetFunction.CountA(Rows(i)) = 0 Then
            Rows(i).Delete
        End If
    Next
End Sub
注意 此处一定要从最大行数至最小行数开始循环判断，因为如果工作表中存在两行及两行以上的相邻空行，从最小行数开始循环删除的话，当第一行空行被删除后，被删除行下面的一行会往上移位，而此时For...Next循环的计数器已经加1，所以会出现漏删除的现象。
其中第8、9行代码使用工作表CountA函数判断当前行已使用单元格的数量，如果为零说明此行是空行则使用Delete删除。
应用于Range对象的Delete方法删除对象，语法如下：
expression.Delete(Shift)
参数expression是必需的，返回一个Range对象。
参数Shift是可选的，指定删除单元格时替补单元格的移位方式。可为以下 XlDeleteShiftDirection常量之一：xlShiftToLeft或xlShiftUp。如果省略该参数，则Microsoft Excel将根据区域的图形决定移位方式。
运行DelBlankRow过程工作表区域如图 31 2所示。</code></pre>
<h3 id="技巧32-删除工作表的重复行"><a href="#技巧32-删除工作表的重复行" class="headerlink" title="技巧32     删除工作表的重复行"></a>技巧32     删除工作表的重复行</h3><p>在实际应用中，可能需要删除如图 32 1所示的工作表中A列的重复内容而只保留一行，那么可以借助工作表CountIf函数来完成，如下面的代码所示。</p>
<p>图 32 1    需删除重复行的工作表区域</p>
<pre><code class="vb">Sub DeleteRow()
    Dim R As Integer
    Dim i As Integer
    With Sheet1
        R = .[a65536].End(xlUp).Row
        For i = R To 1 Step -1
            If WorksheetFunction.CountIf(.Columns(1), .Cells(i, 1)) &gt; 1 Then
                .Rows(i).Delete
            End If
        Next
    End With
End Sub
代码解析：
DeleteRow过程删除工作表A列重复单元格所在的整行内容，只保留一行。
第5行代码取得工作表中A列的最后一个非空单元格的行号，关于Range对象的End属性请参阅技巧3 。
第6行到第10行代码从最大行数至最小行数循环判断A列单元格内容是否重复并删除重复单元格所在的整行。和技巧32 一样，此处For...Next循环也要从最大行数至最小行数开始循环判断，否则可能会删除不净。其中第7、8行代码使用工作表CountIf函数判断单元格内容是否重复，如果重复则删除该单元格所在的行。</code></pre>
<p>图 32 2    删除重复行的工作表区域</p>
<h3 id="技巧33-定位删除特定内容所在的行"><a href="#技巧33-定位删除特定内容所在的行" class="headerlink" title="技巧33     定位删除特定内容所在的行"></a>技巧33     定位删除特定内容所在的行</h3><p>如果需要删除如图 33 1所示的工作表区域中特定内容所在的行，可以使用定位的方法快速删除，无需使用For…Next循环对单元格逐个进行判断。</p>
<p>图 33 1    需删除的工作表区域<br>示例代码如下：</p>
<pre><code class="vb">Sub SpecialDelete()
    Dim R As Integer
    With Sheet1
        R = .Range(&quot;a65536&quot;).End(xlUp).Row
        .Range(&quot;a2:a&quot; &amp; R).Replace &quot;Excel&quot;, &quot;&quot;, 2
        .Columns(1).SpecialCells(4).EntireRow.Delete
    End With
End Sub
代码解析：
SpecialDelete过程删除工作表A列单元格中显示为“Excel”的行。
第5行代码使用Replace方法将工作表A列中显示为“Excel”的单元格内容替换成空白。关于Replace方法请参阅技巧6 。
第6行代码使用SpecialCells方法定位到工作表A列中所有的空单元格，使用Range对象的EntireRow属性返回其所在的整个行一次性删除。关于SpecialCells方法请参阅技巧4 。
运行SpecialDelete过程工作表区域如图 33 2所示。</code></pre>
<h3 id="技巧34-判断是否选中整行"><a href="#技巧34-判断是否选中整行" class="headerlink" title="技巧34     判断是否选中整行"></a>技巧34     判断是否选中整行</h3><p>通过当前选择的单元格区域的单元格数目与行数或列数相比较，判断用户是否选中了整行或整列，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Rows.Count = 1 Then
        If Target.Columns.Count = 256 Then
            MsgBox &quot;您选中了整行,当前行号&quot; &amp; Target.Row
        End If
    End If
End Sub
代码解析：
工作表的SelectionChange事件，判断用户是否选中了工作表中一整行单元格区域。
第2行代码中的Target.Rows.Count返回目标区域的行数，确定用户当前选择区域的总行数是否为1。
第3行代码中的Target.Columns.Count返回目标区域的列数，确定用户当前选择区域总列数是否为256。
第4行代码当用户选中一整行时显示一个消息框，提示用户当前选择的行号，如图 34 1所示。
如果需要判断是否选中了整列，只需将上面代码中的总行数修改为65536，总列数修改为1。</code></pre>
<h3 id="技巧35-限制工作表的滚动区域"><a href="#技巧35-限制工作表的滚动区域" class="headerlink" title="技巧35     限制工作表的滚动区域"></a>技巧35     限制工作表的滚动区域</h3><p>如果希望限制工作表中滚动的区域，可以通过设置WorkSheet对象的ScrollArea属性来实现。ScrollArea属性使用以A1样式的区域引用形式（字符串类型）返回或设置工作表允许滚动的区域。当设置了工作表滚动区域之后，用户不能选定滚动区域之外的单元格，但仍然可以选定区域之外的其他对象（例如图形、按钮等），同时工作表的一些相应功能可能被禁止（例如工作表全选、选中整行或整列等）。<br>在VBE中的工程管理窗口选择相应工作表对象，然后在其属性窗口中设置ScrollArea属性，即可限制工作表中滚动的区域，如图 35 1所示。</p>
<p>图 35 1    设置ScrollArea属性<br>但是Excel不会记忆该项设置，当再次打开该工作簿时，ScrollArea属性将被重置，用户必须重新设置ScrollArea属性才能限制工作表中的滚动区域，解决方法是使用代码在工作簿打开时对ScrollArea属性进行设置，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Workbook_Open()
    Sheet1.ScrollArea = &quot;B4:H12&quot;
End Sub
代码解析：
工作簿的Open事件，在打开该工作簿时设置Sheet1工作表的滚动区域为“B4:H12”单元格区域。
如果需要取消滚动区域的限制，可以将ScrollArea属性值设置为空，如下面的代码所示。
Sheet1.ScrollArea = &quot;&quot;</code></pre>
<h3 id="技巧36-复制自动筛选后的数据区域"><a href="#技巧36-复制自动筛选后的数据区域" class="headerlink" title="技巧36     复制自动筛选后的数据区域"></a>技巧36     复制自动筛选后的数据区域</h3><p>用户在对如图 36 1所示的数据列表进行自动筛选后，往往希望将自动筛选的结果复制到其它地方。</p>
<p>图 36 1    筛选结果<br>这时可以通过获取该列表区域中可见单元格的方法得到筛选结果的单元格区域，并复制到工作表Sheet2中，如下面的代码所示。</p>
<pre><code class="vb">Sub CopyFilter() &#39;将Sheet1表中的筛选结果复制到工作表Sheet2中
    Sheet2.Cells.Clear &#39;清除Sheet2表中数据
    With Sheet1
        If  .FilterMode Then &#39;判断Sheet1表是否处于自动筛选状态
            .AutoFilter.Range.SpecialCells(12).Copy Sheet2.Cells(1, 1)
        End If
    End With
End Sub
FilterMode属性返回工作表是否处于筛选模式，如果指定工作表中包含已筛选序列且该序列中含有隐藏行，则该值为True。
第5行代码通过AutoFilter对象的Range属性返回工作表的自动筛选列表区域，再使用SpecialCells方法获取该列表区域中可见单元格（SpecialCells方法请参阅技巧4 ），得到筛选结果的单元格区域，然后使用Copy方法将结果区域复制到工作表Sheet2中，应用于Range对象的Copy方法将单元格区域复制到指定的区域或剪贴板中，语法如下：
expression.Copy(Destination)
参数expression是必需的，该表达式返回一个Range对象。
参数Destination是可选的，指定区域要复制到的目标区域。如果省略该参数，则将该区域复制到剪贴板中。</code></pre>
<p>图 36 2    复制筛选区域</p>
<h3 id="技巧37-使用高级筛选获得不重复记录"><a href="#技巧37-使用高级筛选获得不重复记录" class="headerlink" title="技巧37     使用高级筛选获得不重复记录"></a>技巧37     使用高级筛选获得不重复记录</h3><p>在如图 37 1所示的数据列表中，如果要将其中不重复的记录复制到另一工作表中，则可以通过高级筛选功能实现。</p>
<p>图 37 1    数据列表<br>示例代码如下：</p>
<pre><code class="vb">Sub Filter()
    Sheet1.Range(&quot;A1&quot;).CurrentRegion.AdvancedFilter _
        Action:=xlFilterCopy, Unique:=True, _
        CopyToRange:=Sheet2.Range(&quot;A1&quot;)
End Sub
代码解析：
Filter过程使用AdvancedFilter方法对单元格A1的当前区域筛选不重复的记录，并将筛选结果复制到工作表Sheet2中。应用于Range集合的AdvancedFilter方法语法如下：
AdvancedFilter(Action, CriteriaRange, CopyToRange, Unique)
参数Action是必需的，可以为表格 37 1所列的XlFilterAction常量之一。
XlFilterAction 常量    值    描述
xlFilterCopy    2    将筛选结果复制到其他位置
xlFilterInPlace    1    在原有区域显示筛选结果
表格 37 1    XlFilterAction常量
参数CriteriaRange指定高级筛选操作的条件区域，缺省时表示没有条件限制。
参数CopyToRange表示指定被复制行的目标区域，仅当Action为xlFilterCopy时有效，否则忽略本参数。
参数Unique指示是否选择不重复的记录，如果其值为True，则重复出现的记录仅保留一条；如果其值为 False（默认值），则筛选出所有符合条件的记录。
运行FilterUnique过程，结果如图 37 2所示。</code></pre>
<p>图 37 2    得到不重复记录结果</p>
<h3 id="技巧38-工作表的保护与解除保护"><a href="#技巧38-工作表的保护与解除保护" class="headerlink" title="技巧38     工作表的保护与解除保护"></a>技巧38     工作表的保护与解除保护</h3><p>在在实际应用中，Excel编制的报表、表格、程序等，往往在单元格中设置了公式、函数、自定义格式等，为了防止在使用过程中修改或无意中修改这些设置，一般使用Excel的工作表保护功能来保护这些设置。<br>但是程序中可能会使用代码对受保护的工作表进行操作，此时如果没有解除工作表保护，运行出现错误，如图 38 1所示。</p>
<p>图 38 1    运行错误提示<br>解决方法是在运行操作工作表的代码前先使用代码解除工作表保护，待操作完毕后再保护工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub ShProtect()
    With Sheet1
        .Unprotect Password:=&quot;12345&quot;
        .Cells(1, 1) = 100
        .Protect Password:=&quot;12345&quot;
    End With
End Sub
代码解析：
ShProtect过程在受保护的工作表中对单元格进行操作，其中第3行代码使用Unprotect方法解除工作表的保护。应用于Worksheet 对象的Unprotect方法解除工作表的保护，如果工作表不是受保护的，则此方法不起作用，所以在解除之前无需判断工作表是否受保护，其语法如下：
expression.Unprotect(Password)
参数expression是必需的，该表达式返回一个Worksheet 对象。
参数Password是可选的，指定用于解除工作表的保护的密码，此密码是区分大小写的。
第4、5行代码在单元格录入数据后使用Protect方法重新保护工作表。应用于Worksheet对象的Protect方法保护工作表使其不至被修改，语法如下：
expression.Protect(Password, DrawingObjects, Contents, Scenarios, UserInterfaceOnly, AllowFormattingCells, AllowFormattingColumns, AllowFormattingRows, AllowInsertingColumns, AllowInsertingRows, AllowInsertingHyperlinks, AllowDeletingColumns, AllowDeletingRows, AllowSorting, AllowFiltering, AllowUsingPivotTables) 
其中参数expression是必需的，该表达式返回一个Worksheet对象。
参数Password是可选的，为一个字符串，该字符串为工作表指定区分大小写的密码。
其他参数都是可选参数，其功能等同于如图 38 2所示的工作表保护对话框中的各项选项，具体请参阅VBA帮助。</code></pre>
<p>如果一个Excel文件使用时间过长，忘记了工作表保护时设置的密码，那么也可以使用VBA解除工作表的保护，代码如下：</p>
<pre><code class="vb">Sub RemoveShProtect()
    Dim i1 As Integer, i2 As Integer, i3 As Integer
    Dim i4 As Integer, i5 As Integer, i6 As Integer
    Dim i7 As Integer, i8 As Integer, i9 As Integer
    Dim i10 As Integer, i11 As Integer, i12 As Integer
    On Error Resume Next
    If ActiveSheet.ProtectContents = False Then
        MsgBox &quot;该工作表没有保护密码！&quot;
        Exit Sub
    End If
    For i1 = 65 To 66: For i2 = 65 To 66: For i3 = 65 To 66
    For i4 = 65 To 66: For i5 = 65 To 66: For i6 = 65 To 66
    For i7 = 65 To 66: For i8 = 65 To 66: For i9 = 65 To 66
    For i10 = 65 To 66: For i11 = 65 To 66: For i12 = 32 To 126
        ActiveSheet.Unprotect Chr(i1) &amp; Chr(i2) &amp; Chr(i3) &amp; Chr(i4) &amp; Chr(i5) _
        &amp; Chr(i6) &amp; Chr(i7) &amp; Chr(i8) &amp; Chr(i9) &amp; Chr(i10) &amp; Chr(i11) &amp; Chr(i12)
        If ActiveSheet.ProtectContents = False Then
            MsgBox &quot;已经解除了工作表保护！&quot;
            Exit Sub
        End If
    Next: Next: Next: Next: Next: Next
    Next: Next: Next: Next: Next: Next
End Sub
代码解析：
RemoveShProtect过程解除工作表的保护。
其中第7行到第10行代码判断工作表是否受保护，ProtectContents属性返回工作表的保护状态，如果工作表的内容处于保护状态，则该值为True。
第11行到第22行代码使用For...Next 语句和Chr函数来返回指定字符码所代表的字符串组合不断地尝试解除工作表保护，一旦工作表的ProtectContents属性返回False说明已经解除工作表保护。</code></pre>
<h3 id="技巧39-奇偶页打印"><a href="#技巧39-奇偶页打印" class="headerlink" title="技巧39     奇偶页打印"></a>技巧39     奇偶页打印</h3><p>在Excel中却没有提供打印奇数页和偶数页的功能，用户可以使用VBA在Excel中实现该功能，如下面的代码所示。</p>
<pre><code class="vb">Sub PrintOddPage()
    Dim TotalPg As Integer
    TotalPg = ExecuteExcel4Macro(&quot;GET.DOCUMENT(50)&quot;)
    For i = 1 To TotalPg Step 2
        ActiveSheet.PrintOut From:=i, To:=i
    Next
End Sub
代码解析：
第3行代码使用Excel 4.0宏表函数获取总页数，通过该函数获取总页数而无需判断分页符。
第4行到第6行代码逐页打印所有奇数页，其中第5行代码中的参数From和To指定打印的开始页数和结束页数。
将第4行代码中的数值改为2，则实现偶数页的打印。</code></pre>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">VBA</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/05/07/VBA常用技巧2--Worksheet(工作表对象)/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-VBA常用技巧1--Range(单元格对象)" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/05/VBA常用技巧1--Range(单元格对象)/">VBA常用技巧1--Range(单元格对象)</a>
    </h1>
  

        
        <a href="/2018/05/05/VBA常用技巧1--Range(单元格对象)/" class="archive-article-date">
  	<time datetime="2018-05-04T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-05-05</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>VBA常用技巧集锦，方便查找使用。</p>
<h2 id="第1章-Range（单元格）对象"><a href="#第1章-Range（单元格）对象" class="headerlink" title="第1章     Range（单元格）对象"></a>第1章     Range（单元格）对象</h2><h3 id="技巧1-单元格的引用方法"><a href="#技巧1-单元格的引用方法" class="headerlink" title="技巧1     单元格的引用方法"></a>技巧1     单元格的引用方法</h3><p>在VBA中经常需要引用单元格或单元格区域区域，主要有以下几种方法。</p>
<h4 id="1-1-使用Range属性"><a href="#1-1-使用Range属性" class="headerlink" title="1-1    使用Range属性"></a>1-1    使用Range属性</h4><p>VBA中可以使用Range属性返回单元格或单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Sub RngSelect()    &#39;RngSelect过程使用Select方法选中A3:F6，B1:C5单元格区域。
    Sheet1.Range(&quot;A3:F6, B1:C5&quot;).Select
End Sub
Range属性返回一个Range对象，该对象代表一个单元格或单元格区域，语法如下：
Range(Cell1, Cell2)
参数Cell1是必需的，必须为 A1 样式引用的宏语言，可包括区域操作符（冒号）、相交区域操作符（空格）或合并区域操作符（逗号）。也可包括美元符号（即绝对地址，如“$A$1”）。可在区域中任一部分使用局部定义名称，如Range(&quot;B2:LastCell&quot;)，其中LastCell为已定义的单元格区域名称。
参数Cell2是可选的，区域左上角和右下角的单元格。
运行Sub RngSelect过程，选中A3:F6, B1:C5单元格区域，如图 1 1所示。
注意 如果没有使用对象识别符，Range属性返回活动表的一个区域，如果活动表不是工作表，则该属性无效。</code></pre>
<h4 id="1-2-使用Cells属性"><a href="#1-2-使用Cells属性" class="headerlink" title="1-2    使用Cells属性"></a>1-2    使用Cells属性</h4><p>使用Cells属性返回一个Range对象，如下面的代码所示。</p>
<pre><code class="vb">Sub Cell()
    For icell = 1 To 100
    Sheet2.Cells(icell, 1).Value = icell
    Next
End Sub
代码解析：
Cell过程使用For...Next语句为工作表中的A1:A100单元格区域填入序号。
Cells属性指定单元格区域中的单元格，语法如下：
Cells(RowIndex, ColumnIndex)
参数RowIndex是可选的，表示引用区域中的行序号。
参数ColumnIndex是可选的，表示引用区域中的列序号。
如果缺省参数，Cells属性返回引用对象的所有单元格。
Cells属性的参数可以使用变量，因此经常应用于在单元格区域中循环。</code></pre>
<h4 id="1-3-使用快捷记号"><a href="#1-3-使用快捷记号" class="headerlink" title="1-3    使用快捷记号"></a>1-3    使用快捷记号</h4><p>在VBA中可以将A1引用样式或命名区域名称使用方括号括起来，作为Range属性的快捷方式，这样就不必键入单词“Range”或使用引号，如下面的代码所示。</p>
<pre><code class="vb">Sub Fastmark() &#39;Fastmark过程使用快捷记号为单元格区域赋值。
     [A1：A5] = 2 &#39;使用快捷记号将活动工作表中的A1：A5单元格赋值为2
     [Fast] = 4 &#39;将工作簿中已命名为“Fast”的单元格区域赋值为4。
End Sub
注意 使用快捷记号引用单元格区域时只能使用固定字符串而不能使用变量。</code></pre>
<h4 id="1-4-使用Offset属性"><a href="#1-4-使用Offset属性" class="headerlink" title="1-4    使用Offset属性"></a>1-4    使用Offset属性</h4><p>可以使用Range对象的Offset属性返回一个基于引用的Range对象的单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Sub Offset()
    Sheet3.Range(&quot;A1:C3&quot;).Offset(3, 3).Select &#39;Offset过程使用Range对象的Offset属性选中A1：A3单元格偏移三行三列后的区域。
End Sub
应用于Range对象的Offset 属性的语法如下：
expression.Offset(RowOffset, ColumnOffset)
参数expression是必需的，该表达式返回一个Range对象。
参数RowOffset是可选的，区域偏移的行数（正值、负值或 0（零））。正值表示向下偏移，负值表示向上偏移，默认值为 0。
参数ColumnOffset是可选的，区域偏移的列数（正值、负值或 0（零））。正值表示向右偏移，负值表示向左偏移，默认值为 0。
运行Offset过程，选中A1：A3单元格偏称三行三列后的区域，如图 1 2所示。</code></pre>
<h4 id="1-5-使用Resize属性"><a href="#1-5-使用Resize属性" class="headerlink" title="1-5    使用Resize属性"></a>1-5    使用Resize属性</h4><p>使用Range对象的Resize属性调整指定区域的大小，并返回调整大小后的单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Sub Resize() &#39;使用Range对象的Resize属性选中A1单元格扩展为三行三列后的区域
    Sheet4.Range(&quot;A1&quot;).Resize(3, 3).Select
End Sub
Resize属性的语法如下：
expression.Resize(RowSize, ColumnSize)
参数expression是必需的，返回要调整大小的Range 对象
参数RowSize是可选的，新区域中的行数。如果省略该参数，则该区域中的行数保持不变。
参数ColumnSize是可选的，新区域中的列数。如果省略该参数。则该区域中的列数保持不变。
运行Resize过程，选中A1单元格扩展为三行三列后的区域，如图 1 3所示。</code></pre>
<h4 id="1-6-使用Union方法"><a href="#1-6-使用Union方法" class="headerlink" title="1-6    使用Union方法"></a>1-6    使用Union方法</h4><p>使用Union方法可以将多个非连续区域连接起来成为一个区域，从而可以实现对多个非连续区域一起进行操作，如下面的代码所示。</p>
<pre><code class="vb">Sub UnSelect() &#39;UnSelect过程选择单元格A1:D4和E5:H8所组成的区域
    Union(Sheet5.Range(&quot;A1:D4&quot;), Sheet5.Range(&quot;E5:H8&quot;)).Select
End Sub
Union方法返回两个或多个区域的合并区域，语法如下：
expression.Union(Arg1, Arg2, ...)
其中参数expression是可选的，返回一个Application对象。
参数Arg1, Arg2, ...是必需的，至少指定两个Range对象。
运行UnSelect过程，选中单元格A1:D4和E5:H8所组成的区域，如图 1 4所示。 </code></pre>
<h4 id="1-7-使用UsedRange属性"><a href="#1-7-使用UsedRange属性" class="headerlink" title="1-7    使用UsedRange属性"></a>1-7    使用UsedRange属性</h4><p>使用UsedRange属性返回指定工作表上已使用单元格组成的区域，如下面的代码所示。</p>
<pre><code class="vb">Sub UseSelect()
    Sheet6.UsedRange.Select
End Sub
代码解析：
UseSelect过程使用UsedRange属性选择工作表上已使用单元格组成的区域，包括空单元格。如工作表中已使用A1单元格和D8单元格，运行UseSelect过程将选择A1到D8单元格区域</code></pre>
<h4 id="1-8-使用CurrentRegion属性"><a href="#1-8-使用CurrentRegion属性" class="headerlink" title="1-8    使用CurrentRegion属性"></a>1-8    使用CurrentRegion属性</h4><p>使用CurrentRegion属性返回指定工作表上当前的区域，如下面的代码所示。</p>
<pre><code class="vb">Sub CurrentSelect()
    Sheet7.Range(&quot;F12&quot;).CurrentRegion.Select
End Sub
代码解析：
CurrentSelect过程使用CurrentRegion属性选择工作表上A5单元格当前的区域，当前区域是一个边缘是任意空行和空列组合成的范围。
运行CurrentSelect过程将选择A5到B6单元格区域</code></pre>
<h3 id="技巧2-选定单元格区域的方法"><a href="#技巧2-选定单元格区域的方法" class="headerlink" title="技巧2     选定单元格区域的方法"></a>技巧2     选定单元格区域的方法</h3><h4 id="2-1-使用Select方法"><a href="#2-1-使用Select方法" class="headerlink" title="2-1    使用Select方法"></a>2-1    使用Select方法</h4><p>在VBA中一般使用Select方法选定单元格或单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Sub RngSelect() &#39;RngSelect过程使用Select方法选定Sheet3中的A1：B10单元格区域
    Sheet3.Activate
    Sheet3.Range(&quot;A1：B10&quot;).Select
End Sub
Select方法应用于Range对象时语法如下：
expression.Select(Replace)
参数expression是必需的，一个有效的对象。
参数Replace是可选的，要替换的对象。
使用Select方法选定单元格时，单元格所在的工作表必需为活动工作表，所以在第2行代码中先使用Activate方法使Sheet3成为活动工作表，否则Select方法有可能出错</code></pre>
<h4 id="2-2-使用Activate方法"><a href="#2-2-使用Activate方法" class="headerlink" title="2-2    使用Activate方法"></a>2-2    使用Activate方法</h4><p>还可以使用Activate方法选定单元格或单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Sub RngActivate() &#39;RngActivate过程使用Activate方法选定Sheet3中的A1：B10单元格区域
    Sheet3.Activate
    Sheet3.Range(&quot;A1:B10&quot;).Activate
End Sub
Activate方法应用于Range对象时语法如下：
expression.Activate
使用Activate方法选定单元格时，单元格所在的工作表也必需为活动工作表，否则Activate方法有可能出错，显示如图 2 2所示的错误提示。</code></pre>
<h4 id="2-3-使用Goto方法"><a href="#2-3-使用Goto方法" class="headerlink" title="2-3    使用Goto方法"></a>2-3    使用Goto方法</h4><p>使用Goto方法无需使单元格所在的工作表成为活动工作表，如下面的代码所示。</p>
<pre><code class="vb">Sub RngGoto() &#39;RngGoto过程使用Goto方法选定Sheet3中的A1：B10单元格区域，并滚动工作表以显示该单元格
    Application.Goto Reference:=Sheet3.Range(&quot;A1：B10&quot;), scroll:=True
End Sub
Goto方法选定任意工作簿中的任意区域或任意Visual Basic过程，并且如果该工作簿未处于活动状态，就激活该工作簿，语法如下：
expression.Goto(Reference, Scroll)
参数expression是必需的，返回一个Application 对象。
参数Reference是可选的，Variant类型，指定目标。可以是Range对象、包含R1C1-样式记号的单元格引用的字符串或包含 Visual Basic 过程名的字符串。如果省略本参数，目标将是最近一次用Goto方法选定的区域。
参数Scroll是可选的，Variant类型，如果该值为True，则滚动窗口直至目标区域的左上角单元格出现在窗口的左上角。如果该值为False，则不滚动窗口。默认值为False。</code></pre>
<h3 id="技巧3-获得指定行、列中的最后一个非空单元格"><a href="#技巧3-获得指定行、列中的最后一个非空单元格" class="headerlink" title="技巧3     获得指定行、列中的最后一个非空单元格"></a>技巧3     获得指定行、列中的最后一个非空单元格</h3><p>使用VBA对工作表进行操作时，经常需要定位到指定行或列中最后一个非空单元格，此时可以使用Range对象的End属性，在取得单元格对象后便能获得该单元格的相关属性，如单元格地址、行列号、数值等，如下面的代码所示。</p>
<pre><code class="vb">Sub LastRow() &#39;LastRow过程使用消息框显示工作表中A列最后非空单元格的地址、行号和数值
    Dim rng As Range
    Set rng = Sheet1.Range(&quot;A65536&quot;).End(xlUp)
    MsgBox &quot;A列中最后一个非空单元格是&quot; &amp; rng.Address(0, 0) _
    &amp; &quot;,行号&quot; &amp; rng.Row &amp; &quot;,数值&quot; &amp; rng.Value
    Set rng = Nothing
End Sub
End属性返回一个Range对象，该对象代表包含源区域的区域尾端的单元格。等同于按键&lt;End+向上键&gt;、&lt;End+向下键&gt;、&lt;End+向左键&gt;或&lt;End+向右键&gt;，语法如下：
expression.End(Direction)
参数expression是必需的，一个有效的对象。
参数Direction是可选的，所要移动的方向，可以为表格 3 1所示的XlDirection 常量之一。
常量    值    描述
xlDown    -4121    向下
xlToRight    -4161    向右
xlToLeft    -4159    向左
xlUp    -4162    向上
表格 3 1    XlDirection 常量
Range对象的End属性返回的是一个Range对象，因此可以直接使用该对象的属性和方法。</code></pre>
<p>通过修改相应的参数，能够获得指定行中最后一个非空单元格，如下面的代码所示。</p>
<pre><code class="vb">Sub LastColumn() &#39;LastColumn过程使用消息框显示工作表中第一行最后一个非空单元格的地址、列号和数值
    Dim rng As Range
    Set rng = Sheet1.Range(&quot;IV1&quot;).End(xlToLeft)
    MsgBox &quot;第一行中最后一个非空单元格是&quot; &amp; rng.Address(0, 0) _
    &amp; &quot;,列号&quot; &amp; rng.Column &amp; &quot;,数值&quot; &amp; rng.Value
    Set rng = Nothing
End Sub</code></pre>
<h3 id="技巧4-定位单元格"><a href="#技巧4-定位单元格" class="headerlink" title="技巧4     定位单元格"></a>技巧4     定位单元格</h3><p>在Excel中使用定位对话框可以选中工作表中特定的单元格区域，而在VBA中则使用SpecialCells方法，如下面的代码所示。</p>
<pre><code class="vb">Sub SpecialAddress() &#39;SpecialAddress过程使用SpecialCells方法选中工作表中有公式的单元格，并用消息框显示其地址。
    Dim rng As Range
    Set rng = Sheet1.UsedRange.SpecialCells(xlCellTypeFormulas) &#39;返回的是含有公式的单元格，通过修改相应的参数可以返回不同的单元格
    rng.Select
    MsgBox &quot;工作表中有公式的单元格为： &quot; &amp; rng.Address &#39;SpecialCells方法返回的是Range对象，因此可以直接使用该对象的属性和方法。
    Set rng = Nothing
End Sub
SpecialCells方法返回一个Range对象，该对象代表与指定类型及值相匹配的所有单元格，语法如下：
expression.SpecialCells(Type, Value)
参数expression是必需的，返回一个有效的对象。</code></pre>
<p>参数Type是必需的，要包含的单元格，可为表格 4 1所列的XlCellType常量之一。<br>常量    值    描述<br>xlCellTypeAllFormatConditions    -4172    任意格式单元格<br>xlCellTypeAllValidation    -4174    含有验证条件的单元格<br>xlCellTypeBlanks    4    空单元格<br>xlCellTypeComments    -4144    含有注释的单元格<br>xlCellTypeConstants    2    含有常量的单元格<br>xlCellTypeFormulas    -4123    含有公式的单元格<br>xlCellTypeLastCell    11    使用区域中最后的单元格<br>xlCellTypeSameFormatConditions    -4173    含有相同格式的单元格<br>xlCellTypeSameValidation    -4175    含有相同验证条件的单元格<br>xlCellTypeVisible    12    所有可见单元格<br>表格 4 1    XlCellType常量<br>参数Value是可选的，如果Type参数为xlCellTypeConstants或xlCellTypeFormulas， 此参数可用于确定结果中应包含哪几类单元格。将某几个值相加可使此方法返回多种类型的单元格。如果省略将选定所有常量或公式，可为表格 4 2所列的 XlSpecialCellsValue常量之一。<br>常量    值    描述<br>xlErrors    16    错误<br>xlLogical    4    逻辑值<br>xlNumbers    1    数字<br>xlTextValues    2    文本<br>表格 4 2    XlSpecialCellsValue常量</p>
<h3 id="技巧5-查找单元格"><a href="#技巧5-查找单元格" class="headerlink" title="技巧5     查找单元格"></a>技巧5     查找单元格</h3><h4 id="5-1-使用Find方法"><a href="#5-1-使用Find方法" class="headerlink" title="5-1    使用Find方法"></a>5-1    使用Find方法</h4><p>在Excel中使用查找对话框可以查找工作表中特定内容的单元格，而在VBA中则使用Find方法，如下面的代码所示。</p>
<pre><code class="vb">Sub RngFind() &#39;使用Find方法在工作表Sheet1的A列中查找InputBox函数对话框中所输入的值，并查找该值所在的第一个单元格
    Dim StrFind As String
    Dim Rng As Range
    StrFind = InputBox(&quot;请输入要查找的值:&quot;)
    If Trim(StrFind) &lt;&gt; &quot;&quot; Then
        With Sheet1.Range(&quot;A:A&quot;)
            Set Rng = .Find(What:=StrFind, _
                            After:=.Cells(.Cells.Count), _
                            LookIn:=xlValues, _
                            LookAt:=xlWhole, _
                            SearchOrder:=xlByRows, _
                            SearchDirection:=xlNext, _
                            MatchCase:=False)
            If Not Rng Is Nothing Then
                Application.Goto Rng, True
            Else
                MsgBox &quot;没有找到该单元格!&quot;
            End If
        End With
    End If
End Sub
代码解析：
RngFind过程使用Find方法在工作表Sheet1的A列中查找InputBox函数对话框中所输入的值，并查找该值所在的第一个单元格。
第6到第13行代码在工作表Sheet1的A列中查找InputBox函数对话框中所输入的值。应用于Range对象的Find方法在区域中查找特定信息，并返回Range对象，该对象代表用于查找信息的第一个单元格。如果未发现匹配单元格，就返回Nothing，语法如下：
expression.Find(What, After, LookIn, LookAt, SearchOrder, SearchDirection, MatchCase, MatchByte, SerchFormat)
参数expression是必需的，该表达式返回一个Range对象。
参数What是必需的，要搜索的数据，可为字符串或任意数据类型。
参数After是可选的，表示搜索过程将从其之后开始进行的单元格，必须是区域中的单个单元格。查找时是从该单元格之后开始的，直到本方法绕回到指定的单元格时，才对其进行搜索。如果未指定本参数，搜索将从区域的左上角单元格之后开始。
在本例中将After参数设置为A列的最后一个单元格，所以查找时从A1单元格开始搜索。
参数LookIn是可选的，信息类型。
参数LookAt是可选的，可为XlLookAt常量的xlWhole 或xlPart之一。
参数SearchOrder是可选的，可为XlSearchOrder常量的xlByRows或xlByColumns之一。
参数SearchDirection是可选的，搜索的方向，可为XlSearchDirection常量的xlNext或xlPrevious之一。
参数MatchCase是可选的，若为True，则进行区分大小写的查找。默认值为False。
参数MatchByte是可选的，仅在选择或安装了双字节语言支持时使用。若为True，则双字节字符仅匹配双字节字符。若为False，则双字节字符可匹配其等价的单字节字符。
参数SerchFormat是可选的，搜索的格式。
每次使用Find方法后，参数LookIn、LookAt、SearchOrder 和MatchByte的设置将保存。如果下次调用Find方法时不指定这些参数的值，就使用保存的值。因此每次使用该方法时请明确设置这些参数。</code></pre>
<p>如果工作表的A列中存在重复的数值，那么需要使用FindNext方法或FindPrevious方法进行重复搜索，如下面的代码所示。</p>
<pre><code class="vb">Sub RngFindNext()
    Dim StrFind As String
    Dim Rng As Range
    Dim FindAddress As String
    StrFind = InputBox(&quot;请输入要查找的值:&quot;)
    If Trim(StrFind) &lt;&gt; &quot;&quot; Then
        With Sheet1.Range(&quot;A:A&quot;) &#39;使用Find方法在工作表Sheet1的A列中查找
            Set Rng = .Find(What:=StrFind, _ 
                            After:=.Cells(.Cells.Count), _
                            LookIn:=xlValues, _
                            LookAt:=xlWhole, _
                            SearchOrder:=xlByRows, _
                            SearchDirection:=xlNext, _
                            MatchCase:=False)
            If Not Rng Is Nothing Then
                FindAddress = Rng.Address &#39;将查找到的第一个单元格地址赋给字符串变量FindAddress
                Do
                    Rng.Interior.ColorIndex = 6 &#39;将查找到的单元格底色设置成黄色
                    Set Rng = .FindNext(Rng) &#39;使用FindNext方法进行重复搜索
                Loop While Not Rng Is Nothing And Rng.Address &lt;&gt; FindAddress &#39;如果查找到的单元格地址等于字符串变量FindAddress所记录的地址，说明A列已搜索完毕，结束查找过程
            End If
        End With
    End If
End Sub
RngFindNext过程在工作表Sheet1的A列中查找InputBox函数对话框中所输入的值，并将查到单元格底色设置成黄色。
使用FindNext方法进行重复搜索。FindNext方法继续执行用Find方法启动的搜索。查找下一个匹配相同条件的单元格并返回代表单元格的Range对象，语法如下：
expression.FindNext(After)
参数expression是必需的，返回一个Range对象。
参数After是可选的，指定一个单元格，查找将从该单元格之后开始。

还可以使用FindPrevious方法进行重复搜索，FindPrevious方法的语法如下：
expression.FindPrevious(After)
FindPrevious方法和FindNext方法唯一的区别是FindPrevious方法查找匹配相同条件的前一个单元格而FindNext方法是查找匹配相同条件的下一个单元格。</code></pre>
<h4 id="5-2-使用Like运算符"><a href="#5-2-使用Like运算符" class="headerlink" title="5-2    使用Like运算符"></a>5-2    使用Like运算符</h4><p>使用Like运算符可以进行更为复杂的模式匹配查找，如下面的代码所示。</p>
<pre><code class="vb">Sub RngLike()
    Dim rng As Range
    Dim a As Integer
    a = 1
    With Sheet2
        .Range(&quot;A:A&quot;).ClearContents   &#39;使用ClearContents方法清除A列区域的数据
        For Each rng In .Range(&quot;B1:E1000&quot;) &#39;使用For Each...Next语句在单元格区域B1:E10000中循环
            If rng.Text Like &quot;*a*&quot; Then &#39;使用Like运算符在单元格区域B1:E10000中搜索含有“a”字符的单元格
                .Range(&quot;A&quot; &amp; a) = rng.Text
                a = a + 1
            End If
        Next
    End With
End Sub
RngLike过程使用For Each...Next语句和Like运算符在单元格区域B1:E10000中搜索含有“a”字符的单元格，找到匹配单元格以后将单元格的值写入到A列中。
Like运算符用来比较两个字符串，语法如下：
result = string Like pattern
参数string是必需的，字符串表达式。
参数pattern是必需的，字符串表达式。
如果string与pattern匹配，则result为True；如果不匹配，则result为False。但是如果string或pattern 中有一个为Null，则result 为 Null。
参数pattern可以使用通配符、字符串列表或字符区间的任何组合来匹配字符串。表格 5 1列出pattern中允许的字符以及它们与什么进行匹配。
pattern中的字符    符合string中的字符
?    任何单一字符
*    零个或多个字符
#    任何一个数字 (0–9)
[charlist]    charlist中的任何单一字符
[!charlist]    不在charlist中的任何单一字符
表格 5 1    pattern中的匹配字符串
第9行代码将找到的匹配单元格的值写入到A列中。</code></pre>
<h3 id="技巧6-替换单元格内字符串"><a href="#技巧6-替换单元格内字符串" class="headerlink" title="技巧6     替换单元格内字符串"></a>技巧6     替换单元格内字符串</h3><p>如果需要替换单元格内指定的字符串，那么使用Range对象的Replace方法，如下面的代码所示。<br>Sub RngReplace() ‘RngReplace过程将工作表A1:A5单元格中的“通州”字符串替换成“南通”字符串<br>    Range(“A1:A5”).Replace “通州”, “南通”<br>End Sub<br>应用于Range对象的Replace方法替换指定区域内单元格中的字符，语法如下：<br>expression.Replace(What, Replacement, LookAt, SearchOrder, MatchCase, MatchByte, SearchFormat, ReplaceFormat)<br>其中参数expression是必需的，返回一个Range对象。<br>参数What是必需的，要搜索的字符串。<br>参数Replacement是必需的，替换的字符串。</p>
<h3 id="技巧7-复制单元格区域"><a href="#技巧7-复制单元格区域" class="headerlink" title="技巧7     复制单元格区域"></a>技巧7     复制单元格区域</h3><p>在实际操作中，经常需要复制指定的单元格区域到另外一个单元格区域。要复制指定单元格区域到其他位置，使用Range对象的Copy方法，如下面的代码所示。</p>
<pre><code class="vb">Sub RangeCopy() &#39;将Sheet1工作表中A1单元格的当前区域复制到Sheet2工作表中以A1单元格为左上角单元格的区域
    Application.DisplayAlerts = False &#39;通常复制单元格区域的操作不会将单元格区域的列宽大小同时复制
    Sheet1.Range(&quot;A1&quot;).CurrentRegion.Copy Sheet2.Range(&quot;A1&quot;)
    Application.DisplayAlerts = True
End Sub
Range对象的Copy方法的语法如下：
Copy(Destination)
参数Destination表示复制单元格区域的目标区域，如果省略该参数，Excel将把该区域复制到剪贴板中。
使用Copy方法复制单元格区域时，也复制了该单元格区域的格式
复制单元格区域时，如果目标区域为非空单元格区域,所示的消息框提示是否替换单元格内容，可以设置Application.DisplayAlerts属性值为False，使复制时不出现该消息框。</code></pre>
<p>如果希望在复制单元格区域的同时，也复制源区域的列宽大小，可以使用下面的代码。</p>
<pre><code class="vb">Sub CopyWithSameColumnWidths()
    Sheet1.Range(&quot;A1&quot;).CurrentRegion.Copy
    With Sheet3.Range(&quot;A1&quot;)
        .PasteSpecial xlPasteColumnWidths &#39;使用Range对象的PasteSpecial方法选择性粘贴剪贴板中的Range对象的列宽
        .PasteSpecial xlPasteAll &#39;粘贴剪贴板中的Range对象全部内容
    End With
    Application.CutCopyMode = False &#39;取消应用程序复制模式
End Sub
应用于Range对象的PasteSpecial方法将剪贴板中的Range对象粘贴到指定区域，在粘贴时可以有选择的粘贴对象的部分属性。其语法如下：
PasteSpecial(Paste, Operation, SkipBlanks, Transpose)</code></pre>
<p>参数Paste指定要粘贴的区域部分，可为表格 7 1所列的XlPasteType常量之一。<br>常量    值    描述<br>xlPasteAll     -4104    全部（默认值）<br>xlPasteAllExceptBorders    7    边框除外<br>xlPasteColumnWidths    8    列宽<br>xlPasteComments    -4144    批注<br>xlPasteFormats    -4122    格式<br>xlPasteFormulas    -4123    公式<br>xlPasteFormulasAndNumberFormats    11    公式和数字格式<br>xlPasteValidation    6    有效性验证<br>xlPasteValues    -4163    数值<br>xlPasteValuesAndNumberFormats    12    值和数字格式<br>表格 7 1        XlPasteType 常量<br>参数Operation指定粘贴操作。可为表格 7 2所列的XlPasteSpecialOperation常量之一。<br>常量    值    描述<br>xlPasteSpecialOperationNone    -4142    无（默认值）<br>xlPasteSpecialOperationAdd    2    加<br>xlPasteSpecialOperationSubtract    3    减<br>xlPasteSpecialOperationMultiply    4    乘<br>xlPasteSpecialOperationDivide    5    除<br>表格 7 2        XlPasteSpecialOperation常量<br>参数SkipBlanks指示是否跳过空单元格，若参数值为True，则不将剪贴板上区域中的空白单元格粘贴到目标区域中。默认值为False。<br>参数Transpose指示是否进行转置，若参数值为True，则粘贴区域时转置行和列。默认值为False。<br>运行CopyWithSameColumnWidths过程后，Sheet3工作表如图 7 4所示，目标区域的各列列宽与源区域一致。</p>
<p>注意 使用PasteSpecial方法时指定xlPasteAll(粘贴全部)，不会粘贴列宽。</p>
<h3 id="技巧8-仅复制数值到另一区域"><a href="#技巧8-仅复制数值到另一区域" class="headerlink" title="技巧8     仅复制数值到另一区域"></a>技巧8     仅复制数值到另一区域</h3><p>如果在复制单元格区域时，仅希望复制单元格区域的数值，有下面几种方法。</p>
<h4 id="8-1-使用选择性粘贴"><a href="#8-1-使用选择性粘贴" class="headerlink" title="8-1    使用选择性粘贴"></a>8-1    使用选择性粘贴</h4><p>使用选择性粘贴功能并指定粘贴数值，如下面的代码所示。</p>
<pre><code class="vb">Sub CopyPasteSpecial()
    Sheet1.Range(&quot;A1&quot;).CurrentRegion.Copy &#39;对Sheet1中A1单元格的当前区域进行复制
    Sheet2.Range(&quot;A1&quot;).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
End Sub
第3行代码使用选择性粘贴功能并指定粘贴数值，选择性粘贴数值仅复制了单元格区域的数值，单元格区域的格式（背景颜色、字体对齐格式和边框等）不会被复制</code></pre>
<h4 id="8-2-直接赋值的方法"><a href="#8-2-直接赋值的方法" class="headerlink" title="8-2    直接赋值的方法"></a>8-2    直接赋值的方法</h4><p>除了使用Copy方法外，还可以使用直接赋值的方法，如下面的代码所示。</p>
<pre><code class="vb">Sub GetValueResize() &#39;将工作表Sheet1中的A1单元格的当前区域的数值赋予工作表Sheet3的A1单元格所在的单元格区域
    With Sheet1.Range(&quot;A1&quot;).CurrentRegion
        Sheet3.Range(&quot;A1&quot;).Resize(.Rows.Count, .Columns.Count).Value = .Value
    End With
End Sub
在对单元格区域直接赋值时，应保证源区域大小与目标区域的大小一致，如果源区域为动态的单元格区域，可使用Resize方法确定目标区域。</code></pre>
<h3 id="技巧9-单元格自动进入编辑状态"><a href="#技巧9-单元格自动进入编辑状态" class="headerlink" title="技巧9     单元格自动进入编辑状态"></a>技巧9     单元格自动进入编辑状态</h3><p>当光标选择单元格时无需双击，自动进入编辑状态，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Column = 3 And Target.Count = 1 Then
        If Target &lt;&gt; &quot;&quot; Then
            Application.SendKeys &quot;{F2}&quot;
        End If
    End If
End Sub
代码解析：
工作表的SelectionChange事件过程，当选择工作表C列有数据单元格时自动进入编辑状态。
第2、3行代码设置SelectionChange事件的触发条件，利用Target参数的Column属性和Count属性将事件的触发条件限制在C列并且只有在选择一个单元格时才发生。
第4行代码使用SendKeys方法发送一个F2键到应用程序，等同于选择单元格后按F2键，使单元格进入编辑状态。关于SendKeys方法请参阅技巧12-4。</code></pre>
<h3 id="技巧10-禁用单元格拖放功能"><a href="#技巧10-禁用单元格拖放功能" class="headerlink" title="技巧10     禁用单元格拖放功能"></a>技巧10     禁用单元格拖放功能</h3><p>在工作表中可以拖放单元格右下角的小十字对单元格内容进行复制等操作，如果不希望用户进行此操作可以禁用单元格拖放功能，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range) &#39;在指定的单元格区域禁用单元格的拖放功能
   If Not Application.Intersect(Target, Range(&quot;A1:A15&quot;)) Is Nothing Then
        Application.CellDragAndDrop = False &#39;CellDragAndDrop 属性设置单元格的拖放功能，如果允许使用单元格拖放功能，则该值为True
    Else
        Application.CellDragAndDrop = True
    End If
End Sub
为了不影响其他工作表，应在工作表的Deactivate事件中恢复单元格的拖放功能，如下面的代码所示。
Private Sub Worksheet_Deactivate() &#39;工作表的Deactivate事件过程，恢复单元格的拖放功能
    Application.CellDragAndDrop = True
End Sub
工作表的Deactivate事件当工作表从活动状态转为非活动状态时产生，语法如下：
Private Sub object_Deactivate()
参数object代表Worksheet对象。</code></pre>
<h3 id="技巧11-单元格格式操作"><a href="#技巧11-单元格格式操作" class="headerlink" title="技巧11     单元格格式操作"></a>技巧11     单元格格式操作</h3><h4 id="11-1-单元格字体格式设置"><a href="#11-1-单元格字体格式设置" class="headerlink" title="11-1    单元格字体格式设置"></a>11-1    单元格字体格式设置</h4><p>在VBA中可以对单元格的字体格式进行各种设置，如下面的代码所示。</p>
<pre><code class="vb">Public Sub RngFont() &#39;RngFont过程对单元格A1的字体格式进行设置
    With Range(&quot;A1&quot;).Font
        .Name = &quot;华文彩云&quot; &#39;设置字体为“华文彩云”，应用于Font对象的Name属性返回或设置对象的名称
        .FontStyle = &quot;Bold&quot; &#39;设置字体为加粗，FontStyle属性返回或设置字体样式。设置为“Bold” 加粗字体，设置为“Italic”倾斜字体，也可以设置成“Bold Italic”
        .Size = 18 &#39;设置字体的大小为18磅，Size属性返回或设置字体大小
        .ColorIndex = 3 &#39;设置字体的颜色为红色
        .Underline = 2
    End With
End Sub
第6行代码设置字体的颜色为红色，应用于Font对象的ColorIndex属性返回或设置字体的颜色，该颜色可指定为当前调色板中颜色的编号，如图 11 1所示。</code></pre>
<p>图 11 1    调色板中颜色的编号<br>第7行代码设置字体为单下划线类型，Underline属性返回或设置应用于字体的下划线类型，可为表格 11 1所列的XlUnderlineStyle常量之一。<br>常量    值    描述<br>xlUnderlineStyleNone    -4142    无<br>xlUnderlineStyleSingle    2    单下划线<br>xlUnderlineStyleDouble    -4119    双下划线<br>xlUnderlineStyleSingleAccounting    4    会计用单下划线<br>xlUnderlineStyleDoubleAccounting    5    会计用双下划线<br>表格 11 1    XlUnderlineStyle常量</p>
<h4 id="11-2-设置单元格内部格式"><a href="#11-2-设置单元格内部格式" class="headerlink" title="11-2    设置单元格内部格式"></a>11-2    设置单元格内部格式</h4><p>设置单元格的Interior属性可以对单元格的内部格式进行设置，如下面的代码所示。</p>
<pre><code class="vb">Sub RngInterior()
    With Range(&quot;A1&quot;).Interior
        .ColorIndex = 3
        .Pattern = xlPatternCrissCross
        .PatternColorIndex = 6
    End With
End Sub
代码解析：
RngInterior过程对A1单元格的内部格式进行设置。
第2行代码使用Interior属性返回单元格对象的内部。
第3行代码设置单元格边框内部的颜色为红色。应用于Interior对象的ColorIndex属性返回或设置边框内部的颜色，可指定为如图 11 1所示的当前调色板中颜色的编号或为XlColorIndex 常量之一：xlColorIndexAutomatic （自动填充）、xlColorIndexNone （无内部填充）。
第4行代码设置单元格设置内部图案为十字图案。应用于Interior对象的Pattern属性返回或者设置内部图案。
第5行代码设置单元格设置内部图案的颜色为黄色。应用于Interior对象的PatternColorIndex属性返回或设置内部图案的颜色，可指定为如图 11 1所示的当前调色板中颜色的编号XlColorIndex常量之一：xlColorIndexAutomatic （自动填充）、xlColorIndexNone （无内部填充）。
运行RngInterior过程结果如图 11 3所示。</code></pre>
<p>图 11 3    设置单元格内部格式</p>
<h4 id="11-3-为单元格区域添加边框"><a href="#11-3-为单元格区域添加边框" class="headerlink" title="11-3    为单元格区域添加边框"></a>11-3    为单元格区域添加边框</h4><p>我们为单元格区域添加边框时往往通过录制宏获取代码，但宏录制器生成的代码分别设置单元格区域的每个边框，因此代码多且效率低。使用Range对象的Borders集合可以快速的对单元格区域的每个边框应用相同的格式，而Range对象的BorderAround方法则可以快速地为单元格区域添加一个外边框，如下面的代码所示。</p>
<pre><code class="vb">Sub AddBorders() &#39;单元格区域B4:G10设置内部统一边框并添加一个加粗外边框
    Dim rng As Range
    Set rng = Range(&quot;B4:G10&quot;)
    With rng.Borders &#39;使用Borders属性引用单元格区域的Borders集合
        .LineStyle = xlContinuous &#39;设置其边框样式线条的样式
        .Weight = xlThin &#39;设置边框线条的粗细
        .ColorIndex = 5 &#39;设置边框的颜色
    End With
    rng.BorderAround xlContinuous, xlMedium, 5 &#39;使用BorderAround方法为单元格区域添加一个加粗外边框
    Set rng = Nothing
End Sub
应用于Range对象的Borders集合代表Range对象的4个边框（左边框、右边框、顶部边框和底部边框）的4个Border对象组成的集合，这4个边框既可单独返回，也可作为一个组同时返回。
应用于Range对象的BorderAround方法向单元格区域添加整个区域的外边框，并设置该边框的相关属性，其语法如下：
BorderAround(LineStyle, Weight, ColorIndex, Color)
其中LineStyle参数设置边框线条的样式，Weight参数设置边框线条的粗细，ColorIndex     设置边框颜色，Color参数以RGB值指定边框的颜色。
注意 指定Color参数可以设置颜色为当前调色板之处的其它颜色，不能同时指定ColorIndex参数和Color参数。
运行AddBorders过程，效果如图 11 4所示。</code></pre>
<p>如果需要在单元格区域中应用多种边框格式，则需分别设置各边框格式，如下面的代码所示。</p>
<pre><code class="vb">Sub BordersDemo()
    Dim rng As Range
    Set rng = Sheet2.Range(&quot;B4:G10&quot;)
    With rng.Borders(xlInsideHorizontal)
        .LineStyle = xlDot
        .Weight = xlThin         
        .ColorIndex = 5
    End With
    With rng.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 5
    End With
    rng.BorderAround xlContinuous, xlMedium, 5
    Set rng = Nothing
End Sub
BordersDemo过程代码为单元格区域内部边框在水平和垂直方向上应用不同格式，并为区域添加一个加粗外边框。</code></pre>
<p>Borders(index)属性返回单个Border对象，其Index参数取值可为表格 11 2所列的XlBordersIndex常量之一：<br>常量        值    描述<br>xlDiagonalDown    5    斜下边框<br>xlDiagonalUp    6    斜上边框<br>xlEdgeBottom    9    底部边框<br>xlEdgeLeft    7    左边框<br>xlEdgeRight    10    右边框<br>xlEdgeTop    8    顶部边框<br>xlInsideHorizontal    12    内部水平<br>xlInsideVertical    11    内部垂直<br>表格 11 2    XlBordersIndex常量<br>运行BordersDemo过程效果如图 1 1所示。</p>
<h4 id="11-4-灵活设置单元格的行高列宽"><a href="#11-4-灵活设置单元格的行高列宽" class="headerlink" title="11-4    灵活设置单元格的行高列宽"></a>11-4    灵活设置单元格的行高列宽</h4><p>一般情况下单元格的行高列宽都是以磅为单位进行设置的，也可以使用英寸和厘米计量单位设置单元格的行高列宽，如下面的代码所示。</p>
<pre><code class="vb">Sub RngToPoints()
    With Range(&quot;A1&quot;)
        .RowHeight = Application.CentimetersToPoints(2)
        .ColumnWidth = Application.CentimetersToPoints(1.5)
    End With
    With Range(&quot;A2&quot;)
        .RowHeight = Application.InchesToPoints(1.2)
        .ColumnWidth = Application.InchesToPoints(0.3)
    End With
End Sub
代码解析：
RngToPoints过程以英寸和厘米计量单位设置单元格的行高列宽。
第3、4行代码使用CentimetersToPoints方法以厘米为计量单位设置A1单元格的行高列宽。CentimetersToPoints方法将计量单位从厘米转换为磅（一磅等于 0.035 厘米），语法如下：
expression.CentimetersToPoints(Centimeters)
参数expression是必需的，返回一个Application对象。
参数Centimeters是必需的，指定要转换为磅值的厘米值。
第5、6行代码使用InchesToPoints方法以英寸为计量单位设置A2单元格的行高列宽。InchesToPoints方法将计量单位从英寸转换为磅，语法如下：
expression.InchesToPoints(Inches)
参数expression是必需的，返回一个Application对象。
参数Inches是必需的，指定要转换为磅值的英寸值。
运行RngToPoints过程结果如图 11 6所示。</code></pre>
<h3 id="技巧12-单元格中的数据有效性"><a href="#技巧12-单元格中的数据有效性" class="headerlink" title="技巧12     单元格中的数据有效性"></a>技巧12     单元格中的数据有效性</h3><p>12-1    在单元格中建立数据有效性<br>在单元格中建立数据有效性可以使用Add方法，如下面的代码所示。</p>
<pre><code class="vb">Sub Validation() &#39;使用Add方法在A1：A10单元格中建立数据有效性
    With Range(&quot;A1:A10&quot;).Validation
        .Delete &#39;删除已建立的数据有效性，防止代码运行出错
        .Add Type:=xlValidateList, _ &#39;使用Add方法建立数据有效性
            AlertStyle:=xlValidAlertStop, _
            Operator:=xlBetween, _
            Formula1:=&quot;1,2,3,4,5,6,7,8&quot;
    End With
End Sub
第4行到第7行代码使用Add方法建立数据有效性。应用于Validation对象的Add方法的语法如下：
expression.Add(Type, AlertStyle, Operator, Formula1, Formula2)
参数expression是必需的，返回一个Validation对象。
参数Type是必需的，数据有效性类型。
参数AlertStyl是可选的，有效性检验警告样式。
参数Operator是可选的，数据有效性运算符。
参数Formula1是可选的，数据有效性公式的第一部分。
参数Formula2是可选的，当Operator为xlBetween或xlNotBetween时，数据有效性公式的第二部分（其他情况下，此参数被忽略）。
Add 方法所要求的参数依有效性检验的类型而定，如表格 12 1所示。
数据有效性类型    参数
xlValidateCustom    Formula1 必需，忽略 Formula2。Formula1 必须包含一个表达式，数据项有效时该表达式取值为 True，而数据项无效时取值为 False。
xlInputOnly    能使用 AlertStyle、Formula1 或 Formula2 参数。
xlValidateList    Formula1 必需，忽略 Formula2。Formula1 必须包含以逗号分隔的取值列表，或引用此列表的工作表。
xlValidateWholeNumber、xlValidateDate、xlValidateDecimal、xlValidateTextLength 或 xlValidateTime    必须指定 Formula1 或 Formula2 之一，或两者均指定。</code></pre>
<p>表格 12 1    数据有效性类型</p>
<h4 id="12-2-判断单元格是否存在数据有效性"><a href="#12-2-判断单元格是否存在数据有效性" class="headerlink" title="12-2    判断单元格是否存在数据有效性"></a>12-2    判断单元格是否存在数据有效性</h4><p>在VBA中没有专门的属性判断单元格是否存在数据有效性设置，可以使用Validation对象的有效性类型和错误陷阱来判断，如下面的代码所示。</p>
<pre><code class="vb">Sub Validation()
    On Error GoTo Line
    If Range(&quot;A2&quot;).Validation.Type &gt;= 0 Then
        MsgBox &quot;单元格有数据有效性!&quot;
        Exit Sub
    End If
Line:
    MsgBox &quot;单元格没有数据有效性!&quot;
End Sub
代码解析：
Validation过程使用Validation对象的有效性类型和错误陷阱来判断A2单元格中是否存在数据有效性。
第6行代码，如果A2单元格中存在数据有效性，Type参数值就会大于等于0，否则就会发生错误，使用On Error GoTo捕捉到错误后转移到第8行代码，显示一个消息框。</code></pre>
<p>12-3    动态的数据有效性<br>利用VBA可以在单元格中建立动态的数据有效性，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Column = 1 And Target.Count = 1 And Target.Row &gt; 1 Then
        With Target.Validation
            .Delete
            .Add Type:=xlValidateList, _
                AlertStyle:=xlValidAlertStop, _
                Operator:=xlBetween, _
                Formula1:=&quot;主机,显示器&quot;
         End With
    End If
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
    If Target.Column = 1 And Target.Row &gt; 1 And Target.Count = 1 Then
        With Target.Offset(0, 1).Validation
            .Delete
            Select Case Target
                Case &quot;主机&quot;
                    .Add Type:=xlValidateList, _
                        AlertStyle:=xlValidAlertStop, _
                        Operator:=xlBetween, _
                        Formula1:=&quot;Z286,Z386,Z486,Z586&quot;
                Case &quot;显示器&quot;
                    .Add Type:=xlValidateList, _
                        AlertStyle:=xlValidAlertStop, _
                        Operator:=xlBetween, _
                        Formula1:=&quot;三星17,飞利浦15,三星15,飞利浦17&quot;
            End Select
       End With
    End If
End Sub
代码解析：
第1行到第11行代码，工作表的SelectionChange事件，当选择工作表的A列单元格时，在A2以下的单元格中建立动态的数据有效性。
其中第2行代码，利用SelectionChange事件的Target参数来限制事件的触发条件。
第3行到第9行代码使用Add方法在A列单元格中建立数据有效性。应用于Validation对象的Add方法请参阅技巧12-1。
第12行到第30行代码，工作表的Change事件，当工作表A列单元格内容改变时，在B列单元格中建立动态的数据有效性。
其中第16行到第27行代码，根据A列单元格的内容在B列对应的单元格中建立数据有效性，其Formula1参数的值根据A列单元格的内容而变化，使之达到动态数据有效性的效果，如图 12 1、图 12 2所示。</code></pre>
<h4 id="12-4-自动展开数据有效性下拉列表"><a href="#12-4-自动展开数据有效性下拉列表" class="headerlink" title="12-4    自动展开数据有效性下拉列表"></a>12-4    自动展开数据有效性下拉列表</h4><p>选择工作表单元格时自动展开数据有效性的下拉列表，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
   If Target.Column = 5 Then Application.SendKeys &quot;%{down}&quot;
End Sub
代码解析：
当选择工作表的E列中有数据有效性的单元格时使用SendKeys方法发送Alt+向下键，打开数据有效性的下拉列表。
应用于Application对象的SendKeys方法将击键发送给活动应用程序，语法如下：
expression.SendKeys(Keys, Wait)
参数expression是可选的，该表达式返回一个Application对象。
参数Keys是必需的，要发送的键或者组合键，以文本方式表示。
Keys参数可以指定任何单个键或与Alt、Ctrl 或Shift的组合键（或者这些键的组合）。每个键可用一个或多个字符表示。例如，&quot;a&quot; 表示字符 a，或者 &quot;{ENTER}&quot; 表示 Enter。</code></pre>
<p>若要指定在按相应键时不会显示的字符（例如，Enter 或 Tab），请使用如表格 12 2所列的代码来表示相应的键，表中的每个代码表示键盘上的一个键。<br>键    代码<br>Backspace    {BACKSPACE} 或 {BS}<br>Break    {BREAK}<br>Caps Lock    {CAPSLOCK}<br>Clear    {CLEAR}<br>Delete 或 Del    {DELETE} 或 {DEL}<br>End    {END}<br>Enter    ~（波形符）<br>Enter（数字小键盘）    {ENTER}<br>Esc    {ESCAPE} 或 {ESC}<br>F1 到 F15    {F1} 到 {F15}<br>Help    {HELP}<br>Home    {HOME}<br>Ins    {INSERT}<br>Num Lock    {NUMLOCK}<br>Page Down    {PGDN}<br>Page Up    {PGUP}<br>Return    {RETURN}<br>Scroll Lock    {SCROLLLOCK}<br>Tab    {TAB}<br>向上键    {UP}<br>向下键    {DOWN}<br>向右键    {RIGHT}<br>向左键    {LEFT}<br>表格 12 2    按键代码</p>
<h3 id="技巧13-单元格中的公式"><a href="#技巧13-单元格中的公式" class="headerlink" title="技巧13     单元格中的公式"></a>技巧13     单元格中的公式</h3><h4 id="13-1-在单元格中写入公式"><a href="#13-1-在单元格中写入公式" class="headerlink" title="13-1    在单元格中写入公式"></a>13-1    在单元格中写入公式</h4><p>使用Range对象的Formula属性可以在单元格区域中写入公式，如下面的代码所示。</p>
<pre><code class="vb">Sub rngFormula()
    Sheet1.Range(&quot;C1:C10&quot;).Formula = &quot;=SUM(A1+B1)&quot;
End Sub
代码解析：
应用于Range对象的Formula属性返回或设置A1样式表示的Range对象的公式，语法如下：
expression.Formula
参数expression是必需的，返回一个Range对象。
还可以使用FormulaR1C1属性返回或设置以R1C1-样式符号表示的公式，如下面的代码所示。
Sub rngFormulaRC()
    Sheet2.Range(&quot;C1:C10&quot;).FormulaR1C1 = &quot;=SUM(RC[-2]+RC[-1])&quot;
End Sub
如果需要在单元格中写入数组公式则使用Range对象的FormulaArray属性。如下面的代码所示。
Sub RngFormulaArray()
    Sheet3.Range(&quot;C1&quot;).FormulaArray = &quot;=A1:A2*B1:B2&quot;
End Sub
Range对象的FormulaArray属性返回或设置单元格区域的数组公式。</code></pre>
<h4 id="13-2-检查单元格是否含有公式"><a href="#13-2-检查单元格是否含有公式" class="headerlink" title="13-2    检查单元格是否含有公式"></a>13-2    检查单元格是否含有公式</h4><p>使用单元格的HasFormula属性检查单元格是否含有公式,如下面的代码所示。</p>
<pre><code class="vb">Private Sub CommandButton1_Click()
    Select Case Selection.HasFormula
       Case True
            MsgBox &quot;公式单元格!&quot;
        Case False
            MsgBox &quot;非公式单元格!&quot;
        Case Else
        MsgBox &quot;公式区域：&quot; &amp; Selection.SpecialCells(xlCellTypeFormulas, 23).Address(0, 0)
    End Select
End Sub
代码解析：
工作表中按钮的单击过程，检查所选择的单元格区域是否含有公式。
第2行代码返回所选择单元格区域的HasFormula属性值。如果区域中所有单元格均包含公式，则该值为True；如果所有单元格均不包含公式，则该值为False。
第3、4行代码，如果返回True，说明区域中所有单元格均包含公式。
第5、6行代码，如果返回False，说明区域中所有单元格均不包含公式。
第7、8行代码，如果是混合区域，则显示包含公式的单元格地址，如图 13 1所示。</code></pre>
<h4 id="13-3-判断单元格公式是否存在错误"><a href="#13-3-判断单元格公式是否存在错误" class="headerlink" title="13-3    判断单元格公式是否存在错误"></a>13-3    判断单元格公式是否存在错误</h4><p>当需要获取的单元格的值由公式返回时，公式返回的结果可能是一个错误文本，包含#NULL!、#DIV/0!、#VALUE!、#REF!、#NAME?、#NUM!、#N/A等。此时，当单元格公式返回结果为错误文本时，如果试图通过Value属性来获得公式的返回结果，将得到类型不匹配的错误信息，如图 13 2所示。</p>
<p>图 13 2    公式错误导致的消息<br>通过Range对象的Value属性的返回结果是否为错误类型，来判断公式是否存在错误，如下面的代码所示。</p>
<pre><code class="vb">Sub FormulaIsError()
    If VBA.IsError(Range(&quot;A1&quot;).Value) = True Then
        MsgBox &quot;A1单元格错误类型为:&quot; &amp; Range(&quot;A1&quot;).Text
    Else
        MsgBox &quot;A1单元格公式结果为&quot; &amp; Range(&quot;A1&quot;).Value
    End If
End Sub
代码解析“
FormulaIsError过程代码判断单元格A1中公式结果是否为错误，如果为错误则显示该错误类型，否则显示公式的结果，如图 13 3所示。
第2行代码使用IsError函数返回Boolean值，指出表达式是否为一个错误值，如果表达式表示一个错误，则IsError函数返回True，否则返回False。</code></pre>
<p>图 13 3    显示公式错误结果</p>
<h4 id="13-4-取得单元格中公式的引用单元格"><a href="#13-4-取得单元格中公式的引用单元格" class="headerlink" title="13-4    取得单元格中公式的引用单元格"></a>13-4    取得单元格中公式的引用单元格</h4><p>如果需要取得单元格中公式的引用单元格对象，可以使用Range对象的Precedents属性，如下面的代码所示。</p>
<pre><code class="vb">Sub RngPrecedent()
    Dim rng As Range
    Set rng = Sheet1.Range(&quot;C1&quot;).Precedents
    MsgBox &quot;公式所引用的单元格有：&quot; &amp; rng.Address
    Set rng = Nothing
End Sub
代码解析：
在工作表的C1单元格中写有公式“SUM(“A1:B1”)”，RngPrecedent过程使用Range对象的Precedents属性取得其引用的单元格A1:B1。
Precedents属性返回一个Range对象，该对象代表单元格的所有引用单元格。如果有若干引用单元格，那么该区域可能是多个的选定区域（Range 对象的联合）。
运行RngPrecedent过程结果如图 13 4所示。</code></pre>
<p>图 13 4    取得引用单元格</p>
<h4 id="13-5-将单元格中的公式转换为数值"><a href="#13-5-将单元格中的公式转换为数值" class="headerlink" title="13-5    将单元格中的公式转换为数值"></a>13-5    将单元格中的公式转换为数值</h4><p>工作表中如果存在过多的公式将影响操作速度，将单元格中的函数与公式的结果转换为数值，可以提高工作表运算效率，有下面几种方法可以实现。<br>使用选择性粘贴的方法可以将函数与公式的结果转换为数值，如下面的代码所示。</p>
<pre><code class="vb">Sub SpecialPaste()
    With Range(&quot;A1:A10&quot;)
        .Copy
        .PasteSpecial Paste:=xlPasteValues
    End With
    Application.CutCopyMode = False
End Sub
代码解析：
SpecialPaste过程使用选择性粘贴方法将单元格区域的公式转换为数值。
第3行代码将单元格区域复制到剪贴板中。
应用于Range对象的Copy方法将单元格区域复制到指定的区域或剪贴板中，语法如下：
expression.Copy(Destination)
参数expression是必需的，该表达式返回一个Range对象。
参数Destination是可选的，指定区域要复制到的目标区域。如果省略该参数，Microsoft Excel 将把该区域复制到剪贴板中。
第4行代码将剪贴板中的Range对象仅复制值到单元格区域中。
应用于Range对象的PasteSpecial方法将剪贴板中的Range对象粘贴到指定区域中，语法如下：
expression.PasteSpecial(Paste, Operation, SkipBlanks, Transpose)
参数expression是必需的，该表达式返回一个Range对象。
参数Paste是可选的，指定要粘贴的区域部分。在本例中设置为xlPasteValues，仅复制值到单元格区域中。</code></pre>
<p>使用Value属性可以将函数与公式的结果转换为数值，如下面的代码所示。</p>
<pre><code class="vb">Sub UseValue()
    Range(&quot;A1:A10&quot;).Value = Range(&quot;A1:A10&quot;).Value
End Sub
代码解析：
UseValue过程使用Value属性将函数与公式的结果转换为数值。</code></pre>
<p>使用Formula属性可以将函数与公式的结果转换为数值，如下面的代码所示。</p>
<pre><code class="vb">Sub UseFormula()
    Range(&quot;A1&quot;).Formula = Range(&quot;A1&quot;).Value
End Sub
代码解析：
UseFormula过程Formula属性将函数与公式的结果转换为数值。当Formula属性值为非公式时，返回的结果与Value属性一致。</code></pre>
<h3 id="技巧14-单元格中的批注"><a href="#技巧14-单元格中的批注" class="headerlink" title="技巧14     单元格中的批注"></a>技巧14     单元格中的批注</h3><h4 id="14-1-判断单元格是否存在批注"><a href="#14-1-判断单元格是否存在批注" class="headerlink" title="14-1    判断单元格是否存在批注"></a>14-1    判断单元格是否存在批注</h4><p>在VBA中，可以利用Range对象的Comment属性判断单元格是否存在批注，如下面的代码所示。</p>
<pre><code class="vb">Sub HasComment()
    If Range(&quot;A1&quot;).Comment Is Nothing Then
        MsgBox &quot;A1单元格中没有批注!&quot;
    Else
        MsgBox &quot;A1单元格中批注内容为：&quot; &amp; Chr(13) &amp; Range(&quot;A1&quot;).Comment.Text
    End If
End Sub
代码解析：
HasComment过程判断A1单元格是否存在批注，并用消息框显示批注信息。
Range对象的Comment属性返回一个批注对象，如果指定的单元格不存在批注，该属性返回Nothing。</code></pre>
<p>图 14 1    显示批注内容</p>
<h4 id="14-2-为单元格添加批注"><a href="#14-2-为单元格添加批注" class="headerlink" title="14-2    为单元格添加批注"></a>14-2    为单元格添加批注</h4><p>如果希望为单元格添加批注，那么可以使用AddComment方法，如下面的代码所示。</p>
<pre><code class="vb">Sub Comment_Add()
    With Range(&quot;A1&quot;)
        If .Comment Is Nothing Then
            .AddComment Text:=.Value
            .Comment.Visible = True
        End If
    End With
End Sub
代码解析：
Comment_Add判断单元格A1中是否存在批注，如果没有批注则为单元格A1添加批注并将单元格数值作为批注文本，同时显示批注对象。
第4行代码使用Range对象的AddComment方法为单元格添加批注。该方法只有一个参数Text，代表批注文本。如果单元格已经存在批注，则该方法返回一个错误。
第5行代码显示批注对象，Visible属性确定对象是否可视。
当单元格A1中不存在批注时，运行代码后的结果如图 14 2所示。</code></pre>
<p>图 14 2    添加批注</p>
<h4 id="14-3-删除单元格中的批注"><a href="#14-3-删除单元格中的批注" class="headerlink" title="14-3    删除单元格中的批注"></a>14-3    删除单元格中的批注</h4><p>如果需要删除单元格中的批注，那么可以使用ClearComments方法、ClearNotes方法或者Delete方法，如下面的代码所示。</p>
<pre><code class="vb">Sub Commentdel()
    On Error Resume Next
    Range(&quot;A1&quot;).ClearComments
    Range(&quot;A2&quot;).ClearNotes
    Range(&quot;A3&quot;).Comment.Delete
End Sub
代码解析：
Notesdel过程删除单元格中的批注。
第2行代码错误处理语句，如果单元格中没有批注，那么运行第5行代码时会发生错误，所以使用On Error语句来忽略错误
第3行代码使用ClearComments方法删除单元格A1中的批注。ClearComments方法清除指定区域的所有单元格批注，语法如下：
expression.ClearComments
第4行代码使用ClearNotes方法删除A2单元格中的批注。ClearNotes方法清除指定区域中所有单元格的附注和语音批注，语法如下：
expression.ClearNotes
第5行代码使用Delete方法删除删除A3单元格中的批注.Range对象的Comment属性返回一个Comment对象，该对象代表与该区域左上角单元格相关联的批注。</code></pre>
<h3 id="技巧15-合并单元格操作"><a href="#技巧15-合并单元格操作" class="headerlink" title="技巧15     合并单元格操作"></a>技巧15     合并单元格操作</h3><h4 id="15-1-判断单元格区域是否存在合并单元格"><a href="#15-1-判断单元格区域是否存在合并单元格" class="headerlink" title="15-1    判断单元格区域是否存在合并单元格"></a>15-1    判断单元格区域是否存在合并单元格</h4><p>Range对象的MergeCells属性可以确定单元格区域是否包含合并单元格，如果该属性返回值为True，则表示区域包含合并单元格。<br>下面的代码判断单元格 A1是否包含合并单元格，并显示相应的提示信息。</p>
<pre><code class="vb">Sub IsMergeCell()
    If Range(&quot;A1&quot;).MergeCells = True Then
        MsgBox &quot;包含合并单元格&quot;
    Else
        MsgBox &quot;没有包含合并单元格&quot;
    End If
End Sub
如果在指定区域中存在部分合并的单元格，如图 15 1所示，区域E8:I17中包含合并单元格区域F8:G9，H12:I13。判断这样一个单元格区域中是否包含合并单元格，可以使用下面的代码快速判断单元格区域中是否包含部分合并单元格，而不需要遍历单元格。</code></pre>
<p>图 15 1    包含部分合并单元格的区域</p>
<pre><code class="vb">Sub IsMerge()
    If IsNull(Range(&quot;E8:I17&quot;).MergeCells) Then
        MsgBox &quot;包含合并单元格&quot;
    Else
        MsgBox &quot;没有包含合并单元格&quot;
    End If
End Sub
代码解析：
当单元格区域中同时包含合并单元格和非合并单元格时，MergeCells属性将返回Null，因此第2行代码通过该返回结果作为判断条件。
运行IsMerge过程结果如图 15 2所示。</code></pre>
<p>图 15 2    提示信息</p>
<h4 id="15-2-合并单元格时连接每个单元格的文本"><a href="#15-2-合并单元格时连接每个单元格的文本" class="headerlink" title="15-2    合并单元格时连接每个单元格的文本"></a>15-2    合并单元格时连接每个单元格的文本</h4><p>使用Excel的“合并及居中”按钮合并多个单元格区域时，Excel仅保留区域左上角单元格的内容，如果用户希望在合并如图 15 3所示单元格区域时，将各个单元格的内容连接起来保存在合并后的单元格区域中，则可以使用下面的代码。</p>
<p>图 15 3    合并前单元格区域</p>
<pre><code class="vb">Sub Mergerng()
    Dim StrMerge As String
    Dim rng As Range
    If TypeName(Selection) = &quot;Range&quot; Then
        For Each rng In Selection
            StrMerge = StrMerge &amp; rng.Value
        Next
        Application.DisplayAlerts = False
        Selection.Merge
        Selection.Value = StrMerge
        Application.DisplayAlerts = True
    End If
End Sub
代码解析：
Mergerng过程将所选各个单元格的内容连接起来保存在合并后的单元格区域中。
第4行代码使用TypeName函数判断当前选定对象是否为Range对象，若是则继续执行代码。
第5行到第7行代码将当前选中区域的内容连接起来保存在字符串变量StrMerge中。
第8行代码将DisplayAlerts属性设置为False，禁止在合并多重数值区域时，Excel显示的警告信息，如图 15 4所示，以避免中断代码的运行。

图 15 4    合并多重数值区域时警告信息
第9行代码使用Merge方法合并当前选定区域。应用于Range对象的Merge方法通过指定Range对象创建合并单元格，语法如下：
expression.Merge(Across)
参数expression是必需的，返回一个Range对象。
参数Across是可选的，如果该值为True，则将指定区域内的每一行合并为一个合并单元格。默认值为False。
第9行也可以使用下面的代码：
Selection.MergeCells = True
第10行代码将变量StrMerge的值赋给合并后的单元格。
运行Mergerng过程结果如图 15 5所示。</code></pre>
<h4 id="15-3-合并内容相同的连续单元格"><a href="#15-3-合并内容相同的连续单元格" class="headerlink" title="15-3    合并内容相同的连续单元格"></a>15-3    合并内容相同的连续单元格</h4><p>如果需要合并如图 15 6所示的工作表中B列中部门相同的连续单元格，可以使用下面的代码。</p>
<p>图 15 6    需合并的工作表</p>
<pre><code class="vb">Sub Mergerng()
    Dim IntRow As Integer
    Dim i As Integer
    Application.DisplayAlerts = False
    With Sheet1
        IntRow = .Range(&quot;A65536&quot;).End(xlUp).Row
        For i = IntRow To 2 Step -1
            If .Cells(i, 2).Value = .Cells(i - 1, 2).Value Then
               .Range(.Cells(i - 1, 2), .Cells(i, 2)).Merge
            End If
        Next
    End With
    Application.DisplayAlerts = True
End Sub
代码解析：
第7行到第11行代码，从最后一行开始，向上逐个单元格判断连续两个单元格的内容是否相同，如果相同则合并。
运行Mergerng过程后，结果如图 15 7所示。</code></pre>
<p>图 15 7    合并内容相同的连续单元格</p>
<h4 id="15-4-取消合并单元格时在每个单元格中保留内容"><a href="#15-4-取消合并单元格时在每个单元格中保留内容" class="headerlink" title="15-4    取消合并单元格时在每个单元格中保留内容"></a>15-4    取消合并单元格时在每个单元格中保留内容</h4><p>如果需要取消如图 15 7所示的工作表中B列“部门”的合并单元格，并且各个单元格均保留原合并单元格的内容，可以使用下面的代码。</p>
<pre><code class="vb">Sub UnMerge()
    Dim StrMer As String
    Dim IntCot As Integer
    Dim i As Integer
    With Sheet1
        For i = 2 To .Range(&quot;B65536&quot;).End(xlUp).Row
            StrMer = .Cells(i, 2).Value
            IntCot = .Cells(i, 2).MergeArea.Count
            .Cells(i, 2).UnMerge
            .Range(.Cells(i, 2), .Cells(i + IntCot - 1, 2)).Value = StrMer
            i = i + IntCot - 1
        Next
    End With
End Sub
代码解析：
UnMerge过程取消工作表中B列中的合并单元格，并且各个单元格均保留原合并单元格的内容。
第7行代码取得B列每个合并单元格的内容。
第8行代码取得合并区域的单元格数量。
第9行代码使用UnMerge方法取消合并单元格。UnMerge方法将合并区域分解为独立的单元格，语法如下：
expression.UnMerge
第10行代码将原合并单元格的内容赋值给取消合并单元格后的区域。
第11行代码调整循环变量i的值，使下一次循环从下一个单元格区域开始。</code></pre>
<h3 id="技巧16-高亮显示单元格区域"><a href="#技巧16-高亮显示单元格区域" class="headerlink" title="技巧16     高亮显示单元格区域"></a>技巧16     高亮显示单元格区域</h3><p>如果希望以某种方式突出显示活动单元格或者指定的单元格区域，从而一目了然地获得某些信息，那么可以高亮显示活动单元格区域，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    Cells.Interior.ColorIndex = xlColorIndexNone
    Target.Interior.ColorIndex = 8
End Sub
代码解析：
设置工作表当前选定区域单元格的内部填充颜色，以高亮显示选定区域，如图 16 1所示。</code></pre>
<p>图 16 1    高亮显示选定区域<br>第2行代码将工作表中所有的单元格的内部填充颜色设置为xlColorIndexNone，即取消单元格的内部填充颜色。<br>第3行代码将工作表中选定单元格的内部填充颜色设置为8。<br>应用于Interior对象的ColorIndex属性返回或设置边框内部的颜色。该颜色可指定为当前调色板中颜色的编号（请参阅技巧11-1中的图 11 1）或为 XlColorIndex 常量之一：xlColorIndexAutomatic（指定对图形对象自动填充）、xlColorIndexNone（用于指定无内部填充）。<br>还可以高亮显示指定区域内的行列，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    Dim rng As Range
    Cells.Interior.ColorIndex = xlNone
    Set rng = Application.Union(Target.EntireColumn, Target.EntireRow)
    rng.Interior.ColorIndex = 24
End Sub
代码解析：
设置工作表当前选定区域单元格内部填充颜色，高亮显示活动单元格所在的行列，如图 16 2所示。
第4行代码使用Union方法将所选单元格所在的行、列连接起来成为一个区域，关于Union方法请参阅技巧1-6。 
图 16 2    高亮显示活动单元格所在的行列
注意 使用此方法时，工作表中所有设置的单元格内部填充颜色将会被清除。（不包括通过条件格式设置的单元格内部填充颜色），同时无法在工作表中实现复制粘贴功能。</code></pre>
<h3 id="技巧17-双击被保护单元格时不显示提示消息框"><a href="#技巧17-双击被保护单元格时不显示提示消息框" class="headerlink" title="技巧17     双击被保护单元格时不显示提示消息框"></a>技巧17     双击被保护单元格时不显示提示消息框</h3><p>当用户使用鼠标左键双击被保护工作表中锁定的单元格区域时，系统将显示如图 17 1所示的消息框。</p>
<p>图 17 1    系统提示消息框<br>如果不希望显示该消息框，可以在工作表Worksheet_BeforeDoubleClick事件中进行设置，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    If Target.Locked = True Then
        MsgBox &quot;此单元格已保护，不能编辑!&quot;
        Cancel = True
    End If
End Sub
代码解析：
当用户使用鼠标左键双击工作表单元格时，触发Worksheet_BeforeDoubleClick事件。该事件中的Target参数代表用户双击鼠标左键的单元格区域。
参数Cancel设置是否取消该操作。如果将参数Cancel设置为True，将不进行默认的双击操作。
第2行代码中判断用户双击鼠标左键的单元格区域是否已锁定（Range对象的Locked属性返回或设置Range对象是否锁定），如果单元格区域已锁定，则设置参数Cancel设置为True，不进行默认的双击操作，因而不再显示图 17 1所示的消息框，只显示一个自定义的提示信息，如图 17 2所示。</code></pre>
<h3 id="技巧18-重新计算工作表指定区域"><a href="#技巧18-重新计算工作表指定区域" class="headerlink" title="技巧18     重新计算工作表指定区域"></a>技巧18     重新计算工作表指定区域</h3><p>如果在工作表中含有大量公式，那么在对工作表执行重新计算操作时，可能需要较长的时间。在实际工作中，有时希望仅对指定的区域进行重新计算，以提高计算效率，那么可以使用下面的代码。</p>
<pre><code class="vb">Sub CalculationSpecialRange()
    Dim OldCalculation As XlCalculation
    OldCalculation = Application.Calculation
    Application.Calculation = xlCalculationManual
    ActiveSheet.Range(&quot;A1:D10&quot;).Calculate
    Application.Calculation = OldCalculation
End Sub
代码解析：
CalculationSpecialRange过程对单元格A1到B10区域进行重新计算。
第3行代码保存当前应用程序的Calculation属性设置。应用于Application对象的Calculation属性返回或设置当前应用程序的计算模式，可为表格 18 1所示的XlCalculation常量之一。
常量    值    含义
xlCalculationAutomatic    -4105    自动计算
xlCalculationManual    -4135    手动计算
xlCalculationSemiautomatic    2    除模拟运算表外自动计算
表格 18 1    XlCalculation 常量
第4行代码将计算模式设置为手动重算。
第5行代码重新计算活动工作表指定的单元格区域B3:D7。（指定区域之外的公式将不重新计算，但包含易失性函数的公式除外）
第6行代码恢复当前应用程序的Calculation属性设置。</code></pre>
<h3 id="技巧19-录入数据后单元格自动保护"><a href="#技巧19-录入数据后单元格自动保护" class="headerlink" title="技巧19     录入数据后单元格自动保护"></a>技巧19     录入数据后单元格自动保护</h3><p>下面的代码可以使用户在单元格录入数据后自动对已录入数据单元格进行保护,防止修改数据。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    On Error Resume Next
    Sheet1.Unprotect Password:=&quot;12345&quot;
    If Target.Value &lt;&gt; &quot;&quot; Then
        Target.Locked = True
        Sheet1.Protect Password:=&quot;12345&quot;
    End If
End Sub
代码解析：
工作表的SelectionChange事件，在单元格录入数据后自动对已录入数据单元格进行保护。
第3行代码使用Unprotect方法取消工作表的保护。应用于Worksheet 对象的Unprotect方法取消工作表的保护，如果工作表不是受保护的，则此方法不起作用，语法如下：
expression.Unprotect(Password)
参数expression是必需的，该表达式返回一个Worksheet 对象。
参数Password是可选的，指定用于解除工作表的保护的密码，此密码是区分大小写的。
第4、5行代码单元格录入数据后将Locked属性设置为True。Locked属性应用于Range对象时，如果Range对象被锁定，则该值为True，当工作表有保护时Range对象不可被修改。
第6行代码使用Protect方法保护工作表。应用于Worksheet对象的Protect方法保护工作表使其不至被修改，语法如下：
expression.Protect(Password, DrawingObjects, Contents, Scenarios, UserInterfaceOnly, AllowFormattingCells, AllowFormattingColumns, AllowFormattingRows, AllowInsertingColumns, AllowInsertingRows, AllowInsertingHyperlinks, AllowDeletingColumns, AllowDeletingRows, AllowSorting, AllowFiltering, AllowUsingPivotTables) 
其中参数expression是必需的，该表达式返回一个Worksheet对象。
参数Password是可选的，为一个字符串，该字符串为工作表指定区分大小写的密码。
其他参数都是可选参数，其功能等同于如图 19 1所示的工作表保护对话框中的各项选项，具体请参阅VBA帮助。</code></pre>
<h3 id="技巧20-工作表事件Target参数的使用方法"><a href="#技巧20-工作表事件Target参数的使用方法" class="headerlink" title="技巧20     工作表事件Target参数的使用方法"></a>技巧20     工作表事件Target参数的使用方法</h3><p>在工作表的SelectionChange事件中，参数Target代表新选定的区域，在工作表的Change事件中参数Target代表更改的区域。在实际应用中可以使用Target参数将触发工作表事件的区域限制在一定的范围内，有以下几种方法：</p>
<h4 id="20-1-使用单元格的Address-属性"><a href="#20-1-使用单元格的Address-属性" class="headerlink" title="20-1    使用单元格的Address 属性"></a>20-1    使用单元格的Address 属性</h4><p>使用单元格的Address属性可以将触发条件限制在某一个单元格中，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Address(0, 0) = &quot;A1&quot; Then
        MsgBox &quot;你选择了A1单元格&quot;
    End If
End Sub
代码解析：
当选择工作表A1单元格时显示一个消息框。
第2行代码使用Address属性返回所选单元格的区域引用，当返回的区域引用是“A1”时触发SelectionChange事件，显示一个消息框。
此方法只适用于单个单元格或者加上OR运算符可以适用于几个单元格，多则不方便。</code></pre>
<h4 id="20-2-使用Column属性和Row属性"><a href="#20-2-使用Column属性和Row属性" class="headerlink" title="20-2    使用Column属性和Row属性"></a>20-2    使用Column属性和Row属性</h4><p>使用单元格的Column属性和Row属性可以将触发条件限制在某一区域内，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_Change(ByVal Target As Range)
    If Target.Column = 1 And Target.Row &lt; 11 Then
        Target.Offset(, 1) = Val(Target) * 3
    End If
End Sub
代码解析：
当改变工作表的A1到A10单元格时，如果输入的是数值则将在对应的B列单元格写入乘以3的数值。
第2行代码使用Column属性将触发条件限制在第1列，使用Row属性将触发条件限制在第10行以内，也就是A1到A10的区域范围内。</code></pre>
<h4 id="20-3-使用Intersect方法"><a href="#20-3-使用Intersect方法" class="headerlink" title="20-3    使用Intersect方法"></a>20-3    使用Intersect方法</h4><p>使用Intersect方法可以很方便的指定一个或多个区域范围，如下面的代码所示。</p>
<pre><code class="vb">Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Not Application.Intersect(Target, Union(Range(&quot;A1:A10&quot;), Range(&quot;C1:C10&quot;))) Is Nothing Then
        MsgBox &quot;你选择了&quot; &amp; Target.Address(0, 0) &amp; &quot;单元格&quot;
    End If
End Sub
代码解析：
当选择工作表A1到A10，C1到C10单元格时将所选的单元格地址显示在消息框中。
第2行代码使用Intersect方法判断所选单元格是否与A1到A10，C1到C10单元格重叠，如果重叠说明所选单元格在A1到A10，C1到C10单元格区域内。Intersect方法返回一个Range对象，此对象代表两个或多个范围重叠的矩形区域，语法如下：
expression.Intersect(Arg1, Arg2, ...)
参数expression是可选的，返回一个Application对象。
参数Arg1, Arg2, ...是必需的，重叠的区域。必须指定至少两个Range对象。</code></pre>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">VBA</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/05/05/VBA常用技巧1--Range(单元格对象)/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-玉蜀黍 乱语 宣泄" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/01/玉蜀黍 乱语 宣泄/">玉蜀黍 乱语 宣泄</a>
    </h1>
  

        
        <a href="/2018/05/01/玉蜀黍 乱语 宣泄/" class="archive-article-date">
  	<time datetime="2018-04-30T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-05-01</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>多想还能有机会坐在我喜欢的角落，能不被人知，能偷偷看你，我想念那段自由并且幸福的时光。</p>
<h1 id="玉蜀黍-乱语-宣泄"><a href="#玉蜀黍-乱语-宣泄" class="headerlink" title="玉蜀黍 乱语 宣泄"></a>玉蜀黍 乱语 宣泄</h1><p>已是五月，自己距离离开这里也不足四十天了，想想我们认识一百多天来，真正相处的的时光也不过三十多天。它是如此短暂，三十多天与人的相识、相知，又能留下些什么呢？</p>
<p>与你相识之前，很久之前，便有关注你啊，你有很多吸引我的特质，这些特质集中到你身上，总使我充满着对这种美好的无限幻想，我自然也沉醉其中。研一上学期的那段时光很自由，我一直坐在我喜欢的角落，可以观察到班级的每一个地方，而当我的视线落于你的身上时，心底泛出别样的心绪，或是淡淡的欣赏和仰慕，或是对你熬夜困顿的牵挂和怜忧。</p>
<p>自己从未想过在这样一个阶段开始一段恋情，爱情于我而言是奢侈品，一直觉得自己没有资格去消费和享受这种奢华的精神商品。我对自己是如此的不自信，甚至有时候是那么自卑，我常给予自己这种暗示：不应该去触碰、更不能拥有它，即便是遇到了喜欢的人。</p>
<p>当我得知你也喜欢我的时候，我很紧张，也很担忧，担心自己不够好，担心很多很多。幸福和美好总是到来地猝不及防，很开心于你的有美好的相识和相知，我真是幸运。与你深渐渐相处，发现你的很多美好的品质，是我喜欢和欣赏的，你对我来说是对的人。一直觉得自我提升比爱情重要，比这种儿女情长的美好重要。然而，当我陷入其中时，我的理性、原来奉行的原则和价值都不自觉抛到了脑后。一切都变得不重要了，我过往的目标、期盼，都不重要了，重要的是我们，我真想跟你待在一起，现在是，未来也是，和你一起做喜欢的事，便是幸福。</p>
<p>命运总是捉弄人，当我准备想要与你更好走下去时，你却离开了。那些热情美好，为什么来的快并且热烈，而褪去也如此迅速，人与人的羁绊和际遇又为什么如此短暂。</p>
<p>我一直都不是自信的人，我有时候会害怕这种突入起来的天外之物闯入我的世界而把我的生活搅的天翻地覆。现在的我的状况，此刻的我，大概用痛苦来形容吧。很揪心，很想念你，很想看到你，此刻我还不如一个普通的同学，可以和你在一个教室听课，如此微小的期盼都难以满足。</p>
<p>我也常告诫自己，不要再想念你了，就像你说的，不要在你身上浪费时间了，我也知道这是理智的。但是，我做不到，我也不愿意去压抑自己的情感，不在专注学习的时候，自己的思维总是被你占据，刷你的微博。有时候我也会抱怨，你会关注那么多人，甚至是不熟悉的人，恰偏偏多关注我一个就不不可以。我心底十足揪心，无奈，很深的刺痛，又伴随着十足的挫败感。不能让喜欢的人喜欢自己，原来是那么痛苦，我已经不记得我上一次觉得自己是如此失败如此痛苦的时刻了，当下的我确是这样揪心。老天，如果你让我承受这种折磨，我很想知道你带给了我什么。幸福总是那么短暂，现在那些美好，都离我远去。走在校园里，树木、花朵、微笑着的人群，第一次觉得自己与这里是那么格格不入。我真的想逃离这里，逃离这个伤心的地方。思念你却无法对你说，只能在我的博客上疏散我的苦楚，这里是我的树洞，我不想任何人知道，如果有一天，我足够幸运，你还在我身边，我真想让你看过去的我，曾那么思念你的我。</p>
<p>我是一个感性的人，对很多细微的事都很敏感。我真的不知道我们短暂的几十天的相逢，对你的思念会让我留恋几天。可是你现在已经不喜欢我了，你的喜欢为何是如此短暂，为什么就不能再长久一点呢，我也很自责，没能给到你想要的东西。但是，我也多想你也能喜欢我，若是你准备好了走入我的生活，为什么在我正对你情感正浓的时候离开我，你的离去是如此决绝和坚毅。每每想到这里，我真的做不到，我无法主动去联系你，我不那么贫贱一定要绕着你走，哪怕自己遍体鳞伤，那么心脏被撕裂到支离破碎，我也不会找你的。我放不下你，但是你已经 不需要我了，甚至我对你的关注只会引起你的厌恶，我不喜欢这样。</p>
<p>想想这个过程中的我们，现在真希望还能回到上学期，那些我坐在角落的日子，很自由，可以无顾忌的看你，而现在，连跟你待在一个教室都要思考很长时间。我不想躲避你，也不想你躲避我。自己的情绪随时都会爆发出来，而现在只能自己一个人承受，也没有关系，我本来就是一个人。真希望还有很多次机会，能坐在角落里看着你，跟你待在同一个教室里，知道你还在我身边，哪怕不说话，哪怕你不知道我的存在，我抬头能够看到你，真的是一件幸福的事。</p>
<p>我还很在乎你，还很喜欢你，我希望我曾经喜欢的人也会有我喜欢的样子，我祝福你。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">自言语</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の迹//" class="article-tag-list-link color4">生の迹</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/05/01/玉蜀黍 乱语 宣泄/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-白橡 思念 四月" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/白橡 思念 四月/">白橡 思念 四月</a>
    </h1>
  

        
        <a href="/2018/04/28/白橡 思念 四月/" class="archive-article-date">
  	<time datetime="2018-04-27T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-04-28</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这里的冬天受了春的惊扰，一切都变得生机盎然。我却无心流连于校园里的紫丁香和桃花，思想闲暇游离时，都尽是被你占据，时光流逝了一月，我仿佛跋涉了三载。</p>
<h1 id="白橡-思念-四月"><a href="#白橡-思念-四月" class="headerlink" title="白橡 思念 四月"></a>白橡 思念 四月</h1><p>选择一个值得纪念的日子，我们相识的那天，缘起。从那天开始，我想记录自己，记录关于自己的生长、撕裂、快乐以及忧愁。名字叫生长印迹，我更喜欢“生长”这个词，而不是“成长”，我在生长，此为印迹。</p>
<p>我喜欢<a href="http://nipponcolors.com/#shirotsurubami" target="_blank" rel="noopener">NIPPON COLORS</a>，今天是第100天，我选择编号为100的白橡为题。</p>
<p>从认识她那天起，到今天已经壹佰天了。今天自己无心学习，也尽情释放自己的思绪，任由心脏被海浪拍打，痛苦肆意蔓延全身至支离破碎。</p>
<p>我很惋惜、很失落、很痛苦，明明只是一个月前，那份相识相知的美好却已只能拿来作为纪念，而我的怀念与留恋，或许只属于自己一个人。一个多月来，自己的心情波动起伏，像过山车一样上上下下，本以为自己能很轻松放下这些，没想到在这方面我真是错误地高估了自己。想起原来的管理学老师曾说过，人在自己情绪不稳定的情况下，最好不要做决策。现在想想，如果自己能在相处的过程中也遵循的话，或许不会是这样的结局。但是过去了就是过去了，我无法改变它，我能做的只有怀念和向前走。</p>
<p>喜欢一个人，思念一个人，真想立即对她说：我想念你。但是，我知道，就算我说了，她给我的至多也只是朋友间的关怀，我不想要这些，我只想她还能喜欢我，我多希望她下次跟我说的第一句话是：我想念你了。</p>
<p>自己虽不是孩子，但真的还不是大人，不能很好照顾一个人，自己还不足够好，还没有为迎接这份美好做足准备。现在的自己，要尽快从这份痛苦中走出来，我不能止步于此，因为生活在往前走，它不会等我，况且，如果我就此消沉，我喜欢的她反而更不会喜欢我。</p>
<p>不管在过去的时光里，自己有过多少的负面情绪，而在自己情绪平稳的时候，每每想到和她的相处的那段时光，我总是忍不住会笑出来。那些时光，真的，真的，给我很多温暖和感动，就连此刻平静的自己也能真切感受到那种温暖。所以，还是很幸运能遇见自己喜欢的女孩子，我真希望我们的际遇不会到此结束，甚至我都不相信会如此。</p>
<p>此刻，我看着窗外泛黄的灯光，我又想起了那些和她相处的美好。</p>
<p>那时，我和喜欢的人一起漫步在校园里，淡黄的灯光映衬柔美的月色，我的女孩子还站在我的左侧，我多想多想能有足够好的文笔来记录那美好的瞬间，极致温暖沁润我心。每每和她这样漫步在夜色中，我总有意识放慢步伐，我希望时光能慢一点再慢一点，让我更真切地感知这些与她相处的弥足。</p>
<p>想说：我或许是你现阶段人生的过客，但我想生长为那个归人。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">自言语</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の迹//" class="article-tag-list-link color4">生の迹</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/04/28/白橡 思念 四月/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Oracle11g--基础知识" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/21/Oracle11g--基础知识/">Oracle--基础知识</a>
    </h1>
  

        
        <a href="/2018/04/21/Oracle11g--基础知识/" class="archive-article-date">
  	<time datetime="2018-04-20T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-04-21</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="第一天：数据库系统概述"><a href="#第一天：数据库系统概述" class="headerlink" title="第一天：数据库系统概述"></a>第一天：数据库系统概述</h1><p>学习目标：</p>
<ul>
<li>数据库的基本概念</li>
<li>数据管理技术的发展</li>
<li>数据模型</li>
<li>数据库系统的体系结构</li>
</ul>
<h2 id="数据库的基本概念"><a href="#数据库的基本概念" class="headerlink" title="数据库的基本概念"></a>数据库的基本概念</h2><h3 id="数据和数据库"><a href="#数据和数据库" class="headerlink" title="数据和数据库"></a>数据和数据库</h3><p><strong>数据(Data)</strong>：描述事物的符号记录称为“数据”，数据是数据库中的基本对象。</p>
<p><strong>数据库</strong>(DataBase,DB)：数据库是被长期存放在计算机内、有组织的、可以表现为多种形式的、可共享的数据的集合，这是数据库“硬”的含义。另一方面，数据库是数据管理系统的新方法和技术。数据库技术使数据能按一定格式组织、描述和存储，且具有较小的冗余度、较高的数据独立性和易扩展性，并可以为多个用户所共享，这是数据库“软”的含义。</p>
<h3 id="数据库管理系统"><a href="#数据库管理系统" class="headerlink" title="数据库管理系统"></a>数据库管理系统</h3><p>数据库管理系统(DBMS)是位于用户和操作系统之上的一层数据管理软件，功能如下：</p>
<ul>
<li>数据定义功能：方便用户对相关内容进行定义</li>
<li>数据操纵功能：用户可以实现对数据库的基本操作，例如增删查改。</li>
<li>数据组织、存储与管理：何种文件结构存储，提高存储空间利用率，如何实现数据间的联系，选择合适的存取方法以提高存取效率。</li>
<li>数据库的运行管理：DBMS的核心，包括并发控制、安全性检查、完整性约束条件的检查和处理、数据库的内部维护等。</li>
<li>数据库的建立和维护功能：数据库的建立和维护功能包括数据库初始数据的输入、转换，数据库存储、恢复功能，数据库的重新组织功能和性能监视和分析功能。</li>
<li>数据字典(DD:Data Dictionary)：是关于数据的信息集合，是一种用户可以访问的记录数据库和应用程序元数据的目录。</li>
<li>数据通信功能：包括与操作系统的联机处理、分时处理和远程作业传输的相应借口等。</li>
</ul>
<h3 id="数据库系统"><a href="#数据库系统" class="headerlink" title="数据库系统"></a>数据库系统</h3><p>数据库系统(DBS)通常是指带有数据库的计算机应用系统，因此数据系统不仅包括相应数据本身，还包括相应的硬件支持环境和维护人员等。</p>
<p>用户=&gt;数据库应用软件=&gt;应用开发工具=&gt;高级语言及编译系统=&gt;数据库管理系统=&gt;操作系统=&gt;数据库=&gt;数据库管理</p>
<p>在数据库系统中，数据模型主要有层次模型、网状模型和关系模型三种（面向对象模型仍在探索），目前理论成熟使用普及的模型便是关系模型。</p>
<h2 id="关系数据库设计理论"><a href="#关系数据库设计理论" class="headerlink" title="关系数据库设计理论"></a>关系数据库设计理论</h2><p>###实体和属性</p>
<p>模型**是对过程和对象的抽象化，经过模型可以深入了解复杂系统的主要特征。</p>
<p><strong>实体</strong>，是指客观存在的事物，可通过它的若干属性的值来描述。属性是事物某方面的特征，所谓关系，是指实体集之间的联系。关系有3种不同的类型：</p>
<ul>
<li>1:1型，即实体集合之间形成一对一的关系</li>
<li>1:m型，即实体集合之间形成一对多的关系</li>
<li>m:n型，即实体集合的多对多的关系</li>
</ul>
<p>参加一个联系的实体集可以只有一个，也可以是多个，实体间发生联系后，可能产生某些属性。在实体、属性和关系三要素的基础上作E-R图的步骤是：</p>
<ul>
<li>⑴用长方形框表示实体集，在框内写上实体名。</li>
<li>⑵用菱形框表示实体集之间的联系，在菱形框内写上联系的名称，用弧或线段连接菱形框与有关长方形框（实体），并注明1:1、1:m或m:n的函数关系。</li>
<li>⑶用椭圆框表示实体的属性，在椭圆框中标上属性名，用线段连接实体和它的属性。</li>
</ul>
<p>###关系模型</p>
<p><strong>关系模型</strong>：用二维表格结构来表示实体及实体间联系的模型称为关系模型。以下为基本概念：</p>
<ul>
<li>关系模式（relational schema）：在二维表格中，行定义（记录的型）称为关系模式。</li>
<li>元组（tuple）与关系：在二维表中行（记录的值）称为元组，元组的集合称为关系，关系模式通常也称关系。</li>
<li>关键字或码（key）：在关系的属性中，能够用来唯一标识元组的属性（或属性组合）称为关键字或码。关系中的元组由关键字的值唯一确定，关键字不能为空。例如，学生表中学号就是关键字。</li>
<li>候选关键字或候选码（candidate key）：如果一个关系中，存在着多个属性（或属性组合）都能用来唯一标识该关系的元组，这些属性或属性的组合称为该关系的候选关键字或候选码。</li>
<li>主关键字或主码（primary key）：若一个关系中存在若干候选关键字，则从中指定关键字的属性（或属性组合）称为该关系的主关键字或主码。</li>
<li>非主属性或非关键字属性（non primary attribute）：关系中不能组成关键字的属性均为非主属性或非关键字属性。</li>
<li>外部关键字或外键（foreign key）：当关系中的某个属性或属性组合虽不是该关系的关键字或只是关键字的一部分，但却是另一个关系的关键字时，该属性或属性组合称为这个关系的外部关键字或外键。</li>
<li>从表与主表：以某属性为主键的表称为主表，以此属性为外键的表称为从表。例如，学生（学号，姓名，性别，出生日期，入学时间，系部代码）与选课（学号，课程号，成绩）两个表，对于“选课”表，“学号”是外键，对于“学生”表为主表，“选课”表为从表。</li>
</ul>
<h3 id="关系型数据库的设计范式"><a href="#关系型数据库的设计范式" class="headerlink" title="关系型数据库的设计范式"></a>关系型数据库的设计范式</h3><p><strong>函数依赖</strong>：假设有关系模式R(U),x和y是属性集U的子集合，函数依赖是形为x-&gt;y的一个命题，对任意R中的两个元组t和s，都有t[x]=s[x]蕴含t[y]=s[y],那么x-&gt;y在关系模式R(U)中成立。x-&gt;y解释为x决定了y,或者y依赖于x.<br><strong>第一范式(1NF）</strong>：如果关系模式R的每一个关系r的属性都是不可分割的数据项，那么称R是第一范式的模式。<br>简单的讲：每个属性都是原子项，不可分割。</p>
<p>说明：在任何一个关系数据库中，第一范式（1NF）是对关系模式的设计基本要求，一般设计中都必须满足第一范式（1NF）。不过有些关系模型中突破了1NF的限制，这种称为非1NF的关系模型。换句话说，是否必须满足1NF的最低要求，主要依赖于所使用的关系模型。</p>
<p><strong>第二范式(2NF)</strong>：如果关系模式R是第一范式，且每个非主属性完全函数依赖于候选键（或主键），那么我们称R是第二范式的模式。第二范式（2NF）<strong>要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性</strong>，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。为实现区分通常需要为表加上一个列，以存储各个实例的唯一标识。简而言之，第二范式就是在第一范式的基础上属性完全依赖于主键。</p>
<p><strong>第三范式（3NF)</strong>：如果关系模式是第二范式，且关系模式中的所有非主属性都任何候选关键字都不存在传递依赖，则称关系R是属于第三范式。第三范式（3NF）是第二范式（2NF）的一个子集，即满足第三范式（3NF）必须满足第二范式（2NF）。简而言之，第三范式（3NF）要求一个关系中不包含已在其它关系已包含的非主关键字信息。例如，存在一个部门信息表，其中每个部门有部门编号（dept_id）、部门名称、部门简介等信息。那么在员工信息表中列出部门编号后就不能再将部门名称、部门简介等与部门有关的信息再加入员工信息表中。如果不存在部门信息表，则根据第三范式（3NF）也应该构建它，否则就会有大量的数据冗余。简而言之，第三范式就是属性不依赖于其它非主属性，也就是在满足2NF的基础上，任何非主属性不得传递依赖于主属性。</p>
<h1 id="第二天：Oracle概述"><a href="#第二天：Oracle概述" class="headerlink" title="第二天：Oracle概述"></a>第二天：Oracle概述</h1><h2 id="Oracle数据库管理工具"><a href="#Oracle数据库管理工具" class="headerlink" title="Oracle数据库管理工具"></a>Oracle数据库管理工具</h2><p>常用Oracle服务：在Windows操作系统环境下，oracle数据库服务器是以系统服务的方式运行的。可以通过“控制面板”|“管理工具”|“服务”命令，打开系统服务窗口查看Oracle服务。在系统“服务”窗口中，所有的Oracle服务名称都是以“Oracle”开头的。主要的服务如下所示：</p>
<ul>
<li>OracleJobSchedulerORCL：Oracle作业调度服务，一般默认设置成禁用。</li>
<li>Oracle<oracle_home_name>TNSListener：监听服务程序<oracle_home_name>，为Oracle的主目录。</oracle_home_name></oracle_home_name></li>
<li>OracleService&lt;SID&gt;：Oracle数据库实例服务，它是Oracle数据库的主要服务，这个服务会自动地启动和停止数据库。SID为创建的数据库实例的标识，此服务被默认设置为自动启动。</li>
</ul>
<p><strong>SQL Plus工具</strong></p>
<p><strong>SQLPlus</strong>是Oracle公司提供的一个工具程序，它是用户和服务器之间的一种接口，是操作Oracle数据库的工具。有如下功能：</p>
<ul>
<li>对数据库的数据进行增加、删除、修改、查询的操作；</li>
<li>将查询结果输出到报表表格中，设置表格格式和计算公式，不可以把表格存储起来；</li>
<li>启动、连接和关闭数据库；</li>
<li>管理数据库对象，如用户、表空间、角色等对象；</li>
</ul>
<p><strong>SQLPlus</strong>命令的一般语法如下：</p>
<pre><code class="sql">SQLPlus [ user_name[ / password][ @connect_identifier] ]
    [As { SYSOPER | SYSDBA | SYSASM } ] | / NOLOG ] 
/*
user_name:制定数据库的用户名
password:制定数据库用户的命令。
@connect_identifier:指定要连接的数据库。
As:用来指定管理权限，权限可选值为SYSDBA,SYSOPER和SYSASM。
SYSDBA:具有SYSOPER权限的管理员可以启动和关闭数据库，执行联机和脱机备份，归档当前重做日志文件，连接数据库。
SYSOPER:SYSDBA权限包含SYSOPER的所有权限，另外还能够创建数据库，并且授权SYSDBA或SYSOPER给其他数据库用户。
SYSASM:SYSASM权限是Oracle DataBase 11g的新增特性，是ASM实例所特有的，用于数据库存储管理。
NOLOG:表示不计入日志文件。
*/</code></pre>
<p>Oracle数据库12c的企业管理器<strong>Enterprise Manager</strong>（简称EM）是以图形化界面的方式来实现对数据库的管理的，它为数据库的使用提供了方便。由于EM采用基于Web的应用，它对数据库的访问也采用了HTTP/HTTPS协议，即使用三层结构访问Oracle数据库系统。EM通过一个抽象层为最终用户隐藏了底层架构的复杂性。这种抽象通过图形化（GUI）和程序化（API）的自服务接口提供。</p>
<p><strong>SQL Developer</strong>:Developer允许用户创建并维护数据库对象，查看和维护数据，编写、维护并调试PL/SQL代码。这款工具以其简洁整齐的图形用户界面大大简化了开发工作。</p>
<p><strong>PL/SQL Developer</strong>：Oracle SQL Developer是Oracle提供的免费图形化开发工具，TOAD和PL/SQL Developer是商业性的工具，需要付费，但是使用的人也较多。相对来说，对于初学者PL/SQL Developer工具更容易上手，专门用于开发、测试、调试和优化Oracle PL/SQL存储程序单元。</p>
<h2 id="Oracle-DataBase存储结构"><a href="#Oracle-DataBase存储结构" class="headerlink" title="Oracle DataBase存储结构"></a>Oracle DataBase存储结构</h2><p> <img src="https://jiangmoting-post-1256428291.cos.ap-guangzhou.myqcloud.com/img/2018-04/oracle.png" alt></p>
<p>###概述</p>
<p>在Oracle数据库管理系统中有3个重要的概念需要理解:</p>
<ul>
<li><strong>实例</strong>是指一组Oracle后台进程以及在服务器中分配的共享内存区域；</li>
<li><strong>数据库</strong>是由基于磁盘的数据文件、控制文件、日志文件、参数文件和归档日志文件等组成的物理文件集合；</li>
<li><strong>数据库服务器</strong>是指管理数据库的各种软件工具（比如，sqlplus、OEM等）和实例及数据库三个部分。</li>
</ul>
<p>从实例与数据库之间的辩证关系来讲，实例用于管理和控制数据库；而数据库为实例提供数据。一个数据库可以被多个实例装载和打开；而一个实例在其生存期内只能装载和打开一个数据库。</p>
<p>注：此图右下角为物理存储结构。</p>
<p><img src="https://jiangmoting-post-1256428291.cos.ap-guangzhou.myqcloud.com/img/2018-04/oracle%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt></p>
<h3 id="数据库实例"><a href="#数据库实例" class="headerlink" title="数据库实例"></a>数据库实例</h3><p>Oracle数据库系统指具有管理Oracle数据库功能的计算机系统。每一个运行的Oracle数据库都对应一个Oracle实例（Instance），一个Oracle实例为存取和控制数据库的软件机制。当数据库服务器上的一个数据库启动时，Oracle将分配一块内存区间，叫做系统全局区（SGA），并启动一个或多个Oracle进程。因此实例是一组内存结构和后台进程的集合。</p>
<p>用户访问数据库的操作是通过实例来完成的。当数据库服务器启动时，首先启动实例，然后加载并打开数据库。当用户访问数据库时，数据库服务器便为用户进程启动一个服务器进程，负责处理用户进程的所有请求。为了区分不同的实例，每个实例都有一个系统标识符SID，通常SID与数据库同名。每个服务器进程的命名也与SID相匹配。</p>
<h3 id="数据库的逻辑存储结构"><a href="#数据库的逻辑存储结构" class="headerlink" title="数据库的逻辑存储结构"></a>数据库的逻辑存储结构</h3><p><img src="https://jiangmoting-post-1256428291.cos.ap-guangzhou.myqcloud.com/img/2018-04/oracle%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt></p>
<p><strong>数据块:</strong>Oracle逻辑存储结构中的最小的逻辑单位，也是执行数据库输入输出操作的最小存储单位。Oracle数据存放在“Oracle数据块”中，而不是“操作系统块”中。通常Oracle数据块是操作系统块的整数倍，如果操作系统快的大小为2048B，并且Oracle数据块的大小为8192B，则表示Oracle数据块由4个操作系统块构成。Oracle数据块有一定的标准大小，其大小被写入到初始化参数DB_BlOCK_SIZE中。另外，Oracle支持在同一个数据库中使用多种大小的快，与标准块大小不同的块就是非标准块。</p>
<p><strong>“数据区“和“段“：</strong>也可称作数据扩展区，是由一组连续的Oracle数据块所构成的Oracle存储结构，一个或多个数据块组成一个数据区，一个或多个<strong>数据区</strong>再组成一个<strong>段（Segment）</strong>。当一个段中的所有空间被使用完后，Oracle系统将自动为该段分配一个新的数据区，数据区是Oracle存储分配的最小单位，Oracle就以数据区为单位进行存储控件的扩展。使用数据区的目的是用来保存特定数据类型的数据，也是表中数据增长的基本单位。在Oracle数据库中，分配存储空间就是以数据区为单位的。一个Oracle对象包含至少一个数据区。设置一个表或索引的存储参数包含设置它的数据区大小。</p>
<p><strong>表空间</strong>：Oracle使用表空间将相关的逻辑结构（比如段、数据区等）组合在一起，表空间是数据库的最大逻辑划分区域，通常用来存放数据表、索引、回滚段等数据对象（即Segment），任何数据对象在创建时都必须被指定存储在某个表空间中。表空间（属逻辑存储结构）与数据文件（属物理存储结构）相对应，一个表空间由一个或多个数据文件组成，一个数据文件只属于一个表空间；<strong>Oracle数据的存储空间在逻辑上表现为表空间，而在物理上表现为数据文件</strong>。举个例子来说，表空间相当于操作系统中的文件夹，而数据文件就相当于文件夹中的文件。每个数据库至少有一个表空间（即SYSTEM表空间），表空间的大小等于所有从属于它的数据文件大小的总和。</p>
<h3 id="数据库的物理存储结构"><a href="#数据库的物理存储结构" class="headerlink" title="数据库的物理存储结构"></a>数据库的物理存储结构</h3><p><img src="https://jiangmoting-post-1256428291.cos.ap-guangzhou.myqcloud.com/img/2018-04/oracle%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt></p>
<p><strong>数据文件：</strong>用于保存用户应用程序数据和Oracle系统内部数据的文件，这些文件在操作系统中就是普通的操作系统文件，Oracle在创建表空间的同时会创建数据文件。Oracle数据库在逻辑上由表空间组成，每个表空间可以包含一个或多个数据文件，一个数据文件只能隶属于一个表空间。</p>
<p><strong>控制文件：</strong>控制文件是一个二进制文件，它记录了数据库的物理结构，其中主要包含数据库名、数据文件与日志文件的名字和位置、数据库建立日期等信息。控制文件一般在Oracle系统安装时或创建数据库时自动创建，控制文件所存放的路径由服务器参数文件spfileorcl.ora的control_files参数值来指定。由于控制文件存放有数据文件、日志文件等的相关信息，因此，Oracle实例在启动时必须访问控制文件。如果控制文件正常，实例才能加载并打开数据库；但若控制文件中记录了错误的信息，或者实例无法找到一个可用的控制文件，则实例无法正常启动。</p>
<p><strong>日志文件</strong>：日志文件的主要功能是记录对数据所作的修改，对数据库所作的修改几乎都记录在日志文件中。在出现问题时，可以通过日志文件得到原始数据，从而保障不丢失已有操作成果。Oracle的日志文件包括重做日志文件（Redo Log File）和归档日志文件（Archive Log File），它们是Oracle系统的主要文件之一，尤其是重做日志文件，它是Oracle数据库系统正常运行所不可或缺的。下面将介绍这两种日志文件。</p>
<p><strong>服务器参数文件：</strong>SPFILE（ServerparameterFile）是二进制文件，用来记录了Oracle数据库的基本参数信息（如，数据库名、控制文件所在路径、日志缓冲大小等）。数据库实例在启动之前，Oracle系统首先会读取SPFILE参数文件中设置的这些参数，并根据这些初始化参数来配置和启动实例。比如，设置标准数据块的大小（即参数db_block_size的值）、设置日志缓冲区的大小（即参数log_buffer的值）等等，所以SPFILE参数文件非常重要。服务器参数文件在安装Oracle数据库系统时由系统自动创建，文件的名称为SPFILEsid.ora，sid为所创建的数据库实例名。与早期版本的初始化参数文件INITsid.ora不同的是，SPFILE中的参数由Oracle系统自动维护，如果要对某些参数进行修改，则尽可能不要直接对SPFILE进行编辑，最好通过企业管理器（OEM）或ALTERSYSTEM命令来修改，所修改过的参数会自动写到SPFILE中。</p>
<p><strong>密码文件、警告文件、跟踪文件</strong>：Oracle系统运行时，除了必须的数据文件、控制文件、日志文件及服务器参数文件外，还需要一些辅助文件，如，密码文件、警告文件和跟踪文件，下面将对这些辅助文件进行简单的介绍。</p>
<h3 id="Oracle11g服务器结构"><a href="#Oracle11g服务器结构" class="headerlink" title="Oracle11g服务器结构"></a>Oracle11g服务器结构</h3><p><strong>系统全局区（System Global Area）：</strong>是所有用户进程共享的一块内存区域，也就是说，SGA中的数据资源可以被多个用户进程共同使用。SGA主要由高速数据缓冲区、共享池、重做日志缓存区、java池和大型池等内存结构组成。SGA随着数据库实例的启动而加载到内存中，当数据库实例关闭时，SGA区域也就消失了。</p>
<p><strong>程序全局区（Program Global Area）：</strong>也可称作用户进程全局区，它的内存区在进程私有区而不是共享区中。虽然PGA是一个全局区，可以把代码、全局变量和数据结构都可以存放在其中，但区域内的资源并不像SGA一样被所有的用户进程所共享，而是每个Oracle服务器进程都只拥有属于自己的那部分PGA资源。在程序全局区（PGA）中，一个服务进程只能访问属于它自己的那部分PGA资源区，各个服务进程的PGA区的总和即为实例的PGA区的大小。通常PGA区由私有SQL区和会话区组成。</p>
<p><strong>前台进程：</strong></p>
<p> 用户进程是指那些能够产生或执行SQL语句的应用程序，无论是SQL*Plus，还是其它应用程序，只要是能生成或执行SQL语句，都被称作用户进程。</p>
<p>服务进程就是用于处理用户会话过程中向数据库实例发出的SQL语句或SQL*Plus命令，它可以分为专用服务器模式和共享服务器模式。</p>
<p><strong>后台进程：</strong>是一组运行于Oracle服务器端的后台程序，是Oracle实例的重要组成部分。进程包括DBWR、CKPT、LGWR、ARCH、SMON、PMON、LCKN、RECO、DNNN、SNPN。其中SMON、PMON、DBWR、LGWR和CKPT这5个后台进程必须正常启动，否则将导致数据库实例崩溃。此外，还有很多辅助进程，用于实现相关的辅助功能，如果这些辅助进程发生问题，只是某些功能受到影响，一般不会导致数据库实例崩溃。</p>
<h2 id="Oracle数据字典简介"><a href="#Oracle数据字典简介" class="headerlink" title="Oracle数据字典简介"></a>Oracle数据字典简介</h2><p>Oracle数据字典的名称由前缀和后缀组成，使用下划线“_”连接，其代表的含义如下：</p>
<ul>
<li>DBA_：包含数据库实例的所有对象信息。</li>
<li>V$_：当前实例的动态视图，包含系统管理和系统优化等所使用的视图。</li>
<li>USER_：记录用户的对象信息。_</li>
<li>_GV_：分布式环境下所有实例的动态视图，包含系统管理和系统优化使用的视图。</li>
<li>ALL_：记录用户的对象信息机被授权访问的对象信息。</li>
</ul>
<table>
<thead>
<tr>
<th>数据字典名称</th>
<th>说    明</th>
</tr>
</thead>
<tbody><tr>
<td>dba_tablespaces</td>
<td>关于表空间的信息</td>
</tr>
<tr>
<td>dba_ts_quotas</td>
<td>所有用户表空间限额</td>
</tr>
<tr>
<td>dba_free_space</td>
<td>所有表空间中的自由分区</td>
</tr>
<tr>
<td>dba_segments</td>
<td>描述数据库中所有段的存储空间</td>
</tr>
<tr>
<td>dba_extents</td>
<td>数据库中所有分区的信息</td>
</tr>
<tr>
<td>dba_tables</td>
<td>数据库中所有数据表的描述</td>
</tr>
<tr>
<td>v$database</td>
<td>描述关于数据库的相关信息</td>
</tr>
<tr>
<td>v$datafile</td>
<td>数据库使用的数据文件信息</td>
</tr>
<tr>
<td>v$log</td>
<td>从控制文件中提取有关重做日志组的信息</td>
</tr>
<tr>
<td>v$logfile</td>
<td>有关实例重置日志组文件名及其位置的信息</td>
</tr>
</tbody></table>
<h1 id="第三天：SQL-Plus命令"><a href="#第三天：SQL-Plus命令" class="headerlink" title="第三天：SQL*Plus命令"></a>第三天：SQL*Plus命令</h1><h2 id="SQL-Plus与数据库的交互"><a href="#SQL-Plus与数据库的交互" class="headerlink" title="SQL*Plus与数据库的交互"></a>SQL*Plus与数据库的交互</h2><p>SQL<em>Plus工具主要用来进行数据查询和数据处理。利用SQL</em>Plus可将SQL和Oracle专有的PL/SQL结合起来进行数据查询和处理。SQL*Plus工具具备以下功能：</p>
<ul>
<li>定义变量，编写SQL语句。</li>
<li>插入、修改、删除、查询，以及执行命令和PL/SQL语句。比如，执行showparameter命令。</li>
<li>格式化查询结构、运算处理、保存、打印机输出等。</li>
<li>显示任何一个表的字段定义，并实现与用户进行交互。</li>
<li>完成数据库的几乎所有管理工作。比如，维护表空间和数据表。</li>
<li>运行存储在数据库中的子程序或包。</li>
<li>以sysdba身份登录数据库实例，可以实现启动/停止数据库实例。</li>
</ul>
<p><strong>启动数据库</strong>：Oracle数据库实例的启动过程分为3步骤，分别是启动实例、加载数据库、打开数据库。用户可以根据实际情况的需要，以不同的模式启动数据库，启动数据库所使用的命令格式如下:</p>
<pre><code class="sql">STARTUP [nomount | mount | open | force][pfile=filename]
/*
nomount:表示启动实例不加载数据库。
mount:表示启动实例、加载数据库并保持数据库的关闭状态。、
open:表示启动实例、加载并打开数据库，这是个默认选项。
force:表示终止实例并重新启动数据库
restrict:用于指定已受限制的会话方式启动数据库。
pfile:用于指定启动实例时所使用的文本参数文件，filename就是文件名。
*/</code></pre>
<p><strong>关闭数据库</strong>:关闭数据库实例也分为3个步骤，分别是关闭数据库、卸载数据库、关闭Oracle实例。在SQL*Plus中，可以使用shutdown语句关闭数据库，其具体语法格式如下：</p>
<pre><code class="sql">SHUTDOWN [normal | transactional | immediate | abort]
/*
normal:表示以正常方式关闭数据库
transactional:表示在当前所有的活动事物被提交完毕后，关闭数据库。
immediate:表示在尽可能短的时间内立即关闭数据库。
abort:表示以终止方式来关闭数据库。
*/</code></pre>
<h2 id="SQL-Plus的运行环境"><a href="#SQL-Plus的运行环境" class="headerlink" title="SQL*Plus的运行环境"></a>SQL*Plus的运行环境</h2><p> <strong>Set命令</strong>：在Oracle11g数据库中，用户可以使用SET命令来设置SQL*Plus的运行环境，SET命令的语法格式为：</p>
<pre><code class="sql">SET system_variable  value
/*system_variable:表示变量名,value:表示变量值*/</code></pre>
<p>以下为常用 SET命令：</p>
<pre><code class="sql">SET AUTO[COMMIT] {ON|OFF|IMM[EDIATE]| n}    /*设置当前session 是否对修改的数据进行自动提交 */
SET ECHO {ON|OFF}              /* 在用start 命令执行一个sql 脚本时，是否显示脚本中正在执行的SQL 语句 */
SET FEED[BACK] {6|n|ON|OFF}  /* 是否显示当前sql语句查询或修改的行数,默认只有结果大于6 行时才显示结果                               的行数。如果set feedback 1，则不管查询到多少行都返回。当为off 时，一                                律不显示查询的行数*/
SET HEA[DING] {ON|OFF}          /* 当set heading off 时，在每页的上面不显示列标题，而是以空白行代替*/
SET LIN[ESIZE] {80|n}           /* 如果一行的输出内容大于设置的一行可容纳的字符数，则折行显示。*/
SET markup html                 /* 输出的数据为html 格式 */
SET NEWP[AGE] {1|n|NONE}      /* 当set newpage 0  时，会在每页的开头有一个小的黑方框。当set newpage                               n时，会在页和页之间隔着n 个空行。当set newpage none  时，会在页和页                                之间没有任何间隔。*/
SET NULL text                  /*显示时，用text 值代替NULL 值 */
SET PAGES[IZE] {24|n}       /*设置一页有多少行数，如果设为0，则所有的输出内容为一页并且不显示列标题 */
SET TERM[OUT] {ON|OFF}      /*在用spool 命令将一个大表中的内容输出到一个文件中时，将内容输出在屏幕上会                             耗费大量的时间，设置set termspool off 后，则输出的内容只会保存在输出文                             件中，不会显示在屏幕上，极大的提高了spool 的速度。*/
SET TRIMS[OUT] {ON|OFF}     /* 将SPOOL 输出中每行后面多余的空格去掉 */
SET TIMING {ON|OFF}         /* 显示每个sql 语句花费的执行时间 */
SET SERVEROUT[PUT] {ON|OFF} /* 是否显示用DBMS_OUTPUT.PUT_LINE 包进行输出的信息。*/
SET SQLBLANKLINES ON /*遇到空行时不认为语句已经结束，从后续行接着读入。Sql*plus 中,  不允许sql 语句中                        间有空行, 这在从其它地方拷贝脚本到sql*plus 中执行时很麻烦.  比如下面的脚本: 
                       select deptno, empno, ename 
                       from emp 
                       where empno = &#39;7788&#39;; 
                       如果拷贝到sql*plus 中执行,  就会出现错误。这个命令可以解决该问题 */
SET SERVEROUTPUT ON BUFFER 20000 /*设置DBMS_OUTPUT 的输出 */
SET WRA[P] {ON|OFF}   /* 在编写存储过程时，我们有时会用dbms_output.put_line 将必要的信息输出，以便对                        存储过程进行调试，只有将serveroutput 变量设为on 后，信息才能显示在屏幕上。*/</code></pre>
<p>使用SET命令设置运行环境**</p>
<pre><code class="sql">/* PAGESIZE变量：当返回SQL*Plus返回查询结果时，会显示列标题和相应列标题下的数据行，上下两个列标题所在行    之间的空间就是SQL*Plus的一页，一页中所显示数据行的数量即为pagesize的变量值value，value变量的默认值    为14，可根据实际情况修改*/
SET PAGESIZE value 
/* NEWPAGE变量：该变量用来设置一行中的空行数量*/
SET NEWPAGE value 
/* LINESIZE变量：改变量用来设置在SQL*Plus环境中一行所显示的最多字符数，默认值为80如果数据行的宽度大于      LINESIZE的值，则会发生折行现象，此时适当调整LINESIZE的值*/
SET LINESIZE value
/* PAUSE变量：改变量用来设置SQL*Plus输出结果是否滚动显示，value变量值有OFF、ON、TEXT三种情况，OFF为默    认值，返回一次性输出结果完毕，中间页不会暂停。ON输出结果每一页都暂停，用户按Enter键后会继续显示。在设    置PAUSE的值为ON之后，若再设置TEXT的值，则每次暂停都将显示该字符串。*/
set pause on
set pause &#39;按&lt;Enter&gt;键继续&#39;
select user_id,username,account_status from dba_users;
/*NUMFORMAT变量：改变量用来显示数值的默认格式，改格式是数值格式，format为数值的掩码*/
SET NUMFORMAT format</code></pre>
<h2 id="常用的SQL-Plus命令"><a href="#常用的SQL-Plus命令" class="headerlink" title="常用的SQL*Plus命令"></a>常用的SQL*Plus命令</h2><p> 在 sqlplus中，可以运行 sqlplus命令与 sqlplus 语句。我们通常所说的 DML、DDL、DCL 语句都是 sql*plus 语句，它们执行完后，都可以保存在一个被称为 sql buffer 的内存区域中，并且只能保存一条最近执行的 sql 语句，我们可以对保存在 sql buffer 中的 sql 语句进行修改，然后再次执行，sqlplus 一般都与数据库打交道。 </p>
<p>除了sqlplus语句，在sqlplus中执行的其它语句我们称之为qlplus命令。它们执行完后，不保存在sql buffer 的内存区域中，它们一般用来对输出的结果进行格式化显示，以便于制作报表。以下为常用命令：</p>
<pre><code class="sql">SQL&gt;start file_name  
SQL&gt;@ file_name 
/*执行一个SQL脚本文件*/</code></pre>
<p>可以将多条 sql 语句保存在一个文本文件中，这样当要执行这个文件中的所有的 sql 语句时，用上面的任一命令即可，这类似于 dos 中的批处理。 </p>
<p>   <strong>@</strong>与<strong>@@</strong>的区别是什么？ </p>
<ul>
<li>@等于 start 命令，用来运行一个sql 脚本文件。 </li>
<li>@命令调用当前目录下的，或指定全路径，或可以通过 SQLPATH 环境变量搜寻到的脚本文件。该命令使用是一般要指定要执行的文件的全路径，否则从缺省路径(可用 SQLPATH 变量指定)下读取指定的文件。</li>
<li>@@用在 sql 脚本文件中，用来说明用@@执行的 sql 脚本文件与@@所在的文件在同一目录下，而不用指定要执行 sql 脚本文件的全路径，也不是从 SQLPATH 环境变量指定的路径中寻找 sql 脚本文件，该命令一般用在脚本文件中。 </li>
</ul>
<pre><code class="sql">/*c:\temp 目录下有文件start.sql 和 nest_start.sql，则以下1、2两条效果一致*/
SQL&gt;@@ nest_start.sql     
SQL&gt;@ c:\temp\nest_start.sql  
SQL&gt;@ c:\temp\start.sql  </code></pre>
<pre><code class="sql">HELP command_name                       /*查看command_name命令的语法格式及功能描述*/
DESC[RIBE] object_name         /*查看对象object的结构,object可以为表、视图、过程、函数、程序等。*/
edit                                   /*对当前的输入进行编辑*/
/                                      /*重新运行上一次运行的 sql 语句*/
COL COMM NUL[L] text   /*COMM NUL[L] text,显示列值时，如果列值为 NULL 值，用text值代替 NULL值。*/
BREAK ON break_column                  /*屏蔽掉一个列中显示的相同的值 */
BREAK ON break_column SKIP n  /*在上面屏蔽掉一个列中显示的相同的值的显示中，每当列值变化时在值变化之前插入 n 个空行。*/
BREAK                                  /*显示对 BREAK 的设置*/
CLEAR BREAKS                           /*删除 6、7 的设置*/
C[HANGE] /old_value/new_value          /*修改 sql buffer 中的当前行中，第一个出现的字符串*/
EDI[T]                                 /*编辑 sql buffer 中的 sql 语句*/
L[IST] [n]  /*显示 sql buffer 中的 sql 语句，list n 显示 sql buffer 中的第n行，并使第n行成为当前行*/
I[NPUT]                               /*在sql buffer 的当前行下面加一行或多行 */
A[PPEND]                               /*将指定的文本加到sql buffer 的当前行后面 */
SAVE file_name                         /*将sql buffer 中的sql 语句保存到一个文件中 */
GET file_name                          /*将一个文件中的sql 语句导入到sql buffer 中 */
RUN                                    /*再次执行刚才已经执行的sql 语句 */
EXECUTE procedure_name                 /*执行一个存储过程 */
CONNECT user_name/passwd@db_alias      /*在sql*plus 中连接到指定的数据库 */
TTITLE                                 /*设置每个报表的顶部标题 */
BTITLE                                 /*设置每个报表的尾部标题 */
REMARK [text]                          /*写一个注释  */
PROMPT [text]                          /*将指定的信息或一个空行输出到屏幕上 */
PAUSE [text]                           /*将执行的过程暂停，等待用户响应后继续执行 */
HOST                                   /*不退出sql*plus ，在sql*plus 中执行一个操作系统命令*/
！                /*在 sql*plus 中，切换到操作系统命令提示符下，运行操作系统命令后，可以再次切换回*/  </code></pre>
<pre><code class="sql">/*SPOOL命令将显示的内容输出到指定文件,在屏幕上的所有内容都包含在该文件中，包括你输入的sql 语句*/
SPO[OL] [file_name[.ext][CRE[ATE]]|[REP[LACE]]|[APP[END]]|OFF|OUT] 
/*
- CRE[ATE]：表示创建一个新的脱机文件，这也是SPOOL命令的默认状态。
- REP[LACE]:表示替代已经存在的脱机文件。
- APP[END]:表示把脱机内容附加到一个已经存在的脱机文件中。
- OFF|OUT:表示关闭spool输出， 只有关闭 spool 输出，才会在输出文件中看到输出的内容。*/

/*DEFINR命令用来定义一个用户变量并且可以分配给它一个CHAR的值，其语法格式如下，variable表示定义变量名，text表示变量的CHAR值*/
DEF[INE][variable][variable = text]

/*SHOW命令用来显示SQL*Plus系统变量的值或SQL*Plus环境变量的值，其语法格式如下,option表示要显示的系统选项，常用的选项有ALL、PARAMETERS[parameter_name]、SGA、SPOOL、USER等*/
SHO[W] option

/*GET命令把一个SQL脚本文件的内容放进SQL缓存区，其语法格式如下，file_name是要显示的文件名，如果省略了文件的扩展名，则默认的扩展名为SQL;LIST指定文件内容加载到缓存区时显示文件的内容；NOLIST指定文件爱你的内容加载到缓存区时不显示文件的内容。*/
GET[FILE] file_name[.ext][LIST][NOLIST]

/*将一个数据库中的一些数据拷贝到另外一个数据库（如将一个表的数据拷贝到另一个数据库）*/
COPY {FROM database | TO database | FROM database TO database}{APPEND|CREATE|INSERT|REPLACE} destination_table [(column, column, column, ...)] USING query                 </code></pre>
<h2 id="格式化查询结果"><a href="#格式化查询结果" class="headerlink" title="格式化查询结果"></a>格式化查询结果</h2><p>SQL*Plus提供了多个用于格式化查询结果的命令，使用这些命令可以实现设置列的标题、定义输出值的显示格式和显示宽度、为报表增加头标题和底标题、在报表中显示当前日期和页号等功能</p>
<h3 id="COLUMN命令"><a href="#COLUMN命令" class="headerlink" title="COLUMN命令"></a>COLUMN命令</h3><p>该命令可以实现格式化查询结果、设置列宽度、重新设置列标题等功能，其语法格式如下：</p>
<pre><code class="sql">COL[UMN][column_name|alias|option]
/* - column_name:用于指定要设置的列的名称
   - alias: 用于指定列的别名，通过它可以把英文列标题设置为汉字。
   - option: 用于指定某个列的显示格式，option选项的值及其说明如下表所示*/</code></pre>
<table>
<thead>
<tr>
<th>option选项的值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CLE[AR]</td>
<td>清除指定列所设置的显示属性，从而恢复列使用默认属性</td>
</tr>
<tr>
<td>FOR[MAT] format</td>
<td>格式化指定的列</td>
</tr>
<tr>
<td>HEA[DING] text</td>
<td>改变缺省的列标题</td>
</tr>
<tr>
<td>JUS[TIFY{L[EFT]|C[ENTER]|C[ENTRE]|R[IGHT]}</td>
<td>设置列标题的对齐方式</td>
</tr>
<tr>
<td>NUL[L] text</td>
<td>指定一个字符串，如果列的值为NULL,则由该字符串替代。</td>
</tr>
<tr>
<td>NOPRI[NT]|PRI[NT]</td>
<td>隐藏列标题或显示列标题，默认为PRINT</td>
</tr>
<tr>
<td>ON|OFF</td>
<td>控制定义显示属性的状态，OFF表示定义的所有显示属性都不起作用，默认为ON</td>
</tr>
<tr>
<td>WRAPPED</td>
<td>当字符串的长度超过显示宽度时，将字符串的超出部分折叠到下一行显示</td>
</tr>
<tr>
<td>WOLD_WRAPPEND</td>
<td>表示从一个完整的字符处折叠</td>
</tr>
<tr>
<td>TRUNCATED</td>
<td>表示截断字符串尾部</td>
</tr>
</tbody></table>
<p>  示例：</p>
<pre><code class="sql"> /*表示员工工资为$999,999.00格式*/
 col sal format $999,999.00
 select empno,ename,sal from scott.emp; 
 /*把scott.emp表中的empno、ename、sal个列名分别转换为中文格式。*/
 col empno heading 雇员编号
 col ename heading 雇员姓名
 col sal heading 雇员工资 
 select empno,ename,sal from scott.emp;
 /*使用NULL选项把scott.emp表中comm列值为null显示成“空值”字符串*/
 col comm null &#39;空值&#39;
 select empno,ename,comm from scott.emp where comm is null;
 /*设置scott.emp表中的sal.emp列的格式为$999,999.00，但同时使用OFF表示定义的所有显示属性都不起作用，默认为ON。*/
 col sal format $999,999.00
 col sal off
 select empno,ename,sal from scott.emp;</code></pre>
<h3 id="TTITLE和BTITLE命令"><a href="#TTITLE和BTITLE命令" class="headerlink" title="TTITLE和BTITLE命令"></a>TTITLE和BTITLE命令</h3><p>SQL*Plus工具提供了TTITLE和BTITLE命令，这两个命令分别用来设置打印时每页的顶部和底部标题。语法格式如下，BTITLE的语法格式与TTITLE语法格式相同：</p>
<pre><code class="sql">TTI[TLE][printspec[text|variable]...]|[OFF|ON]
/*
- printspec:作为头标题的修饰性选项。选项值如下表：
- text:用于设置输出结果的头标题
- variable:用于在头标题中输出相应的变量值。
- OFF:表示禁止打印头标题。
- ON:表示允许打印头标题。
*/</code></pre>
<table>
<thead>
<tr>
<th>printspec选项的值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>COL</td>
<td>指定在当前行的第几列打印头部标题</td>
</tr>
<tr>
<td>SKIP</td>
<td>跳到从下一行开始的第几行，默认为1</td>
</tr>
<tr>
<td>LEFT</td>
<td>在当前行中左对齐打印数据</td>
</tr>
<tr>
<td>CENTER</td>
<td>在当前行中间打印数据</td>
</tr>
<tr>
<td>RIGHT</td>
<td>在当前行中右对齐打印数据</td>
</tr>
<tr>
<td>BOLD</td>
<td>以黑体打印数据</td>
</tr>
</tbody></table>
<p>示例：</p>
<pre><code class="sql">/*打印输出scott.salgrade数据表中的所有记录，并要求为每页设置头标题（报表名称）和底标题（打印时间和打印人）*/
set pagesize 8
ttitle left &#39;           销售情况排行表&#39;
btitle left &#39;打印日期：2011年9月20日   打印人：东方&#39;
select * from scott.salgrade;
/*打印输出scott.salgrade数据表中的所有记录，并要求头标题和底标题都使用define命令定义的变量输出*/
set pagesize 8
define varT=&#39;            雇员信息表&#39;
define varB=&#39;操作员：东方&#39;
ttitle left varT
btitle left varB
select empno,ename,job from scott.emp;
/*使用set newpage命令修改空行的数量为4，并通过检索数据记录来观察空行的改变。*/
show newpage
newpage 1
set newpage 4
select user_id,username from dba_users;
/*在显示列值时，如果列值为NULL值，则用TEXT替换NULL值*/
col comm null &#39;TEXT&#39;
select ename,comm from scott.emp where comm is null;</code></pre>
<h1 id="第四天：SQL语言基础"><a href="#第四天：SQL语言基础" class="headerlink" title="第四天：SQL语言基础"></a>第四天：SQL语言基础</h1><p>##数据库操作</p>
<h3 id="数据库创建和删除"><a href="#数据库创建和删除" class="headerlink" title="数据库创建和删除"></a>数据库创建和删除</h3><pre><code class="sql">CREATE DATABASE 数据库名
[USER 用户名 IDENTIFIED BY 密码]
[CONTROLFILE REUSE]
[MAXINSTANCES 整数]
[MAXLOGFILES 整数]
[MAXLOGMENBERS 整数]
[MAXLOGHISTOYR整数]
[ MAXDATAFILES 整数]
[LOGFILE [GROUP n] 日志文件，……]
[DATAFILE 数据文件，……]
[SYSAUX DATAFILE 数据文件，……]
[DEFAULT TABLESPACE 表空间名]
[DEFAULT TEMPORARY TABLESPACE 临时表空间名 TEMPFILE 临时文件]
[UNDO TABLESPACE 撤销表空间名 DATAFILE 文件名]
[ARCHIVELOG SET 字符集]    
/*需要注意的是，在创建数据库之前，应首先创建实例，并确保实例已经启动，然后以SYS用户或者其他具有SYSDBA权限的用户连接实例，将实例启动到NOMOUNT状态，SGA在内存中已经存在，并且后台进程已经启动。只有在这种情况下才能执行CREATE DATABASE命令。为了确保用户能够连接到正确的实例，在此之前还需要设置系统变量ORACLE_SID的值。*/

/*删除数据库*/
CONNECT SYS/SYSPWD AS SYSDBA;
SHUTDOWN IMMDIATE;
STARTUP MOUNT;
DROP DATABASE;
/*使用命令行删除数据库的语句是DROP DATABASE。在删除之前，需要用户以SYSDBA或SYSOPER身份登录，并且将数据库以MOUNT模式启动。其中，SYSPWD为SYS用户的密码，用户根据实际情况而定。*/   </code></pre>
<p><strong>创建数据库命令的参数说明</strong>：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描    述</th>
</tr>
</thead>
<tbody><tr>
<td>USER…IDENTIFILED BY…</td>
<td>设置数据库管理员的密码，例如sys用户或system用户</td>
</tr>
<tr>
<td>CONTROLFILE  REUSE</td>
<td>使用已有的控制文件（如果存在的话）</td>
</tr>
<tr>
<td>MAXINSTANCES</td>
<td>定义数据库中最大的实例数量</td>
</tr>
<tr>
<td>MAXLOGFILES</td>
<td>定义最大的日志文件数量</td>
</tr>
<tr>
<td>MAXLOGMENBERS</td>
<td>定义每个日志组中可以包含的最大重做日志文件数目</td>
</tr>
<tr>
<td>MAXLOGHISTORY</td>
<td>定义在控制文件中可以记录的最大历史日志条数</td>
</tr>
<tr>
<td>MAXDATAFILES</td>
<td>定义在数据库中可以创建的最大数据文件数目</td>
</tr>
<tr>
<td>DATAFILE</td>
<td>定义数据文件的初始位置和初始大小</td>
</tr>
<tr>
<td>LOGFILE[GROUP  n]日志文件……</td>
<td>定义数据库的重做日志文件组和成员</td>
</tr>
<tr>
<td>EXTENT  MANAGEMENT LOCAL</td>
<td>定义SYSAUX表空间的区管理方式</td>
</tr>
<tr>
<td>SYSAUX  DATAFLE</td>
<td>定义SYSAUX表空间中数据文件的位置和初始大小</td>
</tr>
<tr>
<td>ARCHIVELOG|NOARCHIVELOG</td>
<td>设置数据库的运行模式为归档模式或非归档模式</td>
</tr>
<tr>
<td>CHARACTER  SET</td>
<td>定义存储数据的字符集</td>
</tr>
<tr>
<td>DEFAULT  TABLESPACE</td>
<td>定义默认的表空间</td>
</tr>
<tr>
<td>DEFAULT  TEMPORARY TABLESPACE</td>
<td>定义临时表空间的位置和初始大小</td>
</tr>
<tr>
<td>UNDO  TABLESPACE</td>
<td>定义UNDO表空间的位置和文件位置</td>
</tr>
</tbody></table>
<p>使用CREATEDATABASE命令创建一个名为test的数据库。 创建数据库的代码如下所示：</p>
<pre><code class="sql">SQL&gt;CREATE DATABASE test
    USER SYS IDENTIFIED BY SYSPWD
    USER SYSTEM IDENTIFIED BY SYSTEMPWD
    CONTROLFILE REUSE           
    MAXINSTANCES 1
    MAXLOGFILES 5
    MAXLOGMENBERS 5
    MAXLOGHISTOYR 1
    MAXDATAFILES 100
    LOGFILE GROUP 1 (‘/app/oracle/testdb/redo01.log’) SIZE 10M,
    GROUP 2(‘/app/oracle/testdb/redo01.log’) SIZE 10M,
    DATAFILE ‘/ Aapp/oracle/testdb/system01.dbf’ SIZE 100M REUSE 
    EXTENT MANAGEMENT LOCAL
    DEFAULT TABLESPACE tbs1
    DEFAULT TEMPORARY TABLESPACE tempts1
    TEMPFILE ‘temp1.dbf’ SIZE 10M REUSE
    CHARACTER SET US7ASCII;</code></pre>
<h3 id="数据库开启和关闭"><a href="#数据库开启和关闭" class="headerlink" title="数据库开启和关闭"></a>数据库开启和关闭</h3><p><strong>概述</strong>：每一个启动的数据库至少对应有一个实例。实例是Oracle用来管理数据库的一个实体，它在服务器中，由一组逻辑内存结构和一系列后台服务进程组成。当启动数据库时，这些内存结构和服务进程得到分配、初始化、启动，以便用户能够与数据库进行通信。一个实例只能访问一个数据库，而一个数据库可以由多个实例同时访问。启动一个Oracle数据库，是按步骤进行的。每完成一个步骤就进入一个状态，以便保证数据库处于某种一致性的操作状态。可以通过在启动过程中设置选项，控制数据库进入一个状态。</p>
<p>Oracle数据库的启动分为三个步骤：<strong>启动实例</strong>、<strong>装载数据库</strong>和<strong>打开数据库</strong>。</p>
<ol>
<li>启动实例：当启动实例时，实例读取参数文件的内容，根据参数的设置分配系统全局区(SGA)，建立后台进程，并打开其他一些文件。默认情况下，读取的是服务器端的参数文件。也可以通过PFILE关键字所指定参数文件的路径和名称来读取相应的参数文件。</li>
<li>装载数据库：装载数据库时，实例将打开控制文件，取得数据库的数据文件和重做日志文件的名称和状态，并在实例和数据库之间建立关联关系。</li>
<li>打开数据库：打开数据库的结果是实例打开所有的数据文件和重做日志文件，为用户访问数据做好准备。如果控制文件、数据文件和重做日志文件的状态不一致，还要进行实例恢复。</li>
</ol>
<p>完成了上述这三个过程，Oracle服务器启动完毕，数据库才能进入到就绪状态，准备提供数据访问。实现数据库的启动之前首先要了解Oracle实例的4种状态，分别是打开、关闭、已装载和已启动。</p>
<ul>
<li><strong>打开(OPEN)</strong>：启动实例，装载并打开数据库。该模式是默认的启动模式，它允许任何有效用户连接到数据库，并执行典型的数据访问操作。</li>
<li><strong>关闭(CLOSE)</strong>：将Oracle实例从允许用户访问数据库的状态转变为拒绝状态。关闭操作首先终止用户访问数据库所需的进程，然后释放计算机中供Oracle运行使用的内存空间。</li>
<li><strong>已装载(MOUNT)</strong>：启动实例并装载了数据库。但注意，该状态仅仅是装载了数据库却尚未打开数据库，故不允许用户访问。该模式用于更改数据库的归档模式或执行恢复操作，还用于数据文件恢复。</li>
<li><strong>已启动(NOMOUNT)</strong>：启动了实例，但没有装载数据库，由于此状态没有打开数据库，故不允许用户访问，该状态也可称之为“不装载”。该模式用于重新创建控制文件，对控制文件进行恢复或重新创建数据库。</li>
</ul>
<p><strong>启动数据库</strong>：STARTUP可以使用的选项有：</p>
<ul>
<li><strong>STARTUP</strong>:这是默认的启动数据库操作，直接使用STARTUP命令即可实现此功能。该方式启动实例后，用户可以连接到数据库并执行数据库访问操作。</li>
<li><strong>STARTUP NOMOUNT</strong>:读参数文件，启动实例，不装载数据库。</li>
<li><strong>STARTUP MOUNT</strong>:打开控制文件，启动实例，并装载数据库，但不打开数据库。当设置重做日志归档选项和恢复数据库时，需要以此种方式打开数据库。</li>
<li><strong>STARTUP OPEN</strong>:启动实例，装载数据库，并打开数据库中的数据文件和重做日志文件。</li>
</ul>
<ul>
<li><strong>STARTUP FORCE</strong>:当遇到特殊情况时，强制实例启动或者重新启动数据库服务器。</li>
</ul>
<ul>
<li><strong>STARTUP RESTRICT</strong>:启动数据库并把它置入OPEN模式，但只给拥有RESTRICTEDSESSION权限的用户赋予访问权。通常，可以在此种方式下执行导入和导出数据、执行数据载入、临时阻止指定的用户访问数据库和执行迁移或升级等操作。RESTRICT子句可以与MOUNT、NOMOUNT、OPEN子句结合使用。可以通过执行如下命令结束限制访问状态：ALTER SYSTEM DISABLE RESTRICTED SESSION;</li>
</ul>
<ul>
<li><strong>STARTUP PFILE</strong>=文件名</li>
</ul>
<p><strong>关闭数据库</strong>：在SQL *Plus中执行SHUTDOWN命令，可以关闭数据库服务器。关闭数据库服务器的过程跟启动过程正好相反，首先关闭数据文件和重做日志文件，然后关闭控制文件，最后关闭实例。可以通过几个参数控制关闭的方式。SHUTDOWN命令的基本语法格式如下，SHUTDOWN选项：</p>
<p>对于数据库的关闭，有4种不同的关闭选项，下面对其进行介绍。</p>
<ol>
<li><strong>SHUTDOWN NORMAL</strong>:这是数据库关闭SHUTDOWN命令的缺省选项，代表正常关闭。SHUTDOWN NORMAL和SHUTDOWN完全相同。等待当前所有已连接的用户断开与数据库的连接，然后关闭数据库。执行此语句后，数据库将不允许建立新的连接。</li>
</ol>
<ol>
<li><strong>SHUTDOWN IMMEDIATE</strong>:常用的关闭数据库方式，立即关闭数据库。回滚活动事务处理并断开所有已连接的用户，然后关闭数据库。在执行立即关闭过程中，数据库将不允许建立新的连接，也不允许开始新的事务。所有未提交的事务都会被执行回滚操作。通常在以下情况下执行立即关闭。</li>
</ol>
<ol>
<li><strong>SHUTDOWN TRANSACTIONAL</strong>:该命令表示事务处理关闭。完成事务处理后断开所有已连接的用户，然后关闭数据库。在执行事务处理关闭时，数据库将不允许建立新的连接，也不允许开始新的事务。当所有事务都处理完成后，数据库将和SHUTDOWNIMMEDIATE同样的方式关闭数据库。</li>
</ol>
<ol>
<li><strong>SHUTDOWN ABORT</strong>: 以ABORT模式关闭数据库时，所有正在执行的客户端SQL语句将被立即中止，没有提交的事务也不被回滚，立即切断所有在线用户的连接。当数据库再次启动时需要实例的恢复过程。这种关闭方式也是最快速的关闭Oracle数据库的方式。通常在以下情况出现时可以考虑采用这种方式关闭数据库。</li>
</ol>
<h3 id="数据库状态的改变"><a href="#数据库状态的改变" class="headerlink" title="数据库状态的改变"></a>数据库状态的改变</h3><p>在Oracle12c中，还可以把实例从较高级别的状态转到较低级别的状态。在数据库的各种状态之间切换需要使用ALTER DATABASE 语句，执行该语句的用户必须具有ALTER DATABSE的系统权限。</p>
<ol>
<li><strong>ALTER DATABASE CLOSE</strong>:该命令用于关闭数据库，把实例从open状态转到mount状态。</li>
<li><strong>ALTER DATABASE MOUNT</strong>:该命令可用于这种情况。即当执行某些管理操作时，数据库必须启动、装载实例，但此时的数据库却处于关闭状态。</li>
<li><strong>ALTER DATABASE OPEN</strong>:该命令用于打开已关闭的数据库。</li>
<li>ALTER DATABASE OPEN READ ONLY**:该命令用于以只读方式打开数据库。例如，有时需要以只读方式打开数据库，从而避免因为误操作而造成的数据丢失，就可以使用这条命令。</li>
</ol>
<h2 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h2><p>学习概览：</p>
<ul>
<li><input checked disabled type="checkbox"> Oracle数据库中有多种类型的表，如堆表、临时表、索引组织表和分区表等。</li>
<li><input checked disabled type="checkbox"> Oracle 12c提供的23种数据类型，其中最常用的有字符型、数值型、日期型和其他数据类型。</li>
<li><input checked disabled type="checkbox"> Oracle的表定义支持实体完整性、参照完整性和用户自定义完整性。</li>
<li><input checked disabled type="checkbox"> 创建表的方法有两种——使用OEM工具和命令行。创建表的关键字是CREATE TABLE。</li>
<li><input checked disabled type="checkbox"> 修改表的方法有两种——使用OEM工具和命令行。修改表的关键字是ALTER TABLE。</li>
<li><input checked disabled type="checkbox"> 删除表的关键字是DROP TABLE。</li>
<li><input checked disabled type="checkbox"> 为表设置完整性约束可以在创建表的时候进行，也可以在ALTER TABLE关键字后面添加ADD CONSTRAINT子句。</li>
<li><input checked disabled type="checkbox"> 向表中添加数据的关键字是INSERT INTO，更新数据的关键字是UPDATE，删除数据的关键字是DELETE。</li>
</ul>
<p>###概述</p>
<p>表是最常用的数据库对象之一，也是最基本和最重要的数据库对象之一。由于表是存储数据库数据的主要手段，因此对表的管理也是非常重要的。表的管理涉及表的结构、表的创建、修改、删除与设置完整性约束等操作，以及如何向表中添加数据、更新数据和删除数据。</p>
<p>表是数据库中最基本的对象，用户的数据在数据库中是以表的形式存储的。数据库中每一个表都被一个用户模式所拥有，因此表是一种典型的模式对象。</p>
<p><strong>构成</strong>：表中的数据是按照行和列的二维结构组成。每一行用来保存关系数据库关系的元组，也称数据行或记录。每一列用来保存关系的属性，也称字段。行的顺序一般是按照写入的先后顺序存放，各列的顺序是根据创建表时定义的先后顺序存放。每个列具有列名、列数据类型、列长度、约束条件、默认值等，这些内容在创建表时确定。</p>
<p>在逻辑结构上，表位于某个表空间。当创建一个表时，将同时创建一个段，专门用来存放表中的数据。在物理结构上，表中的数据都存放在数据块中，因而在数据块中存放的是一行的数据。表的结构主要由列组成，包括列名称、数据类型、数据长度、比例（针对数值型的数据）、约束等信息。</p>
<p>在Oracle数据库中根据不同用途有多种类型的表，如<strong>堆表</strong>、<strong>临时表</strong>、<strong>索引组织表</strong>和<strong>分区表</strong>等。</p>
<ol>
<li><p>堆表(HeapOrganized Table)</p>
<p>  “堆”是一个经典的数据结构，它的存储分配原则是随机的。具体到数据表中，也就是说表中插入的每一行数据的空间分配是随机的。堆表中的数据数据按堆组织，以无序的方式存放在单独的表段中。这种表是最基础、最常用的数据库表类型，是默认情况下创建的表。</p>
</li>
<li><p>临时表(TemporaryTable)</p>
<p> 临时表是一种特殊类型的表，表中的数据并不永久保存，而是一些临时数据。这些临时数据只在当前事务或当前会话中有效，当事务或会话结束时，这些临时数据将被全部删除。</p>
</li>
<li><p>索引组织表(IndexOrganized Table)</p>
<p> 索引组织表是一种特殊类型的表，它把表中的数据和表的索引存放在同一个段中，并以B<em>树的方式组织在一起，从而加快表的查询速度。在索引组织表中必须有一个主键，表中的数据按照主键进行排序，在B</em>树的叶块中同时存储主键列和非主键列。</p>
</li>
<li><p>分区表</p>
<p>为了提高大型表的访问效率，Oracle提供了一种分区技术，利用这种技术可以把表、索引等数据库对象中的数据分割成小的单位，分别存放在一个个单独的段中，用户对表的访问变转化为对较小段的访问。</p>
</li>
</ol>
<p><strong>常用数据类型</strong>：</p>
<p><img src="https://jiangmoting-post-1256428291.cos.ap-guangzhou.myqcloud.com/img/2018-04/%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png" alt></p>
<p><strong>表的约束类型</strong>：Oracle的表定义支持以下完整性约束。</p>
<ol>
<li>实体完整性：实体完整性将定义为特定表的唯一实体，要求主属性非空。可以通过设置主键（Primary Key）、唯一值约束（Unique）和非空值约束（NOTNULL）等多种方法实现。</li>
</ol>
<ol start="2">
<li>参照完整性：参照完整性是用来维护相关数据表之间数据一致性的手段，主要使用外键(Foreign Key)来实现。</li>
</ol>
<ol start="3">
<li>用户自定义完整性：用户自定义完整性由用户根据实际应用中的需要自行定义。</li>
</ol>
<h3 id="数据表的创建、修改和删除"><a href="#数据表的创建、修改和删除" class="headerlink" title="数据表的创建、修改和删除"></a>数据表的创建、修改和删除</h3><p><strong>创建表</strong>：</p>
<pre><code class="sql">CREATE TABLE table_name (column_name type [CONSTRAINT constraint_def DEFAULT default_exp]
[, column_name type [CONSTRAINT constraint_def DEFAULT default_exp] ...])</code></pre>
<p>示例：</p>
<pre><code class="sql">SQL&gt;CREATE TABLE Sys_User
(UserID Number Primary Key,
UserName Varchar2(20) NOT NULL,
UserType Number(1),
UserPwd Varchar2(40),
Remark Varchar2(200)
);</code></pre>
<p>当创建表时，Oracle会自动在用户默认表空间中为新建的表创建一个数据段，以便为表提供存储数据的空间。除此之外，用户也可以在创建表时指定所处的表空间，当然用户还可以在创建表的同时设置数据块管理参数。以下示例说明创建表的其他相关子句。</p>
<pre><code class="sql">SQL&gt;CREATE TABLE Sys_User
(UserID Number Primary Key,
UserName Varchar2(20) NOT NULL,
UserType Number(1),
UserPwd Varchar2(40),
Remark Varchar2(200)
);
TABLESPACE TBSONE
PCTFREE 20
PCTUSED 40
INITRANS 10
MAXTRANS 200;</code></pre>
<p><strong>修改表</strong>：</p>
<p>对于创建好的表如果需要修改，使用ALTER TABLE语句进行修改。对表的修改主要涉及表的结构的修改。</p>
<pre><code class="sql">ALTER TABLE table_name 
ADD column_name | MODIFY column_name | DROP COLUMN column_name</code></pre>
<p>示例：</p>
<pre><code class="sql">/*创建的表Sys_User中添加列，UserTel（用户联系方式）字段类型varchar2，代码如下*/
SQL&gt;ALTER TABLE Sys_User
ADD UserTel VARCHAR2 (15);
/*修改表Sys_User中新添加列UserTel（用户联系方式），将数据类型长度改为20，并且设置为不可为空，代码如下*/
SQL&gt;ALTER TABLE Sys_User
MODIFY UserTel VARCHAR2 (20) NOT NULL;
/*删除表Sys_User中新修改的列UserTel（用户联系方式），代码如下。*/
SQL&gt;ALTER TABLE Sys_User
DROP COLUMN UserTel;</code></pre>
<ul>
<li><input checked disabled type="checkbox"> 如果要在条语句中删除多个列，则<em>需要将删除的字段名放在括号中，相互之间用逗号隔开，并且不能使用COLUMN关键字</em>。</li>
</ul>
<p>当在数据库使用高峰期执行删除字段的操作时，系统会因为删除列操作占用资源而降低响应率。为此，可以通过在ALTER TABLE语句中使用SET UNUSED子句可以将列设置为不可用。从用户角度看，被标记为不可用状态的列与被删除的列没有区别，都无法通过查询获取其数据，并且还可以添加与UNUSED状态的列同名的字段。但是，UNUSED的列在物理上仍然保存在数据库中，它所占用的存储空间并没有被释放。</p>
<pre><code class="sql">/*设置表Sys_User中Remark列为不可用，然后再删除该表中所有不可用的列，代码如下。*/
SQL&gt;ALTER TABLE Sys_User
SET UNUSED (RemarK);
SQL&gt;ALTER TABLE Sys_User
DROP UNUSED COLUMNS;</code></pre>
<p><strong>重命名表</strong></p>
<pre><code class="sql">/*在创建表后，如果想要修改表的名称，可以对表进行重命名。将表Sys_User重命名为用户信息。*/
SQL&gt;ALTER TABLE Sys_User
RENAME TO 用户信息;</code></pre>
<ul>
<li><input checked disabled type="checkbox"> 注意：对表进行重命名要谨慎。虽然Oracle可以自动更新数据字典中的外键、约束定义、以及表关系，但是它还不能够更新数据库中的存储代码、客户应用，以及依赖于该对象的其他对象。</li>
</ul>
<p><strong>删除表</strong></p>
<pre><code class="sql">/*用户经常需要删除一些不需要的表，可使用删除表语句DROP TABLE来完成，语法如下：*/
DROP TABLE table_name 
/*将用户信息表删除。*/
SQL&gt;DROP TABLE 用户信息 ;</code></pre>
<h3 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h3><p>数据库不仅仅存储数据，它也必须保证所保存的数据的正确性和相容性，也就是<strong>数据完整性</strong>。数据完整性是防止数据库中存在不符合语义规定的数据和防止因错误信息的输入/输出造成无效操作或错误信息而提出的。约束是在数据库中保证数据库里表中数据完整性的手段。数据库的完整性一般分为四类：<strong>实体完整性</strong>、<strong>域完整性</strong>、<strong>参照完整性</strong>和<strong>用户定义的完整性</strong>。</p>
<ul>
<li><input checked disabled type="checkbox"> <p>实体完整性：要求表中的每一行在表中是唯一的实体，既不能为空也不能取重复的值。</p>
</li>
<li><input checked disabled type="checkbox"> <p>域完整性：指数据库表中的字段必须满足某种特定的数据类型或约束。</p>
</li>
<li><input checked disabled type="checkbox"> <p>参照完整性：保证数据库中相关联的表里面数据的正确性。</p>
<p>根据约束的作用域，约束可以分为表级约束和列级约束两种。列级约束是列定义的一部分，只能够应用在一个列上；而表级的约束定义在独立的列上，它可以应用于一个表中的多个列。在Oracle系统中定义约束时，可以通过CONSTRAINT关键字为约束命名。如果用户没有为约束指定名称，Oracle将自动为约束建立默认的名称。</p>
</li>
</ul>
<p>在Oracle中，根据不同的用途提供了多种约束，分别为：</p>
<ul>
<li><input checked disabled type="checkbox"> <p>主键约束（PRIMARY KEY）：主键约束在每个数据表中有且仅有一个。</p>
</li>
<li><input checked disabled type="checkbox"> <p>外键约束（FOREIGNKEY）：外键约束保证了数据库的参照完整性。它主要用作把一个表中的数据和另一个表中的数据进行关联。</p>
</li>
<li><input checked disabled type="checkbox"> <p>唯一约束（UNIQUE）：唯一约束和主键约束都是设置表中的列不能取重复值，与主键约束不同的是，一个表可以有多个唯一约束。</p>
</li>
<li><input checked disabled type="checkbox"> <p>非空约束（NOT NULL）：非空约束是用来约束表中的列不允许取空值的。NOTNULL约束只能在列级别上定义。在一个表中可以定义多个NOT NULL约束。</p>
</li>
<li><input checked disabled type="checkbox"> <p>检查约束（CHECK）：CHECK约束通过检查输入到表中的数据值来维护域的完整性，只有符合输入条件的数据才允许输入到表中。</p>
</li>
<li><input checked disabled type="checkbox"> <p>默认值约束（DEFAULT）：用于对指定的列设置默认值。</p>
<p>其中，唯一约束、非空约束、检查约束和默认值约束可以实现数据库的域完整性。对约束的定义既可以创建表的同时可以指定相应的约束，也可以通过修改表的结构添加约束。</p>
</li>
</ul>
<p>示例：</p>
<pre><code class="sql">/*重新创建用户表Sys_User，要求UserID 是主键，UserName列只能取唯一值，不得重复，UserType字段取值大于0小于3，UserPwd的默认值为111111，代码如下*/
SQL&gt;CREATE TABLE Sys_User
(UserID Number Primary Key,
UserName Varchar2(20) NOT NULL UNIQUE,
UserType Number(1) CHECK(UserType&gt;0 AND UserType&lt;3 ),
UserPwd Varchar2(40) DEFAULT(&#39;111111&#39;),
Remark Varchar2(200)
);

/*以高校选课管理系统为例，经分析得知，学生和课程的关系是多对多关系，需要创建学生表、课程表和选课表。学生表的结构如下表所示。*/
CREATE TABLE Students
(Student_ID char (11),
Sname Varchar2(8),
Ssex Varchar2(2),
Sbirth date,
Nationality Varchar2(40),
Dept_ID char(3),
Class_ID char(5)
);
/*创建课程表的代码如下：*/
SQL&gt; CREATE TABLE Courses
(Course_ID Varchar2(4),
Cname Varchar2(20),
Credits NUMBER );
/*创建选课表的代码如下：*/
SQL&gt; CREATE TABLE SC
(Student_ID Varchar2(11) ,
Course_ID Varchar2(4),
Grade NUMBER,
CONSTRAINT fk_sid FOREIGN KEY (Student_ID) REFERENCES Students(Student_ID)
ON DELETE CASCADE);</code></pre>
<pre><code class="sql">/*对上述三个表施加约束*/
/*主键约束,使用ALTER TABLE语句设置主键约束的语法格式如下：*/
ALTER TABLE table_name 
ADD CONSTRAINT constraint_name PRIMARY KEY(column_name)
/*为学生表添加主键约束。*/
SQL&gt; ALTER TABLE Students
ADD CONSTRAINT pk_sid PRIMARY KEY(Student_ID);

/*唯一约束,使用ALTER TABLE语句设置唯一约束的语法格式如下*/
ALTER TABLE table_name 
ADD CONSTRAINTS constraint_name UNIQUE(column_name)
/*为课程表的课程名称设置唯一值约束*/
SQL&gt; ALTER TABLE Courses
ADD CONSTRAINT uq_cn UNIQUE (Course_ID);

/*非空约束,使用ALTER TABLE语句设置非空约束的语法格式如下*/
ALTER TABLE table_name 
MODIFY column_name NOT NULL
/*为学生表的学生姓名设置非空约束*/
SQL&gt; ALTER TABLE Students
MODIFY Sname NOT NULL;
/*如果要取消某个列非空的约束，直接使用MODIFY语句把该列的非空约束写成NULL即可。*/

/*检查约束,使用ALTER TABLE语句设置检查约束的语法格式如下*/
ALTER TABLE table_name 
ADD CONSTRAINTS constraint_name CHECK(condition)
/*选修表的成绩列取值要求在0~100之间*/
SQL&gt; ALTER TABLE SC
ADD CONSTRAINT chk_grade CHECK (Grade&gt;0 and Grade&lt;100);

/*外键约束,外键约束可以保证使用外键约束的数据库列于所引用的主键约束的数据列一致，外键约束在一个数据表中可以有多个。外键约束是建立在两张表中的约束，添加外键约束的语法格式如下：*/
ALTER TABLE table_name 
ADD CONSTRAINTS constraint_name FOREIGN KEY(column_name)
REFERENCE table_name (column_name) ON DELETE CASCADE
/*选修表中的学生要参考学生表的信息，课程号需要参考课程表的信息。由于在创建选修表时已经设置了学号为外键，此处为选修表的课程号设置外键。*/
SQL&gt; ALTER TABLE SC
ADD CONSTRAINT fk_cid FOREIGN KEY (Course_ID) REFERENCES Courses(Course_ID)
ON DELETE CASCADE); 

/*删除约束,删除约束的语法格式*/
ALTER TABLE table_name 
DROP CONSTRAINTS constraint_name 
/*删除创建的约束*/
SQL&gt; ALTER TABLE Courses
DROP CONSTRAINT uq_cn;</code></pre>
<h3 id="表数据操纵"><a href="#表数据操纵" class="headerlink" title="表数据操纵"></a>表数据操纵</h3><p>一个表创建以后，其中并不包含任何记录，需要向表中输入数据。以下介绍如何向表中添加数据、更新数据以及删除数据。</p>
<p><strong>插入数据</strong>：</p>
<pre><code class="sql">/*INSERT语法的基本结构如下*/
INSERT INTO &lt;table_name &gt; （column_name 1, column_name 2…, column_name n） 
VALUES（values 1, values 2,…, values n） 
/*其中，column_name 1, column_name 2…, column_name n必须是指定表名中定义的列，而且必须和VALUES子句中的值values 1, values 2,…, values n一一对应，且数据类型相同。*/

/*向表Sys_User中插入数据。*/
SQL&gt; INSERT INTO Sys_User (UserID, UserName, UserType, UserPwd, Remark )
VALUES(&#39;1&#39;, &#39;Admin&#39;, &#39;1&#39;, &#39;Admin&#39;, null);
/*向表的所有列添加数据时，也可省略INSERT INTO子句后的列表清单，但需要注意的是，必须根据表中定义的列的顺序，为所有列提供数据。*/
/*向表Sys_User中插入数据*/
SQL&gt; INSERT INTO Sys_User 
VALUES(&#39;2&#39;, &#39;Zhang&#39;, &#39;2&#39;, &#39;Zhang&#39;, null);</code></pre>
<pre><code class="sql">/*有一种简单的插入多行数据的方法。这种方法是使用SELECT语句查询出的结果代替VALUES子句。这种方法的语法结构如下*/
INSERT INTO &lt;table_name &gt; （column_name 1, column_name 2…, column_name n） 
SELECT column_name[,…n]
FROM table_name
WHERE search_conditions 

/*向Courses表输入数据，创建“Courses”表的一个副本Courses1，将Courses表的全部数据添加到Courses1表中*/
SQL&gt; INSERT INTO Courses VALUES(&#39;0001&#39;,&#39;大学语文&#39;,4);
SQL&gt; INSERT INTO Courses VALUES(&#39;0002&#39;,&#39;高等数学&#39;,4);
SQL&gt; INSERT INTO Courses VALUES(&#39;0003&#39;,&#39;计算机基础&#39;,4);
SQL&gt; INSERT INTO Courses VALUES(&#39;0004&#39;,&#39;数据库概论&#39;,4);
SQL&gt; INSERT INTO Courses1 
SELECT Course_ID, Cname, Credits FROM Courses;
</code></pre>
<p><strong>更新数据</strong>：</p>
<pre><code class="sql">/*使用UPDATE命令修改表中的数据。*/
UPDATE &lt;table_name &gt; SET column_name 1=values 1,column_name 2=values 2, …,column_name n=values n
   WHERE search_conditions
/*如果不带WHERE子句，则表中的所有行都将被更新*/

/*将Course表中大学语文的学分改为3,更新过可使用SELECT语句查看Course表*/
SQL&gt; UPDATE Courses SET Credits=3 WHERE Cname=&#39;大学语文&#39;</code></pre>
<p><strong>删除数据</strong></p>
<pre><code class="sql">/*使用DELETE命令删除表中的数据。*/
DELETE FROM table_name [WHERE search_conditions]
/*如果省略了WHERE search_conditions子句，就表示删除数据表中全部的数据；如果加上了 [WHERE  search_conditions]子句就可以根据条件删除表中的数据。*/

/*删除Courses1表中所有的数据*/
SQL&gt;DELETE FROM Courses1
/*删除Courses表中学分为3的记录*/
SQL&gt;DELETE FROM Courses WHERE Credits=3;
/*对于删除过表中数据，可根据SELETE语句进行查看*/</code></pre>
<h2 id="SQL语言查询"><a href="#SQL语言查询" class="headerlink" title="SQL语言查询"></a>SQL语言查询</h2><p>对数据库的查询是在数据库创建后的常用操作，通过它可以在数据库中得到用户需要的各种信息。以下介绍数据查询操作。学习目标：</p>
<ul>
<li>掌握查询的基本语法</li>
<li>掌握简单查询的方法</li>
<li>掌握内连接、外连接、交叉连接等连接查询的基本方法</li>
<li>掌握子查询的实现方法和应用</li>
<li>掌握联合查询及其应用</li>
</ul>
<h3 id="SQL语言简介"><a href="#SQL语言简介" class="headerlink" title="SQL语言简介"></a>SQL语言简介</h3><p><strong>结构化查询语言SQL</strong>（Structured Query Language）是关系数据库的标准语言，对关系模型的发展和商用DBMS的研制起着重要的作用。SQL语言是介乎于关系代数和元组演算之间的一种语言。SQL语言从功能上可以分为四部分：<strong>数据查询</strong>（Data Query）、<strong>数据操纵</strong>（Data Manipulation）、<strong>数据定义</strong>（Data Definition）和<strong>数据控制</strong>（Data Control）。</p>
<ul>
<li><strong>数据定义语言</strong>，即SQL DDL,用于检索数据库中的数据，主要是SELECT语句。</li>
</ul>
<ul>
<li><strong>数据定义语言</strong>，即SQL DDL，用于定义SQL模式、基本表、视图、索引等结构。</li>
<li><strong>数据操纵语言</strong>，即SQL DML。数据操纵分成数据查询和数据更新两类。其中数据更新又分成插入、删除和修改三种操作。</li>
<li><strong>数据控制语言</strong>，即SQL DCL，这一部分包括对基本表和视图的授权、完整性规则的描述、事务控制等内容。SQL的核心部分相当于关系代数，同时又具有关系代数所没有的许多特点，如聚集、数据库更新等。</li>
</ul>
<p>SQL的核心部分相当于<strong>关系代数</strong>，同时又具有关系代数所没有的许多特点，如聚集、数据库更新等。SQL关键字不区分大小写，既可以使用大写格式，也可以使用小写格式，或者大小写格式混用。</p>
<p><strong>SQL命令动词及其功能</strong>：</p>
<table>
<thead>
<tr>
<th>SQL的功能</th>
<th>命令动词</th>
</tr>
</thead>
<tbody><tr>
<td>数据库查询</td>
<td>SELECT</td>
</tr>
<tr>
<td>数据定义</td>
<td>CREATE,DROP,ALTER</td>
</tr>
<tr>
<td>数据操纵</td>
<td>INSERT,UPDATE,DELETE</td>
</tr>
<tr>
<td>数据控制</td>
<td>GRANT,REVOKE</td>
</tr>
</tbody></table>
<p>SQL的数据定义功能包括<strong>数据库定义</strong>、<strong>表定义</strong>、<strong>视图</strong>和<strong>索引</strong>的定义。</p>
<table>
<thead>
<tr>
<th>对象\操作</th>
<th>创建</th>
<th>删除</th>
<th>修改</th>
</tr>
</thead>
<tbody><tr>
<td>数据库</td>
<td>CREATE DATABASE</td>
<td>DROP DATABASE</td>
<td></td>
</tr>
<tr>
<td>表</td>
<td>CREATE TABLE</td>
<td>DROP TABLE</td>
<td>ALTER TABLE</td>
</tr>
<tr>
<td>索引</td>
<td>CREATE INDEX</td>
<td>DROP INDEX</td>
<td></td>
</tr>
<tr>
<td>视图</td>
<td>CREATE VIEW</td>
<td>DROP VIEW</td>
<td></td>
</tr>
</tbody></table>
<h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><pre><code class="sql">/*“查询”的含义就是用来描述从数据库中获取数据和操纵数据的过程。*/
    SELECT&lt;列名表&gt;
    FROM &lt;表或视图名&gt;
    WHERE &lt;查询限定条件&gt;
/*也就是说，SELECT指定了要查看的列（字段），FROM指定这些数据的来源（表或视图），WHERE则指定了要查询哪些记录。*/

/*完整的SELECT语句语法较复杂，但是其基本的语法格式可归纳如下：*/
    SELECT select_list 
    FROM table_list
    [WHERE search_conditions]
    [GROUP BY group_by_expression]
    [HAVING search_conditions]
    [ORDER BY order_expression [ASC|DESC]]
/*其中，带有方括号的子句是可选择的，大写的单词表示SQL的关键字，而小写的单词或者单词组合表示表或视图名称或者给定条件，语法中的各选项说明：*/</code></pre>
<p><strong>选择表中若干列</strong></p>
<p>选择表中的全部列或不分列这就是关系代数中表的投影运算。这种运算可以通过SELECT子句给出的的字段列表来实现。字段列表中的列可以是表中的列，也可以是表达式列。所谓表达式列就是多个列运算后产生的列或者是利用函数计算后所得的列。</p>
<pre><code class="sql">/*输出表中的所有列*/
/*将表中的所有字段都输出，可以有两种方法：一种是将所有的字段名在SELECT关键字后列出来；另一种是在SELECT语句后使用一个“*”。*/
/*查询“Teacher”表中全体学生的记录。代码如下，执行效果如图6-1所示：
SQL&gt;SELECT * FROM Teacher;

/*输出表中部分列*/
/*查询全体教师的教师编号、姓名和职称信息。代码如下，执行效果如图6-2所示*/
SQL&gt;SELECT Teacher_ID, Tname, Profess FROM Teacher;

/*计算列并为输出结果中的列指定别名*/
SELECT 表达式 AS 列别名 FROM 数据源
/*查询“Teacher”表中全体教师的姓名及年龄。代码如下*/
SQL&gt;SELECT Tname, TO_CHAR(SYSDATE,&#39;YYYY&#39;)-TO_CHAR(Tbirth,&#39;YYYY&#39;) AS age FROM Teacher;</code></pre>
<p><strong>选择表中的若干行</strong></p>
<p>选择表中的若干记录这就是关系代数中表的选择运算。这种运算可以通过增加一些谓词（例如WHERE字句）等来实现。</p>
<pre><code class="sql">/*消除取值重复的行*/
/*两个本来并不相同的记录，当投影到指定的某些列上后，可能变成相同的行。如果要去掉结果集中的重复的行，可以在字段列表前面加上DISTINCT关键字。*/
/*查询教师所在部门的部门代码。代码如下*/
SQL&gt; SELECT DISTINCT Dept_ID FROM Teacher;</code></pre>
<p>如果只希望得到表中满足特定条件的一些记录，用户可以在查询语言中使用WHERE字句。使用WHERE字句的条件如下：</p>
<p>(1)比较大小：比较运算符是比较两个表达式大小的运算符，各运算符的含义是=（等于）、&gt;（大于）、&lt;（小于）、&gt;=（大于或等于）、&lt;=（小于或等于）、!= （不等于）、&lt;&gt;（不等于）、!&gt; （不大于）。逻辑运算符NOT可以与比较运算符同用，对条件求非。</p>
<pre><code class="sql">/*查询“SC”表中成绩小于60分的记录。代码如下*/
SQL&gt; SELECT * FROM SC WHERE Grade&lt;60;</code></pre>
<p>(2)确定范围：范围运算符BETWEEN…AND…和NOT列表达式[NOT]BETWEEN 起始值AND终止值</p>
<pre><code class="sql">/*查询“Teacher”表出生日期在1960至1980年的教师姓名、编号和出生日期。代码如下*/
SQL&gt; SELECT Tname, Teacher_ID, TO_DATE(Tbirth) FROM Teacher 
WHERE TO_CHAR(Tbirth,&#39;yyyymmdd&#39;) BETWEEN &#39;19600101&#39; AND &#39;19801231&#39;;</code></pre>
<p>(3)确定集合：确定集合运算符IN和NOT IN可以用来查找属性值属于（或不属于）指定集合的记录，运算符的语法格式如下：列表达式 [NOT]IN （列值1、列值2、列值3、……）</p>
<pre><code class="sql">/*查询系部代码为&#39;081&#39;和&#39;082&#39;的系部名称和系主任。代码如下*/
SQL&gt;SELECT Dept_name, Director  FROM Dept 
WHERE Dept_ID IN(&#39;081&#39;,&#39;082&#39;);</code></pre>
<p>(4)字符匹配：在实际的应用中，用户有时候不能给出精确的查询条件。因此，经常需要根据一些不确定的信息来查询。SQL语言提供了字符匹配运算符LIKE进行字符串的匹配运算，实现这类模糊查询。其一般语法格式如下：</p>
<p>​        [NOT] LIKE ‘&lt;匹配串&gt;’ [ESCAPE‘&lt;换码字符&gt;’]</p>
<p>其含义是查找指定的属性列值与“&lt;匹配串&gt;”相匹配的记录。“&lt;匹配串&gt;”可以是一个完整的字符串，也可以含有通配符“%”和“_”，其中通配符包括如下四种：</p>
<ul>
<li>%：百分号，代表任意长度的字符串（长度可以是0）的字符串。例如，a%b表示以a开头，以b结尾的任意长度的字符串。例如，acb、adxyzb、ab等都满足该匹配串。</li>
<li>_：下划线，代表任意单个字符。例如，a_b表示以a开头，以b结尾的长度为3的任意字符串，如afb等。</li>
<li>[]：表示方括号里列出的任意一个字符。例如A[BCDE]，表示第一个字符是A，第二个字符为B、C、D、E中的任意一个。也可以是字符范围，例如A[B-E]与 A[BCDE]的含义相同。</li>
<li>[^]：表示不在方括号里列出的任意一个字符。</li>
</ul>
<pre><code class="sql">/*查询“Students”表中姓“李”的学生的信息。代码如下*/
    SQL&gt;SELECT * FROM Students WHERE Sname LIKE &#39;李%&#39;;
/*通配符字符串“李%”的含义是第一个汉字是“李”的字符串*/

/*查询“Course”表中课程名为“Oracle_11g数据库教程”的课程信息*/
SQL&gt; INSERT INTO Courses VALUES(&#39;0020&#39;,&#39; Oracle_11g数据库教程&#39;,5);
SQL&gt; SELECT * FROM Courses WHERE Cname LIKE &#39;Oracle/_11g数据库教程&#39; ESCAPE &#39;/&#39;;
/*ESCAPE“\”短语表示“\”为换码字符，这样匹配串中紧跟在“\”后面的字符“_”不再具有通配符的含义，而是取其本身含义，及普通的“_”字符。*/</code></pre>
<p>(5)空值判断查询：对于那些允许空值的列，可以使用IS NULL或IS NOT NULL来判断其值是否为空。对于使用IS NULL的查询表达式，如果返回值为逻辑真，则说明当前数据记录对应的列值为空，否则为非空。IS NOT NULL的含义与IS NULL恰好相反。</p>
<pre><code class="sql">/*查询教师表中“学历”不为空的教师信息。代码如下*/
SQL&gt; SELECT * FROM Teacher WHERE Educ IS NOT NULL;</code></pre>
<p>(6)多重条件查询。用户可以使用逻辑运算符AND、OR、NOT连接多个查询条件，实现多重条件查询。逻辑运算符使用格式如下：</p>
<pre><code class="sql">[NOT] 逻辑表达式 AND|OR  [NOT] 逻辑表达式

/*查询“SC”表中课程号为“0002”成绩在80–90分之间的（不含90分）的学生的学号、成绩。代码如下*/
SQL&gt;SELECT Student_ID, Grade FROM SC 
    WHERE Course_ID=’0002’ AND Grade &gt;=80 AND Grade &lt;90;</code></pre>
<p><strong>对查询结果排序</strong></p>
<p>用户可以使用ORDER BY子句对查询结果按照一个或多个属性列的升序（ASC）或降序（DESC）排列，默认为升序。如果不使用ORDERBY子句，所有select查询返回的记录都是随机排列的，也就是按照记录在表中的顺序排列。ORDERBY子句的语法格式如下：</p>
<pre><code class="sql">ORDERBY {列名 [ ASC| DESC ]} [,…n]
/*当按多列排序时，先按前面的列顺序，如果值相同再按后面的列排序*/

/*查询“SC”表中选修课程号为“0001”并且成绩大于70分的的学号，要求输出结果成绩降序排列，当成绩相同时按学号升序排列*/
SQL&gt; SELECT Student_ID,Grade
    FROM SC
    WHERE Course_ID=&#39;0001&#39; AND Grade&gt;70
    ORDER BY Grade DESC，Student_ID ASC;
/*需要注意的是，排序时允许使用查询列表中字段的位置来作为排序字段，这样既可方便操作也可在进行联合查询时防止使用UNION出现错误,可改写如下代码，执行效果是一样的*/
SQL&gt; SELECT Student_ID,Grade
    FROM SC
    WHERE Course_ID=&#39;0001&#39; AND Grade&gt;70
    ORDER BY 3 DESC，1 ASC;</code></pre>
<p><strong>对数进行统计据</strong></p>
<p>在SELECT语句中可以使用统计函数进行统计，并返回统计结果。常用的统计函数包括COUNT()、AVG()、SUM()、MAX()、和MIN()等。详细的用法参考Oracle的系统函数一节。</p>
<p>统计函数功能描述：</p>
<table>
<thead>
<tr>
<th>统计函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>COUNT([DISTINCT|ALL]  列名称|*)</td>
<td>统计符合条件的记录的个数</td>
</tr>
<tr>
<td>SUM([DISTINCT|ALL]  列名称)</td>
<td>计算一列中所有值的总和，只能用于数值类型</td>
</tr>
<tr>
<td>AVG([DISTINCT|ALL]  列名称)</td>
<td>计算一列中所有值的平均值，只能用于数值类型</td>
</tr>
<tr>
<td>MAX([DISTINCT|ALL]  列名称)</td>
<td>求一列值中的最大值</td>
</tr>
<tr>
<td>MIN([DISTINCT|ALL]  列名称)</td>
<td>求一列值中的最小值</td>
</tr>
</tbody></table>
<pre><code class="sql">/*统计查询学生总人数，以及参加选课的学生的人数*/
/*学生总人数*/
SQL&gt;SELECT COUNT(*) FROM STUDENTS;
/*参加选课的学生人数*/
SQL&gt;SELECT COUNT(DISTINCT Student_ID) FROM SC;
/*查询选修“0001”课程学生的最高分，最低分和平均分*/
SELECT MAX(GRADE) ,MIN(GRADE), AVG(GRADE) 
    FROM SC WHERE Course_ID=&#39;0001&#39;</code></pre>
<p><strong>对查询结果进行分组</strong></p>
<p>有时候需要对查询数据记录按列或表达式进行分组，以利于分析数据，此时可以通过使用<strong>GROUP BY</strong>子句来实现。</p>
<pre><code class="sql">/*使用GROUP BY子句*/
/*通过使用GROUP BY子句，可以将查询数据记录集对一列或多列进行分组，依据是这些列的值如果相等就放置在同一组内*/
/*使用GROUP BY子句的语法格式为*/
    GROUP BY [ROLLUP]| [CUBE]|[GROUPING SETS]
         [( ) &lt;列表达式1&gt; [ ] ] [, &lt;列表达式2&gt;…];
/*参数说明如下：*/
/* 
- ROLLUP用于生成数据统计，以及横向小计统计结果。
- CUBE用于生成数据统计、横向小计、纵向小计结果。
- GROUPING SETS用于显示多个分组的统计结果。 */

/*查询每一位学生的选课总数，代码如下*/
SQL&gt; SELECT  Student_ID, COUNT(Course_ID) AS 选课数
    FROM SC
    GROUP BY Student_ID;
/*执行该查询语句，将先按学生的学号进行分组，相同学号的数据记录位于同一个组内，然后通过使用聚合函数进行统计，计算出每一组内具有的课程号数目*/

/*查询每一位学生选课成绩超过90分的的选课门数以及平均分*/
SQL&gt; SELECT Student_ID, COUNT(Course_ID) AS 选课数, AVG(Grade) AS 平均分
    FROM SC
    WHERE Grade&gt;90
    GROUP BY Student_ID;
/*对于本例，可以考虑分两步执行：首先，根据WHERE子句过滤掉成绩小于等于90分的所有选课记录，被过滤掉的数据记录不再参与后面的操作；其次，按学号对过滤后的数据记录集进行分组，得到的分组数据记录集即为最终所需要的结果。如果需要使查询数据记录集生成数据统计，以及横向小计统计，则可以通过添加ROLLUP关键字实现。*/

/*对于上例，添加ROLLUP关键字，在结果中显示数据统计信息，代码如下*/
SQL&gt; SELECT Student_ID, COUNT(Course_ID) AS 选课数, AVG(Grade) AS 平均分
    FROM SC
    WHERE Grade&gt;90
    GROUP BY ROLLUP（Student_ID）;</code></pre>
<p>使用<strong>HAVING</strong>子句进行分组统计:在对查询数据记录集进行分组的基础上，再对每组数据记录集进行筛选时，此时不能用WHERE子句，需要用HAVING子句在分组之后进行过滤。</p>
<pre><code class="sql">/*查询每门课程的平均成绩，要求只输出平均成绩在70到80分之间的的课程号、选修人数、平均成绩以及选修该课程的成绩总分，代码如下*/
SQL&gt; SELECT Course_ID, COUNT(Student_ID), AVG(Grade), SUM(Grade)
    FROM SC
    HAVING AVG(GRADE)&gt;70 and AVG(GRADE)&lt;80
    GROUP BY ROLLUP（Student_ID）;
</code></pre>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>以上是只针对一个表实施查询操作，实际上，数据库实例中的各个表之间可能存在某些内在联系，通过这些联系，可以为应用程序提供一些涉及多个表的复杂信息，如主表和外表之间就存在主键和外键的关联。SQL语言为这种多个表之间存在的关联的查询提供了检索数据的方法，称为连接查询。连接查询主要包括交叉连接查询、内连接查询和外连接查询。以下主要介绍连接查询的类型和具体实施方法。</p>
<p><strong>交叉连接</strong>：交叉连接也称非限制连接，也叫<strong>广义笛卡尔积</strong>。两个表的广义笛卡尔积是两表中记录的交叉乘积，结果集的列为两个表属性列的和，其连接的结果会产生一些没有意义的记录，并且进行该操作非常耗时。因此该运算的实际意义不大。</p>
<pre><code class="sql">/*交叉连接的语法格式*/
SELECT 列表列名 FROM 表名1 CROSS JOIN 表名2 

/*专业表和班级表交叉连接，代码如下*/
SQL&gt; SET PAGESIZE 100
   COLUMN Dept_ID FORMAT A8
   COLUMN Class_Name FORMAT A13
   SELECT Dept.*,Class.*
   FROM Dept, Class;</code></pre>
<p><strong>内连接</strong></p>
<p>内连接也称为简单连接，它会把两个或多个表进行连接，只能查出匹配的记录，不匹配的记录将无法查询出来。这种连接查询是平常用的最多的查询。内连接中最常用的就是等值连接和非等值连接。</p>
<pre><code class="sql">/*1. 等值连接*/
/*当连接条件中的关系运算符使用“=”时，称为等值连接。[&lt;表1或视图1&gt;.]&lt;列1&gt; = [&lt;表2或视图2&gt;.]&lt;列2&gt;
等值连接的过程类似于交叉连接，连接的时候要有一定的条件限制，符合条件的记录输出到结果集中，其语法格式如下：*/
SELECT 列表列名 
FROM 表名1 [INNER] JOIN 表名2
ON 表名1.列名=表名2.列名
/*其中，INNER是连接类型可选关键字，表示内连接，可以省略。“ON 表名1.列名=表名2.列名”是连接的等值连接条件。*/

/*等值连接专业表和班级表，观察连接后的结果和交叉连接的结果有何不同。*/
SQL&gt; SET PAGESIZE 100
    COLUMN Dept_ID FORMAT A8
    COLUMN Class_Name FORMAT A13
    SELECT Dept.*,Class.*
    FROM Dept INNER JOIN Class ON Dept.Dept_ID=Class.Dept_ID;
/*从结果中可以发现只有满足连接条件的记录才被拼接到结果集中，结果集是两个表的交集。通过上例的结果中发现有两列Dept_ID是重复的，如果在等值连接中，把目标列中重复的属性列删除，也就是在SELECT后面不要输出重复的列，此时的等值连接就可称为自然连接。*/</code></pre>
<pre><code class="sql">/*2.非等值连接*/
/*当连接条件中的关系运算符使用除“=”以外的其他关系运算符时，这样的内连接称为非等值连接。非等值连接中设置连接条件的一般语法格式为：[&lt;表1或视图1&gt;.]&lt;列1&gt; 关系运算符 [&lt;表2或视图2&gt;.]&lt;列2&gt;
在实际的应用开发用，很少用到非等值链接，尤其是单独使用非等值连接连接查询，它一般和自连接查询同时使用。非等值连接查询的子请自行练习。*/</code></pre>
<pre><code class="sql">/*3.自连接*/
/*连接操作一般在两个表之间进行，也可以在一个表与其自身之间进行连接，这样的连接操作称为自连接。由于连接的两个表其实是同一个表，为了加以区分，此时需要为表起别名。*/

/*使用教师Teacher表查询与“王鹏飞”在同一个系任课的教师编号、教师姓名和教师的职称，要求不包括“王鹏飞”本人。*/
SQL&gt; SELECT T1.Teacher_ID, T1.Tname, T1.Profess
    FROM Teacher T1 JOIN Teacher T2
    ON T1.Dept_ID=T2.Dept_ID and T2.Tname=&#39;王鹏飞&#39; and T1.Tname!=&#39;王鹏飞&#39; ;</code></pre>
<p><strong>外连接</strong></p>
<p>内连接只返回在两个表中特定列有匹配值的记录，与之不同的是，外连接则<strong>可以从一个表中返回在对应的表没有匹配值的记录</strong>。有时候，需要输出所有参加选课的学生的选课记录，包括那些没有参加选课的学生。此时就需要用到外连接来实现。外连接的语法结构如下：</p>
<pre><code class="sql">SELECT 列表列名 
FROM 表名1 {LEFT | RIGHT | FULL} [OUTER]  JOIN   表名2
ON 表名1.列名 = 表名2.列名</code></pre>
<p>根据匹配表位置的不同，外连接查询分为左外连接、右外连接和完全外部连接。</p>
<ul>
<li><strong>左外连接</strong>：返回所有的匹配的行并从关键字JOIN左边的表中返回所有不匹配的行。</li>
<li><strong>右外连接</strong>：返回所有的匹配的行并从关键字JOIN右边的表中返回所有不匹配的行。</li>
<li><strong>完全外连接</strong>：返回两个表中所有匹配的行和不匹配的行。</li>
</ul>
<pre><code class="sql">/*1.左外连接*/
/*查询所有选修了课程的学生的学号、姓名、选修的课程号和成绩，要求包括没有选课的学生信息也输出。代码和查询结果如下所示*/
SQL&gt;SET PAGESIZE 100
   COLUMN Course_ID FORMAT A10
   SELECT Students.Student_ID, Sname,Course_ID,Grade
   FROM Students LEFT OUTER JOIN SC
   ON Students.Student_ID=SC.Student_ID;
/*利用外连接可以显示在表SC无匹配的表Students的行，无匹配的部分在旁边用空白表示。另外，Oracle也可用符号“(+)”表示外连接。“(+)”可以出现在where子句中的任一个表后，要求查询返回另一个表中无匹配的行。那么上例的代码可改写如下：*/
SQL&gt;SET PAGESIZE 100
    COLUMN Course_ID FORMAT A10
    SELECT Students.Student_ID, Sname,Course_ID,Grade
    FROM Students, SC
    WHERE Students.Student_ID=SC.Student_ID(+);</code></pre>
<pre><code class="sql">/*2.右外连接*/
/*查询选修了课程号为“0001”和“0006”的学生的学号、所选的课程号、课程名和学分，如果该课没有学生选也要把相应的课程信息一并输出*/
SQL&gt;SET PAGESIZE 100
   COLUMN Course_ID FORMAT A10
   SELECT Student_ID, SC.Course_ID,Cname,Credits
   FROM SC, Courses
   WHERE SC.Course_ID(+)=Courses.Course_ID and Courses.Course_ID IN (&#39;0001&#39;,&#39;0006&#39;);</code></pre>
<pre><code class="sql">/*3.完全外连接*/
/*查询数据记录集的两个连接表中所有行的连接操作称为完全外部连接。对于完全外部连接，两个连接表无论是否匹配，它们的数据记录都将被显示。*/
/*查询所有系部的信息和班级信息*/
SQL&gt; SPOOL E:\8-23.txt
    SELECT Dept.*,Class_ID,Class_name
    FROM Dept  FULL JOIN Class
    ON Dept.Dept_ID=Class.Dept_ID;
    SPOOL OFF
/*完全外连接查询时只能用关键字FULL JOIN，此时不能用（+）替代了。由于班级Class是因系部Dept而设，所以此时完全外连接的结果与二者的左外连接的结果是一样的。*/</code></pre>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>将一个查询语句嵌套在另一个查询语句中的查询称为嵌套查询或子查询。被嵌入在其他查询语句中的查询语句称为子查询语句，子查询语句的载体查询语句称为父查询语句。子查询语句一般嵌入在另一个查询语句的WHERE子句或HAVING子句中，另外，子查询语句也可以嵌入在一个数据记录更新语句的WHERE子句中。以下重点介绍使用SELECT语句实现子查询的基本方法。</p>
<p><strong>使用In谓词的子查询</strong></p>
<p>对列表操作的子查询通过IN关键字实现父查询和子查询之间的连接，判断指定列的值是否出现在子查询的查询数据记录集中。使用IN的子查询语句返回的查询数据记录集一般由单列多行值组成，这也是子查询中最常用的一种形式。对于使用IN的子查询的连接条件，其语法格式为：</p>
<pre><code class="sql">WHERE 表达式 [ NOT ] IN （子查询）
/*如果使用了NOT IN关键字，则子查询的意义与使用IN关键字的子查询的意义相反*/

/*查询在“计算机科学与技术系”和“信息管理系”教课的教师编号、教师姓名、教师职称。*/
SQL&gt; SPOOL E:\8-24.txt
SQL&gt; COLUMN Teacher_ID FORMAT A10
SQL&gt; SELECT Teacher_ID,Tname,Profess
     FROM Teacher
     WHERE Dept_ID IN (SELECT Dept_ID
                       FROM Dept
                       WHERE Dept_name IN (&#39;计算机科学与技术系&#39;,&#39;信息管理系&#39;));
SQL&gt;SPOOL OFF
/*子查询的执行顺序是由内而外，并且子查询不需要父查询的条件就可以独立完成，这样的子查询称作不相关子查询*/</code></pre>
<p><strong>使用比较运算符的子查询</strong></p>
<p>子查询也可以使用比较运算符。此时，子查询结果为一个单行单列的值，并可以在父查询中通过比较运算符（“&gt;”、“&gt;=”、“&lt;”、“&lt;=”、“=”、“!=”或“&lt;&gt;”）连接子查询。如果子查询返回不止一个值，整个查询语句将会产生错误。带有IN运算符的子查询返回的结果是集合，而带有比较运算符的子查询返回的结果是单值，而且用户在查询开始时就知晓“内层查询返回的是单值”这一事实。</p>
<pre><code class="sql">/*使用比较运算符查询与“王鹏飞”在同一个系任课的教师编号、教师姓名和教师的职称，要求不包括“王鹏飞”本人。*/
SQL&gt; SELECT Teacher_ID, Tname, Profess
     FROM Teacher
     WHERE Dept_ID = (SELECT Dept_ID
                      FROM Teacher
                      WHERE Tname=&#39;王鹏飞&#39;)
             and Tname!=&#39;王鹏飞&#39;;
SQL&gt;SPOOL OFF
/*由于一个老师只能在一个系部工作，所以子查询返回的结果是单值，此时可以用比较运算符“=”来实现。*/</code></pre>
<p><strong>使用ANY或ALL的子查询</strong></p>
<p>子查询返回单值时可以用比较运算符，但返回多值时要用ANY（或SOME）或ALL谓词修饰符。而使用ANY、SOME或ALL谓词时则必须同时使用比较运算符。</p>
<ul>
<li><p>ANY：表示满足子查询结果的任何一个。可以和&lt;、&lt;=搭配，表示小于或小于等于列表中的最大值，而和&gt;、&gt;=搭配时表示大于或大于等于表中的最小值。</p>
</li>
<li><p>SOME：与ANY表示的含义相同。</p>
</li>
<li><p>ALL：表示满足子查询结果的所有结果。可以和&lt;、&lt;=搭配，表示小于或小于等于列表中的最小值，而和&gt;、&gt;=搭配时表示大于或大于等于表中的最大值。</p>
<pre><code class="sql">/*查询其他系比信息管理系某一学生年龄大的学生姓名和年龄。查询代码如下：*/
SQL&gt; SELECT Sname, TO_CHAR(SYSDATE,&#39;YYYY&#39;)-TO_CHAR(Sbirth,&#39;YYYY&#39;) AS age
  FROM Students
  WHERE TO_CHAR(SYSDATE,&#39;YYYY&#39;)-TO_CHAR(Sbirth,&#39;YYYY&#39;)
           &gt;ANY(SELECT TO_CHAR(SYSDATE,&#39;YYYY&#39;)-TO_CHAR(Sbirth,&#39;YYYY&#39;)
                  FROM Students
                  WHERE Dept_ID=(SELECT Dept_ID
                                   FROM Dept
                                   WHERE Dept_name=&#39;信息管理系&#39;))
            AND Dept_ID&lt;&gt;(SELECT Dept_ID
                          FROM Dept
                       WHERE Dept_name=&#39;信息管理系&#39;);
/*本例中&gt;ANY可以改成大于子查询结果的最小值。
若将本例改为查询其他系比信息管理系所有学生年龄都大的学生姓名和年龄，则只需要把“&gt;ANY”修改为“&gt;ALL”即可，请读者自行实现具体的查询代码。</code></pre>
</li>
</ul>
<p><strong>使用EXISTS的子查询</strong></p>
<p>对于是否存在相应数据记录的子查询通过EXISTS关键字来实现父查询和子查询之间的连接，使用EXISTS的子查询语句返回的结果为逻辑值，若子查询结果为空，则父查询的WHERE子句返回逻辑值TRUE，否则返回逻辑FALSE。由于带EXISTS的子查询只返回真值或假值，故在子查询中给出列名无实际意义。</p>
<pre><code class="sql">/*使用EXISTS谓词的查询改写例，查询与“王鹏飞”在同一个系任课的教师编号、教师姓名和教师的职称，要求不包括“王鹏飞”本人。*/
SQL&gt; SELECT Teacher_ID, Tname, Profess
    FROM Teacher T1
    WHERE EXISTS (SELECT *
              FROM Teacher T2
              WHERE T1.Dept_ID=T2.Dept_ID and Tname=&#39;王鹏飞&#39;)
           and Tname!=&#39;王鹏飞&#39;;

/*查询选修了全部课程的学生学号和姓名*/
SQL&gt; SELECT Student_ID, Sname
   FROM Students
   WHERE NOT EXISTS 
            (SELECT *
            FROM Courses
            WHERE NOT EXISTS (SELECT * 
                                FROM SC
                                WHERE Student_ID=Students.Student_ID
                                   AND Course_ID=Courses.Course_ID));
/*题义是求这样的学生：所有课程，他都选了。关系代数中用除运算来表达此查询。这是含有全称量词&quot;意义的查询，SQL中没有提供&quot;量词，需要用Ø $来表达。“所有课程，所求学生选之”等价于求“不存在任何一门课程，所求学生没有选之”。*/</code></pre>
<p><strong>集合操作</strong></p>
<p>关系数据库的优点之一是SQL查询语句处理的是数据集合而非单个数据行。集合操作符可以将两个或多个查询返回的行组合起来。下图给出了4种集合操作符。</p>
<table>
<thead>
<tr>
<th>集合操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>UNION[ALL]</td>
<td>返回各个查询检索出的所有行，ALL代表包括重复的行，不带ALL的话结果不包括重复行</td>
</tr>
<tr>
<td>INTERSECT</td>
<td>返回两个查询检索出的共有行</td>
</tr>
<tr>
<td>MINUS</td>
<td>返回第二个查询检索出的行从第一个查询检索出的行中减去之后剩余的行。</td>
</tr>
</tbody></table>
<p>当使用集合操作符的时候，必须牢记这样一个限制条件：所有查询返回的列数以及列的类型必须匹配，但<strong>列名可以不同</strong>。</p>
<p><strong>使用UNION操作符</strong></p>
<p>使用UNION运算符可以将两个或多个查询结果集组合成一个结果集。在使用UNION运算符时应注意以下几点：</p>
<ul>
<li>UNION结果集的列名与第一个SELECT语句结果集中的列名相同。</li>
<li>默认情况下，UNION运算符将从结果集中删除重复的行。</li>
<li>如果使用了UNION运算符，那么各个SELECT语句不能包含ORDERBY或COMPUTE子句，而只能在最后一个SELECT语句的后面使用一个ORDERBY或COMPUTE子句；该子句适用于最终的组合结果集。</li>
</ul>
<pre><code class="sql">/*第一个查询将选择所有姓“张”或者姓“李”的学生信息，第二个查询将选择所有姓“李”或者姓“王”的学生信息。*/
SQL&gt; SELECT Student_ID, Sname
     FROM Students
     WHERE Sname LIKE &#39;张%&#39; OR Sname LIKE &#39;李%&#39;
     UNION 
     SELECT Student_ID, Sname
     FROM Students
     WHERE Sname LIKE &#39;李%&#39; OR Sname LIKE &#39;王%&#39;;</code></pre>
<p><strong>使用INTERSECT操作符</strong></p>
<pre><code class="sql">/*INTERSECT操作符返回两个查询检索出的共有行*/
/*查询选修了课程名中含有“数据库”三个字的课程并且也选修了课程名含有“计算”的课程的学生姓名*/
SQL&gt; SELECT Sname
     FROM Students S, SC, Courses C
     WHERE S.Student_ID=SC.Student_ID AND SC.Course_ID=C.Course_ID
               AND Cname LIKE &#39;%数据库%&#39;
     INTERSECT 
     SELECT Sname
     FROM Students S, SC, Courses C
     WHERE S.Student_ID=SC.Student_ID AND SC.Course_ID=C.Course_ID
               AND Cname LIKE &#39;%计算%&#39;;</code></pre>
<p><strong>使用MINUS操作符</strong></p>
<p>MINUS操作符返回将第二个查询检索出的行从第一个查询检索出的行中减去之后剩余的行。下面这个例子使用了MINUS。</p>
<pre><code class="sql">/*查询选修了“艺术欣赏”课，却没有选修“人工智能”课的学生姓名。*/
SQL&gt; SELECT Sname
     FROM Students S, SC, Courses C
     WHERE S.Student_ID=SC.Student_ID AND SC.Course_ID=C.Course_ID
               AND Cname =&#39;艺术欣赏&#39;
     MINUS 
     SELECT Sname
     FROM Students S, SC, Courses C
     WHERE S.Student_ID=SC.Student_ID AND SC.Course_ID=C.Course_ID
               AND Cname = &#39;人工智能&#39;;</code></pre>
<h2 id="Oracle内置函数"><a href="#Oracle内置函数" class="headerlink" title="Oracle内置函数"></a>Oracle内置函数</h2><p>###字符函数——返回字符值</p>
<p>这些函数全都接收的是字符族类型的参数(CHR除外)并且返回字符值.除了特别说明的之外,这些函数大部分返回VARCHAR2类型的数值.字符函数的返回类型所受的限制和基本数据库类型所受的限制是相同的,比如: VARCHAR2数值被限制为2000字符(ORACLE 8中为4000字符),而CHAR数值被限制为255字符(在ORACLE8中是2000).当在过程性语句中使用时,它们可以被赋值给VARCHAR2或者CHAR类型的PL/SQL变量.</p>
<pre><code class="sql">    CHR
语法: chr(x)
功能：返回在数据库字符集中与X拥有等价数值的字符。CHR和ASCII是一对反函数。经过CHR转换后的字符再经过ASCII转换又得到了原来的字符。

    CONCAT
语法： CONCAT（string1,string2）
功能：返回string1，并且在后面连接string2。

    INITCAP
语法：INITCAP（string）
功能：返回字符串的每个单词的第一个字母大写而单词中的其他字母小写的string。单词是用.空格或给字母数字字符进行分隔。不是字母的字符不变动。

    LTRIM
语法：LTRIM（string1,string2）
功能：返回删除从左边算起出现在string2中的字符的string1。String2被缺省设置为单个的空格。数据库将扫描string1，从最左边开始。当遇到不在string2中的第一个字符，结果就被返回了。LTRIM的行为方式与RTRIM很相似。

    NLS_INITCAP
语法：NLS_INITCAP（string[,nlsparams]）
功能：返回字符串每个单词第一个字母大写而单词中的其他字母小写的string，nlsparams
指定了不同于该会话缺省值的不同排序序列。如果不指定参数，则功能和INITCAP相同。Nlsparams可以使用的形式是：
‘NLS_SORT=sort’这里sort制订了一个语言排序序列。

    NLS_LOWER
语法：NLS_LOWER（string[,nlsparams]）
功能：返回字符串中的所有字母都是小写形式的string。不是字母的字符不变。
      Nlsparams参数的形式与用途和NLS_INITCAP中的nlsparams参数是相同的。如果nlsparams没有被包含，那么NLS_LOWER所作的处理和LOWER相同。

    NLS_UPPER
语法：nls_upper（string[,nlsparams]）
功能：返回字符串中的所有字母都是大写的形式的string。不是字母的字符不变。nlsparams参数的形式与用途和NLS_INITCAP中的相同。如果没有设定参数，则NLS_UPPER功能和UPPER相同。

    REPLACE
语法：REPLACE（string，search_str[,replace_str]）
功能：把string中的所有的子字符串search_str用可选的replace_str替换，如果没有指定replace_str，所有的string中的子字符串search_str都将被删除。REPLACE是TRANSLATE所提供的功能的一个子集。

    RPAD
语法：RPAD（string1,x[,string2]）
功能：返回在X字符长度的位置上插入一个string2中的字符的string1。如果string2的长度要比X字符少，就按照需要进行复制。如果string2多于X字符，则仅string1前面的X各字符被使用。如果没有指定string2，那么使用空格进行填充。X是使用显示长度可以比字符串的实际长度要长。RPAD的行为方式与LPAD很相似，除了它是在右边而不是在左边进行填充。

    RTRIM
语法:  RTRIM（string1,[,string2]）
功能:  返回删除从右边算起出现在string1中出现的字符string2. string2被缺省设置为单个的空格.数据库将扫描string1,从右边开始.当遇到不在string2中的第一个字符,结果就被返回了RTRIM的行为方式与LTRIM很相似.

    SOUNDEX
语法:  SOUNDEX（string）
功能:  返回string的声音表示形式.这对于比较两个拼写不同但是发音类似的单词而言很有帮助.

    SUBSTR
语法:  SUBSTR（string,a[,b]）
功能:  返回从字母为值a开始b个字符长的string的一个子字符串.如果a是0,那么它就被认为从第一个字符开始.如果是正数,返回字符是从左边向右边进行计算的.如果b是负数,那么返回的字符是从string的末尾开始从右向左进行计算的.如果b不存在,那么它将缺省的设置为整个字符串.如果b小于1,那么将返回NULL.如果a或b使用了浮点数,那么该数值将在处理进行以前首先被却为一个整数.

    TRANSLATE
   语法:  TRANSLATE(string,from_str,to_str)
   功能:  返回将所出现的from_str中的每个字符替换为to_str中的相应字符以后的string. TRANSLATE是REPLACE所提供的功能的一个超集.如果from_str比to_str长,那么在from_str中而不在to_str中而外的字符将从string中被删除,因为它们没有相应的替换字符. to_str不能为空.Oracle把空字符串认为是NULL,并且如果TRANSLATE中的任何参数为NULL,那么结果也是NULL.

    UPPER
语法: UPPER（string）
功能: 返回大写的string.不是字母的字符不变.如果string是CHAR数据类型的,那么结果也是CHAR类型的.如果string是VARCHAR2类型的,那么结果也是VARCHAR2类型的.</code></pre>
<p>###字符函数——返回数字</p>
<p>这些函数接受字符参数回数字结果.参数可以是CHAR或者是VARCHAR2类型的.尽管实际下许多结果都是整数值,但是返回结果都是简单的NUMBER类型的,没有定义任何的精度或刻度范围.</p>
<pre><code class="sql">    ASCII
语法:  ASCII（string）
功能: 数据库字符集返回string的第一个字节的十进制表示.请注意该函数仍然称作为ASCII.尽管许多字符集不是7位ASCII.CHR和ASCII是互为相反的函数.CHR得到给定字符编码的响应字符. ASCII得到给定字符的字符编码.
使用位置: 过程性语句和SQL语句。

    INSTR
语法:  INSTR（string1, string2[a,b]）
功能:  得到在string1中包含string2的位置. string1时从左边开始检查的,开始的位置为a,如果a是一个负数,那么string1是从右边开始进行扫描的.第b次出现的位置将被返回. a和b都缺省设置为1,这将会返回在string1中第一次出现string2的位置.如果string2在a和b的规定下没有找到,那么返回0.位置的计算是相对于string1的开始位置的,不管a和b的取值是多少.
使用位置: 过程性语句和SQL语句。

    INSTRB
语法:  INSTRB（string1, string2[a,[b]]）
功能:  和INSTR相同,只是操作的对参数字符使用的位置的是字节.
使用位置: 过程性语句和SQL语句。

    LENGTH
语法:  LENGTH（string）
功能:  返回string的字节单位的长度.CHAR数值是填充空格类型的,如果string由数据类型CHAR,它的结尾的空格都被计算到字符串长度中间.如果string是NULL,返回结果是NULL,而不是0.
使用位置: 过程性语句和SQL语句。

    LENGTHB
语法:  LENGTHB（string）
功能:  返回以字节为单位的string的长度.对于单字节字符集LENGTHB和LENGTH是一样的.
使用位置: 过程性语句和SQL语句。

    NLSSORT
语法: NLSSORT（string[,nlsparams]）
功能: 得到用于排序string的字符串字节.所有的数值都被转换为字节字符串,这样在不同数据库之间就保持了一致性. Nlsparams的作用和NLS_INITCAP中的相同.如果忽略参数,会话使用缺省排序.
使用位置: 过程性语句和SQL语句。</code></pre>
<h3 id="数字函数"><a href="#数字函数" class="headerlink" title="数字函数"></a>数字函数</h3><p>函数接受NUMBER类型的参数并返回NUMBER类型的数值.超越函数和三角函数的返回值精确到36位.ACOS、ASIN、ATAN、ATAN2的结果精确到36位.</p>
<pre><code class="sql">    ABS
语法:   ABS(x)
功能:   得到x的绝对值.
使用位置: 过程性语言和SQL语句。

    ACOS
语法:  ACOS(x)
功能:  返回x的反余弦值. x应该从0到1之间的数,结果在0到pi之间,以弧度为单位.
使用位置: 过程性语言和SQL语句。

    ASIN
语法:  ASIN(x)
功能:  计算x的反正弦值. X的范围应该是－1到1之间,返回的结果在－pi/2到pi/2之间,以弧度为单位.
使用位置: 过程性语言和SQL语句。

    ATAN
语法:  ATAN(x)
功能:  计算x的反正切值.返回值在－pi/2到pi/2之间,单位是弧度.
使用位置: 过程性语言和SQL语句。

    ATAN2
语法:  ATAN2(x,y)
功能:  计算x和y的反正切值.结果在负的pi/2到正的pi/2之间,单位是弧度.
使用位置: 过程性语言和SQL语句。

    CEIL
语法:  CEIL(x)
功能:  计算大于或等于x的最小整数值.
使用位置: 过程性语言和SQL语句。

    COS
语法:  COS(x)
功能:  返回x的余弦值. X的单位是弧度.
使用位置: 过程性语言和SQL语句。

    COSH
语法:  COSH(x)
功能:  计算x的双曲余弦值.

    EXP
语法:  EXP(x)
功能:  计算e的x次幂. e为自然对数,约等于2.71828.
使用位置: 过程性语言和SQL语句。

    FLOOR
语法:  FLOOR(x)
功能:  返回小于等于x的最大整数值.
使用位置: 过程性语言和SQL语句。

    LN
语法:  LN(x)
功能:  返回x的自然对数. x必须是正数,并且大于0
使用位置: 过程性语言和SQL语句。

    LOG
语法:  LOG(x)

功能:  计算以x为底的y的对数.底必须大于0而且不等于1, y为任意正数.
使用位置: 过程性语言和SQL语句。

    MOD
语法:  MOD(x,y)
功能:  返回x除以y的余数.如果y是0,则返回x
使用位置: 过程性语言和SQL语句。

    POWER
语法:  POWER(x,y)
功能:  计算x的y次幂.
使用位置: 过程性语言和SQL语句。

    ROUND
语法:  ROUND(x[,y])
功能:  计算保留到小数点右边y位的x值. y缺省设置为0,这会将x保留为最接近的整数.如果y小于0,保留到小数点左边相应的位. Y必须是整数.
使用位置: 过程性语言和SQL语句。

    SIGN
语法:  SIGN(x)
功能:  获得x的符号位标志.如果x&lt;0返回－1.如果x=0返回0.如果x&gt;0返回1.
使用位置: 过程性语言和SQL语句。

    SIN
语法:SIN(x)
功能:计算x的正弦值. X是一个以弧度表示的角度.
使用位置: 过程性语言和SQL语句。

    SINH
语法:SINH(x)
功能:返回x的双曲正弦值.
使用位置: 过程性语言和SQL语句。

    SQRT
语法:  SQRT(x)
功能:  返回x的平方根. x必须是正数.
使用位置: 过程性语言和SQL语句。

    TAN
语法:  TAN(x)
功能:  计算x的正切值, x是一个以弧度位单位的角度.
使用位置: 过程性语言和SQL语句。

TANH
语法:  TANH(x)
功能:  计算x的双曲正切值.
使用位置: 过程性语言和SQL语句。

    TRUNC
语法:  TRUNC(x[,y])
功能:  计算截尾到y位小数的x值. y缺省为0,结果变为一个整数值.如果y是一个负数,那么就截尾到小数点左边对应的位上.
使用位置: 过程性语言和SQL语句。</code></pre>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>日期函数接受DATE类型的参数.除了MONTHS_BETWEEN函数返回的是NUMBER类型的结果,所有其他的日期函数返回的都是DATE类型的数值.</p>
<pre><code class="sql">    ADD_MONTHS
语法:  ADD_MONTHS(d,x)
功能:  返回日期d加上x个月后的月份。x可以是任意整数。如果结果日期中的月份所包含的天数比d日期中的“日”分量要少。（即相加后的结果日期中的日分量信息已经超过该月的最后一天，例如，8月31日加上一个月之后得到9月31日，而9月只能有30天）返回结果月份的最后一天。
使用位置: 过程性语言和SQL语句。

    LAST_DAY
语法:LAST_DAY(d)
功能:计算包含日期的d的月份最后一天的日期.这个函数可以用来计算当月中剩余天数.
使用位置: 过程性语言和SQL语句。

    MONTHS_BETWEEN
语法:  MONTHS_BETWEEN(date 1,date2)
功能:  计算date 1和date2之间月数.如果date 1,date2这两个日期中日分量信息是相同的,或者这两个日期都分别是所在月的最后一天,那么返回的结果是一个整数,否则包括一个小数,小数为富余天数除以31.
使用位置: 过程性语言和SQL语句。

    NEW_TIME
语法:  NEW_TIME(d,zone1,zone2)
功能: 计算当时区zone1中的日期和时间是s时候,返回时区zone2中的日期和时间. zone1和zone2是字符串.
使用位置: 过程性语言和SQL语句。

    NEXT_DAY
语法:  NEXT_DAY(d,string)
功能:  计算在日期d后满足由string给出的条件的第一天. String使用位置;当前会话的语言指定了一周中的某一天.返回值的时间分量与d的时间分量是相同的. String的内容可以忽略大小写.
使用位置: 过程性语言和SQL语句。

    ROUND
语法:  ROUND(d[,format])
功能:  将日期d按照由format指定的格式进行处理.如果没有给format则使用缺省设置`DD`.
使用位置: 过程性语言和SQL语句。

    SYSDATE
语法: SYSDATE
功能: 取得当前的日期和时间,类型是DATE.它没有参数.但在分布式SQL语句中使用时,SYSDATE返回本地数据库的日期和时间.
使用位置: 过程性语言和SQL语句。

    TRUNC
语法:  TRUNC(d,format)
功能:  计算截尾到由format指定单位的日期d.可以使用位置:格式和效果.缺省参数同ROUNG.
使用位置: 过程性语言和SQL语句。</code></pre>
<h3 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h3><p>转换函数用于在PL/SQL数据类型之间进行转换.PL/SQL尽可能地自动进行转换,也就是采用隐含方式转换.隐含转换无法转换格式信息,并且有些类型的数据之间不支持隐含转换,所以对这些可以采用显示转换.使用显示转换也是一种好的编程习惯</p>
<pre><code class="sql">    CHARTOROWID
语法:  CHARTOROWID(string)
功能:  把包含外部格式的ROWID的CHAR或VARCHAR2数值转换为内部的二进制格式.参数string必须是包含外部格式的ROWID的18字符的字符串.oracle7和 oracle8中的外部格式是不同的.CHARTOROWID是ROWIDTOCHAR的反函数.
使用位置: 过程性语言和SQL语句。

    CONVERT
语法:  CONVERT(string,dest_set[,source_set])
功能:  将字符串string从source_set所表示的字符集转换为由dest_set所表示的字符集.如果source_set没有被指定,它缺省的被设置为数据库的字符集.
使用位置: 过程性语言和SQL语句。

    HEXTORAW
语法:  HEXTORAW(string)
功能:  将由string表示的二进制数值转换为一个RAW数值. String应该包含一个十六进制的数值. String中的每两个字符表示了结果RAW中的一个字节..HEXTORAW和RAWTOHEX为相反的两个函数.
使用位置: 过程性语言和SQL语句。

    RAWTOHEX
语法:  RAWTOHEX(rawvalue)
功能:  将RAW类数值rawvalue转换为一个相应的十六进制表示的字符串. rawvalue中的每个字节都被转换为一个双字节的字符串. RAWTOHEX和HEXTORAW是两个相反的函数.
使用位置: 过程性语言和SQL语句。

    ROWIDTOCHAR
语法:  ROWIDTOCHAR(rowid)
功能:  将ROWID类型的数值rowid转换为其外部的18字符的字符串表示,在oracle7和oracle8之间有些不一样的地方. ROWIDTOCHAR和CHARTOROWID是两个相反的函数.
使用位置: 过程性语言和SQL语句。

    TO_CHAR(dates)
语法:  TO_CHAR(d [,format[,nlsparams]])
功能:  将日期d转换为一个VARCHAR2类型的字符串.如果指定了format,那么就使用位置:它控制结果的方式.格式字符串是由格式元素构成的.第一个元素返回日期数值一个部份,例如日子.如果没有给定format,使用的就是该会话的缺省日期格式.如果指定了nlsparams,它就控制着返回字符串的月份和日分量信息所使用的语言. nlsparams的格式是:
“NLS_DATE_LANGUAGE”
使用位置: 过程性语言和SQL语句。

    TO_CHAR(labels)
语法:  TO_CHAR(labels[,format])
功能:  将MISLABEL的LABEL转换为一个VARCHAR2类型的变量.
使用位置: 在trusted数据库的过程性语句和SQL语句。

    TO_CHAR(numbers)
语法: TO_CHAR(num[,format[,nlsparams]])
功能: 将NUMBER类型的参数num转换为一个VARCHAR2类型的变量.如果指定了format,那么它会控制这个转换处理.表5-5列除了可以使用的数字格式.如果没有指定format,它会控制这个转换过程.下面列出了可以使用的数字格式.如果没有指定format,那么结果字符串将包含和num中有效位的个数相同的字符. nlsparams用来指定小数点和千分位分隔符和货币符号.可以使用的格式:
`NLS_NUMERIC_CHARS=”dg”NLS_CURRENCY=”string”
d和g分别表示列小数点和千分位分隔符. String表示了货币的符号.例如,在美国小数点分隔符通常是一个句点(.),分组分隔符通常是一个逗号(,),而千分位符号通常是一个$.
使用位置: 过程性语言和SQL语句。

    TO_DATE
语法:  TO_DATE(String[,format[,nlsparams]])
功能:  把CHAR或者VARCHAR2类型的String转换为一个DATE类型的变量. format是一个日期格式字符串.当不指定format的时候,使用该会话的缺省日期格式.
使用位置: 过程性语言和SQL语句。

    TO¬_LABEL
语法:  TO_LABEL(String[,format])
功能:  将String转换为一个MLSLABEL类型的变量. String可以是VARCHAR2或者CHAR类型的参数.如果指定了format,那么它就会被用在转换中.如果没有指定format,那么使用缺省的转换格式.
使用位置: 过程性语言和SQL语句。

    TO_MULTI_BYTE
语法:  TO_MULTI_BYTE(String)
功能: 计算所有单字节字符都替位换位等价的多字节字符的String.该函数只有当数据库字符集同时包含多字节和单字节的字符的时候有效.否则, String不会进行任何处理. TO_MULTI_BYTE和TO_SINGLE_BYTE是相反的两个函数.
使用位置: 过程性语言和SQL语句。

    TO_NUMBER
语法: TO_NUMBER(String[,format[,nlsparams]])
功能: 将CHAR或者VARCHAR2类型的String转换为一个NUMBER类型的数值.如果指定了format,那么String应该遵循相应的数字格式. Nlsparams的行为方式和TO_CHAR中的完全相同.TO_NUMBER和TO_CHAR是两个相反的函数.
使用位置: 过程性语言和SQL语句。

    TO_SINGLE_BYTE
语法: TO_SINGLE_BYTE(String )
功能: 计算String中所有多字节字符都替换为等价的单字节字符.该函数只有当数据库字符集同时包含多字节和单字节的字符的时候有效.否则, String不会进行任何处理.
TO_MULTI_BYTE和TO_SINGLE_BYTE是相反的两个函数.
使用位置: 过程性语言和SQL语句。</code></pre>
<h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><p>分组函数返回基于多个行的单一结果,这和单行函数正好形成对比,后者是对单行返回一个结果.这些函数仅仅对于查询的选择列表和GROUP BY子句有效.<br>    这些函数大都可以接受对参数的修饰符.可以使用位置:的修饰符有DISTINCT和ALL.如果使用位置:了DISTINCT修饰符,那么在处理中仅仅会考虑由查询返回的不同的取值.ALL修饰符会使得该函数考虑由查询返回的所有数值.如果没有指定任何修饰符,那么缺省使用位置:的是ALL修饰符.</p>
<pre><code class="sql">    AVG
语法:  AVG([DISTINCT ALL]col)
功能:  返回一列数据的平均值.
使用位置: 查询列表和GROUP BY子句.

    COUNT
语法:  COUNT(* [DISTINCT ALL] col)
功能:  得到查询中行的数目.如果使用了*获得行的总数.如果在参数中传递的是选择列表,那么计算的是非空数值.

    获得由label界定的最大下界.函数仅用于trusted oracle.GLB
语法:  GLB ([DISTINCT ALL]label)
功能:  获得由label界定的最大下界.函数仅用于trusted oracle.
使用位置:trusted数据库的选择列表和GROUP BY子句.


    LUB
语法:  LUB ([DISTINCT ALL]label)
功能: 获得由label界定的最小上界.用于trusted oracle.数据库.
使用位置:  trusted数据库的选择列表和GROUP BY子句.
过程性语言和SQL语句。


    MAX
语法:  MAX([DISTINCT ALL]col)
功能:  获得选择列表项目的最大值.
使用位置: 仅用于查询选择和GROUP BY子句.

    MIN
语法:  MIN([DISTINCT ALL]col)
功能: 获得选择列表的最小值.
使用位置: 仅用于查询选择和GROUP BY子句.


    STDDEV
语法:  STDDEV([DISTINCT ALL]col)
功能:  获得选择列表的标准差.标准差为方差的平方根.
使用位置: 仅用于查询选择和GROUP BY子句.

    SUM
语法:SUM([DISTINCT ALL]col)
功能:返回选择的数值和总和
使用位置: 仅用于查询选择和GROUP BY子句.


    VARIANCE
语法: VARIANCE([DISTINCT ALL]col)
功能:返回选择列表项目的统计方差.
使用位置: 仅用于查询选择和GROUP BY子句.</code></pre>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><pre><code class="sql">    BFILENAME
语法: BFILENAME(directory,file_name)
功能: 获得操作系统中与物理文件file_name相关的BFILE位置指示符. directory必须是数据字典中的DIRECTORY类型的对象.
使用位置: 过程性语言和SQL语句。

    DECODE
语法:
DECODE(base_expr,comparel,valuel,
Compare2,value2,
…
default)
功能: 把base_expr与后面的每个compare  (n) 进行比较,如果匹配返回相应的value (n)  .如果没有发生匹配,则返回default
使用位置: 过程性语言和SQL语句。


    DUMP
语法:DUMP(expr[,number_format[,start_position][,length]])
功能:获得有关expr的内部表示信息的VARCHAR2类型的数值. number_format指定了按照下面返回数值的基数(base):
    number_format   结果
8    八进制表示
10        十进制表示
16    十六进制表示
17    单字符
默认的值是十进制.
如果指定了start_position和length,那么返回从start_position开始的长为length的字节.缺省返回全部.
数据类型按照下面规定的内部数据类型的编码作为一个数字进行返回.
         代码             数据类型
1    VARCHAR2
2    NUMBER
8    LONG
12              DATE
23    RAW
69    ROWID
96    CHAR
106    MLSLABEL
使用位置:  SQL语句.


    EMPTY_CLOB/EMPTY_BLOB
语法:  EMPTY_CLOB
       EMPTY_BLOB
功能: 获得一个空的LOB提示符 (locator) .EMOTY_CLOB返回一个字符指示符,而  EMPTY_BLOB返回一个二进制指示符.
使用位置: 过程性语言和SQL语句.

    GREATEST
语法:  GREATEST(expr1[,expr2]…)
功能:  计算参数中最大的表达式.所有表达式的比较类型以expr1为准.
使用位置: 过程性语言和SQL语句.

    GREATEST_LB
语法:  GREATEST_LB(label1[,label2]…)
功能: 返回标签(label)列表中最大的下界.每个标签必须拥有数据类型MLSLABEL、RAWMLSLABEL或者是一个表因字符串文字.函数只能用于truested oracle库.
使用位置: 过程性语言和SQL语句.

    LEAST
语法:  LEAST(expr1[,:expr2]…)
功能:  获得参数中最小的表达式.
使用位置: 过程性语言和SQL语句.

    LEAST_UB
语法:  LEAST_UB(label1[,label2]…)
功能:  与GREATEST_UB函数相似,本函数返回标签列表的最小上界.
使用位置: 过程性语言和SQL语句.

    NVL
语法:  NVL (expr1, expr2)
功能:  如果expr1是NULL,那么返回expr2,否则返回expr1.
如果expr1不是字符串,那么返回值的数据类型和expr1是相同的,否则,返回值的数据类型是VARCHAR2.此函数对于检查并确定查询的活动集不包含NULL值十分有用.
使用位置: 过程性语言和SQL语句.

    UID
语法:
功能:  获得当前数据库用的惟一标识,标识是一个整数.
使用位置: 过程性语言和SQL语句.

    USER
语法:
功能:  取得当前oracle用户的名字,返回的结果是一个VARCHAR2型字符串.
使用位置: 过程性语言和SQL语句.

    USERENV
语法:  USERENV(option)
功能:  根据参数option,取得一个有关当前会话信息的VARCHAR2数值.
使用位置: 过程性语言和SQL语句.

    VSIZE
语法:  VSIZE(value)
功能: 获得value的内部表示的字节数.如果value是NULL,结果是NULL.
使用位置: 过程性语言和SQL语句.</code></pre>
<h1 id="第五天：PL-SQL编程"><a href="#第五天：PL-SQL编程" class="headerlink" title="第五天：PL/SQL编程"></a>第五天：PL/SQL编程</h1><h2 id="PL-SQL简介"><a href="#PL-SQL简介" class="headerlink" title="PL/SQL简介"></a>PL/SQL简介</h2><p>PL/SQL（Procedural Language/SQL）是一种应用在数据库中的程序设计语言。它和其他的程序语言一样可以定义常量和变量，有赋值语句和表达式，有分支、循环等程序结构，可以在程序中嵌入SQL语句是它区别于其他程序设计语言的特点。我们可以把一些运行在数据库中的业务逻辑，通过数据操作和查询语句定义在PL/SQL程序块中，通过逻辑判断，循环等操作实现复杂的功能。</p>
<p><strong>语言结构</strong></p>
<p>PL/SQL语言是结构化程序设计语言，块（block）是PL/SQL程序中最基本的结构。PL/SQL块由三个部分组成：声明部分、执行体部分、异常处理部分。</p>
<pre><code class="plsql">[DECLARE]
--声明部分：在此声明PL/SQL用到的变量、常量、类型、游标、用户定义异常的声明等
BEGIN
--执行部分：SQL语句和PL/SQL语句构成的程序的主要部分
[EXCEPTION]
--异常处理部分：当程序出现异常时，捕捉异常并处理
END;
--标记程序体部分结束</code></pre>
<p><strong>示例程序</strong></p>
<pre><code class="plsql">/*1. 只包含执行体的程序块*/
SQL&gt; SET SERVEROUTPUT ON
BEGIN
     DBMS_OUTPUT.PUT_LINE(‘HELLO WORLD!’);
     END;   
/*2. 包含执行体和声明部分的程序块*/
SQL&gt;DECLARE
       Cname varchar2(20);
     BEGIN
        SELECT CNAME INTO Cname
        FROM User_Yao.Courses
        WHERE Course_ID = &#39;0019&#39;;
        DBMS_OUTPUT.PUT_LINE(&#39;代码是0019的课程名称是：&#39;|| Cname);
      END;
/*3. 包含声明部分、执行部分和异常部分的程序块*/
SQL&gt;DECLARE
      C_name varchar2(20);
      BEGIN
        SELECT Cname INTO C_name
        FROM User_Yao.Courses
        WHERE Course_ID = &#39;0020&#39;;
        DBMS_OUTPUT.PUT_LINE(&#39;0020的课程名称为&#39; || C_name);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE(&#39;没有这门课程！&#39;);
        WHEN TOO_MANY_ROWS THEN
        DBMS_OUTPUT.PUT_LINE(&#39;有多门课程的代码重复，均为0020！&#39;);
      END;</code></pre>
<h2 id="PL-SQL基本语法"><a href="#PL-SQL基本语法" class="headerlink" title="PL/SQL基本语法"></a>PL/SQL基本语法</h2><h3 id="变量和常量"><a href="#变量和常量" class="headerlink" title="变量和常量"></a>变量和常量</h3><p><strong>常量的定义</strong></p>
<p>定义常量的语法格式如下：</p>
<pre><code class="sql">&lt;常量名&gt; constant &lt;数据类型&gt; ：= &lt;值&gt;；</code></pre>
<p>其中，关键字constant 表示是在定义常量。常量一旦定义，在以后的使用中其值将不再改变。一旦固定大小的数据为了防止有人改变，最好定义成常量。例如：定义一个及格线的常量Pass_Score，它的类型为整型，值为90：Pass_Score constant INTEGER：=90；</p>
<p><strong>变量的定义</strong></p>
<p>定义变量的语法格式如下：</p>
<pre><code class="sql">&lt;变量名&gt; &lt;数据类型&gt; [(宽度) ：= &lt;初始值&gt;]；</code></pre>
<p>可见，变量定义时没有关键字，但要指定数据类型。宽度和初始值可以定义也可以不定义，根据需要灵活使用。例如，定义了一个有关住址的变量，它是变长字符型，最大长度为50个字符：Address VARCHAR2 (50)；</p>
<p><strong>变量的初始化</strong></p>
<p>许多语言没有规定未经过初始化的变量中应该存放什么内容。因此在运行时，未初始化的变量就可能包含随即的或者未知的数值。在一种语言中，允许使用未初始化变量并不是一种很好的编程风格。一般而言，如果变量的取值可以被确定，那么最好为其初始化一个数值。</p>
<p><strong>变量的作用域</strong></p>
<p>变量的作用域是指可以访问该变量的程序部分。对于PL/SQL变量来说，其作用域就是从变量的声明到语言快的结束。当变量超出了作用域，PL/SQL解释程序就会自动释放该变量的存储空间。</p>
<h3 id="赋值语句"><a href="#赋值语句" class="headerlink" title="赋值语句"></a>赋值语句</h3><p>使用赋值语句可以为变量赋予数值，或者将计算的结果赋予变量。在PL/SQL中需要注意的是，赋值符号为“：=”，而不是“=”。</p>
<pre><code class="sql">/*下面是几种不同类型的变量的赋值语法：*/
identIFier : = expr;
plsql_table_name (primary_key_value) : = expr;
plsql_record_name.field_name : = expr;
--简单变量的赋值
v_sal : = 5000;
v_married := true;
--在PL/SQL表类型的变量v_name的第一个值中保存名字“Smith”
v_name(1) : = ‘Smith’;
--把一个教师的基本信息保存到PL/SQL的记录类型数据中
Teacher_record.Tname := ‘Smith’;
Teacher_record.sal := 5000;</code></pre>
<h3 id="表达式和运算符"><a href="#表达式和运算符" class="headerlink" title="表达式和运算符"></a>表达式和运算符</h3><p>表达式在PL/SQL中经常出现，可以出现在PL/SQL的很多位置，例如赋值语句中、SQL语句中、条件判断语句中等，表达式可以使用各种运算符和Oracle内置函数。表达式中运算符的优先级决定了表达式求值的顺序。</p>
<p><strong>表达式</strong></p>
<p>表达式是由运算符串起来的一组数。表达式的数值通过组成它的变量、文字的取值及运算符的定义来决定。表达式中运算符的优先级决定了表达式求值的顺序。如：6+3*2，由于运算符优先级的存在，是表达式的值为12，而不是通过顺序运算得来的18.</p>
<p><strong>运算符</strong></p>
<p>PL/SQL的运算符可以是一元的（带有一个参数），也可以是二元的（带有两个参数）。运算符通常可以分为以下几类：* 算术运算符 * 关系运算符  * 其他符号</p>
<h3 id="条件判断语句"><a href="#条件判断语句" class="headerlink" title="条件判断语句"></a>条件判断语句</h3><p>PL/SQL程序块中的流程控制语句最常见的以中是条件判断语句，也就是IF语句。使用IF语句可以根据设置的条件进行判断，选择条件分支中的某个分支进行操作。条件分支语句的语法结构如下：</p>
<pre><code class="sql">IF condition THEN
  statements;
[ELSEIF condition THEN
statements;]
[ELSE
statements;]
END IF;</code></pre>
<p>其中ELSEIF子句和ELSE子句是可选项。判断条件condition可以是一个条件或者是多个条件的组合，多个条件可以通过连接操作符（AND/OR/NOT）连接在一起。</p>
<pre><code class="sql">/*1. 简单分支
简单分支程序，执行结果图如图7-4所示。*/
DECLARE 
        m number;
        n number;
        BEGIN
           m:=10;
           n:=20;
           IF m-n&gt;=0 THEN
              DBMS_OUTPUT.PUT_LINE(m || &#39;&gt;&#39;||n);
           END IF;
           DBMS_OUTPUT.PUT_LINE(m || &#39;&lt;&#39;||n);
  END;
/*2. 二重分支
         IF…THEN… ELSE是一种简单IF语句的扩展，增加了一个分支。如果第一个条件不满足则执行第二个分支的语句。
二重分支程序，使用学籍管理数据库，方案User_Yao下的选修SC表，查询学号‘20100810101’的学生选修‘0001’号课程的成绩情况，执行结果图如图7-5所示。*/
DECLARE
  学生成绩 number;
  BEGIN
       SELECT grade INTO 学生成绩
       FROMUser_Yao.Sc
       WHERE Course_ID=&#39;0001&#39; AND Student_ID=&#39;20100810101&#39;;
DBMS_OUTPUT.PUT_LINE(&#39;课程0001号成绩是：&#39;|| 学生成绩);
       IF 学生成绩&gt;=60 THEN 
          DBMS_OUTPUT.PUT_LINE(&#39;成绩合格，通过考试&#39;);
       ELSE
          DBMS_OUTPUT.PUT_LINE(&#39;成绩不合格，没有通过考试&#39;);
       END IF;
/*3. 多重分支
       IF…THEN …ELSEIF语句可以设置更多的选择分支，当第一个条件不满足时，判断第二个条件是否满足，如果也不满足，再判断第三个条件，一直到找到一个满足条件的分支或者执行ELSE对应的分支语句。
       使用学籍管理数据库，方案User_Yao下的选修SC表，查询学号‘20100810101’的学生选修‘0001’号课程的成绩等级情况。代码如下*/
DECLARE
  学生成绩 number;
  BEGIN
       SELECT grade into 学生成绩
       FROM User_Yao.Sc
       WHERE Course_ID=&#39;0001&#39; AND Student_ID=&#39;20100810101&#39;;
       DBMS_OUTPUT.PUT_LINE(&#39;课程0001号成绩是：&#39;|| 学生成绩);
       IF 学生成绩&gt;=90 THEN 
          DBMS_OUTPUT.PUT_LINE(&#39;成绩优秀，通过考试&#39;);
       ELSIF 学生成绩&gt;=80 THEN
          DBMS_OUTPUT.PUT_LINE(&#39;成绩良好，通过考试&#39;);
       ELSIF 学生成绩&gt;=70 THEN
dbms_output.put_line (&#39;成绩一般，通过考试&#39;);
       ELSIF 学生成绩&gt;=60 THEN
          DBMS_OUTPUT.PUT_LINE(&#39;成绩合格，通过考试&#39;);
       ELSE
          DBMS_OUTPUT.PUT_LINE(&#39;成绩不及格，没有通过考试&#39;);
       END IF;
  END;
/*4. CASE语句
处理多重分支语句时，除了可以使用IF语句之外，还可以使用CASE语句。CASE语法结构有两种类型：
● 简单CASE语句：给出一个表达式，并把表达式结果同提供的几个可预见的结果做比较，如果比较成功，则执行相应的语句序列。
● 搜索CASE语句：提供多个布尔表达式，根据条件满足的情况选择第一个为TRUE的表达式，执行对应的语句。
/*(1) 简单CASE语句
简单CASE表达式语法结构为：*/
CASE case_operand
    WHEN  when_operand THEN 
        statement;
[WHEN  when_operand THEN 
        statement;
]…
[ELSE statement [statement]]…;
       END CASE;
/*例：使用简单CASE语法结构实现查询课程表中“大学语文”这门课程的课程性质*/
DECLARE 
  学分 number;
  BEGIN
       SELECTcredits INTO 学分
       FROM User_Yao.Courses
       WHERE cname=&#39;大学语文&#39;;

       CASE 学分
       WHEN &#39;2&#39; THEN
            DBMS_OUTPUT.PUT_LINE(&#39;选修课&#39;);
       WHEN &#39;4&#39; THEN
            DBMS_OUTPUT.PUT_LINE(&#39;必修课&#39;);
       WHEN &#39;5&#39; THEN
            DBMS_OUTPUT.PUT_LINE(&#39;专业课&#39;);
       WHEN &#39;6&#39; THEN
       DBMS_OUTPUT.PUT_LINE(&#39;毕业设计&#39;);   
       ELSE 
            DBMS_OUTPUT.PUT_LINE(&#39;其他！&#39;);  
       END CASE;     

       DBMS_OUTPUT.PUT_LINE(&#39;CASE结构验证完成！&#39;);
  END;
/*(2) 搜索CASE语句搜索CASE表达式语法结构为：*/
CASE 
    WHEN boolean_expression THEN 
        statement;
[WHEN boolean_expression THEN 
        statement;
]…
[ELSE statement [statement]]…;
       END CASE;
/*例：使用CASE语句实现例7-6的功能。代码如下*/
DECLARE 
学生成绩 number;
  BEGIN
       SELECT grade INTO 学生成绩
       FROM User_Yao.Sc
       WHERE Course_ID=&#39;0001&#39; AND Student_ID=&#39;20100810101&#39;;
       DBMS_OUTPUT.PUT_LINE(&#39;课程0001号成绩是：&#39;|| 学生成绩);
       CASE 
       WHEN 学生成绩&gt;=90 THEN 
          DBMS_OUTPUT.PUT_LINE(&#39;成绩优秀，通过考试&#39;);
       WHEN 学生成绩&gt;=80 THEN
          DBMS_OUTPUT.PUT_LINE(&#39;成绩良好，通过考试&#39;);
       WHEN 学生成绩&gt;=70 THEN
       DBMS_OUTPUT.PUT_LINE(&#39;成绩一般，通过考试&#39;);
       WHEN 学生成绩&gt;=60 THEN
          DBMS_OUTPUT.PUT_LINE(&#39;成绩合格，通过考试&#39;);
       ELSE
          DBMS_OUTPUT.PUT_LINE(&#39;成绩不及格，没有通过考试&#39;);
       END CASE;    
       DBMS_OUTPUT.PUT_LINE(&#39;搜索CASE结构验证完成！&#39;);
  END;</code></pre>
<h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><p>除了IF语句之外，PL/SQL程序中的另一种流程控制语句就是循环。循环用于根据条件一次或者多次执行某些语句。在PL/SQL程序中主要有三种循环类型：简单循环、FOR循环和WHILE循环。</p>
<ol>
<li>简单循环简单循环使程序不经过判断就进入循环，在循环体中判断条件是否满足，一旦满足条件，立刻退出循环。简单循环的基本语法格式如下：</li>
</ol>
<pre><code class="sql">LOOP
   statement1;
   EXIT [WHEN condition];    END LOOP;</code></pre>
<p>其中statement1是循环体，WHEN后面的条件语句就是确定是否退出循环的条件，当条件满足时，退出循环，如果条件不满足，则继续循环。需要注意的是，在简单循环中如果不人为控制，循环体将会无限执行，一般可以通过加入EXIT语句来终止循环。</p>
<p>例：创建一个临时表temp，该表只有一列id，并且这一列的取值通过循环语句获得。代码如下，执行后查询该表：</p>
<pre><code class="sql">CREATE TABLE User_Yao.temp (id NUMBER);
DECLARE
          i INTEGER := 1;
      BEGIN
          LOOP
             INSERT INTO User_Yao.temp VALUES (i);
             EXIT WHEN i = 10;
             i := i + 1;
          END LOOP;
          COMMIT;
      END;</code></pre>
<ol start="2">
<li>FOR循环:FOR循环也是经常使用的循环语句，使用FOR循环，循环将会执行指定的次数。FOR循环的语法结构如下：</li>
</ol>
<pre><code class="sql">FOR index_name IN [REVERSE]
   lower_bound…upper_bound LOOP
   statement1;
   statement2;
   …
END LOOP;</code></pre>
<p>其中，index_name为循环计数器，该变量可以得到当前的循环次数，但是不能为其赋值。low_bound和upper_bound为循环的最小值和最大值，循环将会执行计数器递增的次数。low_bound和upper_bound两者需要用“..”连接。REVERSE是反转的意思，正常的循环计数器从小到大递增，使用REVERSE将使计数器从大到小递减。</p>
<p>需要注意的是，在循环中使用的计数器变量不需要声明，Oracle自动为FOR循环声明计数器变量；计数器变量只能在循环体内引用，控制循环体外看不到这个变量；如果需要在循环体外引用计数器的值，可以使用一个变量记录计数器的值。</p>
<pre><code class="sql">/*例：使用ROR循环实现向表User_Yao.temp中插入1~10倒序的数据。代码如下*/
BEGIN
  FOR v_counter IN REVERSE 1 .. 10 LOOP
     INSERT INTO User_Yao.temp VALUES (v_counter);
  END LOOP;
  COMMIT;
END;</code></pre>
<ol start="3">
<li>WHILE循环:使用WHILE循环同样可以执行循环，WHILE循环在条件满足的时候执行循环体，当条件不再满足，退出循环。WHILE循环语句的语法格式如下：</li>
</ol>
<pre><code class="sql">WHILE condition LOOP
   statement1;
   statement2;
   …
END LOOP;</code></pre>
<p>使用WHILE循环实现例的功能，代码如下:</p>
<pre><code class="sql">DECLARE
       i INT := 1;
       BEGIN
         WHILE i&lt;=10 LOOP
            INSERT INTO User_Yao.temp VALUES (i);
            i := i + 1;
          END LOOP;
       COMMIT;
       END;</code></pre>
<ol start="4">
<li>嵌套循环:循环块可以多级嵌套，嵌套的规则与PL/SQL块的嵌套规则类似。在循环块中可以使用标签标示循环的位置，可以通过引用标签的EXIT语句，退出到指定的循环外，实现循环的跳转。</li>
</ol>
<pre><code class="sql">/*嵌套循环程序示例，代码如下*/
DECLARE 
  i integer;
  j integer;
BEGIN
    &lt;&lt;outer&gt;&gt;
    FOR i IN 1..5 LOOP
        DBMS_OUTPUT.PUT_LINE (&#39;外层循环：i的值是:&#39; || i);
        &lt;&lt;inner&gt;&gt;
        FOR j IN 1..5 LOOP
        DBMS_OUTPUT.PUT_LINE (&#39;  内层循环：j的值是:&#39; || j);
            IF j=3 THEN
               EXIT outer;
            END IF;
        END LOOP inner;
    END LOOP outer;

DBMS_OUTPUT.PUT_LINE (&#39;嵌套循环语句块结束!&#39;);
END;</code></pre>
<p>在这个例子中，使用了两个标签Outer和Inner，一个表示外部循环的标签，另一个是内部循环的标签。在循环体中，根据内部循环计算的值，判断退出到哪一层循环。</p>
<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><p>PL/SQL中的函数是PL/SQL块的一种特殊类型，这种类型的子程序可以以编译的形式存放在数据库中，并为后续的程序块调用。PL/SQL语言为程序员提供了非常丰富的函数，足以满足开发应用程序的需要。本节介绍一些常用函数。</p>
<p><strong>数值型函数</strong></p>
<p>数值类型函数可以输入数字，并返回一个数值。大多数可以达到小数点后38位。一部分则支持30位或36位。</p>
<p><strong>字符型函数</strong></p>
<p>字符串函数对字符串输入值执行操作，返回字符串或数字类型数据。</p>
<p><strong>LENGTH函数</strong></p>
<p>LENGTH函数返回给定字符串表达式的字符（而不是字节）个数，其中不包括尾随空格。</p>
<p><strong>UPPER函数与LOWER函数</strong></p>
<p>UPPER函数返回将小写字符数据转换为大写的字符表达式。LOWER函数返回将大写字符数据转换为小写的字符表达式。</p>
<p><strong>REPLACE函数、RPAD函数与LPAD函数</strong></p>
<p>​        REPLACE函数具体的语法结构是REPLACE(s1,s2,s3)，表示在字符串s1中搜索字符串s2，并用字符串s3替换s2。RPAD函数的语法结构是RPAD(s1,n[,s2])，功能是在字符串s1的右边用字符串s2填充，直到整个字符串长度为n时为止。如果s2不存在，则以空格填充。LPAD函数的语法结构是LPAD(s1,n[,s2])，功能是在字符串s1的左边用字符串s2填充，直到整个字符串长度为n时为止。如果s2不存在，则以空格填充。需要注意的是，这里的字符串长度指的不是字符的个数，而是字符的长度，一个汉字字符占据两个字节。</p>
<p><strong>TRIM函数</strong></p>
<p>TRIM函数具体的语法结构是TRIM(p,s)，功能是将删除指定的前导或尾随的字符，默认删除空格。LTRIM函数具体的语法结构是LTRIM(s[,p])，功能是从字符串s左侧开始删除p中出现的任何字符，直至出现p中没有字符为止。RTRIM函数具体的语法结构是RTRIM(s[,p])，功能是从字符串s右侧开始删除p中出现的任何字符，直至出现p中没有字符为止。</p>
<h3 id="日期型函数"><a href="#日期型函数" class="headerlink" title="日期型函数"></a>日期型函数</h3><p>日期函数用于处理DATE和TIMESTAMP数据类型的数据，这些函数同样可以直接在PL/SQL中直接使用。下面介绍几种常用的日期函数：</p>
<p>SYSDATE函数与SYSTIMESTAMP函数SYSDATE函数返回当前日期和时间。SYSTIMESTAMP函数没有参数，用来返回系统时间，该时间包含时区信息，精确到微秒。</p>
<p><strong>LAST_DAY函数与NEXT_DAY函数</strong></p>
<p>LAST_DAY函数语法结构是：LAST_DAY (date)，返回指定日期对应月份的最后一天的日期。NEXT_DAT函数语法结构是：NEXT_DAY(date,char)，返回当前日期向后的一周char的对应日期，char表示的是星期几，全称和缩写都允许。</p>
<p><strong>MONTHS_BETWEEN函数</strong></p>
<p>MONTHS_BETWEEN函数语法结构是：MONTHS_BETWEEN(date1,date2)，用来返回两个日期之间月的数目。</p>
<p><strong>XTRACT函数</strong></p>
<p>EXTRACT函数语法结构是：EXTRACT (datetime)，该函数可以从指定的时间当中提取到指定的日期部分。</p>
<p><strong>统计函数</strong></p>
<p>统计函数对一组值执行计算并返回单一的值。统计函数经常与SELECT语句的GROUP BY子句一起使用。</p>
<p><strong>COUNT函数</strong></p>
<p>COUNT函数语法结构是：COUNT(*|[distinct][all]exp)，该函数用来计算记录的数量或某列的个数。函数中必须指定列名，或使用星号代表统计所有记录的个数。</p>
<p><strong>MAX函数</strong>:MAX函数语法结构是：MAX([distinct][all]exp)，该函数用来返回表达式的最大值。</p>
<p><strong>MIN函数</strong>:MIN函数语法结构是：MIN([distinct][all]exp)，该函数用来返回表达式的最小值。</p>
<p><strong>SUM函数</strong>:SUM函数语法结构是：SUM([distinct][all]exp)，该函数用来分组计算指定列的和，如果不使用分组，默认整个表作为一组。</p>
<p><strong>AVG函数</strong>:AVG函数语法结构是：AVG([distinct][all]exp)，该函数可求指定列的平均值，表示某组的平均值，返回数值类型。经常配合GROUP BY子句一起使用。</p>
<h3 id="转换函数-1"><a href="#转换函数-1" class="headerlink" title="转换函数"></a>转换函数</h3><p>换函数可以完成不同数据类型之间的转换，是平常使用比较多的函数类型之一.</p>
<p><strong>TO_CHAR函数</strong>:TO_CHAR函数转换数值和日期为字符串。</p>
<p><strong>TO_DATE函数</strong>:TO_DATE函数语法结构是：TO_DATE(char[,fmt[,nlsparam]])，该函数可将字符型数据转换成日期型数据。其中，fmt表示转换的格式；nlsparam控制格式化时使用的语言类型。</p>
<p><strong>CAST函数</strong>:CAST函数语法结构是：CAST(expr as type_name)，该函数实现了数据类型之间的转换。基本上用于数字与字符之间以及字符与日期类型之间的转换。</p>
<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>当在PL/SQL中使用SQL语句时，Oracle会为其分配上下文区域，这是一段私有的内存区域，用于暂时保存SQL语句影响到的数据。游标是指向这段内存区域的指针。游标并不是一个数据库对象，只是存留在内存中。游标分为显式游标和隐式游标两种。显式游标由用户声明和控制，用于从表中取出多行数据，并将多行数据一行一行单独进行处理。而隐式游标是是Oracle为所有数据操纵语句声明和操作的一种游标，主要针对DML操作和单行SELECT语句使用。在每个用户会话中，可以同时打开多个游标，其数量由数据库初始化参数文件中的OPEN CURSORS参数定义。两种游标都具有相同的属性，可以使用游标属性取得SQL语句的相关信息。在PL/SQL中游标的使用方法类似于数据库的函数。</p>
<h4 id="显式游标"><a href="#显式游标" class="headerlink" title="显式游标"></a>显式游标</h4><p>显式游标的主要作用就是暂存查询取出的多行数据，然后一行一行地进行处理。在PL/SQL中的SELECT语句只能且必须取出一行数据，取出多行或者零行都被认为是异常，所以在对多行数据进行查询操作时，必须使用显示游标来实现。显示游标的处理包括声明游标、打开游标、提取游标、关闭游标四个步骤。</p>
<p><strong>声明游标</strong></p>
<p>控制游标的第一步是声明游标，游标的声明定义了游标的名字，并将该游标与一个SELECT语句相关联，该语句将对应记录结果集返回游标。显式游标声明部分在DECLARE中，语法格式为：</p>
<pre><code class="sql">CURSOR cursor_name IS select_statement;</code></pre>
<p>其中cursor_name是游标名称，IS后面可以是SELECT语句的所有语法。</p>
<p><strong>打开游标</strong></p>
<p>打开游标相当于执行了游标定义的查询语句，激活了游标，取出的数据被暂存到了游标区域中，并且游标的指针指向了游标中的第一条记录，准备在程序的执行体中打开游标。打开游标的语法格式如下：</p>
<pre><code class="sql">OPEN cursor_name;</code></pre>
<p>与PL/SQL程序中的SELECT不同，游标的查询无论有没有返回记录，都不会引起异常。当打开一个游标时，会完成以下几件事情：（1） 检查联编变量的取值；（2） 根据联编变量的取值，确定活动集；（3） 活动集的指针指向第一行。</p>
<p><strong>提取游标</strong></p>
<p>打开游标后，可以通过程序来获得游标当前记录的信息，对应的取值语句是FETCH，提取操作相当于从游标区域中依次取出每一条记录，需要借助循环语句，每次取操作只能取出一条数据，并将指针指向下一条记录，通过使用游标属性测试游标状态，循环多次，直到游标区域被取空，指针指向空值为止。提取游标的语法格式如下：</p>
<pre><code class="sql">FETCH cursor_name INTO variable1, variable2, ... ;</code></pre>
<p>需要注意的是，INTO后面的变量应该与游标中的字段个数相同，并且变量与字段顺序也应该一一对应。在每次取操作后使用游标属性测试游标中是否还包含数据行，如果游标还未取空，循环执行取操作。</p>
<p><strong>关闭游标</strong>:在对查询到的所有记录的处理完成后，应该关闭游标。关闭游标意味着释放游标区域，将占用的游标内存空间回收。关闭游标的语法如下：</p>
<pre><code class="sql">CLOSE cursor_name;</code></pre>
<h4 id="隐式游标"><a href="#隐式游标" class="headerlink" title="隐式游标"></a>隐式游标</h4><p>隐式游标就是指非PL/SQL程序中定义的，而且是在PL/SQL中使用UPDATE、DELETE语句时，Oracle系统自动分配的游标。一般来说，所有的SQL语句在工作区内部都是可执行的，因此都有一个游标。与显示游标不同，隐式游标在PL/SQL中不需要打开，也不需要关闭，即在执行UPDATE、DELETE语句时自动打开和关闭。</p>
<p><strong>游标的属性</strong></p>
<p>无论是显式游标还是隐式游标，都有%ISOPEN、%FOUND、%NOTFOUND和%ROWCOUNT这四种属性来描述与游标操作相关的DML语句的执行情况。游标属性只能用在PL/SQL的流程控制语句内，而不能用在SQL语句内。</p>
<ol>
<li>%ISOPEN:该属性表示游标是否处于打开状态。在实际应用中，使用一个游标前，第一步往往是先检查它的%ISOPEN属性，看其是否已打开，若没有，要打开游标再向下操作。这也是防止运行过程中出错的必备一步。</li>
<li>Boolean类型，该属性表示当前游标是否指向有效一行，若是则为TRUE，否则为FALSE。检查此属性可以判断是否结束游标使用。</li>
<li>%NOTFOUND:该属性与%FOUND属性类似，但其值正好相反。在隐式游标中此属性的引用方法是SQL%NOTFOUND。</li>
<li>%ROWCOUNT:该属性记录了游标提取过的记录行数，也可以理解为当前游标所在的行号。这个属性在循环判断中也很有效，使得不必提取所有记录行就可以中断游标操作。</li>
</ol>
<p><strong>游标变量</strong></p>
<p>如同常量和变量的区别一样，前面所讲的游标都是与一个SQL语句相关联，并且在编译该块的时候此语句已经是可知的、是静态的，而游标变量可以在运行时与不同的语句关联，是动态的。游标变量被用于处理多行的查询结果集。在同一个PL/SQL块中，游标变量不同于特定的查询绑定，而是在打开游标时才确定所对应的查询。因此，游标变量可以依次对应多个查询。使用游标变量之前，必须先声明，然后在运行时必须为其分配存储空间，因为游标变量是REF类型的变量，类似于高级语言中的指针。  </p>
<p><strong>游标变量的声明</strong>:游标变量是一种引用类型。当程序运行时，它们可以指向不同的存储单元。如果要使用引用类型，首先要声明该变量，然后相应的存储单元必须要被分配。PL/SQL中的引用类型通过下述的语法进行声明：REF type其中，type是已经被定义的类型。REF关键字指明新的类型必须是一个指向经过定义的类型的指针。因此，游标可以使用的类型就是REF CURSOR。定义一个游标变量类型的完整语法如下：</p>
<pre><code class="sql">TYPE &lt;类型名&gt; IS REF CURSOR
RETURN &lt;返回类型&gt;；</code></pre>
<p>其中，&lt;类型名&gt;是新的引用类型的名字，而&lt;返回类型&gt;是一个记录类型，它指明了最终由游标变量返回的选择列表的类型。        游标变量的返回类型必须是一个记录类型。它可以被显式声明为一个用户定义的记录，或者隐式使用%ROWTYPE进行声明。在定义了引用类型后，就可以声明该变量了。</p>
<p><strong>游标变量的打开</strong>:如果要将一个游标变量与一个特定的SELECT语句相关联，需要使用OPEN FOR语句，其语法是：</p>
<pre><code class="sql">OPEN &lt;游标变量&gt; FOR &lt;SELECT语句&gt;;</code></pre>
<p>如果游标变量是受限的，则SELECT语句的返回类型必须与游标所限的记录类型匹配，如果不匹配，Oracle会返回错误ORA_6504。</p>
<p><strong>游标变量的关闭</strong>:游标变量的关闭和静态游标的关闭类似，都是使用CLOSE子句，这会释放查询所使用的空间。关闭已经关闭的游标变量是非法的。 </p>
<h3 id="游标FOR循环"><a href="#游标FOR循环" class="headerlink" title="游标FOR循环"></a>游标FOR循环</h3><p>游标FOR循环是显示游标的一种快捷使用方式，它使用FOR循环依次读取结果集中的行数据。当FOR循环开始时，不需要使用OPEN语句，游标被自动打开；每循环一次，系统自动读取游标当前行的数据，不需要FETCH语句；当退出FOR循环时，不需要使用CLOSE语句，游标自动关闭。也就是说，一个游标FOR循环可以隐含地实现OPEN、FECTCH、CLOSE游标以及循环处理结果集的功能。其语法格式是：</p>
<pre><code class="sql">FOR variable_name IN cursor_name [(value 1 [,value 2]…)] LOOP
Statement1; Statement 2, … ;
END LOOP;</code></pre>
<p>其中，variable_name为游标FOR循环隐含声明的索引变量，该变量名不需要显示定义，可以直接使用，并且该索引变量为记录类型，其结构与游标查询语句返回结果集的结构相同。在程序中可以通过引用该索引变量中的元素来读取所提取的游标数据。索引变量中的元素名称与游标查询语句选择列表中所指定的列名相同。如果在游标查询语句的选择列中有计算列，则必须为这些计算列起别名，然后才能通过游标FOR循环的索引变量来访问这些列的数据。cursor_name为声明的游标。value 1、value 2是应用程序传递给游标的参数。</p>
<p><strong>游标的更新</strong></p>
<p>游标的主要作用是查询数据，并对数据逐行进行处理。对于游标中的数据还可以根据需要进行修改或删除。在这种情况下，要求游标查询语句中必须使用FOR UPDATE选项。以便在打开游标时锁定游标结果集在数据库表中对应的数据行。此时，定义游标的格式如下：</p>
<pre><code class="sql">DECLARE
    CURSOR cursor_name(value 1, value 2,…)
    IS
SELECT column_list FROM table_list FOR UPDATE;</code></pre>
<p>游标可以带参数，或者不带参数。由于在并发环境中许多用户可能同时访问数据库，为了避免把游标打开后其他用户同时修改这些数据，需要对游标加锁，否则会导致数据的不一致。那么SELECT语句中的FOR UPDATE子句就是为了在游标打开后为其加锁，游标关闭后再释放锁，从而保证了用户对数据访问的正确性和一致性。</p>
<p>由于对游标中的数据是逐行处理的，每次处理指针所指向的当前行，并对当前行的数据进行修改，然后把修改过的数据写入数据库。PL/SQL在UPDATE和DELETE中使用WHERE CURRENT OF子句修改游标的当前行，其语法格式为：</p>
<pre><code class="sql">WHERE CURRENT OF cursor_name</code></pre>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><p>用户编写的PL/SQL块在执行过程中难免地会发生一些错误或者异常情况。例如，除数为0或者无法建立到Oracle的连接等。这里涉及的错误并不是由于程序的语法错误引起的，而是因为处理的数据超出了处理的范围而引发的错误，这就是异常。好的程序应该对可能发生的异常情况进行处理，异常处理代码在EXCEPTION块中实现。如果要在PL/SQL块中对异常进行处理，就需要在异常处理部分编写处理程序。可以使用WHEN语句来定义异常处理，基本语法结构如下：</p>
<pre><code class="sql">EXCEPTION
    WHEN exception 1 [OR exception 2 …] THEN  --异常列表
        statement [statement]…                 --语句序列
    [WHEN exception 3 [OR exception 4 …]  THEN
        statement [statement]…]
    …
    [WHEN OTHERS THEN
        statement [statement]…]
END</code></pre>
<p>异常处理程序以关键字EXCEPTION开始，以END关键字结束。在这部分可以对多个异常分别进行不同的处理，也可以进行相同的处理。在PL/SQL块中有三种类型的异常，即预定义的异常、非预定义的异常和用户自定义的异常。</p>
<p>● 预定义的异常：Oracle为用户提供了大量的在PL/SQL中使用的预定义异常，以检查用户代码失败的一般原因。它们都定义在Oracle的核心PL/SQL库中，用户可以在自己的PL/SQL异常处理部分使用名称对其进行标识。对这种异常情况的处理，无需在程序中定义，由Oracle自动将其引发。  </p>
<p>● 非预定义异常：即其他标准的Oracle错误。对这种异常情况的处理，需要用户在程序中定义，然后由Oracle自动将其引发。  </p>
<p>● 自定义异常：程序员可以把一些特定的状态定义为异常，在一定的条件下抛出，然后利用PL/SQL机制进行处理。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Oracle</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/04/21/Oracle11g--基础知识/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-21天VBA学习计划--基础知识篇" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/21/21天VBA学习计划--基础知识篇/">Excel VBA 21天学习计划</a>
    </h1>
  

        
        <a href="/2018/04/21/21天VBA学习计划--基础知识篇/" class="archive-article-date">
  	<time datetime="2018-04-20T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-04-21</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>参考《中文版Excel 2016高级VBA编程宝典》，开始21天的VBA学习计划，此为基础知识篇。</p>
<h1 id="第一天：Excel-VBA编程基础"><a href="#第一天：Excel-VBA编程基础" class="headerlink" title="第一天：Excel VBA编程基础"></a>第一天：Excel VBA编程基础</h1><h2 id="VBA基础知识"><a href="#VBA基础知识" class="headerlink" title="VBA基础知识"></a>VBA基础知识</h2><p>VBE会对文本进行自动调整，输入Sub语句后会自动插入End Sub语句，自动在等号两侧添加空格，对文本进行变色和大写处理。</p>
<pre><code class="vb">Sub GuessName() &#39;定义子过程&#39;
    Dim Msg As String &#39;声明变量（Dim语句）&#39;
    Dim Ans As Long &#39;为变量赋值（Msg和Ans）&#39;
    Mag = &quot;Is your name&quot; &amp; Application.UserName &amp; &quot;?&quot; &#39;连接两个字符串（用&amp;操作符）&#39;
    Ans = MsgBox(Msg, vbYesNo) &#39;使用内置的VBA函数（MsgBox）&#39;
    If Ans = vbNo Then MsgBox &quot;Oh,never mind.&quot; &#39;使用内置的VBA常量（vbYesNo、vbNo和vbYes）&#39;
    If Ans = vbYes Then MsgBox &quot;I must clairvoyant&quot; &#39;使用If-Then 结构两次&#39;
End Sub &#39;结束子过程&#39;</code></pre>
<p><strong>对象</strong>：看到的任何事物，属性为这些事物的特点特征。例如，在VBA中获取Sheet1中的单元格A1,输入:</p>
<pre><code class="vb">Application.ThisWorkbook.Sheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;).Select</code></pre>
<p><strong>集合</strong>：每个Workbook对象中，都有Worksheet集合。Worksheet集合是一个可通过VBA调用的对象。Workbook对象中每个Worksheet对象都位于Workbook集合中。</p>
<pre><code class="vb">Worksheets(1).Select &#39;通过集合位置引用，为从1开始的索引号&#39;
Worksheets(&quot;MySheet&quot;).Select &#39;将Worksheet名称作为索引号&#39;
Worksheets(2).Select &#39;通过集合位置引用，为从2开始的索引号&#39;
Worksheets(&quot;YourSheet&quot;).Select &#39;将Worksheet名称作为索引号&#39;
Workbooks(&quot;MyData.xlsx&quot;).Worksheets(&quot;Mysheet&quot;).Select &#39;引用某个不活动的工作簿中名为MySheet的工作表&#39;</code></pre>
<p><strong>属性</strong>：本质上是对象的特征。有些属性可修改，有些不不可修改。</p>
<pre><code class="vb">Sheets(“Sheet1”).Name = &quot;MySheet&quot; &#39;将Sheet1重命名为MySheet&#39;
MsgBoxRange(&quot;A1&quot;).Adress(RowAbsolute:=True,ColumnAbsolute:=True) &#39;使用RowAbsolute和ColumnAbsolute属性将danyuange单元格A1的Adress属性返回绝对引用($A$1)&#39;</code></pre>
<p><strong>为活动对象指定属性</strong>：Application有ActiveCelll,ActiveChart,ActiveSheet,ActiveWindow,ActiveWorkbook,Selection，ThisWorkbook等属性</p>
<pre><code class="vb">ActiveShell.ClearContents &#39;清除活动单元格的内容&#39;
MsgBox ActiveSheet.Name &#39;可显示活动工作表的名称&#39;
MsgBox ActiveWorkbook.FullName &#39;查看活动工作簿的名称和目录路径&#39;
Selection.Value = 12 &#39;Applicaion对象的Selection属性返回与所选单元格相对应的Range对象，修改Range对象的Value属性&#39;
ActiveWindow.RangeSelection.Value = 12 &#39;将值12填充到在选中非Range对象之前就已经选中的Range对象中&#39;
MsgBox ActiveWindow.RangeSelection.Count &#39;查看活动窗口选中了多少个单元格&#39;</code></pre>
<p><strong>方法</strong>：为可在对象上执行的动作</p>
<pre><code class="vb">Range(&quot;A1&quot;).Select &#39;Range对象的Select方法&#39;
Range(&quot;A1&quot;).Copy &#39;Range对象的Copy方法&#39;
ActiveSheet.Paste Destination:=Range(&quot;B1&quot;) &#39;显示定义Destination参数，就可以有效的使用Paste方法&#39;</code></pre>
<p><strong>参数</strong>：</p>
<pre><code class="vb">Workbooks(&quot;MyBook.xlsx&quot;).Protect &quot;xyzzy&quot;, True, False &#39;Workbook对象Protect方法，有三个参数:password,structure,windows对应保护结构和窗口&#39;
Workbooks(&quot;MyBook.xlsx&quot;).Protect , True, False &#39;不给密码赋值，用逗号隔出了占位符&#39;
Workbooks(&quot;MyBook.xlsx&quot;).Protect Structure:=True, Windows:=False &#39;使用命名参数，可读性更强&#39;
MsgBoxRange(&quot;A1&quot;).Address False &#39;此为无效语法，对于返回值的属性（和方法），必须给参数加上圆括号，Address属性会返回值，此处为无效语法&#39;
MsgBoxRange(&quot;A1&quot;).Address (False) &#39;正确语法&#39;
MsgBoxRange(&quot;A1&quot;).Address(rowAbsolute:=False) &#39;命名参数编写，可读性更强&#39;</code></pre>
<h2 id="使用Range对象"><a href="#使用Range对象" class="headerlink" title="使用Range对象"></a>使用Range对象</h2><p><strong>Range对象属性</strong>：Worksheet或Range类对象的Range属性，Worksheet对象的Cells属性，Range对象的Offset属性</p>
<p><strong>Range属性</strong>：返回一个Range对象</p>
<pre><code class="vb">Object.Range (cell1) &#39;Range属性返回一个Range对象&#39;
object.Range(cell1,cell2)  &#39;cell1与cell2是两个占位符，Excel认为他们是确定单元格区域(第一个实例)和描绘单元格区域（第二个实例）的项&#39;
Worksheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;).Value = 12.3 &#39;将值12.3放到活动工作簿中的工作表Sheet1的单元格的A1中&#39;
Worksheets(&quot;Sheet1&quot;).Range(&quot;Input&quot;).Value = 100 &#39;将值100放入名为&quot;Input&quot;单元格中&#39;
ActiveSheet.Range(&quot;A1:B10&quot;).Value = 2  &#39;把值2输入到活动工作表上包含20个单元格的单元区域内，如果活动工作表不是工作表，将出现一条错误信息&#39;
Range(&quot;A1&quot;, &quot;B10&quot;) = 2 &#39;与上例结果相同，省略了工作表的引用，因此假定是活动工作表;第一个参数是单元格左上角的单元格，而第二个参数是单元格右下角的单元格&#39;
Range(&quot;C1:C10 A6:E6&quot;) = 3 &#39;单元格区域交集赋值，此为C6单元格中放入3&#39;
Range(&quot;A1,A3,A5,A7,A9&quot;) = 4 &#39;指定5个单元格赋值4&#39;
ActiveCell.Range(&quot;B2&quot;) = 5 &#39;此示例将Range对象看成工作表中左上角的单元格，在单元格B2中输入5&#39;</code></pre>
<p><strong>Cells属性</strong>：可在Worksheet对象和Range对象上使用Cells属性，可在WorkSheet和Range对象上使用Cells属性。有三种语法格式：</p>
<pre><code class="vb">object.Cells(rowIndex,columnIndex)
Object.Cells (RowIndex)
Object.Cells</code></pre>
<p>举例说明：</p>
<pre><code class="vb">
Worksheets(&quot;Sheet1&quot;).Cells(1, 1) = 9 &#39;使用第一种语法，将9输入Sheet1中的单元格A1中&#39;
ActiveSheet.Cells(3, 4) = 7 &#39;数值7输入到活动工作表的单元格D3中&#39;
ActiveCell.Cells(1, 1) = 5 &#39;此示例将活动单元格看成是工作表中的单元格A1，输入5到活动单元格中&#39;
ActiveCell.Cells(2, 1) = 5 &#39;将5输入到活动单元格正下方的单元格中，将活动单元格看成参照&#39;

ActiveSheet.Cells(520) = 2 &#39;第二种语法，使用单个参数，数值范围是1-17179869184,与Excel单元格数目相等&#39;
MsgBox ActiveSheet.Cells(17179869184#) &#39;显示工作表最后一个单元隔的值&#39;
Range(&quot;A1:D10&quot;).Cells(5) = 2000 &#39;Cells属性有一个1-40的参数，第五个为A2&#39;
Range(&quot;A1:D10&quot;).Cells(41) = 2000 &#39;修改区域外单元格的值,A11&#39;

ActiveCells.Cells.ClearContents &#39;第三种语法返回所引用工作表中所有单元格，此例使用了Cells属性，在返回区域上使用了ClearContents清空所有单元格内容&#39;</code></pre>
<p><strong>Offset属性</strong>：与Range和Cells属性一样，Offset也返回Range对象，区别的是Offset对象只应用于Range，而不应用于其他的类。语法如下：</p>
<pre><code class="vb">object.Offset(rowOffset,columnOffset) &#39;接收两个参数，位置相对于指定的Range对象的左上角单元格，参数值可以为正、负或0&#39;</code></pre>
<p>例：</p>
<pre><code class="vb">ActiveCell.Offset(1, 0).Value = 12 &#39;把12输入到活动单元格正下方的单元格中&#39;
ActiveCell.Offset(-1, 0).Value = 15 &#39;把15输入到活动单元格的正上方的单元格中，此时若活动单元格为第一行，则返回错误&#39;</code></pre>
<p>使用相对引用模式下录制宏，Excel使用Offset属性时引用相对于起始位置的单元格，也就是宏录制开始的单元格，以下示例从B1开始:</p>
<pre><code class="vb">Sub Marco()
    ActiveCell.FormulaR1C1 = &quot;1&quot; &#39;将B1赋值1&#39;
    ActiveCell.Offset(1, 0).Range(&quot;A1&quot;).Select &#39;选中B2&#39;
    ActiveCell.FormulaR1C1 = &quot;2&quot; &#39;将B2赋值2&#39;
    ActiveCell.Offset(1, 0).Range(&quot;A1&quot;).Select &#39;选中B3&#39;
    ActiveCell.FormulaR1C1 = &quot;3&quot; &#39;赋值3&#39;
    ActiveCell.Offset(-2, 0).Range(&quot;A1&quot;).Select &#39;选中B1&#39;
End Sub</code></pre>
<p>生成的代码比较复杂，也可以删除Range(“A1”),也可以工作:</p>
<pre><code class="vb">Sub Marco()
    ActiveCell.FormulaR1C1 = &quot;1&quot; &#39;将B1赋值1&#39;
    ActiveCell.Offset(1, 0).Select &#39;选中B2&#39;
    ActiveCell.FormulaR1C1 = &quot;2&quot; &#39;将B2赋值2&#39;
    ActiveCell.Offset(1, 0).Select &#39;选中B3&#39;
    ActiveCell.FormulaR1C1 = &quot;3&quot; &#39;赋值3&#39;
    ActiveCell.Offset(-2, 0).Select &#39;选中B1&#39;
End Sub</code></pre>
<p>实际上，还有效率更高的宏版本：</p>
<pre><code class="vb">Sub Marco()
    ActiveCelll = 1
    ActiveCell.Offset(1, 0) = 2
    ActiveCell.Offset(2, 0) = 3
End Sub</code></pre>
<h2 id="需要记住的概念"><a href="#需要记住的概念" class="headerlink" title="需要记住的概念"></a>需要记住的概念</h2><ul>
<li>对象有独特的属性和方法</li>
<li>不进行选择情况下即可处理对象，这种情况下执行效率更高。录制宏先选择对象是没有必要的。</li>
<li>理解集合的概念很重要。多数时候，通过引用对象所在的集合可以间接引用某个对象，例如:此为访问名为MyFile的Workbook对象，按如下方式引用Workbooks集合，Workbook(“MyFile.xlsx”)</li>
<li>属性可以返回另一个对象的引用。下面例子中，Font属性返回Range对象中包含的一个Font对象，Bold是Font对象中而不是Range对象中的属性。</li>
</ul>
<pre><code class="vb">Range(&quot;A1&quot;).Font.Bold = True</code></pre>
<ul>
<li>有很多不同的方法可以引用相同的工作簿。假如有一个名为Sales的工作簿，它是唯一打开的工作簿，该工作簿只有一个名为Summary的工作表。可采取以下任意一种方式：</li>
</ul>
<pre><code class="vb">Workbook(&quot;Sales.xlsx&quot;).Worksheets(&quot;Summary&quot;)
Workbooks(1).Worksheets(1)
Workbooks.Sheets(1)
Application.ActiveWorkbook.ActiveSheet
ActiveWorkbook.ActiveSheet
ActiveSheet</code></pre>
<p>如果有多个工作簿打开，第二、三种方法就不可靠，如果使用活动工作表则后三种方法中可以任选一种。如果希望完全引用某个特定工作簿上的特定工作表，第一种方法是最佳选择。</p>
<p>##学习更多</p>
<p>使用Excel帮助，运用宏，使用对象浏览器，从w网上获取代码并修改，访问专家博客，youtube视频，Microsoft OfficeDev Center获取信息，查看底层代码。</p>
<h1 id="第二天：VBA编程基础"><a href="#第二天：VBA编程基础" class="headerlink" title="第二天：VBA编程基础"></a>第二天：VBA编程基础</h1><p>学习目标：</p>
<ul>
<li>理解VBA语言元素，包括变量、数据类型、常量和数组</li>
<li>使用VBA内置函数</li>
<li>处理对象和集合</li>
<li>控制过程的执行</li>
</ul>
<h2 id="VBA语言元素"><a href="#VBA语言元素" class="headerlink" title="VBA语言元素"></a>VBA语言元素</h2><p><strong>概览</strong>：以下为计算前100正数总和代码。下面过程并没有在任何对象上处理，只是对几个数据进行处理。</p>
<pre><code class="vb">Sub VBA_Demo() &#39;一个变量声明语句，Dim开头&#39;
    &#39;这是一个简单的VBA例子    一行注释，注释前用单引号&#39;
    Dim Total As Long, i As Long
    Total = 0
    For i = 1 To 100 &#39;两个变量，Total和i&#39;
        Total = Total + i &#39;两个赋值语句，Total=0和Total=Total+1&#39;
    Next i &#39;一个循环结构，For-Next结构&#39;
    MsgBox Total &#39;一个VBA函数，MsgBox函数&#39;
End Sub</code></pre>
<p>输入代码事项：</p>
<pre><code class="vb">&#39;一行中可以组合多条指令，用冒号隔开&#39;
Sub Oneline()
    x = 1: y = 2: Z = 3: MsgBox x + y + Z
End Sub
&#39;等同于:&#39;
Sub Oneline()
    x = 1
    y = 2
    Z = 3
    MsgBox x + y + Z
End Sub
&#39;每行代码长度不受限制，换行时用空格和下划线表示&#39;
Sub LongLine()
    SummeValue = _
        Worksheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;).Value + _
        Worksheets(&quot;Sheet2&quot;).Range(&quot;A1&quot;).Value
End Sub
&#39;在运算符间插入空格，调整关键字、属性和方法的字母大小写。&#39;</code></pre>
<p><strong>注释</strong>：嵌入代码中的描述性文本，VBA会忽略注释，即忽略不在双引号中的单引号的剩余内容，也可以用Rem进行注释，但Rem关键字只能在一行的开始处而不能与其他关键字共用一行。下面不包含注释：</p>
<blockquote>
<p>Msg  = “Can’t continue” </p>
</blockquote>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>变量是一些已命名的位于计算机内存的存储位置。有如下一些规则：</p>
<ul>
<li>可以使用字母、数字和一些标点符号，但是必须是字母开头。</li>
<li>VBA不区分大小写</li>
<li>不能使用空格或句点</li>
<li>不能在变量中嵌入特殊类型的声明字符</li>
<li>变量最多可以包含254个字符</li>
</ul>
<p>以下为一些示例,其中使用了各种类型的变量：</p>
<pre><code class="vb">x = 1
InterestRante = 0.075
LoanpayoffAmount = 243089.87
DataEntered = False
x = x + 1
MyNum = YourNum * 1.25
UserName = &quot;Bob Johnson&quot;
DataStarted = #12/14/2012#
Next = 132 &#39;保留字最好不要作为变量名&#39;</code></pre>
<p><strong>VBA内置数据类型分类</strong></p>
<table>
<thead>
<tr>
<th><em>数据类型（名称）</em></th>
<th><em>大小（字节）</em></th>
<th><em>描述</em></th>
</tr>
</thead>
<tbody><tr>
<td>Boolean</td>
<td>2</td>
<td>逻辑值True或False</td>
</tr>
<tr>
<td>Byte</td>
<td>1</td>
<td>0到255的整数</td>
</tr>
<tr>
<td>Integer</td>
<td>2</td>
<td>–32,768到32,767的整数</td>
</tr>
<tr>
<td>Long</td>
<td>4</td>
<td>–2,147,483,648到2,147,483,647的整数</td>
</tr>
<tr>
<td>Single</td>
<td>4</td>
<td>单精度浮点数值负数：–3.402823E38到–1.401298E–45正数：1.401298E–45到3.402823E38</td>
</tr>
<tr>
<td>Double</td>
<td>8</td>
<td>双精度浮点数值负数：–1.79769313486231E308到–4.94065645841247E–324正数：4.94065645841247E–324到1.79769313486231E308</td>
</tr>
<tr>
<td>Currency</td>
<td>8</td>
<td>（放大的整数（译者：整数除以10000得到的数值，参见VBA帮助））使用在定点计算中：–922,337,203,685,477.5808到922,337,203,685,477.5807</td>
</tr>
<tr>
<td>Decimal</td>
<td>14</td>
<td>+/–79,228,162,514,264,337,593,543,950,335没有小数点；+/–7.9228162514264337593543950335小数点后有28位数字；最小的非0数字是+/–0.0000000000000000000000000001</td>
</tr>
<tr>
<td>Date</td>
<td>8</td>
<td>从100年1月1日到9999年12月31日的日期</td>
</tr>
<tr>
<td>String（变长字符串）</td>
<td>10字节+字符串长度</td>
<td>变长字符串最多可包含大约 20 亿 ( 2^31)个字符。</td>
</tr>
<tr>
<td>String（定长字符串）</td>
<td>字符串长度</td>
<td>定长字符串最多可包含大约65,400 个字符。</td>
</tr>
<tr>
<td>Object</td>
<td>4</td>
<td>对象变量用来引用Excel中的任何对象</td>
</tr>
<tr>
<td>Variant（带数字）</td>
<td>16</td>
<td>最高范围到Double类型的任何数值</td>
</tr>
<tr>
<td>Variant（带字母）</td>
<td>22字节+字符串长度</td>
<td>和变长字符串的范围一样</td>
</tr>
<tr>
<td>用户定义类型（使用Type）</td>
<td>成员所需的数值</td>
<td>每个成员的范围和它的数据类型的范围一致</td>
</tr>
</tbody></table>
<p>一般来说，最好使用占用字节最少却能处理所有赋给他值的数据类型，换言之，数据使用字节越少，VBA访问和处理的速度就越快。</p>
<p><strong>声明变量</strong></p>
<p>如果不为VBA示例所使用的某个变量声明数据类型，VBA默认的数据类型是Variant。存储Variant数据类型的数据行为根据所处理的内容不同将改变数据类型：</p>
<pre><code class="vb">Sub VariantDemo()
    MyVar = True &#39;最开始为Boolean&#39;
    MyVar = MyVar * 100 &#39;乘法运算将其转换为Integer&#39;
    MyVar = MyVar / 4 &#39;除法运算将其转换为Double&#39;
    MyVar = &quot;Answer: &quot; &amp; MyVar &#39;把MyVar附加到一个字符串后，把MyVar转换为字符串&#39;
    MsgBox MyVar &#39;显示出最后的字符串&#39;
End Sub</code></pre>
<p>VBA对未声明变量的数据转换行为是自动的，但是这是以牺牲内存和速度为代价的，而且可能会出现错误。</p>
<pre><code class="vb">Sub VariantDemo()
    MyVar = True &#39;最开始为Boolean&#39;
    MsgBox TypeName(MyVar) &#39;每一步都显示出MyVar数据类型，利用VBA中的TypeName函数&#39;
    MyVar = MyVar * 100 &#39;乘法运算将其转换为Integer&#39;
    MsgBox TypeName(MyVar)
    MyVar = MyVar / 4 &#39;除法运算将其转换为Double&#39;
    MsgBox TypeName(MyVar)
    MyVar = &quot;Answer: &quot; &amp; MyVar &#39;把MyVar附加到一个字符串后，把MyVar转换为字符串&#39;
    MsgBox TypeName(MyVar)
    MsgBox MyVar &#39;显示出最后的字符串&#39;
End Sub</code></pre>
<p>过程中使用每个变量前，最好对变量进行声明，告诉VBA变量的名称和数据类型，有两个好处：</p>
<ul>
<li>程序运行更快并能更有效地使用内存</li>
<li>避免出现与错误拼写变量名称相关的问题</li>
</ul>
<p>可以强制声明所有变量，在VBA中使用以下语句：Option Explicit，此语句存在时，要是含有一个未声明变量，VBA会提示错误信息，建议启用“工具”|“选项”|“编辑器”|“要求声明变量”。</p>
<p><strong>变量作用域</strong></p>
<table>
<thead>
<tr>
<th align="center">作用域</th>
<th align="left">如何声明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">单个过程</td>
<td align="left">在过程中包括一个Dim或Static语句</td>
</tr>
<tr>
<td align="center">单个模块</td>
<td align="left">在模块内的第一个过程之前包括一个Dim和Private语句</td>
</tr>
<tr>
<td align="center">所有模块</td>
<td align="left">在模块内的第一个过程之前包括第一个Public语句</td>
</tr>
</tbody></table>
<blockquote>
<p>局部变量：在过程中声明的变量，在过程结束时，Excel会释放出它占有的内存。因此，局部变量一般来说是最高效的。如果需要在过程结束时，变量保留自己的数值，那么可以把变量声明为静态变量。</p>
</blockquote>
<p>最常用声明方式为把Dim(Dimension的简写)放在Sub之后、过程代码之前。</p>
<pre><code class="vb">&#39;使用6个局部变量均用Dim语句进行声明&#39;
Sub MySub()
    Dim x As Integer
    Dim First As Long
    Dim IntersetRate As Single
    Dim TodaysDate As Date
    Dim UserName As String
    Dim MyValue &#39;此处为Variant&#39;
End Sub</code></pre>
<p>也可以用一条Dim语句声明多个变量</p>
<pre><code class="vb">Dim x As Integer, y As Integer, z As Integer &#39;VBA不允许将一组变量以逗号分隔形式声明某个数据类型，如：Dim x,y,z As Integer为错误&#39;
Dim First As Long, Last As Double</code></pre>
<blockquote>
<p>模块作用域下的变量:希望在所有过程中都可以使用某个变量，这样只需要在第一个过程之前声明这个变量即可。</p>
</blockquote>
<pre><code class="vb">Dim CurentValue As Long

Sub Procedure1()
...
End Sub

Sub Procedure2()
...
End Sub</code></pre>
<p>通常当某个过程正常结束时，模块作用域下的值不会改变。但是有一种情况例外，就是使用End语句终止过程时，当VBA遇到End语句时，所有模块作用域下的值豆浆丢失。</p>
<blockquote>
<p>公共变量：为能在项目所有VBA模块的所有过程都可以使用的某个变量，需要在第一个过程之前进行变量的声明，此时用Public而不是Dim。</p>
</blockquote>
<pre><code class="vb">Public CurrentRate as Long</code></pre>
<p>Public关键字使得变量CurrentRate在VBA项目内的任意过程中都可以使用，甚至在其他模块中也可以使用。</p>
<blockquote>
<p>静态变量：在过程层次上进行变量的声明，当过程结束时静态变量保持他们的值不变，然而，如果有一条End终止了该过程，则静态变量会丢失值。</p>
</blockquote>
<pre><code class="vb">&#39;使用关键字Static可以声明静态变量&#39;
Sub MSub()
    Static Counter As Long
    ...
End Sub()</code></pre>
<p><strong>使用常量</strong></p>
<blockquote>
<p>使用Const声明常量,常量值一般不会发生变化。</p>
</blockquote>
<pre><code class="vb">Public Const AppName As String = &quot;Budget Application&quot; &#39;工作簿中所有模块中使用某个常量，可以使用Public关键字并在第一个模块中的第一个过程前声明它。&#39;
Const NumQuaters As Integer = 4 &#39;未声明数据类型，VBA会指定&#39;
Const Rate = 0.75, Period = 12
Const ModName As String = &quot;Budget Macros&quot;</code></pre>
<blockquote>
<p>使用预定义的常量：Excel和VBA中提供了很多预定义的常量，这些常量不声明即可使用。</p>
</blockquote>
<pre><code class="vb">Sub SetToLandScape() &#39;录制宏的时候会发现xlLandscape是一个常量，将活动工作表的页面设置为横向&#39;
    ActiveSheet.PageSetup.Orientation = xlLandscape
End Sub</code></pre>
<blockquote>
<p>使用日期：使用Date数据类型处理日期。</p>
</blockquote>
<p>Excel错误的假定1900年是个闰年，即是没有1900年2月29日，Excel还是接受下面的公式并显示结果为1900年2月29日,但是VBA没有这种故障，VBA中DateSerial函数相当于Excel的DATE函数。</p>
<pre><code class="vb">= Date(1900,2,29) &#39;Excel下
DateSerial(1900,2,29) &#39;VBA下返回1900年3月1日&#39;</code></pre>
<p>举例说明：将变量和常量声明为Date数据类型：</p>
<pre><code class="vb">Dim Today As Date
Dim StartTime As Date
Const FirstDay As Date = #1/1/2013#
Const Noon = #12:00:00 PM#</code></pre>
<blockquote>
<p>使用字符串</p>
</blockquote>
<pre><code class="vb">Dim MyString As String * 50 &#39;定长字符串，把MyString声明为最大长度为50的字符串&#39;
Dim YourString As String &#39;变长字符串&#39;</code></pre>
<p><strong>赋值语句</strong>：VBA用等号进行语句赋值</p>
<pre><code class="vb">X = 1
X = X + 1
X = (y * 2) / Z * 2
FileOpen = True
FileOpen = Not FileOpen
Range(&quot;TheYear&quot;).Value = 2010</code></pre>
<p>VBA运算符优先级顺序：</p>
<table>
<thead>
<tr>
<th><strong>算术运算</strong></th>
<th><strong>比较</strong></th>
<th><strong>逻辑</strong></th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>求幂 ( <strong>^</strong> )</td>
<td>相等 ( <strong>=</strong> )</td>
<td><strong>Not</strong></td>
<td>非</td>
</tr>
<tr>
<td>求反 ( <strong>-</strong> )</td>
<td>不相等 ( ** &lt; ** )</td>
<td><strong>And</strong></td>
<td>与</td>
</tr>
<tr>
<td>乘法和除法 (<strong>， */</strong> )</td>
<td>小于 ( <strong>&lt;</strong> )</td>
<td><strong>Or</strong></td>
<td>或</td>
</tr>
<tr>
<td>整数除法 (<strong>\</strong> )</td>
<td>大于号 ( <strong>&gt;</strong> )</td>
<td><strong>Xor</strong></td>
<td>异或</td>
</tr>
<tr>
<td>求模算法 ( <strong>Mod</strong> )</td>
<td>小于或等于 ( ** &lt; ** )</td>
<td><strong>Eqv</strong></td>
<td>等价</td>
</tr>
<tr>
<td>加法和减法 ( <strong>+</strong>， <strong>-</strong> )</td>
<td>大于或等于 ( <strong>&gt;=</strong> )</td>
<td><strong>Imp</strong></td>
<td>蕴含</td>
</tr>
<tr>
<td>字符串连接 ( <strong>&amp;;</strong> )</td>
<td><strong>LikeIs</strong></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><p><strong>数组</strong>是指拥有相同名称的同类元素。使用数组名称和一个索引号可以引用数组的某个特定元素，索引号从0开始。</p>
<p><strong>数组声明</strong>：可以用Dim或Public语句来声明数组，就像声明普通变量一样。</p>
<pre><code class="vb">Dim MyArray(1 To 100) As Integer
Dim MyArray(100) As Integer &#39;与上句效果一样，VBA假定从0开始&#39;
Option Base 1 &#39;包含此语句时，即让VBA假定索引号从1开始&#39;
Dim MyArray(1 To 10, 1 To 10) As Integer &#39;声明10x10的二维数组&#39;
MyArray(3, 4) = 125 &#39;给以上矩阵的某个元素赋值&#39;
Dim MyArray(1 To 10, 1 To 10, 1 To 10) As Integer  &#39;声明10x10x10的三维数组&#39;
MyArray(3, 4, 5) = 125 &#39;给以上矩阵的某个元素赋值&#39;
Dim MyArray() As Integer &#39;声明动态数组，使用一组空括号&#39;
ReDim MyArray(1 To X) &#39;使用动态数组之前，必须使用ReDim语句说明VBA数组包含多少个元素，此例中x是一个数值&#39;
ReDim Preserve MyArray(1 To y) &#39;可以使用任意次数的ReDim，每次使用将破坏原有值，若想保留原有值，则加上Preserve&#39;</code></pre>
<h3 id="对象变量"><a href="#对象变量" class="headerlink" title="对象变量"></a>对象变量</h3><p><strong>对象变量</strong>是代表一个完整对象的变量，如单元格区域或工作表。对象变量很重要，可以显著地简化代码并且可使代码的执行速度更快。同样使用Dim或Public语句进行声明。</p>
<pre><code class="vb">Dim InputArea As Range &#39;该语句把变量InputArea声明为一个Range对象变量&#39;
Set InputArea = Range(&quot;C16:E16&quot;) &#39;使用关键字Set可以把对象付给变量&#39;
    Sub ObjVar() &#39;将MyCell声明为一个Range对象后，Set语句把一个对象赋给它，然后后面的语句可以使用更简单的MyCell引用来代替冗长的Worksheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;)引用&#39;
    Dim MyCell As Range
    Set MyCell = Worksheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;)
    MyCell.Value = 124
    MyCell.Font.Bold = True
    MyCell.Font.Italic = True
    MyCell.Font.Size = 14
    MyCell.Font.Name = Cambria
End Sub
</code></pre>
<p><strong>用户自定义数据类型</strong>：VBA允许用户自定义数据类型。用户自定义数据类型可以方便处理一些数据类型。例如，如果应用程序要处理客户的信息，可能要创建一个名为CustomerInfo的用户自定义数据类型，如下所示：</p>
<pre><code class="vb">Type CustomerInfo
    Company As String
    Contact As String
    RegionCode As Long
    Sales As Double
End Type</code></pre>
<p>在用户创建了自定义数据类型后，可使用Dim语句把变量声明为这种类型。</p>
<pre><code class="vb">Dim Customers(1 To 100) As CustomerInfo &#39;采用如下语句引用记录中的某个tedingdebug&#39;
Customers(1).Cmpany = &quot;Acme Tools&quot;
Customers(1).Contact = &quot;Tim Robertson&quot;
Customers(1).RegionCode = 3
Customers(1).Sales = 150674.98
Customers(2) = Customers(1)
&#39;上面的示例等于下面的指令块&#39;
Customers(2).Company = Customers(1).Company
Customers(2).Contact = Customers(1).Contact
Customers(2).Contact = Customers(1).RegionCode
Customers(2).Sales = Customers(1).Sales</code></pre>
<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><p>在VBA中，可以使用很多但不是所有的Excel的工作表函数。Worksheet-Function对象包含在Application对象中，Worksheet-Function对象包含可从VBA过程调用的所有工作表函数。在为VBA语句中使用工作表函数，可以使用如下语句。</p>
<pre><code>Application.WorksheetFunction</code></pre><p>下面的示例阐述了如何在VBA过程中使用Excel工作表函数。在Excel中很少用到ROMAN函数，可以将十进制数转换为罗马数字。</p>
<pre><code class="vb">Sub ShowRoman()
    Dim DecValue As Long
    Dim RomanValue As String
    DecValue = 1939
    RomanValue = Application.WorksheetFunction.Roman(DecValue)
    MsgBox RomanValue
End Sub</code></pre>
<p>注意：不能使用具有等价的VBA函数的工作表函数，例如VBA不能访问Excel的SQRT工作表函数。</p>
<p><strong>MsgBox</strong>函数正式语法包含5个参数（方括号中的参数是可选的）</p>
<pre><code class="vb">MsgBox( prompt ** [, ***buttons* ] [, title ] [, helpfile, context ] )</code></pre>
<p><strong>MsgBox</strong> 语法包含以下 <a href="https://msdn.microsoft.com/zh-cn/vba/language-reference-vba/articles/vbe-glossary" target="_blank" rel="noopener">命名参数</a>：</p>
<table>
<thead>
<tr>
<th><strong>部件</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>prompt</strong></td>
<td>必需。 <a href="https://msdn.microsoft.com/zh-cn/vba/language-reference-vba/articles/vbe-glossary" target="_blank" rel="noopener">字符串表达式</a>在对话框中显示为消息。 <strong>prompt</strong> 的最大长度约为 1024 个字符，具体取决于所使用的字符的宽度。如果 <strong>prompt</strong> 包含多个行，则可以通过在每行之间使用回车符 ( <strong>Chr(</strong> 13 <strong>)</strong> )、换行符 ( <strong>Chr(</strong>10 <strong>)</strong> ) 或回车符和换行符的组合 ( <strong>Chr(</strong> 13 <strong>)</strong> &amp; <strong>Chr(</strong> 10 <strong>)</strong> ) 分隔这些行。</td>
</tr>
<tr>
<td><strong>buttons</strong></td>
<td>可选。一个 <a href="https://msdn.microsoft.com/zh-cn/vba/language-reference-vba/articles/vbe-glossary" target="_blank" rel="noopener">数值表达式</a>，是用于指定要显示的按钮的数量和类型、要使用的图标样式、默认按钮的标识和消息框的模态的值的总和。如果省略 <strong>buttons</strong> ，则其默认值为 0。</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>可选。对话框的标题栏中显示的字符串表达式。如果省略了 <strong>title</strong> ，应用程序名称将位于标题栏内。</td>
</tr>
<tr>
<td><strong>helpfile</strong></td>
<td>可选。确定要用于为对话框提供上下文相关帮助的帮助文件的字符串表达式。如果提供了 <strong>helpfile</strong> ，则还必须提供 <strong>context</strong> 。</td>
</tr>
<tr>
<td><strong>context</strong></td>
<td>可选。一个数值表达式，是由帮助作者分配给适当的帮助主题的帮助上下文编号。如果提供了 <strong>context</strong> ，则还必须提供 <strong>helpfile</strong> 。</td>
</tr>
</tbody></table>
<p>下面的示例把结果值赋给了一个变量，或在不使用赋值语句的情况下使用函数，如下图所示：</p>
<pre><code>Dim Ans As Long
Ans = MsgBox(&quot;Continue?&quot;, vbYesNo + vbQuestion, &quot;Tell me&quot;)
If Ans = vbNo Then Exit Sub</code></pre><p>注意，buttons参数中使用了两个内置参数之和(vbYesNo+vbQuestion)。使用vbYesNo可以在消息框中显示两个按钮：一个按钮标签是“是”，一个为“否”。vbQuestion添加到参数中会显示一个问号图标。</p>
<h2 id="处理对象和集合"><a href="#处理对象和集合" class="headerlink" title="处理对象和集合"></a>处理对象和集合</h2><p>VBA提供了两种简化对象和集合处理的结构:</p>
<ul>
<li>With-End With结构</li>
<li>For Each-Next 结构</li>
</ul>
<p><strong>With-End With结构</strong>允许在单个对象上执行多项操作。以下过程修改了选中区域的6个属性（选中区域假定为一个Range对象）：</p>
<pre><code class="vb">Sub ChangeFont1()
    Selection.Font.Name = &quot;Cambria&quot;
    Selection.Font.Bold = True
    Selection.Font.Italic = True
    Selection.Font.Size = 12
    Selection.Font.Underline = xlUnderlineStyleSingle
    Selection.Font.ThemeColor = xlThemeColorAccent1
End Sub</code></pre>
<p>可用With-End With结构重新编写该过程，下面 结果与上面一样,但速度更快：</p>
<pre><code class="vb">Sub ChangeFont2()
    With Selection.Font
        .Name = &quot;Cambria&quot;
        .Bold = True
        .Italic = True
        .Size = 12
        .Underline = xlUnderlineStyleSingle
        .ThemeColor = xlThemeColorAccent1
    End With
End Sub</code></pre>
<p><strong>For Each-Next结构</strong>:语法如下：</p>
<pre><code class="vb">For Each element In Collection
    [instructions]
    [Exit For]
    [instructions]
Next [element]</code></pre>
<p>下面的过程在活动工作簿中的Worksheets集合上使用For Each-Next结构。在执行这个过程时，MsgBox函数显示出每个工作表的Name属性。</p>
<pre><code class="vb">Sub CountSheets()
    Dim Item As Worksheet &#39;Item为Worksheet对象变量&#39;
    For Each Item In ActiveWorkbook.Worksheets
        MsgBox Item.Name
    Next Item
End Sub</code></pre>
<p>下面示例使用了For Each-Next结构来遍历Windows集合中所有对象，并计算隐藏窗口总数。</p>
<pre><code class="vb">Sub HiddenWindows()
    Dim Cnt As Integer
    Dim Win As Window
    Cnt = 0
    For Each Win In Windows
        If Not Win.Visible Then Cnt = Cnt + 1
    Next Win
    MsgBox Cnt &amp; &quot;hidden windows&quot;
End Sub</code></pre>
<p>下面示例中关闭了除活动工作簿之外的所有工作簿。使用了If-Then结构对Workbooks集合中的每个工作簿求值。</p>
<pre><code class="vb">Sub CloseInactive()
    Dim Book As Workbook
    For Each Book In Workbooks
        If Book.Name &lt;&gt; ActiveWorkbook.Name Then Book.Close
    Next Book
End Sub</code></pre>
<p>For Each-Next一个常见的用法就是遍历单元格区域中所有的单元格。下一个For Each-Next结构的示例将在用户选择了单元格区域后才执行。因为选区中的每一个单元格都是一个Range对象，所以Selection对象扮演由Range对象组成的集合的角色。这个过程对每个单元格求值并使用VBA的UCase函数把单元格的内容转换为大写字母（数字单元格不受影响）。</p>
<pre><code class="vb">Sub MakeUpperCase()
    Dim Cell As Selection
    For Each Cell In Selection
        Cell.Value = UCase(Cell.Value)
    Next Cell
End Sub</code></pre>
<p>下面示例选择了活动工作表中的第一行的第一个负数。</p>
<pre><code class="vb">Sub SelectNegtive()
    Dim Cell As Range
    For Each Cell In Range(&quot;1:1&quot;)
        If Cell.Value &lt; 0 Then
           Cell.Select
           Exit For
        End If
    Next Cell
End Sub</code></pre>
<p>该示例使用了If-Then结构来检查每个单元格的数值。如果单元格是负值，那么选定该单元格，然后执行Exit For语句时结束该循环。</p>
<p>##控制过程的执行</p>
<h3 id="Go-To语句"><a href="#Go-To语句" class="headerlink" title="Go To语句"></a>Go To语句</h3><p>在下面过程中，使用VBA的Input函数来获得函数用户名。如果姓名不是Howard,那么过程将转移到执行带有WrongName标签的分支并结束。否则，该过程执行其他代码。Exit Sub语句将结束该过程的执行。</p>
<pre><code class="vb">Sub GoToDemo()
    UserName = InputBox(&quot;Enter YOur Name&quot;)
    If UserName &lt;&gt; &quot;Howard&quot; Then GoTo WrongName
    MsgBox (&quot;Welcome Howard ...&quot;)
    &#39;-[More Codes here]-
    Exit Sub
WrongName:
    MsgBox &quot;Sorry.Only Howard can run this macro&quot;
End Sub</code></pre>
<h3 id="If-Then结构"><a href="#If-Then结构" class="headerlink" title="If-Then结构"></a>If-Then结构</h3><p>If-Then结构基本语法如下：</p>
<pre><code class="vb">If condition Then true_instructions [Else false_instructionw]</code></pre>
<p>这种常用的指令提供了赋予应用程序决策能力的方式。好的决策是成功编写程序的关键。下面例子阐述了不喊Else子句的If-Then结构。</p>
<pre><code class="vb">Sub GreenMe1()
    If Time &lt; 0.5 Then MsgBox &quot;Good Morning&quot;
End Sub</code></pre>
<p>另一种给该历程编写代码的方法是使用多个子句：</p>
<pre><code class="vb">Sub GreenMe1()
    If Time &lt; 0.5 Then 
        MsgBox &quot;Good Morning&quot;
    End If
End Sub</code></pre>
<p>还可以多添加一个If-Then语句，如下所示：</p>
<pre><code class="vb">Sub GreenMe2()
    If Time &lt; 0.5 Then MsgBox &quot;Good Morning&quot;
    If Time &gt;= 0.5 Then MsgBox &quot;Good Afternoon&quot;
End Sub</code></pre>
<p>还有一种方法运用If-Then结构的Else子句,这里使用了换行连续序列，If-Then-Else实际上是一条语句。</p>
<pre><code class="vb">Sub GreenMe3()
    If Time &lt; 0.5 Then MsgBox &quot;Good Morning&quot; Else _
    MsgBox &quot;Good Afternoon&quot;
End Sub</code></pre>
<p>如果想执行基于条件的多条语句，可以用如下形式：</p>
<pre><code class="vb">Sub GreenMe3a()
    If Time &lt; 0.5 Then 
        MsgBox &quot;Good Morning&quot; Else _
    Else
        MsgBox &quot;Good Afternoon&quot;
    End If
End Sub</code></pre>
<p>对于更复杂的情形来说，则需要另一种语法：</p>
<pre><code class="vb">If condition Then
    [true_instructions]
[ElseIf condition-n Then
    [alternate_instructions]]
[Else
    [default_instructions]]
End If</code></pre>
<p>以下为示例：</p>
<pre><code class="vb">Sub GreetMe5()
    If Time &lt; 0.5 Then 
        MsgBox &quot;Good Morning&quot; 
    ElseIf Time &gt;= 0.5 And Time &lt; 0.75 Then
        MsgBox &quot;Good Afternoon&quot;
    Else
        MsgBox &quot;Good Evening&quot;
    End If
End Sub</code></pre>
<p>下面过程阐述另一种方法来编写上述代码，其中使用了If-The-Else结构（没有使用ElseIf）。这个过程效率更高，更容易读懂。</p>
<pre><code class="vb">Sub GreetMe6()
    If Time &lt; 0.5 Then 
        MsgBox &quot;Good Morning&quot; 
    Else
        If Time &gt;= 0.5 And Time &lt; 0.75 Then
            MsgBox &quot;Good Afternoon&quot;
        Else
            If Time &gt;= 0.75 Then
                MsgBox &quot;Good Evening&quot;
            End If
        End If
    End If
End Sub</code></pre>
<p>以下示例使用了If-Then结构的简单形式。这个过程用户输入Quantity的值，然后会显示折扣，由于考虑空字符，因此把Quantity声明为Variant而不是Integer</p>
<pre><code class="vb">Sub Discount1()
    Dim Quantity As Variant
    Dim Discount As Double
    Quantity = InputBox(&quot;Enter Quantity: &quot;)
    If Quantity = &quot;&quot; Then Exit Sub
    If Quantity &gt;= 0 Then Discount = 0.1
    If Quantity &gt;= 25 Then Discount = 0.1
    If Qantity &gt;= 50 Then Discount = 0.2
    If Quantity &gt;= 75 Then Discount = 0.25
    MsgBox &quot;Discount: &quot; &amp; Discount
End Sub</code></pre>
<p>下面过程使用了另一种语法对上一个过程进行了重新编写。这种情况下在执行了True指令块后，该过程立即结束。</p>
<pre><code class="vb">Sub Discount2()
    Dim Quantity As Variant
    Dim Discount As Double
    Quantity = InputBox(&quot;Enter Quantity: &quot;)
    If Quantity = &quot;&quot; Then Exit Sub
    If Quantity &gt;= 0 And Quantity &lt; 25 Then
        Discount = 0.1
    ElseIf Qantity &lt; 50 Then 
        Discount = 0.15
    ElseIf Quantity &lt; 75 Then 
        Discount = 0.2
    Else
        Discount = 0.25
    End If
    MsgBox &quot;Discount: &quot; &amp; Discount
End Sub</code></pre>
<p>VBA也提供了替代If-Then结构的另一种方法，即用IIf函数。</p>
<blockquote>
<p>IIf(expr,truepart,falsepart)</p>
</blockquote>
<p>示例：</p>
<pre><code class="vb">MsgBox IIf(Range(&quot;A1&quot;) = 0, &quot;Zero&quot;, &quot;Nonzero&quot;)
MsgBox IIf(n = 0, 0, 1/n) &#39;即使expr为True时，第三个参数仍要计算，此例中会生成一个除零的错误消息。&#39;</code></pre>
<h3 id="Select-Case结构"><a href="#Select-Case结构" class="headerlink" title="Select Case结构"></a>Select Case结构</h3><p><strong>SelectCase</strong>便于在三个或多个选项之间做选择，只要发现为True的情况，就退出Select Case结构，因此为例最大限度提升效率，应先检测最可能发生的情况。是If-Then-Else结构的很好替代。语法如下：</p>
<pre><code class="vb">Select Case testexpression
    [Case expressionlist-n
        [instructions-n]]
    [Case Else
        [default_instructions]]
End Select</code></pre>
<p>以下为示例，对GreetMe重新编写</p>
<pre><code class="vb">Sub GreetMe()
    Dim Msg As String
    Select Case Time
        Case Is &lt; 0.5
            Msg = &quot;Good Morning&quot;
        Case 0.5 To 0.75
            Msg = &quot;Good Afternoon&quot;
        Case Else
            Msg = &quot;Good Evening&quot;
    End Select
    MsgBox Msg
End Sub
</code></pre>
<p>对Discount重新编写：</p>
<pre><code class="vb">Sub Discount2()
    Dim Quantity As Variant
    Dim Discount As Double
    Quantity = InputBox(&quot;Enter Quantity: &quot;)
    Select Case Quntity
    Case &quot;&quot;
        Exit Sub
    Case 0 To 24
        Discount = 0.1
    Case 25 To 49
        Discount = 0.15
    Case 50 To 74
        Discount = 0.2
    Case Is &gt;= 75
        Discount = 0.25
    End Select
    MsgBox &quot;Discount: &quot; &amp; Discount
End Sub</code></pre>
<p>下面过程使用VBA的WeekDay函数确定当天是否为周末（即Weekday函数返回1，7）：</p>
<pre><code class="vb">Sub GreetUser1()
    Select Case Weekday(Now)
        Case 1, 7
            MsgBox &quot;This is the weekend&quot;
        Case Else
            MsgBox &quot;This is not the weekend&quot;
    End Select
End Sub</code></pre>
<p>下面示例显示了对前面代码的过程进行编写的另一种方法：</p>
<pre><code class="vb">Sub GreetUser2()
    Select Case Weekday(Now)
        Case 2, 3, 4, 5, 6
            MsgBox &quot;This is not the weekend&quot;
        Case Else
            MsgBox &quot;This is not the weekend&quot;
    End Select
End Sub</code></pre>
<p>可以把指令与关键字Case放在同一行上（VBA分割符：），这样的处理会使VBA代码变得更加简洁，例如：</p>
<pre><code class="vb">Sub Discount2()
    Dim Quantity As Variant
    Dim Discount As Double
    Quantity = InputBox(&quot;Enter Quantity: &quot;)
    Select Case Quntity
    Case &quot;&quot;: Exit Sub
    Case 0 To 24: Discount = 0.1
    Case 25 To 49: Discount = 0.15
    Case 50 To 74: Discount = 0.2
    Case Is &gt;= 75: Discount = 0.25
    End Select
    MsgBox &quot;Discount: &quot; &amp; Discount
End Sub</code></pre>
<p>以下示例为使用VBA的TypeName函数来确定选择的对象（单元格区域、什么都不选择或其他对象）。如果选择的是单元格区域，过程将执行嵌套的Select Case结构并测试单元格区域内的单元格数目。如果选择的是一个单元格，将显示”One Cell is Selected”:</p>
<pre><code class="vb">Sub SelectionType()
    Select Case TypeName(Selection)
        Case &quot;Range&quot;
            Select Case Selection.Count
                Case 1
                    MsgBox &quot;One cell is selected&quot;
                Case Else
                    MsgBox Selection.Rows.Count &amp; &quot; rows&quot;
            End Select
        Case &quot;Nothing&quot;
            MsgBox &quot;Nothing is selected&quot;
        Case Else
            MsgBox &quot;Something other than a range&quot;
    End Select
End Sub</code></pre>
<h3 id="For-Next循环"><a href="#For-Next循环" class="headerlink" title="For-Next循环"></a>For-Next循环</h3><p>在不是绝对必要的情况下，不赞成编程人员使用GoTo语句，使用GoTo语句进行循环违背了结构化程序设计理念。最简单的一个好循环就是For-Next循环。语法如下：</p>
<pre><code class="vb">For counter = start To end [Step stepval]
    [instructions]
    [Exit For]
    [instructions]
Next counter</code></pre>
<p>以下示例计算前100整数平方根总和，其中Count为循环计数器变量，每重复一次，循环计数器就加1：</p>
<pre><code class="vb">Sub SumSquareRoobts()
    Dim Sum As Double
    Dim Count As Integer
    Sum = 0
    For Count = 1 To 100
        Sum = Sum + Sqr(Count)
    Next Count
    MsgBox Sum
End Sub</code></pre>
<p><strong>结构化程序设计</strong>：结构化程序设计基本的前提是例程或代码片段只应该有一个入口和一个出口。换言之，代码的主体应该是独立的单元，而程序控制应该不跳入这个单元内部或从这个单元中间退出。VBA是一种结构化的语言，它提供了标准的结构化构造，如If-Then-Else、Select Case、For-Next、Do Until以及Do While循环。</p>
<p>以下示例为删除了活动工作表中第2、4、6、8和第10行的内容，为了避免行数发生变化，因此从下方向上删除：</p>
<pre><code class="vb">Sub DeleteRows()
    Dim RowNum As Long
    For RowNum = 10 To 2 Step -2
        Rows(RowNum).Delete
    Next RowNum
End Sub</code></pre>
<p>以下示例为For-Next结构的良好循环：</p>
<pre><code class="vb">Sub GoodLoop()
    Dim StartVal As Integer
    Dim NumToFill As Integer
    Dim Cnt As Integer
    StartVal = 1
    NumToFill = 100
    For Cnt = 0 To NumToFill - 1
        ActiveCell.Offset(Cnt, 0).Value = StartVal + Cnt
    Next Cnt
End Sub</code></pre>
<p>For-Next循环还可在循环中包含一条或多条Exit For语句。在遇到这条语句时，循环立即终止，控制权交给For-Next循环的Next语句后面的一条语句。下面的示例说明了Exit For语句的用法。该过程确定了在活动工作表中的列A中包含最大值的单元格是哪一个：</p>
<pre><code class="vb">Sub ExitForDemo()
    Dim MaxVal As Double
    Dim Row As Long
    MaxVal = Application.WorksheetFunction.Max(Range(&quot;A:A&quot;)) 
    For Row = 1 To 1048576
        If Cells(Row, 1).Value = MaxVal Then
            Exit For
        End If
    Next Row
    MsgBox &quot;Max value is in Row &quot; &amp; Row
    Cells(Row, 1).Activate
End Sub</code></pre>
<p>实际上，用一条语句即可完成上述任务：</p>
<pre><code class="vb">Range(&quot;A:A&quot;).Find(Application.WorksheetFunction.Max(Range(&quot;A:A&quot;))).Activate</code></pre>
<p>使用For-Next循环来初始化一个10x10x10的数组，使得数组的元素值都为-1.</p>
<pre><code class="vb">Sub NestedLoops()
    Dim MyArray(1 To 10, 1 To 10, 1 To 10)
    Dim i As Integer, j As Integer, k As Integer
    For i = 1 To 10
        For j = 1 To 10
            For k = 1 To 10
                MyArray(i, j, k) = -1
            Next k
        Next j
    Next i
End Sub</code></pre>
<h3 id="Do-While循环"><a href="#Do-While循环" class="headerlink" title="Do While循环"></a>Do While循环</h3><p><strong>Do While循环</strong>只有在满足指定条件时才会执行Do While循环。</p>
<pre><code class="vb">Do [While condition]
    [instructions]
    [Exit Do]
    [instructions]
&#39;或&#39;
Do  &#39;第二种语法至少执行一次&#39;
    [instructions]
    [Exit Do]
    [instructions]
Loop [While condition]</code></pre>
<p>以下示例把当月的日期写到工作表的第一个以活动单元格为起点的列中，TheDate变量包含了写到工作表的日期。</p>
<pre><code class="vb">Sub EnterDates1()
    Dim TheDate As Date
    TheDate = DateSerial(Year(Date), Month(Date), 1) &#39;Date返回当前日期，Month返回作为参数的日期对应月份，DateSerial返回年月日&#39;
    Do While Month(TheDate) = Month(Date)
        ActiveCell = TheDate
        TheDate = TheDate + 1
        ActiveCell.Offset(1, 0).Activate
    Loop
End Sub</code></pre>
<p>第二种语法：</p>
<pre><code class="vb">Sub EnterDates1()
    Dim TheDate As Date
    TheDate = DateSerial(Year(Date), Month(Date), 1) &#39;Date返回当前日期，Month返回作为参数的日期对应月份，DateSerial返回年月日&#39;
    Do
        ActiveCell = TheDate
        TheDate = TheDate + 1
        ActiveCell.Offset(1, 0).Activate
    Loop While Month(TheDate) = Month(Date)
End Sub</code></pre>
<p>Do While也可以包含一条或多条Exit Do语句。遇到Exit Do语句时，循环会立即结束，控制权交给Loop语句后面的语句。</p>
<h3 id="Do-Untill循环"><a href="#Do-Untill循环" class="headerlink" title="Do Untill循环"></a>Do Untill循环</h3><p><strong>Do Untill</strong>循环中，一直执行循环直至循环条件值为True，也有两种语法模式：</p>
<pre><code class="vb">Do [Untill condition]
   [instructions]
   [Exit Do]
   [instructions] 
Loop</code></pre>
<p>第二种语法：</p>
<pre><code class="vb">Do 
   [instructions]
   [Exit Do]
   [instructions] 
Loop [Untill condition]</code></pre>
<p>下面示例与Do While日期录入示例效果一致，唯一区别在于两个过程计算条件的位置不同（位于循环开始处和位于循环结尾处）</p>
<pre><code class="vb">Sub EnterDates3()
    Dim TheDate As Date
    TheDate = DateSerial(Year(Date), Month(Date), 1) &#39;Date返回当前日期，Month返回作为参数的日期对应月份，DateSerial返回年月日&#39;
    Do Until Month(TheDate) &lt;&gt; Month(Date)
        ActiveCell = TheDate
        TheDate = TheDate + 1
        ActiveCell.Offset(1, 0).Activate
    Loop
End Sub</code></pre>
<p>下面是第二个示例：</p>
<pre><code class="vb">Sub EnterDates3()
    Dim TheDate As Date
    TheDate = DateSerial(Year(Date), Month(Date), 1) &#39;Date返回当前日期，Month返回作为参数的日期对应月份，DateSerial返回年月日&#39;
    Do
        ActiveCell = TheDate
        TheDate = TheDate + 1
        ActiveCell.Offset(1, 0).Activate
    Loop Until Month(TheDate) &lt;&gt; Month(Date)
End Sub</code></pre>
<p>另一个示例：</p>
<pre><code class="vb">Sub DoUntilDemo1()
    Dim LineCt As Long
    Dim LineOfText As String
    Open &quot;c:\data\textfile.txt&quot; For Input As #1
    LineCt = 0
    Do Until EOF(1)
        Line Input #1, LineOfText
        Range(&quot;A1&quot;).Ofset(LineCt, 0) = UCase(LineOfText)
        LineCt = LineCt + 1
    Loop
    Close #1
End Sub</code></pre>
<p>注意：VBA还支持另外一种循环：While Wend。包含这种循环结构主要是处于兼容性的目的。下面是通过While Wend循环编写的日期录入过程的代码：</p>
<pre><code class="VB">Sub EnterDates5()
    Dim TheDate As Date
    TheDate = DateSerial(Year(Date), Month(Date), 1)
    While Month(TheDate) = Month(Date)
        ActiveCell = TheDate
        TheDate = TheDate + 1
        ActiveCell.Offset(1, 0).Activate
    Wned
End Sub</code></pre>
<h1 id="第三天：VBA子过程"><a href="#第三天：VBA子过程" class="headerlink" title="第三天：VBA子过程"></a>第三天：VBA子过程</h1><p>##关于过程</p>
<p><strong>“过程”</strong>是一系列位于VBA模块中的VBA语句，在VBE中可以访问这些VBA模块，一个模块可以包含任意数量的过程。</p>
<p>使用Sub关键字生命的过程必须遵循以下语法格式：</p>
<pre><code class="vb">[Private | Public][Static] Sub name ([arglist])
    [instructions]
    [Exit Sub]
    [instructions]
End Sub</code></pre>
<p>其中：Sub、name和End Sub必需，其余可选。</p>
<ul>
<li>Private：表明只有痛一个模块的其他过程才可以访问这个过程。</li>
<li>Public：表明该工作簿中所有模块的其他过程都可以访问这个过程。如果该过程包含在含义Option Private Module语句的模块中，那么这个过程就不可以用于该工程之外。</li>
<li>Static：表明过程结束时将保存过程的变量。</li>
<li>Sub：表示过程的起点。</li>
<li>name：过程名称。</li>
<li>arglist：代表一系列变量，逗号分隔，括号括起。</li>
<li>instructions：代表有效的VBA指令。</li>
<li>Exit Sub：在正式结束之前，强制立即从过程中退出的语句。</li>
<li>End Sub：表示过程的结束。</li>
</ul>
<p><strong>公共过程</strong>：Public声明。</p>
<p><strong>私有过程</strong>：Excel中宏对话框中只显示公共过程，用Private定义私有过程，仅可以被同一模块下的其他过程调用。在第一个Sub语句前加入 Option Private Module可以将模块中所有过程强制设为私有过程，此时可以在Sub前省略Private。</p>
<h2 id="过程的执行"><a href="#过程的执行" class="headerlink" title="过程的执行"></a>过程的执行</h2><p>调用VBA过程有几种方法：</p>
<ul>
<li>使用“运行”|“运行子过程/用户窗体”命令，或使用工具栏上的按钮。</li>
<li>“宏”对话框中运行</li>
<li>Ctrl指定快捷键</li>
<li>插入控件指定宏的模式</li>
<li>在事件反生时执行</li>
<li>在立即窗口中执行</li>
</ul>
<pre><code class="vb">Sub ChangeCase()
    Dim MyString As String
    MyString = &quot;This is a test&quot;
    MyString = UCase(MyString)
    Debug.Print MyString
End Sub &#39;在立即窗口中输入ChangeCase时：Debug.Print语句将立即显示结果&#39;</code></pre>
<ul>
<li>编写一个子过程，子过程和函数过程可以执行其他过程。有三种方式：</li>
</ul>
<pre><code class="vb">Sub AddTwo(arg1, arg2)
    MsgBox arg1 * arg2
End Sub

AddTwo 12, 6 &#39;第一种调用方式，参数不放在括号里&#39;
Call AddTwo(12, 6) &#39;第二种调用方式，使用关键字Call&#39;
Run &quot;AddTwo&quot;, 12, 6 &#39;第三种，使用Application对象的Run方法&#39;</code></pre>
<p>通常使用Call来清楚表明正在调用的某个过程。当过程名称指定给某个变量时，只能使用Run。</p>
<pre><code>Sub Main()
    Dim SubToCall As String &#39;SubCall变量被赋予一个代表过程名称的字符串
    Select Case Weekday(Now)
        Case 1, 7: SubToCall = &quot;WeekEnd&quot;
        Case Else: SubToCall = &quot;Daily&quot;
    End Select
        Application.Run SubToCall
End Sub

Sub WeekEnd()
    MsgBox &quot;Today is a weekend&quot;
End Sub

Sub Daily()
    MsgBox &quot;Today is not a weekend&quot;
End Sub</code></pre><p><strong>调用其他模块的过程</strong>时，可以在过程名称前加上模块名。</p>
<pre><code class="vb">Module1.MySub
Call Module.MySub &#39;两条语句中任选一句&#39;</code></pre>
<p><strong>调用另一个工作簿的过程</strong>有两种方式。一种先创建饮用，创建饮用后可以使用如下其中一条语句：</p>
<pre><code class="vb">YourSub
Call YourSub &#39;与上效果一致&#39;
YourProject.YourModule.YourSub &#39;为准确识别另一个工作簿的某个过程，可以使用此语法指定工程名称、模块名称和过程名称。&#39;
Call YourProject.YourModule.YourSub &#39;使用关键字Call&#39;</code></pre>
<p>创建引用的方式：“工具”|引用|点击要添加引用的工作簿，按确定即可，被引用的工作簿可以看作单独的对象库，引用后被引用工作簿不必打开。</p>
<p>另一种方式方法是使用Application对象的Run方法，这种方法不需要建立引用，但是含有该过程的工作簿必须是打开的。下列语句执行了位于budget macro.xlsm工作簿中的Consolidate过程：</p>
<pre><code class="vb">Application.Run &quot;&#39;budget macro.xlsm&#39;!Consolidate&quot; &#39;工作簿名称包括在了单引号内，此种语法只有当文件名包括了一个或多个空格时才是必须的&#39;
Application.Run &quot;budget.xlsm!Consolidate&quot; </code></pre>
<p>注意：创建小型过程而不是大型单个过程是非常好的习惯，模块化方法不仅使工作变得更加容易，而且可以简化处理代码人员的工作。</p>
<h2 id="向过程中传递参数"><a href="#向过程中传递参数" class="headerlink" title="向过程中传递参数"></a>向过程中传递参数</h2><p>过程中的“参数”提供了它在指令中要使用的数据，通过参数传递的数据可能是以下一种：</p>
<ul>
<li>变量</li>
<li>常量</li>
<li>表达式</li>
<li>数组</li>
<li>对象</li>
</ul>
<pre><code class="vb">Sub Main()
    Dim File(1 To 3) As String
    Dim i As Integer
    File(1) = &quot;Dept1.xlsx&quot;
    File(2) = &quot;Dept2.xlsx&quot;
    File(3) = &quot;Dept3.xlsx&quot;
    For i = 1 To 3
        Call Processfile(TheFile)
    Next i
End Sub

Sub Processfile()
    Workbooks.Open Filename:=TheFile
End Sub</code></pre>
<p>可采用下面两种方式将参数传递给过程：</p>
<ul>
<li>通过引用：通过引用传递参数方法（默认方法）只是传递变量的内存地址。对过程的参数修改将影响到原始变量。</li>
<li>通过数值：通过数值传递参数传递的是原始变量的副本。因此，对过程中所做的参数修改不会影响到原变量。</li>
</ul>
<pre><code class="vb">Sub Main()
    Dim Value As Integer
    MyValue = 12
    Call Process(MyValue)
    MsgBox MyValue
End Sub

Sub Process(YourValue)             &#39;调用此过程，输出结果120，Process过程结束后把控制权交给了Main&#39;
    YourValue = YourValue * 10
End Sub

Sub Process(ByVal YourValue)       &#39;调用此过程则对YourValue的修改不会影响到Main过程的MyValue的值&#39;
    YourValue = YourValue * 10
End Sub</code></pre>
<p>使用参数的过程可以直接在参数列表中定义数据类型，再此调用时作为参数传递的数据必须与这个参数的数据类型进行匹配。下面语句接收两个不同的参数：</p>
<pre><code class="vb">Sub Process(Iterations As Integer, TheFile As String)</code></pre>
<h2 id="错误处理技术"><a href="#错误处理技术" class="headerlink" title="错误处理技术"></a>错误处理技术</h2><p>一般而言，运行错误时将导致VBA代码停止运行，用户会看到错误编号和内容。好的应用程序不会让用户处理这些消息，而是在应用程序中集成了错误处理代码，进而可以捕获并采取相应的动作。为了能让错误处理过程起作用，必须关闭发生错误则中断设置。在VBE中选择“工具”|“选项”|“通用”|“遇到未知错误则中断”。</p>
<p>可使用On Error语句<strong>捕获错误</strong>，基本上有下列两种办法：</p>
<ul>
<li>忽略错误并允许VBA继续执行代码：代码可以稍后检查Err对象，进而确定错误。</li>
</ul>
<pre><code class="vb">On Error Resume Next &#39;插入此语句会使错误发生时VBA代码继续执行&#39;</code></pre>
<ul>
<li>跳转到代码中特殊的错误处理部分，进而采取动作：这一代码部分位于过程的末尾，还用标签进行了标识。有些错误无关紧要，但是当想知道发生了什么错误时，可以使用Err对象确定错误编号。VBA的Error函数可以显示与Err.Number相应的文本。</li>
</ul>
<pre><code class="vb">If Err.Number &lt;&gt; 0 Then MsgBox &quot;An error occurred.&quot; &#39;可使用此语句检查是否存在错误 &#39;</code></pre>
<pre><code class="vb">Sub ChangeSheetName()
    On Error Resume Next
    Worksheets(&quot;sheet1&quot;).Name = &quot;Raw Data&quot;
    If Err.Number &lt;&gt; 0 Then
        MsgBox &quot;Error &quot; &amp; Err &amp; &quot;: &quot; &amp; Error(Err.Number)
    End If
End Sub</code></pre>
<p>注意：引用Err对象等同于访问Err对象的Number属性。</p>
<pre><code class="vb">MsgBox Err
MsgBox Err.Number &#39;与上一语句效果相同&#39;
On Error GoTo ErrorHandler &#39;还可以使用On Error语句指定在错误发生时应跳转到过程中的某个位置，可以使用此标签标识。&#39;</code></pre>
<p>示例1：</p>
<pre><code class="vb">&#39;下面的示例没有使用错误处理&#39;
Sub SelectionFormulas() 
    Selection.SpecialCells(xlFormulas).Select &#39;SpecialCells选中了当前单元格区域选区中所有的单元格&#39;
End Sub

&#39;下面的示例使用了On Error Resume Next语句防止显示错误处理&#39;
Sub SelectionFormulas2()
    On Error Resume Next
    Selection.SpecialCells(xlFormulas).Select
    On Error GoTo 0 &#39;为了执行该语句，On Error GoTo 0语句将恢复为普通的错误处理&#39;
End Sub

&#39;下面的语句使用了另一条语句来确定是否会发生错误。如果发生错误，将会向用户显示消息&#39;
Sub SelectionFormulas3()
    On Error Resume Next
    Selection.SpecialCells(xlFormulas).Select
    If Err.Number = 1004 Then MsgBox &quot;No formula cells were found.&quot;
    On Error GoTo 0 &#39;为了执行该语句，On Error GoTo 0语句将恢复为普通的错误处理&#39;
End Sub</code></pre>
<p>示例二：</p>
<pre><code class="vb">&#39;此示例说明了通过跳转到某个标签而进行的错误处理。该例试图把值赋给当前选中的区域，如果出现错误，赋值语句会出错，On Error语句就指定跳转到Handler标签。注意这个标签中使用了Exit Sub语句，避免了没有出现错误时执行错误处理代码，如果省略这个条语句，即使没有出现错误也会显示错误消息。&#39;
Sub ErrorDemo()
    On Error GoTo Handler
    Selection.Value = 123 
    Exit Sub
Handler:
    MsgBox &quot;Cannot assign a value to the selection&quot;
End Sub</code></pre>
<p>示例三：</p>
<pre><code class="vb">&#39;下面示例检测某个特定工作簿是否打开，这里没有使用任何错误处理代码。&#39;
Sub CheckForFiel1()
    Dim FileName As String
    Dim FileExists As Boolean
    Dim book As Workbook
    FileName = &quot;BUDGET.XLSX&quot;
    FileExists = False

    &#39;Cycle through all open workbooks
    For Each book In Workbooks
        If UCase(book.Name) = FileName Then FileExists = True
    Next book

    &#39;Display appropriate message
    If FileExists Then
        MsgBox FileName &amp; &quot; is open&quot;
    Else
        MsgBox FileName &amp; &quot; is not open&quot;
    End If
End Sub

&#39;对上述示例进行改写，使用错误处理代码即可确定文件是否打开。在下面示例中，On Error Resume Next导致VBA忽略了任何错误。通过把工作簿赋值给某个对象变量，接下来通过关键字Set引用这个工作簿，如果没有工作簿没有打开，便会出现错误。If-Then-Else结构检查Err的value属性并显示出相应消息。&#39;
Sub CheckForFiel2()
    Dim FileName As String
    Dim x As Workbook
    FileName = &quot;BUDGET.XLSX&quot;
    On Error Resume Next
    Set x = Workbooks(FileName)
    If Err = 0 Then
        MsgBox FileName &amp; &quot; is open&quot;
    Else
        MsgBox FileName &amp; &quot; is not open&quot;
    End If
End Sub</code></pre>
<h2 id="使用子过程的实际示例"><a href="#使用子过程的实际示例" class="headerlink" title="使用子过程的实际示例"></a>使用子过程的实际示例</h2><p><strong>目标</strong>：开发一个程序，使其通过工作表的字母顺序重新整理所在的工作簿。</p>
<p>第一步，进行初始准备，建立包含5个工作表的空白工作簿，打乱顺序，保存为Text.xlsx。创建子过程并保存到个人宏工作簿的模块中（个人宏存储状态为个人宏工作簿），子过程存放程序代码。</p>
<p>第二步，编写代码获取工作表的名称。</p>
<pre><code class="vb">&#39;由于初始不知道工作表个数，因此用带括号的Dim语句声明数组，再用ReDim重新定义维数。&#39;
Sub SortSheets()
    Dim SheetNames() As String
    Dim i As Long
    Dim SheetCount As Long
    SheetCount = ActiveWorkbook.Sheets.Count
    ReDim SheetNames(1 To SheetCount)
    For i = 1 To SheetCount
        SheetNames(i) = ActiveWorkbook.Sheets(i).Name
        Debug.Print SheetNames(i)
    Next i
End Sub</code></pre>
<p>第三步，编写排序过程。</p>
<pre><code class="vb">&#39;排序过程采用冒泡排序算法，这个过程接受了一个参数：一个名为List的一位数组。传递给过程的数组可以任意长。这里使用LBound和UBound两个函数把数组的下界和上界分别指定给First和Last变量。&#39;
Sub BubbleSort(List() As String)
    Dim First As Long, Last As Long
    Dim i As Long, j As Long
    Dim Temp As String
    First = LBound(List)
    Last = UBound(List)
    For i = First To Last - 1
        For j = i + 1 To Last
            If UCase(List(i)) &gt; UCase(List(j)) Then
                Temp = List(j)
                List(j) = List(i)
                List(i) = Temp
            End If
        Next j
    Next i
End Sub
&#39;这是一个临时过程可以测试BubbleSort过程。&#39;
Sub SortTester()
    Dim x(1 To 5) As String
    Dim i As Long
    x(1) = &quot;dog&quot;
    x(2) = &quot;cat&quot;
    x(3) = &quot;pig&quot;
    x(4) = &quot;elephant&quot;
    x(5) = &quot;lion&quot;
    Call BubbleSort(x)
    For i = 1 To 5
        Debug.Print i, x(i)
    Next i
End Sub</code></pre>
<p>第三步,编写移动表代码：</p>
<pre><code class="vb">For i = 1 To SheetCount
    Sheets(SheetNames(i)).Move Before:=Sheets(i)
Next i</code></pre>
<p>第四步，整合代码，添加注释。</p>
<p>第五步，测试并修复问题:</p>
<ul>
<li>包含很多工作表的工作簿要花费很长时间进行排序，在移动中，屏幕要不断更新。</li>
</ul>
<ul>
<li>BubbleSort过程会导致所有字母都是大写的表（例如SUMMARY）放在Sheet1的前面，使用UCase函数修复，或是在模块顶部添加Option Compare Text。</li>
<li>避免没有可见工作簿而引起的异常，在运行前测试是否为空工作簿。</li>
<li>如果工作簿受保护，则move失败，可以在运行前测试工作表状态。</li>
<li>排序后，活动工作表变成了最后一个工作表，修复为原来的工作表活动状态。</li>
<li>如果按Ctrl+Break快捷键中断宏的运行，VBA就会显示错误的信息，可以设置禁用Ctrl+Break。</li>
<li>如果不小心按下快捷键，则会进行排序，因此要在运行前增加提示信息。</li>
</ul>
<pre><code class="vb">Sub SortSheets()
&#39;   This routine sorts the sheets of the active workbook in ascending order.&#39;
&#39;   Use Ctrl+Shift+S to execute&#39;

    Dim SheetNames() As String
    Dim i As Long
    Dim SheetCount As Long

    If ActiveWorkbook Is Nothing Then Exit Sub &#39; No active workbook&#39;
    SheetCount = ActiveWorkbook.Sheets.Count

&#39;   Check for protected workbook structure&#39;
    If ActiveWorkbook.ProtectStructure Then
        MsgBox ActiveWorkbook.Name &amp; &quot; is protected.&quot;, _
           vbCritical, &quot;Cannot Sort Sheets.&quot;
        Exit Sub
    End If

&#39;   Make user verify&#39;
    If MsgBox(&quot;Sort the sheets in the active workbook?&quot;, _
      vbQuestion + vbYesNo) &lt;&gt; vbYes Then Exit Sub

&#39;   Disable Ctrl+Break&#39;
    Application.EnableCancelKey = xlDisabled

&#39;   Get the number of sheets&#39;
    SheetCount = ActiveWorkbook.Sheets.Count

&#39;   Redimension the array&#39;
    ReDim SheetNames(1 To SheetCount)

&#39;   Store a reference to the active sheet&#39;
    Set OldActive = ActiveSheet

&#39;   Fill array with sheet names&#39;
    For i = 1 To SheetCount
        SheetNames(i) = ActiveWorkbook.Sheets(i).Name
    Next i

&#39;   Sort the array in ascending order&#39;
    Call BubbleSort(SheetNames)

&#39;   Turn off screen updating&#39;
    Application.ScreenUpdating = False

&#39;   Move the sheets&#39;
    For i = 1 To SheetCount
        ActiveWorkbook.Sheets(SheetNames(i)).Move _
            Before:=ActiveWorkbook.Sheets(i)
    Next i

&#39;   Reactivate the original active sheet&#39;
    OldActive.Activate

End Sub

Sub BubbleSort(List() As String)
    Dim First As Long, Last As Long
    Dim i As Long, j As Long
    Dim Temp As String
    First = LBound(List)
    Last = UBound(List)
    For i = First To Last - 1
        For j = i + 1 To Last
            If UCase(List(i)) &gt; UCase(List(j)) Then
                Temp = List(j)
                List(j) = List(i)
                List(i) = Temp
            End If
        Next j
    Next i
End Sub</code></pre>
<p>因为SortSheets宏存储在个人宏工作簿，所以只要Excel在运行，都可以使用这个宏。</p>
<h1 id="第四天：创建函数过程"><a href="#第四天：创建函数过程" class="headerlink" title="第四天：创建函数过程"></a>第四天：创建函数过程</h1><h2 id="子过程与函数过程"><a href="#子过程与函数过程" class="headerlink" title="子过程与函数过程"></a>子过程与函数过程</h2><p>VBA允许创建子过程和函数过程，子过程可以被看成由用户或另一个过程执行的命令。而函数过程通常返回一个数值（或一个数组），就像Excel的工作表函数一样。</p>
<h2 id="创建自定义函数"><a href="#创建自定义函数" class="headerlink" title="创建自定义函数"></a>创建自定义函数</h2><p>函数示例：</p>
<pre><code class="vb">&#39;开头使用零Function而不是Sub,函数名称为REMOVEVOWELS,这个自定义函数只使用了一个参数(Txt),As String指定了参数类型。接下来的语句使用了For Next循环，该循环过程遍历了每一个输入的字符，然后构成一个字符串。循环的第一条指令使用了VBA的Mid函数从输入的字符串中返回了一个字符，并把该字符串转换成大写字母。然后使用Excel中Like运算符来比较一列字符。当If子句为true时，字符就添加到了REMOVEVOWLS中。&#39;
Function REMOVEVOWELS(Txt) As String
&#39;REMOVE ALL VOWELS FROM THE Txt argument&#39;
    Dim i As Long
    REMOVEVOWELS = &quot;&quot;
    For i = 1 To Len(Txt)
        If Not UCase(Mid(Txt, i, 1)) Like &quot;[AEIOU]&quot; Then
            REMOVEVOWELS = REMOVEVOWELS &amp; Mid(Txt, i, 1)
        End If
    Next i
End Function
&#39;以下为Select Case实现方法&#39;
Function REMOVEVOWELS(Txt) As String
&#39;REMOVE ALL VOWELS FROM THE Txt argument&#39;
    Dim i As Long
    Dim TempString As String
    TempString = &quot;&quot;
    For i = 1 To Len(Txt)
        Select Case UCase(Mid(Txt, i, 1))
            Case &quot;A&quot;, &quot;E&quot;, &quot;I&quot;, &quot;O&quot;, &quot;U&quot;
                &#39;Do nothing&#39;
            Case Else
                TempString = TempString &amp; Mid(Txt, i, 1)
            End Select
        Next i
        REMOVEVOWELS = TempString
End Function</code></pre>
<p><strong>使用方法</strong>：</p>
<ul>
<li>在模块中放入上述函数代码，在工作表中使用的时候=REMOVEVOWELS(A1)，或是嵌套使用，例如：=UPPER(REMOVEVOWELS(A1)</li>
<li>在VBA过程中使用函数，要在模块内容中放入上述函数代码，并添加以下代码，调用宏。</li>
</ul>
<pre><code class="vb">Sub ZapTheVowels()
    Dim UserInput As String
    UserInput = InputBox(&quot;Enter some text: &quot;)
    MsgBox REMOVEVOWELS(UserInput), vbInformation, UserInput
End Sub</code></pre>
<p>注意：自定义工作表函数只返回一个值，它不能执行与对象有关的动作。因此，在开发自定义函数时，函数过程中的代码不能处理单元格区域或在工作表上进行修改。</p>
<h2 id="函数过程"><a href="#函数过程" class="headerlink" title="函数过程"></a>函数过程</h2><p>声明函数的语法如下：</p>
<pre><code class="vb">[Public | Private |Static Function Name(arglist)[As type] ]
    [instructions]
    [name = expression]
    [Exit Function]
    [instructions]
    [name = expression]
End Function</code></pre>
<p>创建自定义函数，首先要插入一个VBA模块（或使用已有的标准VBA模块）。需要牢记：通常在执行结束时，至少给函数名称赋值一次。</p>
<p><strong>函数作用域、执行函数的过程、函数过程的参数</strong>参考子过程相关部分。</p>
<p><strong>函数示例</strong>：</p>
<p>示例一：</p>
<pre><code class="vb">&#39;以下函数为无参数函数，阐明了如何创建一个包装器函数，使它只返回一个属性或是一个VBA函数的结果。&#39;
Function USER()
    &#39;返回当前用户名&#39;
    USER = Apication.UserName
End Function

Function EXCELDIR() As String
    &#39;返回Excel加载的字典&#39;
    EXCELDIR = Application.Path
End Function

Function SHEETCOUNT()
    &#39;返回工作簿中工作表的个数&#39;
    SHEETCOUNT = Application.Caller.Parent.Parent.Sheets.Count
End Function

Function SHEETNAME()
    &#39;返回工作表名称&#39;
    SHEETNAME = Application.Caller.Parent.Name
End Function

Function STATICRAND()
    &#39;返回随机数&#39;
    STATICRAND = Rnd()
End Function</code></pre>
<p>示例二：</p>
<pre><code class="vb">&#39;用来计算销售人员佣金的函数，佣金与月销售额成正比。此为带有一个参数的函数。&#39;
Function COMMISSION(Sales)
    Const Tier1 = 0.08
    Const Tier2 = 0.105
    Const Tier3 = 0.12
    Const Tier4 = 0.14
&#39;   Calculates sales commissions
    Select Case Sales
       Case 0 To 9999.99: COMMISSION = Sales * Tier1
       Case 10000 To 19999.99: COMMISSION = Sales * Tier2
       Case 20000 To 39999.99: COMMISSION = Sales * Tier3
       Case Is &gt;= 40000: COMMISSION = Sales * Tier4
    End Select
End Function
&#39;假设销售人员在工作时间每增长1年，支付总佣金就增长1%。此为带有两个参数的函数。&#39;
Function COMMISSION2(Sales, Years) As Single
&#39;    Calculates sales commissions based on&#39;
&#39;    years in service&#39;
     Const Tier1 = 0.08
     Const Tier2 = 0.105
     Const Tier3 = 0.12
     Const Tier4 = 0.14
     Select Case Sales
        Case 0 To 9999.99: COMMISSION2 = Sales * Tier1
        Case 10000 To 19999.99: COMMISSION2 = Sales * Tier2
        Case 20000 To 39999.99: COMMISSION2 = Sales * Tier3
        Case Is &gt;= 40000: COMMISSION2 = Sales * Tier4
     End Select
     COMMISSION2 = COMMISSION2 + (COMMISSION2 * Years / 100)
End Function
&#39;CalcComm会显示一个输入框，它请求用户输入销售额。下述过程使用了VBA内置的两个常量：vbTab代表一个制表符（隔开输出的不同部分），vbCrLf指定回车和换行（跳到下一行）。VBA的Format函数可以显示制定格式的值。&#39;
Sub CalcComm()
    Dim Sales As Double
    Dim Message As String
    Dim Ans As Integer

&#39;   Prompt for sales amount&#39;
    Sales = Val(InputBox(&quot;Enter Sales:&quot;, &quot;Sales Commission Calculator&quot;))

&#39;   Exit if canceled&#39;
    If Sales = 0 Then Exit Sub

&#39;   Build the message&#39;
    Message = &quot;Sales Amount:&quot; &amp; vbTab &amp; Format(Sales, &quot;$#,##0&quot;)
    Message = Message &amp; vbCrLf &amp; &quot;Commission:&quot; &amp; vbTab
    Message = Message &amp; Format(COMMISSION(Sales), &quot;$#,##0&quot;)
    Message = Message &amp; vbCrLf &amp; vbCrLf &amp; &quot;Another?&quot;

&#39;   Display the result and prompt for another&#39;
    Ans = MsgBox(Message, vbYesNo, &quot;Sales Commission Calculator&quot;)
    If Ans = vbYes Then CalcComm
End Sub</code></pre>
<p>示例三：</p>
<pre><code class="vb">&#39;函数可以接受一个或多个数组，作为参数、处理数组并返回一个值。该数组可以由单元格组成。下面函数接受一个数组并返回数组内数字总和。&#39;
Function SUMARRAY(List) As Double
    Dim Item As Variant
    SUMARRAY = 0
    For Each Item In List
        If WorksheetFunction.IsNumber(Item) Then _
            SUMARRAY = SUMARRAY + Item
    Next Item
End Function
&#39;下面过程阐述了如何从子过程调用这种函数。计算包含100个随机数的值的和。&#39;
Sub MakeList()
    Dim Nums(1 To 100) As Double
    Dim i As Integer
    For i = 1 To 100
        Nums(i) = Rnd * 1000
    Next i
    MsgBox SUMARRAY(Nums)
End Sub</code></pre>
<p>示例四：</p>
<pre><code class="vb">&#39;下面举例为带有可选参数的函自定义函数，该函数随机从输入单元格区域中选择一个单元格并返回了它的内容。如果第二个参数的值为True，那么只要重新计算工作表，所选中的单元格的值就会发生变化（即把这个函数标记为易失性函数）。&#39;
Function DRAWONE(Rng As Variant, Optional Recalc As Boolean = False)
&#39;    Chooses one cell at random from a range&#39;

&#39;    Make function volatile if Recalc is True&#39;
     Application.Volatile Recalc

&#39;    Determine a random cell
     DRAWONE = Rng(Int((Rng.Count) * Rnd + 1))
End Function
&#39;以下所有公式都是有效的，且前两个公式结果相同。&#39;
= DRAWOME(A1:A100)
= DRAWONE(A1:A100,False)
= DRAWONE(A1:A100,True)

Sub DescribeFunction()
    Dim FuncName As String
    Dim FuncDesc As String
    Dim FuncCat As Long
    Dim Arg1Desc As String, Arg2Desc As String

    FuncName = &quot;DRAWONE&quot;
    FuncDesc = &quot;Displays the contents of a random cell from a range&quot;
    FuncCat = 5 &#39;Lookup &amp; Reference
    Arg1Desc = &quot;The range that contains the values&quot;
    Arg2Desc = &quot;(Optional) If False or missing, a new cell is not &quot;
    Arg2Desc = Arg2Desc &amp; &quot;selected when recalculated. If True, a &quot;
    Arg2Desc = Arg2Desc &amp; &quot;new cell is selected when recalculated.&quot;

    Application.MacroOptions _
        Macro:=FuncName, _
        Description:=FuncDesc, _
        Category:=FuncCat, _
        ArgumentDescriptions:=Array(Arg1Desc, Arg2Desc)
End Sub</code></pre>
<p>示例五：</p>
<pre><code class="vb">&#39;以下示例是一个返回VBA数组的函数。用到了VBA中的ARRAY函数，ARRAY函数返回包含一个数组的Variant数据类型的值（多个值）。使用VBA中的IsMissing函数来测试是否缺少参数，在此情况下，不可能为函数的参数列表中省略的参数指定默认值，因为默认值要在函数内部定义。只有当可选参数为Variant数据类型时，才可以使用IsMissing函数。&#39;
Function MONTHNAMES(Optional MIndex)
    Dim AllNames As Variant
    Dim MonthVal As Long

    AllNames = Array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, _
       &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;)
    If IsMissing(MIndex) Then
        MONTHNAMES = AllNames
        Else
        Select Case MIndex
            Case Is &gt;= 1
&#39;            Determine month value (for example, 13=1)
             MonthVal = ((MIndex - 1) Mod 12)
             MONTHNAMES = AllNames(MonthVal)
          Case Is &lt;= 0 &#39; Vertical array
             MONTHNAMES = Application.Transpose(AllNames)
         End Select
    End If
End Function</code></pre>
<p>示例六：</p>
<pre><code class="vb">Function REMOVEVOWELS2(txt) As String
&#39; Removes all vowels from the Txt argument&#39;
&#39; Returns #Value if Txt is not a string&#39;
    Dim i As Long
    Dim TempString As String
    TempString = &quot;&quot;
    If Application.WorksheetFunction.IsText(Txt) Then
        For i = 1 To Len(txt)
            Select Case ucase(Mid(txt, i, 1))
                Case &quot;A&quot;, &quot;E&quot;, &quot;I&quot;, &quot;O&quot;, &quot;U&quot;
                    &#39;Do nothing
                Case Else
                    TempString = TempString &amp; Mid(txt, i, 1)
                    REMOVEVOWELS2 = TempString
            End Select
        Next i
    Else
    REMOVEVOWELS = CVErr(xlErrNA)
    End If
End Function

Sub ZapTheVowels()
     Dim UserInput As String
     UserInput = InputBox(&quot;Enter some text:&quot;)
     MsgBox REMOVEVOWELS(UserInput), vbInformation, UserInput
End Sub</code></pre>
<p>示例七：</p>
<pre><code class="vb">&#39;带有不定数量参数的函数。下面函数可以包含任意数量单个值的参数（不适用于多个单元格参数的参数）。该函数仅返回这些参数值的总和。&#39;
Function SIMPLESUM(ParamArray arglist() As Variant) As Double
    For Each arg In arglist
        SIMPLESUM = SIMPLESUM + arg
    Next arg
End Function
&#39;下面进行了修改以便能处理多个单元格的参数。&#39;
Function SIMPLESUM(ParamArray arglist() As Variant) As Double
    Dim Cell As Range
    For Each arg In arglist
        For Each Cell In arg
            SIMPLESUM = SIMPLESUM + Cell
        Next Cell
    Next arg
End Function</code></pre>
<h2 id="模拟Excel的SUM函数"><a href="#模拟Excel的SUM函数" class="headerlink" title="模拟Excel的SUM函数"></a>模拟Excel的SUM函数</h2><pre><code class="vb">&#39;以下创建了自定义函数MYSUM，与上节介绍的SIMPLESUM函数不同的是，MYSUM函数将几乎完全模拟Excel中的SUM函数。&#39;
Function MYSUM(ParamArray args() As Variant) As Variant
&#39; Emulates Excel&#39;s SUM function&#39;

&#39; Variable declarations&#39;
  Dim i As Variant
  Dim TempRange As Range, cell As Range
  Dim ECode As String
  Dim m, n
  MYSUM = 0

&#39; Process each argument&#39;
  For i = 0 To UBound(args)
&#39;   Skip missing arguments&#39;
    If Not IsMissing(args(i)) Then
&#39;     What type of argument is it?&#39;
      Select Case TypeName(args(i))
        Case &quot;Range&quot;
&#39;         Create temp range to handle full row or column ranges&#39;
          Set TempRange = Intersect(args(i).Parent.UsedRange, args(i))
          For Each cell In TempRange
            If IsError(cell) Then
              MYSUM = cell &#39; return the error&#39;
              Exit Function
            End If
            If cell = True Or cell = False Then
              MYSUM = MYSUM + 0
            Else
              If IsNumeric(cell) Or IsDate(cell) Then _
                 MYSUM = MYSUM + cell
              End If
          Next cell
        Case &quot;Variant()&quot;
            n = args(i)
            For m = LBound(n) To UBound(n)
               MYSUM = MYSUM(MYSUM, n(m)) &#39;recursive call
            Next m
        Case &quot;Null&quot;  &#39;ignore it&#39;
        Case &quot;Error&quot; &#39;return the error&#39;
          MYSUM = args(i)
          Exit Function
        Case &quot;Boolean&quot;
&#39;         Check for literal TRUE and compensate
          If args(i) = &quot;True&quot; Then MYSUM = MYSUM + 1
        Case &quot;Date&quot;
          MYSUM = MYSUM + args(i)
        Case Else
          MYSUM = MYSUM + args(i)
      End Select
    End If
  Next i
End Function</code></pre>
<h2 id="扩展日期函数"><a href="#扩展日期函数" class="headerlink" title="扩展日期函数"></a>扩展日期函数</h2><p>VBA可以识别的最早日期为0100年1月1日。以下为常用日期函数：</p>
<ul>
<li>XDATE(y,m,d,fmt)：返回给定年、月、日的日期。选择提供日期格式字符串。</li>
<li>XDATEADD(xdate1,days,fmt)：将一个日期增加指定的天数。fmt为可以选择提供日期的字符串。</li>
<li>XDATEDIF(xdate1,xdate2)：返回两个日期相隔天数。</li>
<li>XDATEYEARDIF(xdate1,xdate2)：返回两个日期之间相隔的年数。</li>
<li>XDATEYEAR(xdate1)：返回第一个日起年份。</li>
<li>XDATEMONTH(xdate1)：返回第一个日起月份。</li>
<li>XDATEDAY(xdate1)：返回第一个日期日子。</li>
<li>XDATEDOW(xdate1)：返回一个日期是一周中的哪一天(1~7的整数)</li>
</ul>
<h2 id="函数的调试"><a href="#函数的调试" class="headerlink" title="函数的调试"></a>函数的调试</h2><p>在工作表中使用公式来测试函数过程时，VBA运行错误不会出现在熟悉的弹出式错误框中。</p>
<ul>
<li>把MsgBox函数放在关键位置中以监视特定变量的值。</li>
<li>通过从子过程调用函数而不是从工作表公式来测试过程。</li>
<li>在函数中设置断点，然后逐语句调试函数。</li>
<li>在代码中使用一个或多个临时的Debug.Print语句，进而在VBE中的“立即窗口”中写入数值。</li>
</ul>
<h1 id="第五天：了解Excel事件"><a href="#第五天：了解Excel事件" class="headerlink" title="第五天：了解Excel事件"></a>第五天：了解Excel事件</h1><h2 id="识别Excel可以监视的事件类型"><a href="#识别Excel可以监视的事件类型" class="headerlink" title="识别Excel可以监视的事件类型"></a>识别Excel可以监视的事件类型</h2><p>对于Excel来说，发生任何事情都要通过事件。某个具体事件发生时，就是告诉Excel要运行的某个宏或某段代码。Excel可监视很多不同的事件，可以分为以下几类：</p>
<ul>
<li>工作簿事件：某个具体工作簿发生的事件。包括Open事件，BeforeSave事件和NewSheet事件等。</li>
<li>工作表事件：某个具体工作表发生的事件。此类事件包括Change事件，SelectionChange事件和Calculate事件等。</li>
<li>图表事件：某个具体图表发生的事件。此类事件包括Select事件和SeriesChange事件等。</li>
<li>应用程序事件：应用程序发生的事件。此类事件包括NewWorkbook事件、WorkbookBeforeClose事件和SheetChange事件等。</li>
<li>用户窗体事件：具体的用户窗体或包含在该用户窗体中的对象发生的事件。Initialize事件和Click事件。</li>
<li>与对象无关的事件。Ontime事件和Onkey事件。</li>
</ul>
<p>事件以特定的顺序发生VB编辑器窗口中，每个工程都被列在了工程窗口，工程组件被排在了一个折叠窗口。每个组件都有自己的代码模块：</p>
<ul>
<li>Sheet对象：使用这个模块处理与特定工作表有关的代码。</li>
<li>Chart对象：使用这个模块处理与图表有关的代码。</li>
<li>ThisWorkbook对象：使用这个模块处理与工作簿有关的事件处理代码。</li>
<li>通用VBA模块：不能把事件处理程序放在一个通用（即非对象）模块。</li>
<li>UserForm对象：使用这个模块处理与用户窗体或用户窗体上的控件有关的事件处理程序代码。</li>
<li>类模块：使用类模块处理特定的事件处理程序，包括应用程序级别的事件和嵌入式图表事件。</li>
</ul>
<p>即使<strong>事件处理程序必须放在正确的模块中</strong>，过程也可以调用存储在其他模块中其他标准过程。</p>
<p><strong>禁用事件</strong>通常是为了防止级联事件的无限循环，防止级联顺序的无限循环的另一种方法为在程序开头声明一个Static布尔变量：</p>
<pre><code class="vb">&#39;示例&#39;
Static AbortProc As Boolean
IfAborProc = False
    AbortProc = False
    Exit = Sub
End If
&#39;禁用和启用事件使用如下代码&#39;
Application.EnableEvents = False
Application.EnableEvents = True</code></pre>
<p><strong>使用参数的事件处理程序</strong>：有些事件处理程序会使用一个参数列表。例如，创建一个事件处理程序来监视工作簿的SheetActivate事件，工作簿的BeforePrint事件。</p>
<pre><code class="vb">&#39;工作簿的BeforePrint事件&#39;
Private Sub Workbook_BeforePrint(Cancel As Boolean)
    Dim Msg As String, Ans As Integer
    Msg = &quot;Have you loaded the 5164 label stock?&quot;
    Ans = MsgBox(Msg, vbYesNo, &quot;About to print...&quot;)
    If Ans = vbNo Then Cancel = True
End Sub
&#39;工作簿的SheetActivate事件&#39;
Private Sub Workbook_SheetActivate(ByVal Sh As Object)
    MsgBox TypeName(Sh) &amp; vbCrLf &amp; Sh.Name
End Sub</code></pre>
<h2 id="工作簿级别的事件"><a href="#工作簿级别的事件" class="headerlink" title="工作簿级别的事件"></a>工作簿级别的事件</h2><p><strong>Open事件</strong>：</p>
<pre><code class="vb">&#39;Workbook_Open过程的一个示例。它使用VBA的Weekday函数来确定今天是星期几，如果为星期五则会弹出消息框&#39;
Private Sub Workbook_Open()
    If Weekday(Now) = vbFriday Then
        Msg = &quot;Today is Friday.Make sure that you &quot;
        Msg = Msg &amp; &quot;do your weekly backup!&quot;
        MsgBox Msg, vbInformation
    End If
End Sub</code></pre>
<p><strong>NewSheet事件</strong>：</p>
<pre><code class="vb">&#39;向工作簿中添加一个新工作表中执行下列过程。该工作表将作为参数传递给过程。由于新表可以是工作表也可以是图表，因此If语句判断工作表类型。若是工作表，代码会调整全部列宽度，并在新的工作表单元格A1中插入一个日期和时间戳。&#39;
Private Sub Workbook_NewSheet(ByVal Sh As Object)
    If TypeName(Sh) = &quot;Worksheet&quot; Then
        Sh.Cells.ColumnWidth = 35
        Sh.Range(&quot;A1&quot;) = &quot;Sheet added &quot; &amp; Now()
    End If
End Sub</code></pre>
<p><strong>Deactivate事件</strong>：</p>
<pre><code class="vb">&#39;该过程在工作簿被禁用并且不再让用户禁用该工作簿时执行。&#39;
Private Sub Workbook_Deactivate()
    Me.Activate
    MsgBox &quot;Sorry, you may not leave this workbook&quot;
End Sub</code></pre>
<p><strong>BeforPrint事件</strong>：</p>
<pre><code class="vb">&#39;该过程在工作簿打印或预览时更新每个工作表的左页脚，在Sheet1上插入单元格A1的内容。&#39;
Private Sub Workbook_BeforePrint(Cancel As Boolean)
    Dim sht As Object
    For Each sht In ThisWorkbook.Sheets
        sht.PageSetup.LeftFooter = Worksheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;)
    Next sht
End Sub
&#39;在打印或预览之前隐藏工作表Sheet1中的B:D列&#39;
Private Sub Workbook_BeforePrint(Cancel As Boolean)
    Worksheets(&quot;Sheet1&quot;).Range(&quot;B:D&quot;).EntireColumn.Hidden = True
End Sub 
&#39;调度了OnTime事件，该事件在打印或预览5秒后调用一个名为UnhideColumns的过程。&#39;
Private Sub Workbook_BeforePrint(Cancel As Boolean)
    Worksheets(&quot;Sheet1&quot;).Range(&quot;B:D&quot;).EntireColumn.Hidden = True
    Application.OnTime Now() + TimeValue(&quot;0:00:05&quot;),&quot;UnhideColumns&quot;
End Sub </code></pre>
<p><strong>BeforeClose事件</strong>：</p>
<pre><code class="vb">&#39;打开一个工作簿，能显示自定义快捷菜单。工作簿打开时，使用Work_Open创建菜单项，关闭工作簿时使用Workbook_BeforeClose过程来删除这些菜单项。&#39;
Private Sub Workbook_Open()
    &#39;simulated procedure
    Call CreateShortcutMenuItems
    MsgBox &quot;Shortcut menu items have been added.&quot;
End Sub
&#39;该过程检查了Workbook对象的Saved属性。&#39;
Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Dim Msg As String
    If Me.Saved = False Then
        Msg = &quot;Do you want to save the changes you made to &quot;
        Msg = Msg &amp; Me.Name &amp; &quot;?&quot;
        Ans = MsgBox(Msg, vbQuestion + vbYesNoCancel)
        Select Case Ans
            Case vbYes
                Me.Save
            Case vbCancel
                Cancel = True
                Exit Sub
        End Select
    End If
    Call DeleteShortcutMenuItems
    Me.Saved = True
End Sub

Sub DeleteShortcutMenuItems()
    &#39;simulated procedure
    MsgBox &quot;Shortcut menu items have been deleted.&quot;
End Sub</code></pre>
<h2 id="检查工作表事件"><a href="#检查工作表事件" class="headerlink" title="检查工作表事件"></a>检查工作表事件</h2><p><strong>Change事件</strong>：</p>
<pre><code class="vb">&#39;当用户修改工作表中任何单元格时都会触发Change事件，当计算某个公式而生成的值或向工作表添加一个对象时，并不会触发Change事件。以下过程在工作表被修改时执行，显示一个消息框，这个消息框用来显示Target单元格区域的地址。&#39;
Private Sub Worksheet_Change(ByVal Target As Excel.Range)
    MsgBox &quot;Range &quot; &amp; Target.Address &amp; &quot; was changed.&quot;
End Sub
&#39;监视特定单元格区域修改。以下过程假设工作表有一个名为InputRange的单元格区域，只监视该单元格，使用了名为MRange的Range对象，表明想要监视其改动的单元格区域。该过程使用VBA中的Intersect函数来确定Target单元格区域是否与MRange单元格区域相交叉。&#39;
Private Sub Worksheet_Change(ByVal Target As Excel.Range)
    Dim MRange As Range
    Set MRange = Range(&quot;InputRange&quot;)
    If Not Intersect(Target, MRange) Is Nothing Then _
        MsgBox &quot;A changed cell is in the input range.&quot;
End Sub

&#39;监视单元格区域，将公式加粗。首先利用Intersect确定Target区域与工作表已使用的单元格区域的交集来确定符合条件的单元格区域。&#39;
Private Sub Worksheet_Change(ByVal Target As Excel.Range)
    Dim cell As Range
    Set Target = Intersect(Target, Target.Parent.UsedRange)
    If Not Target Is Nothing Then
        For Each cell In Target
            If cell.HasFormula Then cell.Font.Bold = True
        Next cell
    End If
End Sub

&#39;监视单元格区域，验证数据有效性。Worksheet_Change过程创建了一个Range对象，表示待验证的工作表单元格区域。然后循环遍历Target参数中的每个单元格，该参数表示被修改的单元格。代码确定是否每个单元格都包含在待验证的单元格区域中。如果是，则会将该单元格作为参数传递给另一个自定义函数(EntryIsValid)，如果该单元格是一个有效的输入，则返回True。如果不是有效的，EntryIsValid函数将返回一个字符串来说明该问题，并通过一个消息框通知用户。消息框被解除后，无效输入会从单元格清除，单元格被激活。注意：在清空单元格之前，事件是禁用的。如果事件没有禁用，那么清空单元格会生成Change事件从而引起死循环。&#39;            
Private Sub Worksheet_Change(ByVal Target As Excel.Range)
    Dim VRange As Range, cell As Range
    Dim Msg As String
    Dim ValidateCode As Variant
    Set VRange = Range(&quot;InputRange&quot;)
    If Intersect(VRange, Target) Is Nothing Then Exit Sub
    For Each cell In Intersect(VRange, Target)
        ValidateCode = EntryIsValid(cell)
        If TypeName(ValidateCode) = &quot;String&quot; Then
            Msg = &quot;Cell &quot; &amp; cell.Address(False, False) &amp; &quot;:&quot;
            Msg = Msg &amp; vbCrLf &amp; vbCrLf &amp; ValidateCode
            MsgBox Msg, vbCritical, &quot;Invalid Entry&quot;
            Application.EnableEvents = False
            cell.ClearContents
            cell.Activate
            Application.EnableEvents = True
        End If
    Next cell
End Sub

Private Function EntryIsValid(cell) As Variant
&#39;   Returns True if cell is an integer between 1 and 12&#39;
&#39;   Otherwise it returns a string that describes the problem&#39;

&#39;   Numeric&#39;
    If Not WorksheetFunction.IsNumber(cell) Then
        EntryIsValid = &quot;Non-numeric entry.&quot;
        Exit Function
    End If

&#39;   Integer?&#39;
    If CInt(cell) &lt;&gt; cell Then
        EntryIsValid = &quot;Integer required.&quot;
        Exit Function
    End If

&#39;   Between 1 and 12?&#39;
    If cell &lt; 1 Or cell &gt; 12 Then
        EntryIsValid = &quot;Valid values are between 1 and 12.&quot;
        Exit Function
    End If

&#39;   It passed all the tests&#39;
    EntryIsValid = True
End Function
&#39;以上方法过于冗余，调整为下&#39;
Private Sub Worksheet_Change(ByVal Target As Range)
    Dim VT As Long
    &#39;Do all cells in the validation range&#39;
    &#39;still have validation?&#39;
    On Error Resume Next
    VT = Range(&quot;InputRange&quot;).Validation.Type
    If Err.Number &lt;&gt; 0 Then
        Application.Undo
        MsgBox &quot;Your last operation was canceled. &quot; &amp; _
        &quot;It would have deleted data validation rules.&quot;, vbCritical
    End If
End Sub</code></pre>
<p><strong>SelectionChange事件</strong>：</p>
<pre><code class="vb">&#39;以下过程显示了SelectionChange事件，当用户在工作表中做出新的选择会执行该事件。&#39;
Private Sub Worksheet_SelectionChange(ByVal Target As Excel.Range)
    Cells.Interior.ColorIndex = xlNone &#39;将工作表中所有单元格的背景色删除。&#39;
    With ActiveCell &#39;活动单元格在整行和整列上都被加上了淡蓝色的阴影。&#39;
        .EntireRow.Interior.Color = RGB(219, 229, 241)
        .EntireColumn.Interior.Color = RGB(219, 229, 241)
    End With
End Sub</code></pre>
<p>注意：执行Worksheet_SelectionChange宏会销毁Undo堆栈，因此使用该技术禁用Excel撤销功能。</p>
<p><strong>BeforeDoubleClick事件</strong>：</p>
<pre><code class="vb">&#39;以下过程在双击单元格会切换单元格样式，在Good和Normal样式间进行切换。&#39;
Private Sub Worksheet_BeforeDoubleClick _
  (ByVal Target As Excel.Range, Cancel As Boolean)
    If Target.Style = &quot;Good&quot; Then
        Target.Style = &quot;Normal&quot;
    Else
        Target.Style = &quot;Good&quot;
    End If
    Cancel = True
End Sub</code></pre>
<p><strong>BeforRightClick事件</strong>：</p>
<pre><code class="vb">&#39;以下过程捕获RightClick事件，将Cancel参数设置为True，这样就取消了RightClick事件，取消了快捷菜单。&#39;
Private Sub Worksheet_BeforeRightClick _
  (ByVal Target As Excel.Range, Cancel As Boolean)
    Cancel = True
    MsgBox &quot;The shortcut menu is not available.&quot;
End Sub
&#39;以下过程检验了右击的单元格是否包含数值，如果包含，则会显示“设置单元格格式”对话框的“数字”选项卡，并将Cancel参数设置为True（避免显示正常的快捷菜单），如果单元格不包含数值，则不发生任何事。&#39;
Private Sub Worksheet_BeforeRightClick _
  (ByVal Target As Excel.Range, Cancel As Boolean)
  If IsNumeric(Target) And Not IsEmpty(Target) Then
    Application.CommandBars.ExwcuteMso (&quot;NumberFormastDialog&quot;)
    Cancel = True
    End If
End Sub</code></pre>
<h2 id="监视应用程序事件"><a href="#监视应用程序事件" class="headerlink" title="监视应用程序事件"></a>监视应用程序事件</h2><p>要监视所有打开的工作簿或工作表，可使用应用程序级别的事件。</p>
<p><strong>启用应用程序级别事件</strong>：要使用Application级别的事件，需要执行如下操作：</p>
<ul>
<li>创建一个新的<strong>类模块</strong></li>
<li>“视图”|“属性窗口”|“属性”|“名称”下设置类模块名称，例如clsApp</li>
</ul>
<ul>
<li>在该类模块中，使用WithEvents关键字来声明一个公共的Application对象</li>
</ul>
<p>​        例如:</p>
<pre><code>   ```vb</code></pre><p>Public WithEvents XL As Application<br>       ```</p>
<ul>
<li>创建一个变量，该变量用来指向类模块中声明的Application对象。该变量应该是在常规的VBA模块（而非类模块）中声明的模块级别对象变量。</li>
</ul>
<pre><code class="vb">Dim X As New clsApp</code></pre>
<ul>
<li>将声明的变量与Application对象连接到一起，这通常在Workbook_Open过程中完成。</li>
</ul>
<pre><code class="vb">Set X.XL = Application</code></pre>
<ul>
<li>为类模块中的XL对象编写事件处理程序。</li>
</ul>
<p><strong>确定工作簿何时被打开</strong>：</p>
<p>该示例通过将信息存储在CSV文本文件中，来追踪打开每个工作簿，该文件可导入Excel中。首先插入一个新的类模块，将其命名为claApp，类模块代码如下：</p>
<pre><code class="vb">&#39;该段代码将AppEvents声明为一个包含事件的Application对象。打开工作簿就会调用AppEvents_WorkbookOpen过程，该事件处理程序调用了UpdateLogFile过程，并传递了Wb变量，该变量表示的是打开的工作簿。&#39;
Public WithEvents AppEvents As Application

Private Sub AppEvents_WorkbookOpen(ByVal Wb As Excel.Workbook)
    Call UpdateLogFile(Wb)
End Sub</code></pre>
<p>然后添加一个VBA模块，插入如下代码：</p>
<pre><code class="vb">Sub Init()
&#39;   Called by Workbook_Open
    Set AppObject.AppEvents = Application &#39;AppObject被声明为clsApp（类模块的名称）类型。&#39;
End Sub
    &#39;UpdateLogFile过程打开一个文本文件，如果不存在则会创建一个文本文件。然后写入被打开工作簿的信息。&#39;
Sub UpdateLogFile(Wb)
    Dim txt As String
    Dim Fname As String
    On Error Resume Next
    txt = Wb.FullName
    txt = txt &amp; &quot;,&quot; &amp; Date &amp; &quot;,&quot; &amp; Time
    txt = txt &amp; &quot;,&quot; &amp; Application.UserName
    Fname = Application.DefaultFilePath &amp; &quot;\logfile.csv&quot;
    Open Fname For Append As #1
    MsgBox txt &#39;用来显示写入CSV文件的信息&#39;
    Print #1, txt
    Close #1
End Sub</code></pre>
<p>对Init过程的调用放在Workbook_Open过程中，该过程位于ThisWorkbook的代码模块中，该过程如下：</p>
<pre><code class="vb">Private Sub Workbook_Open() &#39;当工作簿被打开时，Init就会创建对象变量。&#39;
    Call Init
End Sub</code></pre>
<h2 id="访问与对象无关联的事件"><a href="#访问与对象无关联的事件" class="headerlink" title="访问与对象无关联的事件"></a>访问与对象无关联的事件</h2><p><strong>OnTime事件</strong></p>
<pre><code class="vb">&#39;该示例中，SetAlarm过程使用Application对象的OnTime方法来设置OnTime事件。该方法使用了两个参数，时间和时间到来时执行的过程。&#39;
Sub SetAlarn()
    Application.OnTime TimeValue(&quot;15:00:00&quot;), &quot;DisplayAlarm&quot; &#39;下午三点执行&#39;
    &#39;Application.OnTime Now+TimeValue(&quot;00:20:00&quot;), &quot;DisplayAlarm&quot;，此为二十分钟后执行&#39;
    &#39;Application.OnTime DateSerial(2013,4,1)+TimeValue(&quot;15:00:00&quot;), &quot;DisplayAlarm&quot;,具体时间&#39;
End Sub

Sub DisplayAlarm()
    Beep
    MsgBox &quot;Wake Up.It&#39;s time for yoyr afternoon break&quot;
End Sub</code></pre>
<pre><code class="vb">&#39;下面过程展示了如何编辑重复文件。示例中，单元格A1每5秒更新一次时间。执行UpdateClock过程会将时间写入单元格A1中，5秒后则编辑另一个事件。则事件重复运行UpdateClock过程。如果要停止事件，挨饿执行StopClock过程。NextTick是一个模块级别的变量，它保存下一个事件的时间。&#39;
Dim NextTick As Date

Sub UpdateClock()
&#39;   Updates cell A1 with the current time&#39;
    ThisWorkbook.Sheets(1).Range(&quot;A1&quot;) = Time
&#39;   Set up the next event five seconds from now&#39;
    NextTick = Now + TimeValue(&quot;00:00:05&quot;)
    Application.OnTime NextTick, &quot;UpdateClock&quot;
End Sub

Sub StopClock()
&#39;   Cancels the OnTime event (stops the clock)&#39;
    On Error Resume Next
    Application.OnTime NextTick, &quot;UpdateClock&quot;, , False
End Sub</code></pre>
<p><strong>OnKey事件</strong></p>
<pre><code class="vb">&#39;下面的示例使用了Onkey方法来建立一个OnKey事件。该事件重新指定了PgDn和PgUp键。执行Setup_OnKey过程后，按下PgDn键会执行PgDn_Sub过程，按下PgUp键会执行PgUp_Sub过程。最终的效果是，按下PgDn键将会将指针下移一行，按PgUp键会将指针上移一行。使用PgUp和PgDn的按键组合不受影响。所以，诸如Ctrl+PgDn的组合键仍会激活工作簿的下一个工作表。&#39;
Sub Setup_OnKey()
    Application.OnKey &quot;{PgDn}&quot;, &quot;PgDn_Sub&quot;
    Application.OnKey &quot;{PgUp}&quot;, &quot;PgUp_Sub&quot;
    MsgBox &quot;PgUp and PgDown have been re-mapped.&quot;
End Sub

Sub Cancel_OnKey() &#39;执行此过程将OnKey事件取消，将这些按键恢复到正常的功能。&#39;
    Application.OnKey &quot;{PgDn}&quot;
    Application.OnKey &quot;{PgUp}&quot;
    MsgBox &quot;PgUp and PgDown have been restored to normal.&quot;
End Sub

Sub PgDn_Sub()
    On Error Resume Next &#39;使用此语句来忽略生成的所有错误，如第一行的PgUp,图表工作表下的移动等。&#39;
    ActiveCell.Offset(1, 0).Activate
End Sub

Sub PgUp_Sub()
    On Error Resume Next
    ActiveCell.Offset(-1, 0).Activate
End Sub
</code></pre>
<h1 id="第六天-VBA编程示例与技巧"><a href="#第六天-VBA编程示例与技巧" class="headerlink" title="第六天 VBA编程示例与技巧"></a>第六天 VBA编程示例与技巧</h1><h2 id="使用VBA处理单元格区域"><a href="#使用VBA处理单元格区域" class="headerlink" title="使用VBA处理单元格区域"></a>使用VBA处理单元格区域</h2><p>处理VBA单元格区域包括以下几个方面：复制单元格区域、移动单元格区域、选择单元格区域、确定单元格内信息类型、提示输入单元格的值、确定一列中第一个空单元格、暂停宏以允许用户选择单元格区域、统计单元格区域中的单元格数、遍历单元格区域中的单元格以及其他几个与单元格有关的常用操作。</p>
<p><strong>复制单元格</strong></p>
<pre><code class="vbscript">&#39;单元格Copy方法可以接受一个参数，该参数代表已复制单元格区域的目标。&#39;
Sub CopyRange1()
    Range(&quot;A1&quot;).Copy Range(&quot;B1&quot;) &#39;活动工作表时可用&#39;
    Range(&quot;A1:C100&quot;).Copy Range(&quot;D1&quot;) &#39;复制单元格区域，目标是粘贴到的左上单元格&#39;
End Sub

Sub CopyRange2()
    Workbook(&quot;File1.xlsx&quot;).Sheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;).Copy _
    Workbook(&quot;File2.xlsx&quot;).Sheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;) &#39;任意工作簿均可使用&#39;
End Sub
&#39;使用对象变量来代表单元格&#39;
Sub CopyRange3()
    Dim Rng1 As Range, Rng2 As Range
    Set Rng1 = Workbook(&quot;File1.xlsx&quot;).Sheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;)
    Set Rng2 = Workbook(&quot;File2.xlsx&quot;).Sheets(&quot;Sheet1&quot;).Range(&quot;A1&quot;)
    Rng1.Copy Rng2
End Sub</code></pre>
<p><strong>移动单元格</strong></p>
<pre><code class="vb">&#39;移动单元格可以使用Cut方法，需要指出目的地单元格区域左上方单元格&#39;
Sub MoveRange1()
    Range(&quot;A1:C6&quot;).Cut Range(&quot;H1&quot;) 
End Sub</code></pre>
<p><strong>复制大小可变的单元格区域</strong></p>
<pre><code class="vb">&#39;用到了CurrentRegion属性，返回某个特殊的单元格区域，此例为返回单元格A1&#39;
Sub CopyCurrentRegion2()
    Range(&quot;A1&quot;).CurrentRegion.Copy Sheets(&quot;Sheet2&quot;).Range(&quot;A1&quot;)
End Sub
&#39;若要复制的单元格区域是一个表，可以使用如下代码：&#39;
Sub CopyTable()
    Range(&quot;Table[#A11]&quot;).Copy Sheets(&quot;Sheet2&quot;).Range(&quot;A1&quot;)
End Sub</code></pre>
<p><strong>选中或识别各种类型的单元格区域</strong></p>
<pre><code class="vb">&#39;Range对象的End方法，End方法接受了一个参数，这个参数决定了选区的扩展方向，以下语句从单元格到某方向的最后一个非空单元格，若为空行，则到最后一个单元格。&#39;
Range(ActiveCell,ActiveCell.End(xlDown)).Select &#39;从单元格一直选到了表格中最后一个非空单元格&#39;
Range(Range(&quot;A2&quot;),Range(&quot;A2&quot;).End(xlDown)).Select &#39;使用一个特定的单元格作为起点&#39;
Range(ActiveCell, ActiveCell.End(xlUp)).Select &#39;向上选择&#39;
Range(ActiveCell, ActiveCell.End(xlToRight)).Select &#39;向右选择&#39;
Range(ActiveCell, ActiveCell.End(xlToLeft)).Select &#39;向左选择&#39;
ActiveCell.CurrentRegion.Select &#39;选中当前区域&#39;

Sub SelectActiveArea()&#39;
Range(Range(&quot;A1&quot;), ActiveCell.SpecialCells(xlLastCell)).Select &#39;选中从A1开始到最后的单元格区域&#39;
End Sub

Sub SelectActiveColumn() &#39;选中列，至山或下为空单元格为止&#39;
    Dim TopCell As Range
    Dim BottomCell As Range   
    If IsEmpty(ActiveCell) Then Exit Sub
&#39;   ignore error if activecell is in Row 1
    On Error Resume Next
    If IsEmpty(ActiveCell.Offset(-1, 0)) Then Set TopCell = ActiveCell Else Set TopCell = ActiveCell.End(xlUp)
    If IsEmpty(ActiveCell.Offset(1, 0)) Then Set BottomCell = ActiveCell Else Set BottomCell = ActiveCell.End(xlDown)
    Range(TopCell, BottomCell).Select
End Sub

&#39;选中行，直到左行左右均为空单元格为止&#39;
Sub SelectActiveRow()
    Dim LeftCell As Range
    Dim RightCell As Range

    If IsEmpty(ActiveCell) Then Exit Sub
&#39;   ignore error if activecell is in Column A
    On Error Resume Next
    If IsEmpty(ActiveCell.Offset(0, -1)) Then Set LeftCell = ActiveCell Else Set LeftCell = ActiveCell.End(xlToLeft)
    If IsEmpty(ActiveCell.Offset(0, 1)) Then Set RightCell = ActiveCell Else Set RightCell = ActiveCell.End(xlToRight)
    Range(LeftCell, RightCell).Select
End Sub

&#39;选取整列&#39;
Sub SelectEntireColumn()
    ActiveCell.EntireColumn.Select
End Sub

&#39;选取整行&#39;
Sub SelectEntireRow()
    ActiveCell.EntireRow.Select
End Sub

&#39;选取整个工作表&#39;
Sub SelectEntireSheet()
    Cells.Select&#39;
End Sub

&#39;向下选取非空单元格&#39;
Sub ActivateNextBlankDown()
    ActiveCell.Offset(1, 0).Select
    Do While Not IsEmpty(ActiveCell)
        ActiveCell.Offset(1, 0).Select
    Loop
End Sub

&#39;向右选取非空单元格&#39;
Sub ActivateNextBlankToRight()
    ActiveCell.Offset(0, 1).Select
    Do While Not IsEmpty(ActiveCell)
        ActiveCell.Offset(0, 1).Select
    Loop
End Sub

&#39;选中一行中第一个非空到最后一个非空单元格区域&#39;
Sub SelectFirstToLastInRow()
    Dim LeftCell As Range
    Dim RightCell As Range

    Set LeftCell = Cells(ActiveCell.Row, 1)
    Set RightCell = Cells(ActiveCell.Row, 256)

    If IsEmpty(LeftCell) Then Set LeftCell = LeftCell.End(xlToRight)
    If IsEmpty(RightCell) Then Set RightCell = RightCell.End(xlToLeft)
    If LeftCell.Column = 256 And RightCell.Column = 1 Then ActiveCell.Select Else Range(LeftCell, RightCell).Select
End Sub

&#39;选中一列中第一个非空到最后一个非空单元格区域&#39;
Sub SelectFirstToLastInColumn()
    Dim TopCell As Range
    Dim BottomCell As Range

    Set TopCell = Cells(1, ActiveCell.Column)
    Set BottomCell = Cells(16384, ActiveCell.Column)

    If IsEmpty(TopCell) Then Set TopCell = TopCell.End(xlDown)
    If IsEmpty(BottomCell) Then Set BottomCell = BottomCell.End(xlUp)
    If TopCell.Row = 16384 And BottomCell.Row = 1 Then ActiveCell.Select Else Range(TopCell, BottomCell).Select
End Sub
                                                                                                 &#39;选中当前区域&#39;                                                                  
Sub SelectCurrentRegion()
    ActiveCell.CurrentRegion.Select
End Sub

Sub FormatCurrentRegion() &#39;不选中单元格而以某种方式处理它们的情况&#39;
    ActiveCell.CurrentRegion.Font.Bold = True
End Sub</code></pre>
<p><strong>调整单元格区域大小</strong></p>
<pre><code class="vb">&#39;Range的Resize属性使得很容易改变单元格大小，Resize有两个参数，分别表示被调整的单元格区域的总行数和总列数&#39;
&#39;执行以下语句后，MyRange对象变成了20行5列（单元格区域A1:E20）&#39;
Set MyRange = Range(&quot;A1&quot;)
Set MyRange = MyRange.Resize(20,5)
&#39;以下语句使MyRange的大小增加一行，由于省略了第二个参数，列数不变&#39;
Set MyRange = MyRange.Resize(MyRange.Rows.Count + 1)      

&#39;更改单元格区域名称定义，名为Data的单元格区域需要添加额外一行来扩展命名的单元格区域&#39;         
With Range(&quot;Data&quot;)
   .Resize(.Rows.Count +1).Name = &quot;Data&quot;
End With</code></pre>
<p><strong>提示输入单元格的值</strong></p>
<pre><code class="vb">&#39;会弹出InputBox输入框，从用户那里获得要要插入到单元格的值&#39;
Sub GetValue1()
    Range(&quot;A1&quot;).Value = InputBox(&quot;Enter the value&quot;)
End Sub

&#39;如果用户单击“取消”按钮则会导致UserEntry变为空值，不会采取任何动作&#39;
Sub GetValue2()
    Dim UserEntry As Variant
    UserEntry = InputBox(&quot;Enter the value&quot;)
    If UserEntry &lt;&gt; &quot;&quot; Then Range(&quot;A1&quot;).Value = UserEntry
End Sub

&#39;增加有效性验证条件，要求输入的为介于1和12之间的数值&#39;
Sub GetValue3()
    Dim UserEntry As Variant
    Dim Msg As String
    Const MinVal As Integer = 1
    Const MaxVal As Integer = 12
    Msg = &quot;Enter a value between &quot; &amp; MinVal &amp; &quot; and &quot; &amp; MaxVal
    Do
        UserEntry = InputBox(Msg)
        If UserEntry = &quot;&quot; Then Exit Sub
        If IsNumeric(UserEntry) Then
            If UserEntry &gt;= MinVal And UserEntry &lt;= MaxVal Then Exit Do
        End If
        Msg = &quot;Your previous entry was INVALID.&quot;
        Msg = Msg &amp; vbNewLine
        Msg = Msg &amp; &quot;Enter a value between &quot; &amp; MinVal &amp; &quot; and &quot; &amp; MaxVal
    Loop
    ActiveSheet.Range(&quot;A1&quot;).Value = UserEntry
End Sub</code></pre>
<p><strong>在下一个空单元格中输入一个值</strong></p>
<pre><code class="vb">&#39;下例提示用户输入姓名和数值，然后把这些数据输入下一个空白行中。&#39;
Sub GetData()
    Dim NextRow As Long
    Dim Entry1 As String, Entry2 As String
  Do
    &#39;Determine next empty row&#39;
    NextRow = Cells(Rows.Count, 1).End(xlUp).Row + 1

&#39;   Prompt for the data
    Entry1 = InputBox(&quot;Enter the name&quot;)
    If Entry1 = &quot;&quot; Then Exit Sub
    Entry2 = InputBox(&quot;Enter the amount&quot;)
    If Entry2 = &quot;&quot; Then Exit Sub

&#39;   Write the data
    Cells(NextRow, 1) = Entry1
    Cells(NextRow, 2) = Entry2
  Loop
End Sub</code></pre>
<p><strong>暂停宏运行以便获得用户选中的单元格区域</strong></p>
<pre><code class="vb">&#39;下例使用了Excel的InputBox方法（Excel的Input方法与VBA的InputBox函数不同）。下例阐述了如何暂停宏的运行并允许用户选中单元格。随后代码把公式插入指定元格区域的每个单元格中。&#39;
&#39;把InputBox方法的Type参数的值设为8是这个过程的关键。Type参数为8是告诉这个Excel该输入框只接受有效的单元格区域。&#39;
Sub GetUserRange()
    Dim UserRange As Range

    Prompt = &quot;Select a range for the random numbers.&quot;
    Title = &quot;Select a range&quot;

&#39;   Display the Input Box
    On Error Resume Next &#39;忽略了用户单击“取消”按钮时反生的错误，如果单击取消，则不定义UserRange，如果单击确定，宏将继续执行。&#39;
    Set UserRange = Application.InputBox( _
        Prompt:=Prompt, _
        Title:=Title, _
        Default:=ActiveCell.Address, _
        Type:=8) &#39;Range selection
    On Error GoTo 0 &#39;恢复为普通的错误处理方式&#39;

&#39;   Was the Input Box canceled?&#39;
    If UserRange Is Nothing Then
        MsgBox &quot;Canceled.&quot;
    Else
        UserRange.Formula = &quot;=RAND()&quot;
    End If
End Sub
&#39;这里没有必要检测单元格区域选取的有效性了，Excel已经考虑到了，如果无效，则会弹出提示框。&#39;</code></pre>
<p><strong>计算选中单元格的数目</strong></p>
<pre><code class="vb">&#39;可创建宏来处理用户选中的单元格区域&#39;
MsgBox Selection.Count &#39;显示消息框，其中包含了当前选取的单元格数目。使用Range对象的Count属性&#39;
CellCount = Range(&quot;Data&quot;).Count &#39;把活动工作表中Data单元格区域中的单元格数目赋给变量CellCount。&#39;
Selection.Columns Count &#39;该表达式计算出了当前选中的单元格区域的列数&#39;
RowsCount = Range(&quot;Data&quot;).Rows.Count &#39;使用Rows属性计算Data单元格区域的行数并赋给变量RowCount&#39;</code></pre>
<p><strong>确定单元格区域的类型</strong></p>
<pre><code class="vb">&#39;在选区中包含多个单元格区域的情况下，Range对象由一些各自独立的区域组成。要确定这种选区是不是多个选区，可使用Area方法，它将返回一个Area集合。这集合代表多单元格区域的选取中的所有单元格。&#39;
NumAreas = Selection.Areas.Count &#39;可使用该表达式确定选取中的单元格是否包含多个区域，若NumAreas&gt;1，则包含多个区域&#39;
&#39;下面使用了名为AreaType的函数，该函数返回一个说明单元格区域的选区类型的文本字符串&#39;
Function AreaType(RangeArea As Range) As String
    &#39;returns the type of a range in an area
    Select Case True
        Case RangeArea.Cells.CountLarge = 1
            AreaType = &quot;Cell&quot;
        Case RangeArea.CountLarge = Cells.CountLarge &#39;如果单元格中的单元格数目等于工作表中的单元格数目&#39;
            AreaType = &quot;Worksheet&quot;
        Case RangeArea.Rows.CountLarge = Cells.Rows.Count
            AreaType = &quot;Column&quot;
        Case RangeArea.Columns.CountLarge = Cells.Columns.Count
            AreaType = &quot;Row&quot;
        Case Else
            AreaType = &quot;Block&quot;
End Function</code></pre>
<p><strong>有效地循环遍历选中的单元格区域</strong></p>
<pre><code class="vb">&#39;以下示例中，ColorNegative过程给选区中内容为负值的所有单元格都应用红色背景。&#39;
Sub ColorNegative() &#39;遍历效率低&#39;
&#39;   Makes negative cells red&#39;
    Dim cell As Range
    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub
    Application.ScreenUpdating = False
    For Each cell In Selection
        If cell.Value &lt; 0 Then
            cell.Interior.Color = RGB(255, 0, 0)
        Else
            cell.Interior.Color = xlNone
        End If
    Next cell
End Sub

&#39;进行修改，创建了一个Range对象变量WorkRange，这个变量由选中单元格区域和工作表中所使用的单元格区域交集&#39; 
Sub ColorNegative2()
&#39;   Makes negative cells red
    Dim WorkRange As Range
    Dim cell As Range
    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub
    Application.ScreenUpdating = False
    Set WorkRange = Application.Intersect(Selection, ActiveSheet.UsedRange)
    For Each cell In WorkRange
        If cell.Value &lt; 0 Then
            cell.Interior.Color = RGB(255, 0, 0)
        Else
            cell.Interior.Color = xlNone
        End If
    Next cell
End Sub

&#39;ColorNegative2过称仍没那么高效，原因在于它处理了空的单元格。进行改进，使用了SpecialCells方法生成了选取的两个子集：一个子集(ConstantCells)只包含那些含有数字常量的单元格；另一个子集(FormulaCells)只包括那些含有数字公式的单元格。然后代码中使用了两个ForEach-Next结构来处理这些子集中的单元格。实际效果是只对非空的、非文本的单元格求值，因此极大地加快了宏的运行速度。&#39;
Sub ColorNegative3()
&#39;   Makes negative cells red
    Dim FormulaCells As Range, ConstantCells As Range
    Dim cell As Range
    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub
    Application.ScreenUpdating = False

&#39;   Create subsets of original selection&#39;
    On Error Resume Next &#39;如果任何单元格都不符合要求，SpecialCells方法将生成一个错误，因此On Error是必须的&#39;
    Set FormulaCells = Selection.SpecialCells(xlFormulas, xlNumbers)
    Set ConstantCells = Selection.SpecialCells(xlConstants, xlNumbers)
    On Error GoTo 0

&#39;   Process the formula cells
    If Not FormulaCells Is Nothing Then
        For Each cell In FormulaCells
            If cell.Value &lt; 0 Then
                cell.Interior.Color = RGB(255, 0, 0)
            Else
                cell.Interior.Color = xlNone
            End If
            Next cell
    End If

&#39;   Process the constant cells&#39;
    If Not ConstantCells Is Nothing Then
        For Each cell In ConstantCells
            If cell.Value &lt; 0 Then
                cell.Interior.Color = RGB(255, 0, 0)
            Else
                cell.Interior.Color = xlNone
            End If
        Next cell
    End If
End Sub    </code></pre>
<p><strong>删除所有空行</strong></p>
<pre><code class="vb">&#39;下列例程展示如何删除单元格中所有空行，该例程快捷高效，原因是不会检查所有的行，而只是检测已使用单元格区域的行，是否使用某一行由Worksheet对象的UsedRange属性确定&#39;
Sub DeleteEmptyRows()
    Dim LastRow As Long
    Dim r As Long
    Dim Counter As Long
    Application.ScreenUpdating = False
    LastRow = ActiveSheet.UsedRange.Rows.Count + _
      ActiveSheet.UsedRange.Rows(1).Row - 1
    For r = LastRow To 1 Step -1
        If Application.WorksheetFunction.CountA(Rows(r)) = 0 Then
            Rows(r).Delete
            Counter = Counter + 1
        End If
    Next r
    Application.ScreenUpdating = True
    MsgBox Counter &amp; &quot; Empty rows were deleted.&quot;
End Sub
&#39;第一步：找到单元格区域中最后一行=单元格区域使用的行数+第一行编号-1，赋值给LastRow&#39;
&#39;第二步：遍历每行，使用Excel中的COUNTA工作表函数来确定某一行是否为空，若该函数返回0，则删除。&#39;
&#39;注意：遍历从最后一行开始，因为若从上至下删除一行后，循环中的计数器就不准确了。&#39;</code></pre>
<p><strong>任意次数地复制行</strong></p>
<pre><code class="vb">&#39;该宏复制行，使得第二列内值大于1的非空单元格复制指定值数量-1的单元格。通过单元格B2来初始化cell,也就是含有第一个数字的单元格。该循环利用了FillDown方法来插入新行，然后复制改行，递增变量cell变量，循环进行，直到碰到非空单元格。&#39;
Sub DupeRows()
  Dim cell As Range
&#39; 1st cell with number of tickets
  Set cell = Range(&quot;B2&quot;)
  Do While Not IsEmpty(cell)
    If cell &gt; 1 Then
      Range(cell.Offset(1, 0), cell.Offset(cell.Value - 1, 0)).EntireRow.Insert
      Range(cell, cell.Offset(cell.Value - 1, 1)).EntireRow.FillDown
    End If
   Set cell = cell.Offset(cell.Value, 0)
    Loop
End Sub</code></pre>
<p><strong>确定单元格区域是否包含在另一个单元格区域内</strong></p>
<pre><code class="vb">&#39;下面的InRange函数接收两个参数，都是Range对象。如果第一个单元格区域包含在第二个单元格区域内，则该函数返回True。这个函数可用在公式表达中。&#39;
&#39;Application对象的Union方法返回一个表示合并了两个Range对象的Range对象。合并后单元格区域包含这两个单元格区域的并集。&#39;
&#39;如果两个单元格区域在不同的工作表中，则Union方法将报错，因此用On Error事项处理。&#39;
Function InRange(rng1, rng2) As Boolean
&#39;   Returns True if rng1 is a subset of rng2
    On Error GoTo ErrHandler
    If Union(rng1, rng2).Address = rng2.Address Then
        InRange = True
        Exit Function
    End If
ErrHandler:
    InRange = False
End Function</code></pre>
<p><strong>确定单元格区域的类型</strong></p>
<pre><code class="vb">&#39;Excel提供了很多可以帮助确定单元格内数据类型的内置函数，其中包括ISTEXT,ISLOGICAL和ISERROR。此外，VBA中还包括诸多如IsEmpty、IsDate和IsNumeric。&#39;
Function CELLTYPE(Rng)
&#39;   Returns the cell type of the upper left
&#39;   cell in a range
    Dim TheCell As Range
    Set TheCell = Rng.Range(&quot;A1&quot;) &#39;CellType函数接收任意单元格区域，但该过程中这条语句只应用于单元格区域左上方单元格&#39;
    Select Case True
        Case IsEmpty(TheCell)
            CELLTYPE = &quot;Blank&quot;
        Case TheCell.NumberFormat = &quot;@&quot;
            CELLTYPE = &quot;Text&quot;
        Case Application.IsText(TheCell)
            CELLTYPE = &quot;Text&quot;
        Case Application.IsLogical(TheCell)
            CELLTYPE = &quot;Logical&quot;
        Case Application.IsErr(TheCell)
            CELLTYPE = &quot;Error&quot;
        Case IsDate(TheCell)
            CELLTYPE = &quot;Date&quot;
        Case InStr(1, TheCell.Text, &quot;:&quot;) &lt;&gt; 0
            CELLTYPE = &quot;Time&quot;
        Case IsNumeric(TheCell)
            CELLTYPE = &quot;Number&quot;
    End Select
End Function</code></pre>
<p><strong>读写单元格区域</strong></p>
<pre><code class="vb">&#39;Excel从单元格中读取的速度要比向单元格中写入数据的速度快，因为写操作要用到计算引擎。以下过程说明了读写单元格区域的相对速度，这个过程先创建一个数组，然后用For-Next循环把数组写到某个单元格区域，接着把单元格区域中的值读到这个数组中。&#39;
Sub WriteReadRange()
    Dim MyArray()
    Dim Time1 As Double
    Dim NumElements As Long, i As Long
    Dim WriteTime As String, ReadTime As String
    Dim Msg As String

    NumElements = 60000
    ReDim MyArray(1 To NumElements)

&#39;   Fill the array&#39;
    For i = 1 To NumElements
        MyArray(i) = i
    Next i

&#39;   Write the array to a range&#39;
    Time1 = Timer
    For i = 1 To NumElements
        Cells(i, 1) = MyArray(i)
    Next i
    WriteTime = Format(Timer - Time1, &quot;00:00&quot;)

&#39;   Read the range into the array&#39;
    Time1 = Timer
    For i = 1 To NumElements
        MyArray(i) = Cells(i, 1)
    Next i
    ReadTime = Format(Timer - Time1, &quot;00:00&quot;)

&#39;   Show results&#39;
    Msg = &quot;Write: &quot; &amp; WriteTime
    Msg = Msg &amp; vbCrLf
    Msg = Msg &amp; &quot;Read: &quot; &amp; ReadTime
    MsgBox Msg, vbOKOnly, NumElements &amp; &quot; Elements&quot;
End Sub</code></pre>
<p><strong>在单元格区域写入值的更好的方法</strong></p>
<pre><code class="vb">&#39;下例说明填充单元格区域最容易理解的方法（不是最有效的），这个示例使用一个For-Next循环把数组值插入某个单元格中。&#39;
Sub LoopFillRange()
&#39;   Fill a range by looping through cells&#39;

    Dim CellsDown As Long, CellsAcross As Long
    Dim CurrRow As Long, CurrCol As Long
    Dim StartTime As Double
    Dim CurrVal As Long

&#39;   Get the dimensions&#39;
    CellsDown = InputBox(&quot;How many cells down?&quot;)
    If CellsDown = 0 Then Exit Sub
    CellsAcross = InputBox(&quot;How many cells across?&quot;)
    If CellsAcross = 0 Then Exit Sub

&#39;   Record starting time&#39;
    StartTime = Timer

&#39;   Loop through cells and insert values&#39;
    CurrVal = 1
    Application.ScreenUpdating = False
    For CurrRow = 1 To CellsDown
        For CurrCol = 1 To CellsAcross
            Range(&quot;A1&quot;).Offset(CurrRow - 1, CurrCol - 1).Value = CurrVal
            CurrVal = CurrVal + 1
        Next CurrCol
    Next CurrRow

&#39;   Display elapsed time&#39;
    Application.ScreenUpdating = True
    MsgBox Format(Timer - StartTime, &quot;00.00&quot;) &amp; &quot; seconds&quot;
End Sub</code></pre>
<pre><code class="vb">&#39;以下介绍一种可产生相同效果但更快捷的方法，先把过程插入到某个数组，然后使用一条语句把数组的内容传递到单元格区域中。&#39;
Sub ArrayFillRange()
&#39;   Fill a range by transferring an array&#39;

    Dim CellsDown As Long, CellsAcross As Long
    Dim i As Long, j As Long
    Dim StartTime As Double
    Dim TempArray() As Double
    Dim TheRange As Range
    Dim CurrVal As Long

&#39;   Get the dimensions&#39;
    CellsDown = InputBox(&quot;How many cells down?&quot;)
    If CellsDown = 0 Then Exit Sub
    CellsAcross = InputBox(&quot;How many cells across?&quot;)
    If CellsAcross = 0 Then Exit Sub

 &#39;  Record starting time&#39;
    StartTime = Timer

&#39;   Redimension temporary array&#39;
    ReDim TempArray(1 To CellsDown, 1 To CellsAcross)

&#39;   Set worksheet range&#39;
    Set TheRange = Range(Cells(1, 1), Cells(CellsDown, CellsAcross))

&#39;   Fill the temporary array&#39;
    CurrVal = 0
    Application.ScreenUpdating = False
    For i = 1 To CellsDown
        For j = 1 To CellsAcross
            TempArray(i, j) = CurrVal
            CurrVal = CurrVal + 1
        Next j
    Next i

&#39;   Transfer temporary array to worksheet&#39;
    TheRange.Value = TempArray

&#39;   Display elapsed time&#39;
    Application.ScreenUpdating = True
    MsgBox Format(Timer - StartTime, &quot;00.00&quot;) &amp; &quot; seconds&quot;
End Sub</code></pre>
<p><strong>传递一维数组中的内容</strong></p>
<pre><code class="vb">&#39;把一维数组的内容传递给某个单元格区域中时，这个单元格区域中的单元格必须是水平方向的，如果使用垂直方向的单元格区域时，则必须把数组转换成垂直的。可使用Excel的TRANSPORT函数完成数组转置任务。&#39;
&#39;例如将含有100个元素的数组MyArray转置并传递给垂直方向工作表单元格区域&#39;
Range(&quot;A1:A100&quot;).Value = Application.WorksheetFunction.Transport(MyArray)</code></pre>
<p><strong>将单元格区域传递给Variant类型的数组</strong></p>
<pre><code class="vb">&#39;下例把单元格区域中的数据传递给一个Variant类型的二维数组。然后用消息框显示出这个Variant数组每一维的上界。&#39;
Sub RangeToVariant2()
    Dim x As Variant
    x = Range(&quot;A1:L600&quot;).Value
    MsgBox UBound(x, 1) &#39;显示600，原单元格区域的行数
    MsgBox UBound(x, 2) &#39;显示12，列数
End Sub
&#39;下例中，先把单元格区域（名为data）中的数据读入Variant类型的数组中，然后对该数组中的每一个元素执行乘法运算，接着把Variant类型数组中的数据传回这个单元格区域。&#39;
Sub RangeToVariant2()
    Dim x As Variant
    Dim r As Long, c As Integer

&#39;   Read the data into the variant&#39;
    x = Range(&quot;data&quot;).Value

&#39;   Loop through the variant array&#39;
    For r = 1 To UBound(x, 1)
        For c = 1 To UBound(x, 2)
&#39;           Multiply by 2
            x(r, c) = x(r, c) * 2
        Next c
    Next r

&#39;   Transfer the variant back to the sheet&#39;
    Range(&quot;data&quot;) = x
End Sub</code></pre>
<p><strong>按数值选择单元格</strong></p>
<pre><code class="vb">&#39;以下示例阐述如何通过数值选择单元格，以下选择出含有负值的单元格，很容易对选择条件进行修改。&#39;
&#39;从检查选区开始，如果只是一个单元格，则搜索整个工作表，若至少含有两个以上的单元格，则只搜索选中的单元格区域。使用SpecialCells方法进一步对被搜索的单元格进行细化，进而创建一个仅由数值常量组成的Range对象。&#39;
&#39;包含在Font-Next循环中的代码可检查单元格的值。如果它满足标准，则使用Union方法把该单元格添加到Range对象FoundCells中。注意不能在第一个单元格中使用Union方法，如果FoundCells不含单元格，那么尝试Union方法将生成一个错误。&#39;
&#39;循环结束时，FoundCells对象将由满足标准的单元格组成，如果没有，则是Nothing，否则选中这些单元格。&#39;
Sub SelectByValue()
    Dim Cell As Object
    Dim FoundCells As Range
    Dim WorkRange As Range

    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub

&#39;   Check all or selection?&#39;
    If Selection.CountLarge = 1 Then
        Set WorkRange = ActiveSheet.UsedRange
    Else
       Set WorkRange = Application.Intersect(Selection, ActiveSheet.UsedRange)
    End If

&#39;   Reduce the search to numeric cells only&#39;
    On Error Resume Next
    Set WorkRange = WorkRange.SpecialCells(xlConstants, xlNumbers)
    If WorkRange Is Nothing Then Exit Sub
    On Error GoTo 0

&#39;   Loop through each cell, add to the FoundCells range if it qualifies&#39;
    For Each Cell In WorkRange
        If Cell.Value &lt; 0 Then
            If FoundCells Is Nothing Then
                Set FoundCells = Cell
            Else
                Set FoundCells = Application.Union(FoundCells, Cell)
            End If
        End If
    Next Cell

&#39;   Show message, or select the cells&#39;
    If FoundCells Is Nothing Then
        MsgBox &quot;No cells qualify.&quot;
    Else
        FoundCells.Select
        MsgBox &quot;Selected &quot; &amp; FoundCells.Count &amp; &quot; cells.&quot;
    End If
End Sub</code></pre>
<p><strong>复制非连续单元格区域</strong></p>
<pre><code class="vb">&#39;Excel不支持复制非连续单元格区域，可以使用宏来迂回解决此问题。以下VBA过程允许把多个选区复制到一个位置。&#39;
Sub CopyMultipleSelection()
    Dim SelAreas() As Range
    Dim PasteRange As Range
    Dim UpperLeft As Range
    Dim NumAreas As Integer, i As Integer
    Dim TopRow As Long, LeftCol As Integer
    Dim RowOffset As Long, ColOffset As Integer

    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub

&#39;   Store the areas as separate Range objects&#39;
    NumAreas = Selection.Areas.Count    &#39;得出所选单元格区域数量&#39;
    ReDim SelAreas(1 To NumAreas) &#39;重新定义SelAreas维度&#39;
    For i = 1 To NumAreas
        Set SelAreas(i) = Selection.Areas(i)
    Next 

&#39;   Determine the upper left cell in the multiple selection&#39;
    TopRow = ActiveSheet.Rows.Count
    LeftCol = ActiveSheet.Columns.Count
    For i = 1 To NumAreas &#39;在多个选区中确定左上单元格&#39;
        If SelAreas(i).Row &lt; TopRow Then TopRow = SelAreas(i).Row
        If SelAreas(i).Column &lt; LeftCol Then LeftCol = SelAreas(i).Column
    Next
    Set UpperLeft = Cells(TopRow, LeftCol)

&#39;   Get the paste address&#39;
    On Error Resume Next
    Set PasteRange = Application.InputBox _
      (Prompt:=&quot;Specify the upper left cell for the paste range:&quot;, _
      Title:=&quot;Copy Mutliple Selection&quot;, _
      Type:=8)
    On Error GoTo 0
&#39;   Exit if canceled&#39;
    If TypeName(PasteRange) &lt;&gt; &quot;Range&quot; Then Exit Sub

&#39;   Make sure only the upper left cell is used&#39;
    Set PasteRange = PasteRange.Range(&quot;A1&quot;)

&#39;   Copy and paste each area&#39;
    For i = 1 To NumAreas
        RowOffset = SelAreas(i).Row - TopRow
        ColOffset = SelAreas(i).Column - LeftCol
        SelAreas(i).Copy PasteRange.Offset(RowOffset, ColOffset)
    Next i
End Sub</code></pre>
<h2 id="出处理工作簿和工作表"><a href="#出处理工作簿和工作表" class="headerlink" title="出处理工作簿和工作表"></a>出处理工作簿和工作表</h2><p><strong>保存所有工作簿</strong></p>
<pre><code class="vb">&#39;以下过程遍历Workbooks集合中所有工作簿，并保存以前保存了的每个文件。&#39;
Public Sub SaveAllWorkbooks1()
    Dim Book As Workbook
    For Each Book In Workbooks
        If Book.Path &lt;&gt; &quot;&quot; Then Book.Save
    Next Book
End Sub
&#39;若Path属性的值为空，就表明从未保存过这个文件（为新工作簿），忽略此类。&#39;
&#39;更有效的方法是检查Save属性，如果工作簿自上次以来从未修改过，则属性为True。&#39;
Public Sub SaveAllWorkbooks2()
    Dim Book As Workbook
    For Each Book In Workbooks
        If Book.Path &lt;&gt; &quot;&quot; Then
            If Book.Saved &lt;&gt; True Then
                Book.Save
            End If
        End If
    Next Book
End Sub</code></pre>
<p><strong>保存和关闭所有工作簿</strong></p>
<pre><code class="vb">&#39;以下过程将循环遍历Workbooks集合，该代码将保存和关闭所有工作簿。&#39;
Public Sub CloseAllWorkbooks()
    Dim Book As Workbook
    For Each Book In Workbooks
        If Book.Name &lt;&gt; ThisWorkbook.Name Then
            Book.Close savechanges:=True
        End If
    Next Book
    ThisWorkbook.Close savechanges:=True
End Sub
&#39;上述If语句用来确定该工作簿是不是包含这些代码的工作簿。该过程必须有这条语句，原因是关闭上述工作簿将结束代码，而不会影响后续工作簿。在其他所有工作簿关闭后，包含代码的工作簿会关闭自身。&#39;</code></pre>
<p><strong>隐藏选区之外的区域</strong></p>
<pre><code class="vb">&#39;本节示例将隐藏除单元格区域选区之外的所有行和列&#39;
Sub HideRowsAndColumns()
    Dim row1 As Long, row2 As Long
    Dim col1 As Long, col2 As Long

    If TypeName(Selection) &lt;&gt; &quot;Range&quot; Then Exit Sub

&#39;   If last row or last column is hidden, unhide all and quit
    If Rows(Rows.Count).EntireRow.Hidden Or Columns(Columns.Count).EntireColumn.Hidden Then
        Cells.EntireColumn.Hidden = False
        Cells.EntireRow.Hidden = False
        Exit Sub
    End If

    row1 = Selection.Rows(1).Row
    row2 = row1 + Selection.Rows.Count - 1
    col1 = Selection.Columns(1).Column
    col2 = col1 + Selection.Columns.Count - 1

    Application.ScreenUpdating = False
    On Error Resume Next
&#39;   Hide rows
    Range(Cells(1, 1), Cells(row1 - 1, 1)).EntireRow.Hidden = True
    Range(Cells(row2 + 1, 1), Cells(Rows.Count, 1)).EntireRow.Hidden = True
&#39;   Hide columns
    Range(Cells(1, 1), Cells(1, col1 - 1)).EntireColumn.Hidden = True
    Range(Cells(1, col2 + 1), Cells(1, Columns.Count)).EntireColumn.Hidden = True
End Sub
&#39;如果在最后一行或最后一列隐藏时执行过程，则会显示所有列。&#39;
&#39;如果单元格区域由非连续区域的单元格组成，那么第一个区域将被用作隐藏行和列的基础&#39;</code></pre>
<p><strong>创建超链接内容表</strong></p>
<pre><code class="vb">&#39;CreateTOC过程在活动工作簿开头插入一个新工作表。然后以每个工作表的超链接列表形式创建一个内容表。&#39;
Sub CreateTOC()
    Dim i As Integer
    Sheets.Add Before:=Sheets(1)
    For i = 2 To Worksheets.Count
      ActiveSheet.Hyperlinks.Add _
         Anchor:=Cells(i, 1), _
         Address:=&quot;&quot;, _
         SubAddress:=&quot;&#39;&quot; &amp; Worksheets(i).Name &amp; &quot;&#39;!A1&quot;, _
         TextToDisplay:=Worksheets(i).Name
     Next i
End Sub
&#39;由于不可创建图表工作表的超链接，因此代码使用了Worksheets集合而不是Sheets集合。&#39;</code></pre>
<p><strong>同步工作表</strong></p>
<pre><code class="vb">&#39;下面的VBA宏使用活动的工作表为基础，然后在这个工作簿中的所有其他工作表上执行下列操作：选中与工作表上同样的单元格区域，使得左上角的单元格等同于工作表上的左上方单元格。&#39;
Sub SynchSheets()
&#39;   Duplicates the active sheet&#39;s active cell upperleft cell
&#39;   Across all worksheets&#39;
    If TypeName(ActiveSheet) &lt;&gt; &quot;Worksheet&quot; Then Exit Sub
    Dim UserSheet As Worksheet, sht As Worksheet
    Dim TopRow As Long, LeftCol As Integer
    Dim UserSel As String

    Application.ScreenUpdating = False

&#39;   Remember the current sheet&#39;
    Set UserSheet = ActiveSheet

&#39;   Store info from the active sheet&#39;
    TopRow = ActiveWindow.ScrollRow
    LeftCol = ActiveWindow.ScrollColumn
    UserSel = ActiveWindow.RangeSelection.Address

&#39;   Loop through the worksheets&#39;
    For Each sht In ActiveWorkbook.Worksheets
        If sht.Visible Then &#39;skip hidden sheets
            sht.Activate
            Range(UserSel).Select
            ActiveWindow.ScrollRow = TopRow
            ActiveWindow.ScrollColumn = LeftCol
        End If
    Next sht

&#39;   Restore the original position
    UserSheet.Activate
    Application.ScreenUpdating = True
End Sub</code></pre>
<h2 id="VBA技巧"><a href="#VBA技巧" class="headerlink" title="VBA技巧"></a>VBA技巧</h2><p><strong>切换布尔类型的属性值</strong></p>
<pre><code class="vb">&#39;切换布尔类型属性的最简单方法是Not,该示例切换了某个选区的WrapText属性的值。&#39;
Sub ToggleWrapText()
&#39;Toogle text wrap alignment for selected cells
    If TypeName(Selection) = &quot;Range&quot; Then
        Selection.WrapText = Not ActiveCell.WrapText
    End If
End Sub
&#39;可使用Not切换其他很多属性的值。&#39;
ActiveWindow.DisplayHeadings = Not ActiveWindow.DisplayHeadings &#39;切换显示工作表中的行和列边界&#39;
ActiveWindow.DisplayGridlines = Not ActiveWindow.DisplayGridlines &#39;切换是否显示工作表中的网格线&#39;</code></pre>
<p><strong>显示日期和时间</strong></p>
<pre><code class="vb">&#39;以下过程显示了包含当前日期和时间对话框，这个示例还在消息框中的标题栏中显示了一条个性化消息。&#39;
&#39;使用Date函数作为传递给Format函数的参数，其结果是一个字符串，包含经过格式化的日期，时间也如此。&#39;
&#39;使用了命名的格式(Long Date和Medium Time),以便确保不管用户所在国家的设置有何不同，这个宏都能正常运行。也可以使用TheDate = Format(Date, &quot;mm/dd/yy&quot;)&#39;
Sub DateAndTime()
&#39;   Displays the current date and time
    Dim TheDate As String, TheTime As String
    Dim LastSaved As String
    Dim Greeting As String
    Dim FullName As String, FirstName As String
    Dim SpaceInName As Long

    TheDate = Format(Date, &quot;Long Date&quot;)
    TheTime = Format(Time, &quot;Medium Time&quot;)

&#39;   Determine greeting based on time
    Select Case Time
        Case Is &lt; 0.5:     Greeting = &quot;Good Morning, &quot;
        Case Is &gt;= 0.7083: Greeting = &quot;Good Evening, &quot;
        Case Else:         Greeting = &quot;Good Afternoon, &quot;
    End Select

&#39;   Last saved
    LastSaved = &quot;Document Last Saved: &quot; &amp; ActiveWorkbook.BuiltinDocumentProperties(12)

&#39;   Append user&#39;s first name to greeting
    FullName = Application.UserName
    SpaceInName = InStr(1, FullName, &quot; &quot;, 1)

&#39;   Handle situation when name has no space
    If SpaceInName = 0 Then SpaceInName = Len(FullName)
    FirstName = Left(FullName, SpaceInName)
    Greeting = Greeting &amp; FirstName

&#39;   Show the message
    MsgBox TheDate &amp; vbCrLf &amp; vbCrLf &amp; &quot;It&#39;s &quot; &amp; TheTime, vbOKOnly, Greeting
End Sub</code></pre>
<p><strong>显示友好时间</strong></p>
<pre><code class="vb">&#39;用文字形式显示时间差
unction FT(t1, t2)
    Dim SDif As Double, DDif As Double

    If Not (IsDate(t1) And IsDate(t2)) Then
        FT = CVErr(xlErrValue)
        Exit Function
    End If

    DDif = Abs(t2 - t1)
    SDif = DDif * 24 * 60 * 60

    If DDif &lt; 1 Then
       If SDif &lt; 10 Then FT = &quot;Just now&quot;: Exit Function
       If SDif &lt; 60 Then FT = SDif &amp; &quot; seconds ago&quot;: Exit Function
       If SDif &lt; 120 Then FT = &quot;a minute ago&quot;: Exit Function
       If SDif &lt; 3600 Then FT = Round(SDif / 60, 0) &amp; &quot;minutes ago&quot;: Exit Function
       If SDif &lt; 7200 Then FT = &quot;An hour ago&quot;: Exit Function
       If SDif &lt; 86400 Then FT = Round(SDif / 3600, 0) &amp; &quot; hours ago&quot;: Exit Function
    End If
    If DDif = 1 Then FT = &quot;Yesterday&quot;: Exit Function
    If DDif &lt; 7 Then FT = Round(DDif, 0) &amp; &quot; days ago&quot;: Exit Function
    If DDif &lt; 31 Then FT = Round(DDif / 7, 0) &amp; &quot; weeks ago&quot;: Exit Function
    If DDif &lt; 365 Then FT = Round(DDif / 30, 0) &amp; &quot; months ago&quot;: Exit Function
    FT = Round(DDif / 365, 0) &amp; &quot; years ago&quot;
End Function</code></pre>
<p><strong>获得字体列表</strong></p>
<pre><code class="vb">&#39;ShowInstallerFonts宏在活动工作表中的列A中显示了安装的字体清单。这个宏创建了一个临时工具栏（一个CommandBar对象），然后添加Font控件，并从该控件中读取字体。最后删除临时工具栏。&#39;
&#39;Excel仍旧支持旧式的CommandBar属性和方法，这些属性和方法主要用来处理工具栏和菜单。&#39;
Sub ShowInstalledFonts()
    Dim FontList As CommandBarControl
    Dim TempBar As CommandBar
    Dim i As Long

&#39;   Create temporary CommandBar&#39;
    Set TempBar = Application.CommandBars.Add
    Set FontList = TempBar.Controls.Add(ID:=1728)

&#39;   Put the fonts into column A&#39;
    Range(&quot;A:A&quot;).ClearContents
    For i = 0 To FontList.ListCount - 1
        Cells(i + 1, 1) = FontList.List(i + 1)
&#39;       Cells(i + 1, 1).Font.Name = FontList.List(i + 1) &#39;可以显示实际字体的每个字体名称&#39;
    Next i

&#39;   Delete temporary CommandBar&#39;
    TempBar.Delete
End Sub</code></pre>
<p><strong>对数组进行排序</strong></p>
<p>VBA没有提供一种对数组进行排序的方法。以下介绍四种不同的排序方法。</p>
<ul>
<li><strong>工作表排序</strong>：把数组中的数据传递到工作表的单元格区域，进行排序，再将数据传递回数组。这种过程把数组作为唯一的参数。</li>
<li><strong>冒泡排序</strong>：冒泡排序算法很容易编写，但是算法速度较慢。</li>
<li><strong>快速排序</strong>：这种排序算法比冒泡排序算法快很多，但更难读懂。并且只能处理Integer或Long数据类型。</li>
<li>计数排序：这种排序方法非常快捷，但很难读懂。与快速排序算法一样，只能处理Integer或Long数据类型。</li>
</ul>
<pre><code class="vb">&#39;工作表排序&#39;
Sub WorksheetSort(list)
&#39;   Sorts an array by transferring it to
&#39;   A worksheet and using Excel&#39;s sorting command&#39;

    Dim First As Integer, Last As Long
    Dim i As Long
    Dim FirstCell As Range, LastCell As Range
    Dim CurrCell As Range, FillRange As Range

    First = LBound(list, 1)
    Last = UBound(list, 1)
    Set FirstCell = Sheets(&quot;Sheet1&quot;).Cells(1, 1)
    Set LastCell = Sheets(&quot;Sheet1&quot;).Cells(Last, 1)
    Set FillRange = Range(FirstCell, LastCell)
    Application.ScreenUpdating = False

&#39;   Transfer the array to worksheet&#39;
    FillRange.Value = list

&#39;   Sort the worksheet range&#39;
    FirstCell.CurrentRegion.Sort Key1:=FirstCell, Order1:=xlAscending, Orientation:=xlTopToBottom

&#39;   Transfer range back to the array and clear range&#39;
    For i = First To Last
        list(i, 0) = FirstCell.Offset(i - 1, 0)
    Next i
    FillRange.Clear
    Application.ScreenUpdating = True
End Sub</code></pre>
<pre><code class="vb">&#39;冒泡排序&#39;
Sub BubbleSort(list() As Long)
&#39;   Sorts an array using bubble sort algorithm&#39;
&#39;   Works with any data type&#39;
    Dim First As Integer, Last As Long
    Dim i As Long, j As Long
    Dim Temp

    First = LBound(list)
    Last = UBound(list)
    For i = First To Last - 1
        For j = i + 1 To Last
            If list(i) &gt; list(j) Then
                Temp = list(j)
                list(j) = list(i)
                list(i) = Temp
            End If
        Next j
    Next i
End Sub</code></pre>
<pre><code class="vb">&#39;快速排序&#39;
&#39;This technique works only with Integer or Long values.&#39;

Public Sub Quicksort(list() As Long, ByVal min As Long, ByVal max As Long)
    Dim med_value As Long
    Dim hi As Long
    Dim lo As Long
    Dim i As Long

    &#39; If min &gt;= max, the list contains 0 or 1 items so it is sorted.&#39;
    If min &gt;= max Then Exit Sub

    &#39; Pick the dividing value.&#39;
    i = Int((max - min + 1) * Rnd + min)
    med_value = list(i)

    &#39; Swap it to the front.&#39;
    list(i) = list(min)

    lo = min
    hi = max
    Do
        &#39; Look down from hi for a value &lt; med_value.&#39;
        Do While list(hi) &gt;= med_value
            hi = hi - 1
            If hi &lt;= lo Then Exit Do
        Loop
        If hi &lt;= lo Then
            list(lo) = med_value
            Exit Do
        End If

        &#39; Swap the lo and hi values.&#39;
        list(lo) = list(hi)

        &#39; Look up from lo for a value &gt;= med_value.&#39;
        lo = lo + 1
        Do While list(lo) &lt; med_value
            lo = lo + 1
            If lo &gt;= hi Then Exit Do
        Loop
        If lo &gt;= hi Then
            lo = hi
            list(hi) = med_value
            Exit Do
        End If

        &#39; Swap the lo and hi values.&#39;
        list(hi) = list(lo)
    Loop

    &#39; Sort the two sublists.&#39;
    Quicksort list(), min, lo - 1
    Quicksort list(), lo + 1, max
End Sub</code></pre>
<pre><code class="vb">&#39;计数排序&#39;
Sub CountingSort(list)
    Dim counts()
    Dim i As Long
    Dim j As Long
    Dim next_index As Long
    Dim min, max
    Dim min_value As Variant, max_value As Variant

&#39;   Allocate the counts array. VBA automatically&#39;
&#39;   initialises all entries to 0.&#39;

    min_value = Minimum(list)
    max_value = Maximum(list)

    min = LBound(list)
    max = UBound(list)

    ReDim counts(min_value To max_value)

    &#39; Count the values.&#39;
    For i = min To max
        counts(list(i)) = counts(list(i)) + 1
    Next i

    &#39; Write the items back into the list array.&#39;
    next_index = min
    For i = min_value To max_value
        For j = 1 To counts(i)
            list(next_index) = i
            next_index = next_index + 1
        Next j
    Next i
End Sub

Function Minimum(list)
    Dim i As Long
    Minimum = list(LBound(list))
    For i = LBound(list) To UBound(list)
        If list(i) &lt; Minimum Then Minimum = list(i)
    Next i
End Function

Function Maximum(list)
    Dim i As Long
    Maximum = list(LBound(list))
    For i = LBound(list) To UBound(list)
        If list(i) &gt; Maximum Then Maximum = list(i)
    Next i
End Function</code></pre>
<p><strong>处理一系列文件</strong></p>
<pre><code class="vb">&#39;本节示例阐述了如何对存储在磁盘上的几个不同的文件执行某个宏。这个示例提示用户输入文件规范，然后处理所有匹配的文件。在这个示例中，处理工作包括导入文件和输入一系列汇总公式，这些公式用于描述文件中的数据。&#39;
&#39;匹配的文件名存储在FoundFiles数组中，该过程使用了一个For-Next循环来处理这些文件。&#39;
Sub BatchProcess()
    Dim FileSpec As String
    Dim i As Integer
    Dim FileName As String
    Dim FileList() As String
    Dim FoundFiles As Integer

&#39;   Specify path and file spec&#39;
    FileSpec = ThisWorkbook.Path &amp; &quot;\&quot; &amp; &quot;text??.txt&quot;
    FileName = Dir(FileSpec)

&#39;   Was a file found?&#39;
    If FileName &lt;&gt; &quot;&quot; Then
        FoundFiles = 1
        ReDim Preserve FileList(1 To FoundFiles)
        FileList(FoundFiles) = FileName
    Else
        MsgBox &quot;No files were found that match &quot; &amp; FileSpec
        Exit Sub
    End If

&#39;   Get other filenames&#39;
    Do
        FileName = Dir
        If FileName = &quot;&quot; Then Exit Do
        FoundFiles = FoundFiles + 1
        ReDim Preserve FileList(1 To FoundFiles)
        FileList(FoundFiles) = FileName &amp; &quot;*&quot;
    Loop

&#39;   Loop through the files and process them&#39;
    For i = 1 To FoundFiles
        Call ProcessFiles(FileList(i))
    Next i
End Sub

&#39;上述循环中调用了下面ProcessFiles过程完成处理工作。在这个简单过程中，使用OpenText方法来导入文件，并插入5个公式。&#39;
Sub ProcessFiles(FileName As String)
&#39;   Import the file
    Workbooks.OpenText FileName:=ThisWorkbook.Path &amp; &quot;\&quot; &amp; FileName, _
        Origin:=xlWindows, _
        StartRow:=1, _
        DataType:=xlFixedWidth, _
        FieldInfo:= _
        Array(Array(0, 1), Array(3, 1), Array(12, 1))
&#39;   Enter summary formulas
    Range(&quot;D1&quot;).Value = &quot;A&quot;
    Range(&quot;D2&quot;).Value = &quot;B&quot;
    Range(&quot;D3&quot;).Value = &quot;C&quot;
    Range(&quot;E1:E3&quot;).Formula = &quot;=COUNTIF(B:B,D1)&quot;
    Range(&quot;F1:F3&quot;).Formula = &quot;=SUMIF(B:B,D1,C:C)&quot;
End Sub</code></pre>
<p>##用于代码中的一些有用函数</p>
<p>以下展示一些实用函数，这里使用Provate关键字声明了这些函数，所以它们不会出现在Excel的”插入函数”对话框中。</p>
<p><strong>FileExists</strong> 函数：该函数接收了一个参数（带文件名的路径），如果文件存在，返回True。</p>
<pre><code class="vb">Private Function FileExists(fname) As Boolean
&#39;   Returns TRUE if the file exists&#39;
    Dim x As String
    x = Dir(fname)
    If x &lt;&gt; &quot;&quot; Then FileExists = True _
        Else FileExists = False
End Function</code></pre>
<p><strong>FileNameOnly</strong> 函数：该函数从文件名中提取路径。</p>
<pre><code class="vb">&#39;使用了VBA的Split函数，Split函数接收一个含分隔符的字符串，并返回包含分隔符之间的元素的Variant数组。&#39;
Private Function FileNameOnly(pname) As String
&#39;   Returns the filename from a path/filename string&#39;
    Dim temp As Variant
    length = Len(pname)
    temp = Split(pname, Application.PathSeparator)
    FileNameOnly = temp(UBound(temp))
End Function
&#39;如果文件存在，下面方法更简单，它将从路径中提取且只返回文件名。&#39;
Private Function FileNameOnly2(panme) As String
    FileNameOnly2 = Dir(pname)
End Function</code></pre>
<p><strong>PathExists</strong> 函数:该函数接收一个参数路径，如果路径存在，那么返回True。</p>
<pre><code class="vb">Private Function PathExists(pname) As Boolean
&#39;   Returns TRUE if the path exists
  If Dir(pname, vbDirectory) = &quot;&quot; Then
    PathExists = False
 Else
    PathExists = (GetAttr(pname) And vbDirectory) = vbDirectory
 End If
End Function</code></pre>
<p><strong>RangeNameExists</strong> 函数：该函数接收一个参数(单元格区域名称)。如果活动工作簿中存在这个单元格区域的名称，则返回True。</p>
<pre><code class="vb">Private Function RangeNameExists(nname) As Boolean
&#39;   Returns TRUE if the range name exists
    Dim n As Name
    RangeNameExists = False
    For Each n In ActiveWorkbook.Names
        If UCase(n.Name) = UCase(nname) Then
            RangeNameExists = True
            Exit Function
        End If
    Next n
End Function</code></pre>
<p><strong>SheetExists</strong> 函数：该函数接收一个参数(工作表的名称)。如果活动工作簿中包含这个工作表，则返回True。</p>
<pre><code class="vb">Private Function SheetExists(sname) As Boolean
&#39;   Returns TRUE if sheet exists in the active workbook&#39;
    Dim x As Object
    On Error Resume Next
    Set x = ActiveWorkbook.Sheets(sname)
    If Err = 0 Then SheetExists = True _
        Else SheetExists = False
End Function</code></pre>
<p><strong>WorkbooklsOpen</strong> 函数：该函数接收一个参数(工作簿的名称)。如果打开了这个工作簿，则返回True。</p>
<pre><code class="vb">Private Function WorkbookIsOpen(wbname) As Boolean
&#39;   Returns TRUE if the workbook is open&#39;
    Dim x As Workbook
    On Error Resume Next
    Set x = Workbooks(wbname)
    If Err = 0 Then WorkbookIsOpen = True _
        Else WorkbookIsOpen = False
End Function</code></pre>
<p><strong>测试集合成员关系的通用函数</strong>：接收两个参数，分别是集合(一个对象)和项(一个字符串)，若这个项是集合成员，则返回True。</p>
<pre><code class="vb">Private Function IsInCollection(Coln As Object, Item As String) As Boolean
    Dim Obj As Object
    On Error Resume Next
    Set Obj = Coln(Item)
    IsInCollection = Not Obj Is Nothing
End Function
&#39;例如:&#39;
MsgBox IsInCollection(ActiveWorkbook.Names,&quot;Data&quot;) &#39;确定单元格区域Data是否包含在活动工作簿中&#39;
MsgBox IsInCollection(Workbooks,&quot;budget.xlsx&quot;) &#39;确定是否打开了名为Budget的工作簿&#39;
MsgBox IsInCollection(ActiveWorkbook.Worksheets,&quot;Sheet1&quot;) &#39;确定活动工作簿是否包含名为Sheet1的工作表&#39;</code></pre>
<p><strong>检索已经关闭的工作簿的值</strong>:VBA没有提供从关闭的文件工作簿文件中检索值的方法。然而，可以利用Excel来处理链接的文件。</p>
<pre><code class="vb">&#39;GetValue函数接收4个参数：&#39;
&#39;- path:已经关闭的文件所在的驱动器盘符和路径（如d:\files）&#39;
&#39;- file:工作簿的名称(如budget.xlsx)&#39;
&#39;- sheet:工作表的名称(如sheet1)&#39;
&#39;- ref:单元格的引用(如C4)&#39;
&#39;该函数通过调用宏XLM来达到目的。&#39;
Private Function GetValue(path, file, sheet, ref)
&#39;   Retrieves a value from a closed workbook&#39;
    Dim arg As String

&#39;   Make sure the file exists&#39;
    If Right(path, 1) &lt;&gt; &quot;\&quot; Then path = path &amp; &quot;\&quot;
    If Dir(path &amp; file) = &quot;&quot; Then
        GetValue = &quot;File Not Found&quot;
        Exit Function
    End If

&#39;   Create the argument&#39;
    arg = &quot;&#39;&quot; &amp; path &amp; &quot;[&quot; &amp; file &amp; &quot;]&quot; &amp; sheet &amp; &quot;&#39;!&quot; &amp; _
      Range(ref).Range(&quot;A1&quot;).Address(, , xlR1C1)

&#39;   Execute an XLM macro&#39;
    GetValue = ExecuteExcel4Macro(arg)
End Function</code></pre>
<pre><code class="vb">&#39;以下过程阐述了如何使用GetValue函数。其中显示了位于2013budget.xlsx文件中Sheet1工作表上的单元格A1中的值，该文件位于C盘的XLFiles\Budget目录下。&#39;
Sub TestGetValue()
    Dim p As String, f As String
    Dim s As String, a As String

    p = ThisWorkbook.path
    f = &quot;myworkbook.xlsx&quot;
    s = &quot;Sheet2&quot;
    a = &quot;C1&quot;
    MsgBox GetValue(p, f, s, a)
End Sub</code></pre>
<pre><code class="vb">&#39;以下是个示例，这个过程展示了如何从已经关闭的文件中读取1200个值(100行和12列)，然后把这些值放到工作表中。&#39;
Sub TestGetValue2()
    Dim p As String, f As String
    Dim s As String, a As String
    Dim r As Long, c As Long

    p = ThisWorkbook.path
    f = &quot;myworkbook.xlsx&quot;
    s = &quot;Sheet1&quot;
    Application.ScreenUpdating = False
    For r = 1 To 100
        For c = 1 To 12
            a = Cells(r, c).Address
            Cells(r, c) = GetValue(p, f, s, a)
        Next c
    Next r
End Sub</code></pre>
<h2 id="一些有用的工作表函数"><a href="#一些有用的工作表函数" class="headerlink" title="一些有用的工作表函数"></a>一些有用的工作表函数</h2><p>以下示例都是自定义函数，可用于工作表中的公式中。必须在一个VBA模块中定义这些Function过程(而不是在与ThisWorkbook、Sheet或UserForm关联的代码模块中)</p>
<p><strong>返回单元格的信息</strong></p>
<p>一以下函数不能自动更新，因为没有触发Excel的自动计算引擎。为强制实施全局的重新计算和更新所有自定义函数，可按Ctrl+Alt+F9快捷键操作。或是在函数中添加语句：Application.Volatile</p>
<pre><code class="vb">&#39;如果单元格参数包含粗体格式，则下面的函数返回True：&#39;
Function ISBOLD(Cell) As Boolean
&#39;   Returns TRUE if cell is bold
    ISBOLD = Cell.Range(&quot;A1&quot;).Font.Bold
End Function
&#39;以上函数只对那些显式运用的格式才有效，但不适用于使用条件格式化来运用的格式。以下重写ISBOLD函数，使得其可以应用于根据条件设置的格式&#39;
Function ISBOLD(Cell) As Boolean
&#39;Returns TRUE if cell is bold，even if from conditional formatting
    ISBOLD = Cell.Range(&quot;A1&quot;).Font.Bold
End Function</code></pre>
<pre><code class="vb">&#39;如果单元格参数包含斜体格式，则下面的函数返回True：&#39;
Function ISITALIC(Cell) As Boolean
&#39;   Returns TRUE if cell is italic
    ISITALIC = Cell.Range(&quot;A1&quot;).Font.Italic
End Function</code></pre>
<pre><code class="vb">&#39;如果单元格中包含混合格式（只有部分字符是粗体显示时），上述两个函数都将显示错误信息。只有单元格中所有的字符都粗体显示时，下面的函数才会返回True:&#39;
Function ALLBOLD(Cell) As Boolean
&#39;   Returns TRUE if all characters in cell are bold
    If IsNull(Cell.Font.Bold) Then 
        ALLBOLD = FALSE
    ELSE
        ALLBOLD = cell.Font.Bold
    End If
End Function
&#39;ALLBOLD函数可简化成如下形式&#39;
Function ALLBOLD(Cell) As Boolean
&#39;   Returns TRUE if all characters in cell are bold&#39;
    ALLBOLD = Not IsNull(Cell.Font.Bold)
End Function</code></pre>
<pre><code class="vb">&#39;以下函数返回一个整数，对应于单元格填充颜色的索引号，如果没有颜色填充单元格，则返回-4142。&#39;
Function FILLCOLOR(Cell) As Integer
&#39;   Returns an integer corresponding to
&#39;   cell&#39;s interior color
    Application.Volatile
    FILLCOLOR = Cell.Range(&quot;A1&quot;).Interior.ColorIndex
End Function</code></pre>
<p><strong>会说话的工作表</strong></p>
<p>SAYIT函数使用了Excel的文本转换成语音的转换生成器，来“讲述”它的参数(可以为文本文字或是单元格引用)</p>
<pre><code class="vb">Function SAYIT(txt)
    Application.Speech.Speak(txt)
    SAYIT = txt
End Function
&#39;该函数有一些娱乐作用，有时还是很有用的，例如：在公式中使用该函数&#39;
= IF(SUM(A:A)&gt;25000,SayIt(&quot;Goal Reached&quot;))</code></pre>
<p><strong>显示保存或打印文件的时间</strong></p>
<pre><code class="vb">&#39;下面函数将返回上一次保存工作簿的日期和时间&#39;
Function LASTSAVED()
    Application.Volatile
    LASTSAVED = ThisWorkbook. _
      BuiltinDocumentProperties(&quot;Last Save Time&quot;)
End Function</code></pre>
<pre><code class="vb">&#39;类似于LASTSAVED的函数，但返回的是上次打印或预览工作簿的时间和日期，若从未打印，返回#Value错误&#39;
Function LASTPRINTED()
    Application.Volatile
    LASTPRINTED = ThisWorkbook. _
      BuiltinDocumentProperties(&quot;Last Print Date&quot;)
End Function</code></pre>
<pre><code class="vb">&#39;某些情况下，想要把以上函数保存在另一个工作簿(如personal.xlsb)或加载项中。因为这些函数引用了ThisWorkbook，不经饿正确与你系那个。下面给出更通用的版本，使用了Application.Caller，它将返回一个Range对象，而对象代表了调用该函数的单元格。Parent.Parent的使用将返回工作簿(即Range对象父对象的父对象，也是一个Workbook对象)&#39;
Function LastSaved2()
    Application.Volatile
    LastSaved2 = Application.Caller.Parent.Parent. _
      BuiltinDocumentProperties(&quot;Last Save Time&quot;)
End Function</code></pre>
<p><strong>理解对象的父对象</strong></p>
<p>Excel的对象模型是一种层次结构：对象包含在其他对象中，层次结构最顶端是Application对象。Excel对象包含其他对象，而这些对象又包含其他对象等，以下为层次结构。</p>
<pre><code class="vb">Application 对象
    Workbook 对象
        Worksheet 对象
            Range 对象</code></pre>
<pre><code class="vb">&#39;以下示例，函数只接收一个参数（单元格区域）&#39;
Function SheetName(ref) As String
    SheetName = ref.Parent.Name &#39;返回工作表名称&#39;
End Function

Function WorkbookName(ref) As String
    WorkbookName = ref.Parent.Parent.Name &#39;返回workbook对象&#39;
End Function

Function AppName(ref) As String
    AppName = ref.Parent.Parent.Parent.Name &#39;返回单元格的application对象名称&#39;
End Function</code></pre>
<p><strong>计算两个值之间的单元格数目</strong></p>
<pre><code class="vb">&#39;以下函数在第一个参数InRange代表的单元格区域内，值介于第二个参数和第三个参数代表的两个值之间的单元格数目
&#39;使用了Excel的COUNTIFS函数&#39;
Function COUNTBETWEEN(InRange, num1, num2) As Long
&#39;   Counts number of values between num1 and num2&#39;
    With Application.WorksheetFunction
        If num1 &lt;= num2 Then
            COUNTBETWEEN = .CountIfs(InRange, &quot;&gt;=&quot; &amp; num1, _
                InRange, &quot;&lt;=&quot; &amp; num2)
        Else
            COUNTBETWEEN = .CountIfs(InRange, &quot;&gt;=&quot; &amp; num2, _
                InRange, &quot;&lt;=&quot; &amp; num1)
        End If
    End With
End Function</code></pre>
<p><strong>确定行或列中最后一个非空单元格</strong></p>
<pre><code class="vb">&#39;以下展示的两个函数分别返回列或行中的最后一个非空单元格的内容，若输入单元格区域不是整行或整列则返回单元格区域左上方单元格所在的行或列中最后一个非空单元格的值。&#39;
Function LASTINCOLUMN(Rng As Range)
&#39;   Returns the contents of the last non-empty cell in a column&#39;
    Dim LastCell As Range
    Application.Volatile
    With Rng.Parent
        With .Cells(.Rows.Count, Rng.Column)
            If Not IsEmpty(.Value) Then
                LASTINCOLUMN = .Value
            ElseIf IsEmpty(.End(xlUp)) Then
                LASTINCOLUMN = &quot;&quot;
            Else
                LASTINCOLUMN = .End(xlUp).Value
            End If
         End With
    End With
End Function

Function LASTINROW(Rng As Range)
&#39;   Returns the contents of the last non-empty cell in a row&#39;
    Application.Volatile
    With Rng.Parent
        With .Cells(Rng.Row, .Columns.Count)
            If Not IsEmpty(.Value) Then
                LASTINROW = .Value
            ElseIf IsEmpty(.End(xlToLeft)) Then
                LASTINROW = &quot;&quot;
            Else
                LASTINROW = .End(xlToLeft).Value
            End If
         End With
    End With
End Function
&#39;- Application.Volatile:使得无论何时计算工作表都会执行这个函数&#39;
&#39;- Rows.Count返回工作表中的行数。因为不是所有的工作表都含有相同的行数，所以这里没有使用编码的值，而使用      了Count属性。&#39;
&#39;- rng.Column返回rng参数中的左上角单元格所在的列号&#39;
&#39;- 使用rng.Parent后，即使rng参数引用其他工作表或工作簿，该函数也能正确运行&#39;
&#39;- End方法(使用xlUp参数)等同于激活列中的最后一个单元格，即按End键，然后按向上箭头键&#39;
&#39;- IsEmpty函数检测单元格是否为空。如果是空，就返回空字符串。如果没有这条语句，那么空单元格返回的值是0&#39;</code></pre>
<p><strong>字符串与模式匹配</strong></p>
<pre><code class="vb">&#39;ISLIKE函数接收两个参数：&#39;
&#39; - text: 文本字符串或对包含文本字符串的单元格的引用&#39;
&#39; - pattern:通配符字符串（?匹配任意单个字符，*匹配0或多个字符，#匹配任意单个数字，[charlist]匹配字符列表中任意单个字符，[!charlist]不在字符列表中的任意单个字符）&#39;
Function ISLIKE(text As String, pattern As String) As Boolean
&#39;   Returns true if the first argument is like the second&#39;
    ISLIKE = text Like pattern
End Function
&#39;该函数基本上是一个包装器，它允许在公式中利用VBA功能强大的Like运算符。&#39;

&#39;示例：&#39;
=ISLIKE(&quot;guiter&quot;,&quot;g*&quot;) &#39;返回TRUE&#39;
=ISLIKE(&quot;Unit1&quot;,&quot;Unit?&quot;) &#39;返回True&#39;
=ISLIKE(&quot;a&quot;,&quot;[aeiou]&quot;) &#39;返回TRUE，此例可以增加用UPPER函数&#39;
=ISLIKE(A1,&quot;1##&quot;)</code></pre>
<p><strong>从字符串中提取第n个元素</strong></p>
<p>EXTRACTELEMENT是一个自定义工作表函数(也可以从VBA过程中掉用)，它从文本字符串中提取一个元素。</p>
<p>EXTRACTELEMENT函数使用了如下三个参数：</p>
<ul>
<li>Txt:从中提取文本字符串，可以是字面上的字符串或单元格引用。</li>
<li>n:整型，代表要提取的元素个数。</li>
<li>Separator:用作分隔符的单个字符。</li>
</ul>
<p>该函数的代码如下：</p>
<pre><code class="vb">Function EXTRACTELEMENT(txt, n, Separator) As String
&#39;   Returns the nth element of a text string, where the&#39;
&#39;   elements are separated by a specified separator character&#39;
    Dim AllElements As Variant
    AllElements = Split(txt, Separator)
    EXTRACTELEMENT = AllElements(n - 1)
End Function</code></pre>
<p><strong>拼写出数字</strong></p>
<p>SPELLDOLLARS函数返回使用文本拼写出的数字。</p>
<pre><code class="vb">=SPELLDOLLARS(123.45) &#39;返回字符串One hundred twenty-three and 45/100 dollars&#39;</code></pre>
<p><strong>多功能函数</strong></p>
<pre><code class="vb">&#39;以下示例描述了某些情况下或许很有用的方法，使得一个工作表函数就像多个函数一样。下面函数包含两个参数，单元格区域rng和操作op,根据op值不同，返回使用下列列出的任意一种工作表函数计算出的值。&#39;
Function STATFUNCTION(Rng, op)
    Select Case UCase(op)
        Case &quot;SUM&quot;
            STATFUNCTION = WorksheetFunction.Sum(Rng)
        Case &quot;AVERAGE&quot;
            STATFUNCTION = WorksheetFunction.Average(Rng)
        Case &quot;MEDIAN&quot;
            STATFUNCTION = WorksheetFunction.Median(Rng)
        Case &quot;MODE&quot;
            STATFUNCTION = WorksheetFunction.Mode(Rng)
        Case &quot;COUNT&quot;
            STATFUNCTION = WorksheetFunction.Count(Rng)
        Case &quot;MAX&quot;
            STATFUNCTION = WorksheetFunction.Max(Rng)
        Case &quot;MIN&quot;
            STATFUNCTION = WorksheetFunction.Min(Rng)
        Case &quot;VAR&quot;
            STATFUNCTION = WorksheetFunction.Var(Rng)
        Case &quot;STDEV&quot;
            STATFUNCTION = WorksheetFunction.StDev(Rng)
        Case Else
            STATFUNCTION = CVErr(xlErrNA)
    End Select
End Function</code></pre>
<p><strong>SHEETOFFSET函数</strong></p>
<p>VBA函数SHEETOFFSET,它允许以相对方式寻址工作表。例如，可使用下列公式引用前一个工作表中的单元格A1:</p>
<pre><code class="vb">=SHEETOFFSET(-1,A1) &#39;该函数第一个参数代表相对的工作表，第二个参数必须是对某个单元格的引用。本例引用前一个工作表中的单元格A1。&#39;
&#39;该函数VBA代码如下：&#39;
Function SHEETOFFSET(Offset As Long, Optional Cell As Variant)
&#39;   Returns cell contents at Ref, in sheet offset
    Dim WksIndex As Long, WksNum As Long
    Dim wks As Worksheet
    Application.Volatile
    If IsMissing(Cell) Then Set Cell = Application.Caller
    WksNum = 1
    For Each wks In Application.Caller.Parent.Parent.Worksheets
        If Application.Caller.Parent.Name = wks.Name Then
            SHEETOFFSET = Worksheets(WksNum + Offset).Range(Cell(1).Address)
            Exit Function
        Else
            WksNum = WksNum + 1
        End If
    Next wks
End Function</code></pre>
<p><strong>返回所有工作表中的最大值</strong></p>
<pre><code class="vb">&#39;如果需要跨很多工作表确定单元格B1中的最大值，则可以使用以下公式：&#39;
    =MAx(Sheet1:Sheet4!B1)
&#39;下面的MAXALLSHEETS函数只接收一个单元格参数，它返回工作簿中所有工作表内该单元格中的最大值。&#39;
Function MAXALLSHEETS(Cell)
    Dim MaxVal As Double
    Dim Addr As String
    Dim Wksht As Object
    Application.Volatile
    Addr = Cell.Range(&quot;A1&quot;).Address
    MaxVal = -9.9E+307
    For Each Wksht In Cell.Parent.Parent.Worksheets
        If Wksht.Name = Cell.Parent.Name And _
          Addr = Application.Caller.Address Then
        &#39; avoid circular reference
        Else
            If IsNumeric(Wksht.Range(Addr)) Then
                If Wksht.Range(Addr) &gt; MaxVal Then _
                  MaxVal = Wksht.Range(Addr).Value
            End If
        End If
    Next Wksht
    If MaxVal = -9.9E+307 Then MaxVal = 0
    MAXALLSHEETS = MaxVal
End Function</code></pre>
<p><strong>返回没有重复随机整数元素的数组</strong></p>
<pre><code class="vb">&#39;以下函数将返回没有重复整数元素的数组，规定在多个单元格数组公式中使用该函数。｛=RANDOMINTEGERS()｝
&#39;首先选中单元格区域,然后按Ctrl+Shift+Enter快捷键输入公式。公式返回没有重复整数的数组。&#39;
&#39;RANDOMINTEGERS函数的代码如下：&#39;
Function RANDOMINTEGERS()
    Dim FuncRange As Range
    Dim V() As Variant, ValArray() As Variant
    Dim CellCount As Double
    Dim i As Integer, j As Integer
    Dim r As Integer, c As Integer
    Dim Temp1 As Variant, Temp2 As Variant
    Dim RCount As Integer, CCount As Integer

&#39;   Create Range object&#39;
    Set FuncRange = Application.Caller

&#39;   Return an error if FuncRange is too large&#39;
    CellCount = FuncRange.Count
    If CellCount &gt; 1000 Then
        RANDOMINTEGERS = CVErr(xlErrNA)
        Exit Function
    End If

&#39;   Assign variables&#39;
    RCount = FuncRange.Rows.Count
    CCount = FuncRange.Columns.Count
    ReDim V(1 To RCount, 1 To CCount)
    ReDim ValArray(1 To 2, 1 To CellCount)

&#39;   Fill array with random numbers&#39;
&#39;   and consecutive integers&#39;
    For i = 1 To CellCount
        ValArray(1, i) = Rnd
        ValArray(2, i) = i
    Next i

&#39;   Sort ValArray by the random number dimension&#39;
    For i = 1 To CellCount
        For j = i + 1 To CellCount
            If ValArray(1, i) &gt; ValArray(1, j) Then
                Temp1 = ValArray(1, j)
                Temp2 = ValArray(2, j)
                ValArray(1, j) = ValArray(1, i)
                ValArray(2, j) = ValArray(2, i)
                ValArray(1, i) = Temp1
                ValArray(2, i) = Temp2
            End If
        Next j
    Next i

&#39;   Put the randomized values into the V array&#39;
    i = 0
    For r = 1 To RCount
        For c = 1 To CCount
            i = i + 1
            V(r, c) = ValArray(2, i)
        Next c
    Next r
    RANDOMINTEGERS = V
End Function</code></pre>
<p><strong>随机化单元格区域</strong></p>
<p>下面的RANGERANDOMIZE函数接收一个单元格类型的参数，返回输入单元格区域组成的数组(随机顺序)：</p>
<pre><code class="vb">Function RANGERANDOMIZE(Rng)
    Dim V() As Variant, ValArray() As Variant
    Dim CellCount As Double
    Dim i As Integer, j As Integer
    Dim r As Integer, c As Integer
    Dim Temp1 As Variant, Temp2 As Variant
    Dim RCount As Integer, CCount As Integer

&#39;   Return an error if rng is too large&#39;
    CellCount = Rng.Count
    If CellCount &gt; 1000 Then
        RANGERANDOMIZE = CVErr(xlErrNA)
        Exit Function
    End If

&#39;   Assign variables&#39;
    RCount = Rng.Rows.Count
    CCount = Rng.Columns.Count
    ReDim V(1 To RCount, 1 To CCount)
    ReDim ValArray(1 To 2, 1 To CellCount)

&#39;   Fill ValArray with random numbers&#39;
&#39;   and values from rng
    For i = 1 To CellCount
        ValArray(1, i) = Rnd
        ValArray(2, i) = Rng(i)
    Next i

&#39;   Sort ValArray by the random number dimension&#39;
    For i = 1 To CellCount
        For j = i + 1 To CellCount
            If ValArray(1, i) &gt; ValArray(1, j) Then
                Temp1 = ValArray(1, j)
                Temp2 = ValArray(2, j)
                ValArray(1, j) = ValArray(1, i)
                ValArray(2, j) = ValArray(2, i)
                ValArray(1, i) = Temp1
                ValArray(2, i) = Temp2
            End If
        Next j
    Next i

&#39;   Put the randomized values into the V array&#39;
    i = 0
    For r = 1 To RCount
        For c = 1 To CCount
            i = i + 1
            V(r, c) = ValArray(2, i)
        Next c
    Next r
    RANGERANDOMIZE = V
End Function
&#39;上述代码与RANDOMINTEFERS函数代码非常类似，使用该函数作为数组公式(按Ctrl+Shift+Enter键)。&#39;
=｛RANGERANDOMIZE(A2:A11)｝ &#39;该函数随机返回单元格A2:A11中的内容&#39;</code></pre>
<p><strong>对单元格区域进行排序</strong></p>
<p>SORTED函数接收一个单列单元格区域参数，并返回排序的单元格区域。</p>
<pre><code class="vb">Function SORTED(Rng)
    Dim SortedData() As Variant
    Dim Cell As Range
    Dim Temp As Variant, i As Long, j As Long
    Dim NonEmpty As Long

&#39;   Transfer data to SortedData&#39;
    For Each Cell In Rng
        If Not IsEmpty(Cell) Then
            NonEmpty = NonEmpty + 1
            ReDim Preserve SortedData(1 To NonEmpty)
            SortedData(NonEmpty) = Cell.Value
        End If
    Next Cell

&#39;   Sort the array&#39;
    For i = 1 To NonEmpty
        For j = i + 1 To NonEmpty
            If SortedData(i) &gt; SortedData(j) Then
                Temp = SortedData(j)
                SortedData(j) = SortedData(i)
                SortedData(i) = Temp
            End If
        Next j
    Next i

&#39;   Transpose the array and return it&#39;
    SORTED = Application.Transpose(SortedData)
End Function
&#39;将SORTED函数作为数组公式(按Ctrl+Shift+Enter键)。Sorted函数返回排过序的数组内容。&#39;
&#39;SORTED函数首先创建一个名为SortedData的数组。这个数组包括参数单元格区域中的所有非空值。接着，数组使用冒泡排序算法进行排序，由于该书组是一个一维水平数组，所以必须在函数返回之前转置它。&#39;
&#39;SORTED函数可用于任意大小的单元格区域，只要它在单行或单列中。如果非排序的数据在一行中，那么公式需要使用Excel的TRANSPOSE函数水平显示排序的数据。例如：=TRABSPOSE(SORTED(A1:L16))&#39;</code></pre>
<p>注：以上源代码可以在<a href="http://www.tupwk.com.cn/index.asp" target="_blank" rel="noopener">清华大学出版社–第五事业部</a>下载。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">VBA</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/04/21/21天VBA学习计划--基础知识篇/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Scrapy爬虫基础" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/22/Scrapy爬虫基础/">Scrapy爬虫基础篇</a>
    </h1>
  

        
        <a href="/2018/03/22/Scrapy爬虫基础/" class="archive-article-date">
  	<time datetime="2018-03-21T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-03-22</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="爬虫与Scrapy初识"><a href="#爬虫与Scrapy初识" class="headerlink" title="爬虫与Scrapy初识"></a>爬虫与Scrapy初识</h1><h2 id="何谓爬虫"><a href="#何谓爬虫" class="headerlink" title="何谓爬虫"></a>何谓爬虫</h2><p>网络爬虫，顾名思义，是指在互联网上自动爬取网站信息的程序，又被称为网络蜘蛛或网络机器人。</p>
<p>爬虫步骤：</p>
<ul>
<li>根据网页URL下载网页</li>
<li>提取HTML中的目标信息，存储到数据库中</li>
<li>爬取页面中的URL</li>
</ul>
<h2 id="何谓Scrapy"><a href="#何谓Scrapy" class="headerlink" title="何谓Scrapy"></a>何谓Scrapy</h2><p>Scrapy 是 Python环境下的一个开源网络爬虫框架，详情可见 <a href="https://doc.scrapy.org/en/latest/index.html" target="_blank" rel="noopener">官方文档</a>   </p>
<p>在Anaconda环境下的基本命令，打开Anaconda prompt，以下为安装命令：</p>
<pre><code class="python">conda install scrapy #安装scrapy
scrapy.version_info #查看版本</code></pre>
<p>创建项目</p>
<pre><code class="python">scrapy startproject example #创建example项目
tree example #查看项目目录文件</code></pre>
<p>会生成</p>
<pre><code class="python">project/
    scrapy.cfg        #项目的配置文件
    modules/          #该项目的python模块,之后您将在此加入代码
        __init__.py
        items.py      #项目中的item文件
        pipelines.py  #项目中的pipelines文件
        settings.py   #项目的设置文件
        spiders/      #放置spider代码的目录
            __init__.py
</code></pre>
<h2 id="Scrapy架构概览"><a href="#Scrapy架构概览" class="headerlink" title="Scrapy架构概览"></a>Scrapy架构概览</h2><p><img src="http://scrapy-chs.readthedocs.io/zh_CN/latest/_images/scrapy_architecture.png" alt="Architecture overview"></p>
<p>下表为Scrapy组件及其描述：</p>
<table>
<thead>
<tr>
<th align="center">组件</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Scrapy  Engine</td>
<td align="left">引擎负责控制数据流在系统中所有组件中流动，并在相应动作发生时触发事件。 详细内容查看下面的数据流(Data Flow)部分。</td>
</tr>
<tr>
<td align="center">调度器(Scheduler)</td>
<td align="left">调度器从引擎接受request并将他们入队，以便之后引擎请求他们时提供给引擎。</td>
</tr>
<tr>
<td align="center">下载器(Downloader)</td>
<td align="left">下载器负责获取页面数据并提供给引擎，而后提供给spider。</td>
</tr>
<tr>
<td align="center">Spiders</td>
<td align="left">Spider是Scrapy用户编写用于分析response并提取item(即获取到的item)或额外跟进的URL的类。 每个spider负责处理一个特定(或一些)网站。 更多内容请看 <a href="http://scrapy-chs.readthedocs.io/zh_CN/latest/topics/spiders.html#topics-spiders" target="_blank" rel="noopener">Spiders</a> 。</td>
</tr>
<tr>
<td align="center">Item Pipeline</td>
<td align="left">Item Pipeline负责处理被spider提取出来的item。典型的处理有清理、 验证及持久化(例如存取到数据库中)。</td>
</tr>
</tbody></table>
<p>运作原理：</p>
<ul>
<li>Spider爬取URL上数据时，使用该URL构造Request提交给Scheduler</li>
<li>Scheduler运算Request对象并传给Downloader</li>
<li>Downloader根据Request对象中的地址向HTTP网站服务器发送请求，服务器返回Response对象</li>
<li>Response对象被送给SPIDER页面解析函数进行处理，页面解析函数提取数据并封装成Item提交给ENGINE，之后被送往ITEM　PIPLINE进行处理，最后由EXPORTER以某种数据写入文件。　　</li>
</ul>
<p>简而言之，爬虫爬取数据的步骤为：提取数据、封装数据、处理数据、导出数据。</p>
<h1 id="提取数据"><a href="#提取数据" class="headerlink" title="提取数据"></a>提取数据</h1><p>从URL上提取数据的核心技术是HTTP文本解析，Python中常用BeautifulSoup和lxml模块处理此类问题。提取数据要先创建对象，选中数据，然后再进行数据提取。</p>
<h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><h3 id="Selector创建对象"><a href="#Selector创建对象" class="headerlink" title="Selector创建对象"></a>Selector创建对象</h3><p>Selector类的实现位于scrapy.selector模块，创建Selector对象时，可将页面的HTML文档字符串传递给Selector构造器方法的text参数：</p>
<p>Scrapy综合以上量点实现了Selector类，它是基于lxml库构建的，并简化了API借口。在Scrapy中使用Selector对象提取页面数据时，使用时先通过XPath或CSS选择器选中页面中要提取的数据，然后进行提取：</p>
<p>text:</p>
<pre><code class="python">from scrapy.selector import Selector
text=&quot;&quot;&quot;
&lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;This is  heading1&lt;/h1&gt;
        &lt;h2&gt;This is  heading2&lt;/h2&gt;
        &lt;h3&gt;This is  heading3&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;Coffee&lt;/li&gt;
            &lt;li&gt;Milk&lt;/li&gt;
            &lt;li&gt;Tea&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;
selector = Selector(text=text)
print selector</code></pre>
<h3 id="Response构建对象"><a href="#Response构建对象" class="headerlink" title="Response构建对象"></a>Response构建对象</h3><p>也可以使用Response对象构造Selector对象，将其传递为Selector构造器方法的response参数:</p>
<pre><code class="markdown">from scrapy.selector import Selector
from scrapy.http import HtmlResponse
response = HtmlResponse(url=&#39;http://www.example.com&#39;,body=text,encoding=&#39;utf8&#39;)
selector = Selector(response=response)
print selector</code></pre>
<p>实际使用中，几乎不用手动创建对象，在第一次访问一个Response对象的selector属性时，Response对象内部会以自身为参数自动创建Selector对象，并将该Selector对象缓存，以便下次使用：</p>
<pre><code class="python\">from scrapy.http import HtmlResponse
response = HtmlResponse(url=&#39;http://www.example.com&#39;,body=text,encoding=&#39;utf8&#39;)
print response.selector # 直接使用Response对象的内置Selector</code></pre>
<p><strong>Response对象</strong>介绍</p>
<p>Response对象用来描述一个HTTP响应，在爬取网页时，通常其内容是HTML文本，创建的是HtmlResponse。Response是一个基类，另外有TextResponse、HtmlResponse、XmlResponse三个子类。</p>
<p>HtmlResponse属性及方法：</p>
<pre><code class="python">class HtmlResponse(scrapy.http.response.text.TextResponse):
follow(self, url, callback=None, method=&#39;GET&#39;, headers=None, body=None, cook=None, meta=None, encoding=None, priority=0, dont_filter=False, errback=None)</code></pre>
<p>主要方法：</p>
<ul>
<li>css(self, query)</li>
<li>urljoin(self, url):Join this Response’s url with a possible relative url to form an absolute interpretation of the latter.</li>
<li>xpath(self, query, **kwargs)</li>
</ul>
<h2 id="选中数据"><a href="#选中数据" class="headerlink" title="选中数据"></a>选中数据</h2><p>调用Selector对象的xpath或css方法，返回一个Selectorlist对象，选择文档中某些部分:</p>
<pre><code class="python">selector_list = selector.xpath(&#39;.//h1&#39;)  # 选中文档中所有&lt;h1&gt;
print selector_list # 输出格式为列表
for sel in selector_list: # 迭代访问
    print(sel.xpath(&#39;./text()&#39;))</code></pre>
<p>SelectorList对象也有xpath和css方法，调用他们的行为是：以接收到的参数分别调用其中每一个Selector对象的path或css方法，并将所有结果收集到一个新的SelectorList对象返回给用户。</p>
<pre><code class="python">selector_list.xpath(&#39;./text()&#39;)
selector.xpath(&#39;.//ul&#39;).css(&#39;li&#39;).xpath(&#39;./text()&#39;)</code></pre>
<h3 id="Xpath选中数据"><a href="#Xpath选中数据" class="headerlink" title="Xpath选中数据"></a>Xpath选中数据</h3><p>关于Xpath基本语法可以参考<a href="http://www.w3school.com.cn/xpath/index.asp" target="_blank" rel="noopener">W3 School Xpath教程</a></p>
<pre><code class="python">from scrapy.selector import Selector
from scrapy.http import HtmlResponse
body=&quot;&quot;&quot;
&lt;html&gt;
    &lt;head&gt;
        &lt;base href=&#39;http://example.com/&#39;/&gt;
        &lt;title&gt;Example website&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&#39;images&#39;&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 1 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 2 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;            
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 3 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 4 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 5 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
        &lt;/div&gt;
     &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;
response=HtmlResponse(url=&#39;http://www.example.com&#39;,body=body,encoding=&#39;utf8&#39;)
response.xpath(&#39;/html&#39;) # 描述一个从根开始的绝对路径
response.xpath(&#39;/html/head&#39;) # z注释同上
response.xpath(&#39;/html/body/div/a&#39;) # E1/E2选中E1子节点中所有的E2
response.xpath(&#39;//a&#39;)# //E:选中文档中所有a
response.xpath(&#39;/html/body//img&#39;)#E1//E2:选中E1后代节点中所有的E2
response.xpath(&#39;//a/text()&#39;) #E/text():选中文档中所有的a的文本
response.xpath(&#39;/html/*&#39;) #E/*:选中E所有元素子节点
response.xpath(&#39;/html/body/div//*&#39;)#选中div所有后代节点
response.xpath(&#39;//div/*/img&#39;) #*/E:选中孙节点中的所有E
response.xpath(&#39;//img/@src&#39;)#E/@ARAR：选中E的所有ATTR属性
response.xpath(&#39;//@href&#39;) #//@ATTR:选中文档中所有的ATTR属性
response.xpath(&#39;//a[1]/img/@*&#39;) #E/@*:选中E的所有属性
response.xpath(&#39;//img/..&#39;)# ..:选中当前节点的父节点，用来描述相对路径
response.xpath(&#39;//a[3]&#39;) #选中a中第三个
response.xpath(&#39;//a[last()]&#39;)
response.xpath(&#39;//a[position&lt;=3]&#39;)
response.xpath(&#39;//div[@id]&#39;) #选中所有含有id属性的div
response.xpath(&#39;//div[@id=&#39;images&#39;]&#39;)</code></pre>
<h3 id="CSS选择器选中数据"><a href="#CSS选择器选中数据" class="headerlink" title="CSS选择器选中数据"></a>CSS选择器选中数据</h3><p>关于CSS的基本语法可以参考<a href="http://www.w3school.com.cn/css/index.asp" target="_blank" rel="noopener">W3 School CSS教程</a>和<a href="https://www.w3.org/TR/selectors-3/" target="_blank" rel="noopener">相关文档</a></p>
<pre><code class="python">from scrapy.selector import Selector
from scrapy.http import HtmlResponse
body=&quot;&quot;&quot;
&lt;html&gt;
    &lt;head&gt;
        &lt;base href=&#39;http://example.com/&#39;/&gt;
        &lt;title&gt;Example website&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div id=&#39;images&#39; atyle=&#39;width:1230px:,&#39;&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 1 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 2 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;            
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 3 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 4 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
            &lt;a href=&#39;images&#39;.html&gt;Name:Image 5 &lt;br/&gt;&lt;img src=&#39;image1.jpg&#39;/&gt;&lt;/a&gt;
        &lt;/div&gt;
     &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;
response=HtmlResponse(url=&#39;http://www.example.com&#39;,body=body,encoding=&#39;utf8&#39;)
response.css(&#39;img&#39;) # 选中所有的img元素
response.css(&#39;base,title&#39;) # 选中所有的base和title
response.css(&#39;div img&#39;) # E1 E2:选中E1后代元素中所有的E2元素
response.css(&#39;body&gt;div&#39;)# 选中body子元素中的div
response.css(&#39;[style]]&#39;)# 选中包含所有style属性的元素
response.css(&#39;[id=images-1]&#39;) #选中属性id值为images-1的元素
response.css(&#39;div&gt;a:nth-child(1)&#39;) #E:nth-child(n):选中E元素,且该元素必须是其父元素的第n个子元素，选中div的第一个a
response.css(&#39;div:nth-child(2)&gt;a:nth-child(1)&#39;)#选中第二个div的第一个a
response.css(&#39;div:first-child&gt;a:last-child&#39;) #E:first-child，选中E元素且该元素是其父元素的第一个子元素，#选中第一个div的最后一个a
response.css(&#39;a::text&#39;)#E::text:选中E元素的文本节点</code></pre>
<h2 id="提取数据-1"><a href="#提取数据-1" class="headerlink" title="提取数据"></a>提取数据</h2><h3 id="Selector提取数据"><a href="#Selector提取数据" class="headerlink" title="Selector提取数据"></a>Selector提取数据</h3><p>调用Selector或Selectorlist对象的以下方法可将选中的内容提取：</p>
<pre><code class="python"># Selector的extract()方法
s1 = selector.xpath(&#39;.//li&#39;)   
print s1
s1[0].extract()
s1 = selector.xpath(&#39;.//li/text()&#39;)
print s1
s1[1].extract()
# Selector/SelectorList的re()方法,另外SelectorList有re_first()
s1 = selector.xpath(&#39;.//li/text()&#39;).re(&#39;正则&#39;) 
# SelectorList的extract()方法，若用extract_first(),则返回列表中第一个Selector对象调用extract方法的结果
s1 = selector.xpath(&#39;.//li/text()&#39;) 
print s1
s1.extract() # 提取对象为列表，返回列表</code></pre>
<p>实际使用中，为方便用户使用，Response对象还提供了xpath和css方法，它们在内部分别调用Selector的xpath和css方法。</p>
<pre><code class="python">response.xpath{&#39;.//h1/text()&#39;}
response.css(&#39;li::text&#39;).extract() # 注意css与xpath语法区别</code></pre>
<h3 id="LinkExtractor提取链接"><a href="#LinkExtractor提取链接" class="headerlink" title="LinkExtractor提取链接"></a>LinkExtractor提取链接</h3><p>Scrapy提供了一个专门提取链接的类LinkExtractor，在提取大量链接或者是链接比较复杂时，更加方便。</p>
<pre><code class="python">from scrapy.linkextractors import LinkExtractor
le = LinkExtractor()  # 如果不传递任何参数，则提取页面的所有链接
links = le.extract_links(responsel)
------------------------------------------------------
pattern = &#39;/intro/.+\.html$&#39; 
le = Linkextractor(allow=pattern) #allow接收正则表达式，提取绝对url与正则表达式匹配的链接，若是该参数为空，则提取全部链接
# le = Linkextractor(deny=pattern) #与allow相反，排除url与正则表达式匹配的链接
links = le.extract_links(responsel)
------------------------------------------------------
domains=[&#39;github.com&#39;,&#39;stackoverflow.com&#39;]
le = LinkExtractors(allow_domains=domains) # allow_domains接收一个指定的域名或列表，提取到指定域的链接
# deny_domains,与allow相反
links = le.extract_links(responsel)
------------------------------------------------------
le = LinkExtractor(restrict_xpaths=&#39;//div[@id=&quot;top&quot;]&#39;) #restrict_xpaths接收一个XPath表达式或表达式列表，提取选中区域下的链接
# le = LinkExtractor(restrict_css=&#39;div#id=&#39;bottom&#39;) #restrict_css接收css选择器...
links = le.extract_links(responsel)
------------------------------------------------------
le = LinkExtractor(tags=&#39;script&#39;,attr=&#39;src&#39;) # tags接收一个标签或一个标签列表，提取指定标签内的链接，默认为[&#39;a&#39;,&#39;area&#39;];attr接收一个属性或是属性列表，提取属性内的指定链接，默认为&#39;href&#39;
links = le.extract_links(responsel)
------------------------------------------------------
process_value:接收一个回调函数</code></pre>
<h1 id="封装和处理数据"><a href="#封装和处理数据" class="headerlink" title="封装和处理数据"></a>封装和处理数据</h1><h2 id="封装数据"><a href="#封装数据" class="headerlink" title="封装数据"></a>封装数据</h2><p> Scrapy提取数据后，需要将这些零散的数据进行封装，便于处理和传递。</p>
<h3 id="Item和Field"><a href="#Item和Field" class="headerlink" title="Item和Field"></a>Item和Field</h3><p>Scrapy提供了以下两个类，用户可以使用它们自定义数据类，封装爬取到的数据：</p>
<ul>
<li>Item基类：自定义数据的基类，如BookItem</li>
<li>Field类：用来描述自定义数据类包含哪些字段（如name、price）</li>
</ul>
<p>自定义数据类只需继承Item，并创建一系列Field对象的类属性。以定义书籍信息BookItem为例，它包含了两个字段，分别为书的名字name和书的价格price，代码如下：</p>
<pre><code class="python">from scripy import Item,Field
class BookItem(Item):
    name = Field()
    price = Field()</code></pre>
<p>Item支持字典对象，因此BookItem在使用上和Python字典类似，可以按以下方式创建BookItem对象：</p>
<pre><code class="python">book1 = BookItem(name=&#39;Python&#39;,price=40)
book2 = BookItem()
book2[&#39;name&#39;] = &#39;Life of Pi&#39;
book2[&#39;price&#39;] = 30
book1[&#39;name&#39;]
list(book1.items())</code></pre>
<p>有些时候我们需要根据自己的自定义数据类（Item子类）进行扩展。例如在example项目中有添加了一个新的Spider，它负责在另外的网站爬取国外书脊的数据，此类数据比之前多了一个译者字段，此时可以继承BookItem定义的一个ForeignBookItem类，在其中添加一个一折字段，代码如下：</p>
<pre><code class="python">class ForignBookItem(BookItem):
    translator = Field()
book2[&#39;name&#39;] = &#39;Life of Pi&#39;
book2[&#39;price&#39;] = 30
book2[&#39;translator&#39;] = &#39;某某某&#39;</code></pre>
<h3 id="Field元数据"><a href="#Field元数据" class="headerlink" title="Field元数据"></a>Field元数据</h3><p>一项数据由Spider提交给Scrapy引擎后，可能会被递送给其他组件（Item Pipline、Exporter）处理。假设想传递额外信息给处理数据的某个组件（例如，告诉该组件应以怎样的方式处理数据），此时可以使用Field的元数据。</p>
<pre><code class="python">class ExampleItem(Item):
    x = Field{a=&#39;hello&#39;,b=[1,2,3]) #x包含两个元数据，字符串和列表
    y = Field(a=lambdax:x**2) # y有一个元数据，为函数</code></pre>
<p>访问ExampleItem对象的fields属性，将得到一个包含所有Field对象的字典。</p>
<pre><code class="python">class BookItem(Item):
    authors = Field(serializer=lambda x:&#39;|&#39;.join(x))
# 元数据的键是serializer是CsvItemExporter规定好的，它会用该键获取元数据，即一个串行化函数的对象，并使用这个串行化函数将authors字段串行化成一个字符串。</code></pre>
<h2 id="处理数据"><a href="#处理数据" class="headerlink" title="处理数据"></a>处理数据</h2><p><strong>Item Pipline</strong></p>
<p>在Scrapy中，Item是处理数据的组件，一个Item Pipline就是一个包含特定接口的类，通常只负责一种功能的数据处理，在一个项目中可以同时启用多个Item Pipline，它们按指定次序级联立起来，形成一条数据流水线。</p>
<h3 id="清洗数据"><a href="#清洗数据" class="headerlink" title="清洗数据"></a>清洗数据</h3><p>在创建一个Scrapy项目时，会自动生成一个piplines.py,它用来放置用户自定义的Item Pipline，在example项目的piplines.py中实现:</p>
<pre><code class="python">class ToscrapeBookPipeline(object):
    #exchange_rate= 8
    def process_item(self, item, spider): 
        # price =  flaot(item[&#39;price&#39;][1:])*self.exchange_rate
        #item[&#39;price&#39;]=￥%.2f%price        
        return item </code></pre>
<p>一个Item Pipline必须实现一个process(item,spider)方法，不用继承特定的类,item是指爬取到的数据，spider指爬取到数据的Spider对象。Item Pipline常用方法：</p>
<ul>
<li>process_item(item,spider):处理某项item时返回一项数据，拖过在处理某项item时会抛出(raise)一个DropItem异常(scrapy.exception.DropItem),该项item便会被抛弃，不再递送给后面的Item Pipline 继续处理，也不会导出到文件。通常，我们在检测到无效的数据或想要过滤掉的数据时会抛出异常。</li>
<li>open_spider(self,spider):Spider打开时（处理数据前）回调该方法，通常该方法用于在开始处理数据之前完成某些初始化的工作，如连接数据可等。</li>
<li>close(self,spider):Spider关闭时（处理数据后）回调该方法，通常该方法用于在处理完所有数据之后完成某些清理工作，如关闭数据库。</li>
<li>from_crawler(cls,crawler):创建Item Pipline对象回调该类方法。通常，在该方法中通过crawler.settings读取配置，根据配置创建Item Pipline对象。</li>
</ul>
<p>在Scrapy中，Item Pipline是可选组件，想要启用某个（或某些）Item Popline，需要在配置文件settings.py进行配置：</p>
<pre><code class="python">ITEM_PIPELINES = {
    &#39;toscrape_book.pipelines.ToscrapeBookPipeline&#39;: 300,
}</code></pre>
<h3 id="数据去重"><a href="#数据去重" class="headerlink" title="数据去重"></a>数据去重</h3><p>为了确保爬取的书籍信息中没有重复项，可以实现一个去重Item Pipline：</p>
<pre><code class="python">from scrapy.exceptions import Dropline
class DuplicatesPipline(object):
    def _init_(self):
        self.book_set = set()
    det process_item(self,item,spider):
        name = item[&#39;name&#39;]
        if name in self.book_set:
            raise DropItem(&quot;Duplicate book found:%s&quot;%item)

        self.book_set.add(name)
        return item #先取出item的name字段，检查书名是否已在集合book_set中，如果存在，就是重复数据，抛出DropItem，将Item抛弃；否则，将item的name字段存入集合，返回item</code></pre>
<p>然后在配置文件settings.py中启用DuplicatesPipline:</p>
<pre><code class="python">ITEM_PIPELINES = {
    &#39;toscrape_book.pipelines.ToscrapeBookPipeline&#39;: 300,
    &#39;toscrape_book.pipelines.DuplicatesPipeline&#39;: 350,
}</code></pre>
<h3 id="将数据存入MongoDB"><a href="#将数据存入MongoDB" class="headerlink" title="将数据存入MongoDB"></a>将数据存入MongoDB</h3><p>如果想把数据存入某种数据库中，可以实现Item Pipline完成此类任务。下面为将数据存入MongoDB数据库的Item Pipline:</p>
<pre><code class="python">from scrapy.item import Item
import pymongo
class MongoDBPipline(object):
    #在类属性中定义两个常量，DB_URI:数据库的URI地址，DB_NAME:数据库的名字
    DB_URI = &#39;mongodb://localhost:27017/&#39;
    DB_NAME = &#39;scrapy_data&#39;
    #在整个爬取过程中，数据库的关闭和连接只进行一次，应在开始之前连接数据库，并在处理完所有数据之后关闭数据。
    def open_spider(self,spider):
        self.client = pymongo.MongoClient(self.DB_URI)
        self.db = self.client[self.DB_URI]

    def close_spider(self,spider):
        self.client.close()
    #在process_iten中实现MongoDB数据库的写入操作，使用self.db和spider.name获取一个集合(collection)然后将数据插入该集合，集合对象的insert_one方法需要传入一个字典对象（不能传入Item对象），因此在调用前先对item的类型进行判断，如果item是Item对象，就将其转化为字典。
    def process_item(self,item,spider):
        collection = self.db[spider.name]
        post= dict(item) if isinstance(item,Item) else item
        collection.insert_one(post)
        return item</code></pre>
<p>接下来测试MongoDBPipline，将配置文件settings.py中启用MongoDBPipline:</p>
<pre><code class="python">ITEM_PIPELINES = {    &#39;toscrape_book.pipelines.ToscrapeBookPipeline&#39;: 300,    &#39;toscrape_book.pipelines.MongoDBPipeline&#39;: 400,
 }</code></pre>
<h1 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h1><p>在Scrapy中，导出数据需要用Exporter（导出器），Scrapy内部实现了多个Exporter，每个Exporter实现一种数据格式的导出，支持数据格式有：</p>
<ol>
<li>JSON（JsonItemExporter）</li>
<li>JSON lines（JsonLinesItemExporter）</li>
<li>CSV（CsvItemExporter）</li>
<li>XML(XmlItemExporter)</li>
<li>Pickle（PickleItemExporter）</li>
<li>Marshal（MarshalItemExporter）</li>
</ol>
<p>在导出数据时，需向Scrapy爬虫提供：文件导出格式(即选用哪个Exporter)及导出路径。可以通过两种方式指定爬虫如何导出数据：命令行参数指定和配置文件指定。</p>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>在运行scrapy crawl命令式时，可以分别使用-o和-t参数指定导出文件路径以及导出数据格式。</p>
<pre><code class="python">scrapy crawl books -t csv -o books1.data
scrapy crawl books -t json -o books1.data
scrapy crawl books -t xml -o books1.data</code></pre>
<p>运行以上命令后，scrapy爬虫会以-t参数中的数据格式字符串（如csv、json、xml）为键，在配置字典FEED_EXPORTERS中搜索Exporter,FEED_EXPORTERS的内容由两个字典的内容合并而成：默认配置文件中的FEED_EXPORTERS_BASE，用户配置文件中的FEED_EXPORTERS。其中内核包含内部支持的导出数据格式，后者包含用户自定义的导出数据格式。如果用户添加了新的导出数据格式（即实现了新的Exporter），可在配置文件settings.py中定义FEED_EXPORTERS，例如：</p>
<blockquote>
<p>Feed_Exporters = {‘excel’:’my_project.my_exporters.ExcelItemExporter’}</p>
</blockquote>
<p>另外，指定文件到处路径时，还可以使用%(name)s和%(time)s两个特殊变量：</p>
<p>%(name)s：会被替换为Spider的名字，%(time)s:会被替换为文件创建时间。</p>
<blockquote>
<p>scrapy crawl books -o ‘exporter_data/%(name)s/%(time)s.csv’</p>
</blockquote>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>在配置文件中导出数据：</p>
<pre><code class="python">FEED_URI=&#39;export_data/%(name)s.data&#39; # 导出文件路径
FEED_FORMAT=&#39;csv&#39; # 导出数据格式
FEED_EXPORT_ENCODING=&#39;gbk&#39; # 导出文件编码(默认为json编码，其他为utf-8编码)
FEED_EXPORT_FIELDS=[&#39;name&#39;,&#39;author&#39;,&#39;price&#39;] #导出数据包含的字段（默认包含所有字段）
FEED_EXPORTERS={&#39;excel&#39;:&#39;my_project.my_exporters.ExcelItemExporter&#39;} # 用户自定义Exporter字典，添加新的导出数据格式时使用。</code></pre>
<h2 id="添加自定义导出数据格式"><a href="#添加自定义导出数据格式" class="headerlink" title="添加自定义导出数据格式"></a>添加自定义导出数据格式</h2><p>Scrapy内部的Exporter类在scrapy.exporters模块中实现，以下为其中的代码片段：</p>
<pre><code class="python">class BaseItemExporter(object):

    def __init__(self, **kwargs):
        self._configure(kwargs)

    def _configure(self, options, dont_fail=False):
        &quot;&quot;&quot;Configure the exporter by poping options from the ``options`` dict.
        If dont_fail is set, it won&#39;t raise an exception on unexpected options
        (useful for using with keyword arguments in subclasses constructors)
        &quot;&quot;&quot;
        self.encoding = options.pop(&#39;encoding&#39;, None)
        self.fields_to_export = options.pop(&#39;fields_to_export&#39;, None)
        self.export_empty_fields = options.pop(&#39;export_empty_fields&#39;, False)
        self.indent = options.pop(&#39;indent&#39;, None)
        if not dont_fail and options:
            raise TypeError(&quot;Unexpected options: %s&quot; % &#39;, &#39;.join(options.keys()))

    def export_item(self, item):
        raise NotImplementedError

    def serialize_field(self, field, name, value):
        serializer = field.get(&#39;serializer&#39;, lambda x: x)
        return serializer(value)

    def start_exporting(self):
        pass

    def finish_exporting(self):
        pass

    def _get_serialized_fields(self, item, default_value=None, include_empty=None):
        &quot;&quot;&quot;Return the fields to export as an iterable of tuples
        (name, serialized_value)
        &quot;&quot;&quot;
        if include_empty is None:
            include_empty = self.export_empty_fields
        if self.fields_to_export is None:
            if include_empty and not isinstance(item, dict):
                field_iter = six.iterkeys(item.fields)
            else:
                field_iter = six.iterkeys(item)
        else:
            if include_empty:
                field_iter = self.fields_to_export
            else:
                field_iter = (x for x in self.fields_to_export if x in item)

        for field_name in field_iter:
            if field_name in item:
                field = {} if isinstance(item, dict) else item.fields[field_name]
                value = self.serialize_field(field, field_name, item[field_name])
            else:
                value = default_value

            yield field_name, value

# json
class JsonItemExporter(BaseItemExporter):

    def __init__(self, file, **kwargs):
        self._configure(kwargs, dont_fail=True)
        self.file = file
        # there is a small difference between the behaviour or JsonItemExporter.indent
        # and ScrapyJSONEncoder.indent. ScrapyJSONEncoder.indent=None is needed to prevent
        # the addition of newlines everywhere
        json_indent = self.indent if self.indent is not None and self.indent &gt; 0 else None
        kwargs.setdefault(&#39;indent&#39;, json_indent)
        kwargs.setdefault(&#39;ensure_ascii&#39;, not self.encoding)
        self.encoder = ScrapyJSONEncoder(**kwargs)
        self.first_item = True

    def _beautify_newline(self):
        if self.indent is not None:
            self.file.write(b&#39;\n&#39;)

    def start_exporting(self):
        self.file.write(b&quot;[&quot;)
        self._beautify_newline()

    def finish_exporting(self):
        self._beautify_newline()
        self.file.write(b&quot;]&quot;)

    def export_item(self, item):
        if self.first_item:
            self.first_item = False
        else:
            self.file.write(b&#39;,&#39;)
            self._beautify_newline()
        itemdict = dict(self._get_serialized_fields(item))
        data = self.encoder.encode(itemdict)
        self.file.write(to_bytes(data, self.encoding))

# json lines
class JsonLinesItemExporter(BaseItemExporter):
    ...</code></pre>
<ul>
<li>rexport_item(self,item):负责导出爬取到的每一项数据，参数item为一项爬取到的数据，每个子类必须实现该方法。</li>
<li>start_exporting(self):在导出开始时被调用，可在该方法中执行某些初始化工作</li>
<li>finish_exporting(self):在到处完成时被调用，可在该方法中执行某些清理工作</li>
</ul>
<p>以JsonItemExporter为例：</p>
<ul>
<li>为了使最终的导出结果是一个json中的列表，在start_exporting和finish_exporting方法中分别向文件中写入b”[\n,b”\n]”。</li>
<li>在export_item方法中，调用self.encoder.encode方法将一项数据转换成json串，然后写入文件。</li>
</ul>
<p>参照以上源码，可以实现一个能将数据以Excel格式导出的Exporter。在项目中创建一个my_exporters.py（与settings.py同级目录），在其中实现ExcelItemExport:</p>
<pre><code class="python">from scrapy.exporters import BaseItemExporter
import xlwt # 使用第三方库xlwt将数据写入Excel文件
class ExcelItemExporter(BaseItemExporter):

    def __init__(self, file, **kwargs):
        self._configure(kwargs)
        self.file = file
        # 在构造器方法中创建Workbook对象和Worksheet对象，并初始化用           来记录写入行坐标的self.row
        self.wbook = xlwt.Workbook()
        self.wsheet = self.wbook.add_sheet(&#39;scrapy&#39;)
        self.row = 0

    # finish_exporting 方法在所有数据都被写入Excel表格后被调用，在       该方法中调用self.wbook.save方法将Excel表格写入Excel文件。
    def finish_exporting(self):
        self.wbook.save(self.file)

    # 在export_item方法中调用基类的_get_serialized_fields方法，获       得item所有字段的迭代器，然后调用self.wsheet.write方法将各自段       写入Excel表格。
    def export_item(self, item):
        fields = self._get_serialized_fields(item)
        for col,v in enumerate(x for _,x in fields):
            self.wsheet.write(self.row,col,v)
        self.row += 1</code></pre>
<p>完成ExcelItemExporter后，在配置文件settings.py中添加如下代码：</p>
<blockquote>
<p>FEED_EXPORTERS=｛’excel’:’example.my_exports.ExcelItemExporter’｝</p>
</blockquote>
<p>现在可以使用ExcelItemExporter导出数据了，以-t excel -o books.xls</p>
<blockquote>
<p>scrapy crawl books -t excel -o books.xls</p>
</blockquote>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">爬虫</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/03/22/Scrapy爬虫基础/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Markdown语法和Typora" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/18/Markdown语法和Typora/">Markdown语法和Typora</a>
    </h1>
  

        
        <a href="/2018/01/18/Markdown语法和Typora/" class="archive-article-date">
  	<time datetime="2018-01-17T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2018-01-18</time>
</a>
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="声明：以下内容来源于Typora客户端中的MarkDown-Reference。"><a href="#声明：以下内容来源于Typora客户端中的MarkDown-Reference。" class="headerlink" title="声明：以下内容来源于Typora客户端中的MarkDown Reference。"></a><strong>声明</strong>：以下内容来源于Typora客户端中的MarkDown Reference。</h2><h1 id="Markdown-For-Typora"><a href="#Markdown-For-Typora" class="headerlink" title="Markdown For Typora"></a>Markdown For Typora</h1><h2 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h2><p><strong>Markdown</strong>是由<a href="http://daringfireball.net/" target="_blank" rel="noopener">Daring Fireball</a>开发出来，参见最初的<a href="http://daringfireball.net/projects/markdown/syntax" target="_blank" rel="noopener">指导手册</a>。但是其语法在不同的解析器和编辑器上也存在差异。<strong>Typora</strong>使用[Github Flavored Markdown][GFM].</p>
<p>需要注意的是HTML片段在markdown源中能被识别但是不会被解析和呈现。另外，markdown原始源代码在保存之后或许会出现小的格式差异。</p>
<p><strong>大纲</strong></p>
<p>[TOC]</p>
<h2 id="区块元素"><a href="#区块元素" class="headerlink" title="区块元素"></a>区块元素</h2><h3 id="段落和换行"><a href="#段落和换行" class="headerlink" title="段落和换行"></a>段落和换行</h3><p>一个 Markdown 段落是由一个或多个连续的文本行组成，它的前后要有一个以上的空行。在Typora中，你只需要按下<code>Return</code>键即可生成新的段落。</p>
<p><code>Shift</code>+<code>Return</code>组合键可以实现换行，但是大多数markdown解析器会忽略换行符。如果你想其他的markdown解析器识别对你的换行符，可以在行末按两个空格键或是插<code>&lt;be/&gt;</code>。</p>
<h3 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h3><p>标题在行的开头使用1-6个哈希字符，分别对应1-6级标题。例如：</p>
<pre><code class="markdown">#This is an H1
##This is an H2
#####This is an H6</code></pre>
<p>在Typroa中，可在若干个’#’键后输入标题内容，然后按<code>Return</code>键以创建标题。</p>
<h3 id="区块引用"><a href="#区块引用" class="headerlink" title="区块引用"></a>区块引用</h3><p>Markdown使用email形式&gt;字符来进行区块引用，展示如下：</p>
<pre><code class="markdown">&gt; This is a blockquote with two paragraphs. This is first paragraph.
&gt;
&gt; This is second pragraph.Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
&gt; This is another blockquote with one paragraph. There is three empty line to seperate two blockquote.</code></pre>
<p>在Typroa中，输入’&gt;’在其后引用内容即可生成引用区块，并为您插入适当的’&gt;’或是行符。区块引用可以嵌套，如果想内置新的引用区块，可以添加额外的’&gt;’来实现。</p>
<p>###列表</p>
<p>输入<code>*列表1</code>可以生成无序列表，’*’可以用’+’或是’-‘替代。</p>
<p>输入<code>1.列表1</code>会生成有序列表，markdown代码如下：</p>
<pre><code class="markdown">##无序列表
*   Red
*   Green
*   Blue
##有序列表
1.  Red
2.  Green
3.  Blue</code></pre>
<h3 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a>任务列表</h3><p>任务列表是用[]或是[x]标记项目（完成或未完成）的列表，例如：</p>
<pre><code class="markdown">- [ ] 任务列表项
- [ ] 列表需求语法
- [ ] 正常 ** 格式 **, @mentions,
- [ ] 未完成
- [x] 已完成</code></pre>
<p>通过单击前面的复选框可以改变完成或未完成状态。</p>
<h3 id="Fenced-代码区块"><a href="#Fenced-代码区块" class="headerlink" title="(Fenced)代码区块"></a>(Fenced)代码区块</h3><p>Typroa仅支持Github Flavored Markdown中的fences,并不支持markdown中原始的代码区块。</p>
<p>使用fences很简单：输入```并按<code>Return</code>键。在```后可以添加可选语言标识符，输入以下语法进行强调：</p>
<pre><code class="gfm">Here&#39;s as example
```
function test() {
  console.log(&quot;notice the blank line before this function?&quot;);
}
```
语法突出显示：
```ruby
require &#39;redcarpet&#39;
markdown = Redcarpet.new(&quot;Hello World!&quot;)
puts markdown.to_html
```</code></pre>
<h3 id="数学区块"><a href="#数学区块" class="headerlink" title="数学区块"></a>数学区块</h3><p>可以使用<strong>MathJax</strong>来引用<em>LaTex</em>中的数学表达式。</p>
<p>输入<code>$$</code>然后按<code>Return</code>键会触发接收<em>Tex/Latex</em>源的输入区段。示例如下：<br>$$<br>\mathbf{V}_1 \times \mathbf{V}_2 =  \begin{vmatrix}<br>\mathbf{i} &amp; \mathbf{j} &amp; \mathbf{k} \<br>\frac{\partial X}{\partial u} &amp;  \frac{\partial Y}{\partial u} &amp; 0 \<br>\frac{\partial X}{\partial v} &amp;  \frac{\partial Y}{\partial v} &amp; 0 \<br>\end{vmatrix}<br>$$<br>在markdown源文件中，数学区块是用<code>$$</code>包裹的<em>LaTex</em>语法：</p>
<pre><code class="markdown">$$
\mathbf{V}_1 \times \mathbf{V}_2 =  \begin{vmatrix} 
\mathbf{i} &amp; \mathbf{j} &amp; \mathbf{k} \\
\frac{\partial X}{\partial u} &amp;  \frac{\partial Y}{\partial u} &amp; 0 \\
\frac{\partial X}{\partial v} &amp;  \frac{\partial Y}{\partial v} &amp; 0 \\
\end{vmatrix}
$$</code></pre>
<h3 id="表"><a href="#表" class="headerlink" title="表"></a>表</h3><p>输入<code>|一级标题 |二级标题 |</code>后按<code>Return</code>键就能创建一个两列的表格。</p>
<p>表格创建后，将光标放于该焦点上将会弹出一个工具栏，可以用于调整、对齐和删除表格。还可以使用上下文菜单来复制、增加或删除表格的行或列。</p>
<p>下面的描述可以跳过，因为markdown中关于表格的源代码可以在typora中自动生成。</p>
<p>markdown源代码中展示如下：</p>
<pre><code class="markdown">| 一级标题 | 二级标题 |
| ------- | ------ |
| 表格内容1| 表格内容2|</code></pre>
<p>你也可以内置markdown例如链接、粗体、意大利体或者是。</p>
<p>最后，通过包含colons:</p>
<pre><code class="markdown">| Left-Aligned  | Center Aligned  | Right Aligned |
| :------------ |:---------------:| -----:|
| col 3 is      | some wordy text | $1600 |
| col 2 is      | centered        |   $12 |
| zebra stripes | are neat        |    $1 |</code></pre>
<h3 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h3><pre><code class="markdown">可以用[^footnoe]形式来创建脚注。
[^footnote]: 这是一段**脚注** *文本*。</code></pre>
<p>会生成：</p>
<p>可以用[^footnoe]形式来创建脚注。</p>
<p>[^footnote]: 这是一段<strong>脚注</strong> <em>文本</em> 。</p>
<p>鼠标放在”footnote”上可以查看脚注的内容。</p>
<h3 id="水平线"><a href="#水平线" class="headerlink" title="水平线"></a>水平线</h3><p>在空行上输入<code>***</code>或是<code>---</code>然后按<code>Return</code>即可生成水平线。</p>
<hr>
<h3 id="YAML-Front-Matter"><a href="#YAML-Front-Matter" class="headerlink" title="YAML Front Matter"></a>YAML Front Matter</h3><p>Typora现在支持<a href="http://jekyllrb.com/docs/frontmatter" target="_blank" rel="noopener">YAML FRONT MATTER  </a>。在文章头部输入<code>---</code>然后按<code>Enter</code>即可生成。也可以从菜单上插入metedata block。</p>
<h3 id="内容目录-TOC"><a href="#内容目录-TOC" class="headerlink" title="内容目录(TOC)"></a>内容目录(TOC)</h3><p>输入<code>TOC</code>并按<code>Enter</code>键会创建内容目录用以提取书写内容的所有标题，目录会自动更新。</p>
<h3 id="图表（顺序图，流程图，鱼线图）"><a href="#图表（顺序图，流程图，鱼线图）" class="headerlink" title="图表（顺序图，流程图，鱼线图）"></a>图表（顺序图，流程图，鱼线图）</h3><p>Typora支持<a href="https://bramp.github.io/js-sequence-diagrams/]" target="_blank" rel="noopener">顺序图</a>、<a href="http://flowchart.js.org/" target="_blank" rel="noopener">流程图</a> 和<a href="https://knsv.github.io/mermaid/#mermaid" target="_blank" rel="noopener">鱼线图</a>。</p>
<p>详细请参考<a href="http://support.typora.io/Draw-Diagrams-With-Markdown/" target="_blank" rel="noopener">文档</a></p>
<h2 id="Span元素"><a href="#Span元素" class="headerlink" title="Span元素"></a>Span元素</h2><p>Span元素在你输入后立即就会被解析和转译，移动光标至这些span元素中间会将这些元素扩展到markdown源中。下面会对这些span元素进行解释。</p>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>Markdown支持两种链接形式：内置和嵌套。</p>
<p>在两种形式中，链接文本内容均用[方括号]引用。</p>
<p>在输入方括号后， 用紧邻方括号的一组圆括号内置链接地址来创建内置链接。在圆括号中输入你想要插入链接的URL地址，链接中可以选择是否插入标题属性，例如：</p>
<pre><code class="markdown">This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.</code></pre>
<p>会产生：</p>
<p>This is <a href="http://example.com/" title"" target="_blank" rel="noopener">an example</a> inline link. (<code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;</code>)</p>
<p><a href="http://example.net/" target="_blank" rel="noopener">This link</a> has no title attribute. (<code>&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has no</code>)</p>
<p>####内置链接</p>
<p><strong>可以将  href  设置为标题</strong>,它将创建一个书签,  允许您在单击后跳转到该节。例如: </p>
<p>命令  (在  Windows: Ctrl  上) +  单击<a href="#区块元素">链接</a>将跳转到页眉块元素。若要查看如何写入,  请移动游标或单击  <code>⌘</code>键的链接,将该元素扩展到降价源.</p>
<p>####参考链接</p>
<p>引用样式链接使用第二组方括号,  在其中放置您选择的标签来标识链接:</p>
<pre><code class="markdown">这是 [示例] [id] 引用样式链接. 
然后, 在文档中的任何位置, 在一行上自行定义链接标签: 
[id]: http://example.com/&quot;此处可选标题&quot; </code></pre>
<p>在  typora,  它们将呈现如下:<br>这是一个<a href="http://example.com/" title="Optional Title Here" target="_blank" rel="noopener">示例</a>引用样式链接。</p>
<p>隐式链接名称快捷方式允许您省略链接的名称,  在这种情况下,  链接文本本身将用作名称。只需使用一组空的方括号  (例如,  将  “Google”  一词链接到<br>google.com  网站,  您就可以简单地编写:  </p>
<pre><code class="markdown">[Google][]
定义：
[Google]:http://google.com/</code></pre>
<p>在  typora  单击链接将展开它进行编辑,  命令  +  单击将在  web  浏览器中打开超链接。</p>
<h3 id="UELs"><a href="#UELs" class="headerlink" title="UELs"></a>UELs</h3><p>Typora  允许您将  url  作为链接插入,  包装为 &lt; 括号&gt;。</p>
<p><code>&lt; i@typora.io i@typora &gt;</code>变为<a href="mailto:i@typora.io" target="_blank" rel="noopener">i@typora.io</a> i@typora. io</p>
<p>Typora  将自动链接标准网址。e. g: <a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a>.  </p>
<h3 id="图像"><a href="#图像" class="headerlink" title="图像"></a>图像</h3><p>图像看起来与链接相似,  但需要另外一个 <code>!</code>字符置于在链接开始前。图像语法如下所示: </p>
<pre><code class="markdown">![Alt text](/path/to/img.jpg)

![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</code></pre>
<p>您可以从图像文件或浏览器中  “拖动” &amp; “移除”  插入图像。并通过单击图像修改markdown源代码。如果在拖动  &amp;  删除时图像与当前编辑文档位于同一目录或子目录中,  则将使用相对路径。 </p>
<p>有关图像的更多内容,  请阅读&lt;<a href="http://support.typora.io//Images/" target="_blank" rel="noopener">http://support.typora.io//Images/</a> &gt;。</p>
<h3 id="强调"><a href="#强调" class="headerlink" title="强调"></a>强调</h3><p>markdown将星号  (<code>*</code>)  和下划线  (<code>_</code>)  视为重点指标。与一个<code>*</code> 或 <code>_</code> 一起包装的文本<br>将用  HTML <code>&lt; em &gt;</code> 标记进行包装。E. g:</p>
<pre><code class="markdown">*单星号*
_单下划线_</code></pre>
<p>输出：</p>
<p> <em>单星号</em><br><em>单下划线</em></p>
<p>GFM  将忽略单词中的下划线,  通常在代码和名称中使用,  如下: </p>
<blockquote>
<p>wow_great_stuff</p>
<p>do_this_and_do_that_and_another_thing.</p>
</blockquote>
<p>若要在将其用在强调分隔符的位置上生成字面星号或下划线,  可以使用反斜线转义它: </p>
<pre><code class="markdown">\*this text is surrounded by literal asterisks\*</code></pre>
<p>Typora  建议使用 <code>*</code> 符号. </p>
<h3 id="Strong"><a href="#Strong" class="headerlink" title="Strong"></a>Strong</h3><p>双*’s’或  _’s 将用  HTML  包装 <code>&lt; strong &gt;</code> 标记, e g: </p>
<pre><code class="markdown">**单星号**

__单下划线__</code></pre>
<p>输出：</p>
<p><strong>单星号</strong></p>
<p><strong>单下划线</strong></p>
<p>Typora  建议使用 <code>**</code> 符号. </p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>要指示代码跨度,  请用  backtick  引号  (‘)  包装它。与预先格式化的代码块不同, 代码范围指示正常段落中的代码。例如: </p>
<pre><code class="markdown">使用 `printf ()`函数.  </code></pre>
<p>将产生：</p>
<p>使用 <code>printf ()</code>函数. </p>
<h3 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a>删除线</h3><p>GFM  添加syntax以创建文本删除线,  这在标准Markdown中删去了。</p>
<p><code>~~错误内容.~~</code> becomes <del>错误内容.</del></p>
<h3 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a>下划线</h3><p>下划线由原生  HTML  驱动。<br><code>&lt; u &gt;下划线&lt;/u &gt;</code> 变为<u>下划线</u></p>
<h3 id="Emoji表情"><a href="#Emoji表情" class="headerlink" title="Emoji表情"></a>Emoji表情</h3><p>使用语法输入emoji表情 <code>:smile:</code> .</p>
<h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><p>Typora  无法呈现  html  片段。但是  typora  可以分析和渲染非常有限的  HTML 片段,  作为降价的扩展,  包括:    </p>
<ul>
<li>Underline: <code>&lt;u&gt;underline&lt;/u&gt;</code></li>
<li>Image: <code>&lt;img src=&quot;http://www.w3.org/html/logo/img/mark-word-icon.png&quot; width=&quot;200px&quot; /&gt;</code> (And <code>width</code>, <code>height</code> attribute in HTML tag, and <code>width</code>, <code>height</code>, <code>zoom</code> style in <code>style</code> attribute will be applied.)</li>
<li>Comments: <code>&lt;!-- This is some comments --&gt;</code></li>
<li>Hyperlink: <code>&lt;a href=&quot;http://typora.io&quot; target=&quot;_blank&quot;&gt;link&lt;/a&gt;</code>.</li>
</ul>
<p>它们的大多数属性、样式或类都将被忽略。对于其他标记, typora  将将它们呈现为原始  HTML  片段。 但是这些  HTML  将在打印或导出时导出。 </p>
<h3 id="内联数学"><a href="#内联数学" class="headerlink" title="内联数学"></a>内联数学</h3><p>要使用此功能,  请首先启用<code>Preference面板</code>-&gt;<code>Markdown</code> 选项卡。然后使用  <code>$</code> 包装  TeX<br>命令,  例如: <code>$\lim_{x \to \infty} \exp(-x) = 0$</code>将作为LaTex命令呈现.<br>触发内联数学的内联预览:  输入  “$”,  然后按 <code>ESC</code> 键,  然后输入  TeX  命令,  预览工具提示将像下面一样可见: </p>
<img src="http://typora.io/img/inline-math.gif" style="zoom:50%;">

<h3 id="下标"><a href="#下标" class="headerlink" title="下标"></a>下标</h3><p>要使用此功能,  请首先启用<code>Preference面板</code>-&gt;<code>Markdown</code> 选项卡。然后使用 <code>~</code>来包装下标<br>内容,  例如:<code>H~2~O</code>, <code>X~long\ text~</code>/</p>
<p>###上标</p>
<p>要使用此功能,  请首先启用<code>Preference面板</code>-&gt;<code>Markdown</code> 选项卡。然后使用 <code>^</code>来包装下标<br>内容,  例如:<code>X^2^</code>.</p>
<h3 id="高亮"><a href="#高亮" class="headerlink" title="高亮"></a>高亮</h3><p>要使用此功能,  请首先启用<code>Preference面板</code>-&gt;<code>Markdown</code> 选项卡。然后使用 <code>==</code>来包装下标<br>内容,  例如：<code>==highlight==</code>. </p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">Markdown</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/生の术//" class="article-tag-list-link color4">生の术</a>
        		</li>
      		
		</ul>
	</div>


      
        <p class="article-more-link">
          <a class="article-more-a" href="/2018/01/18/Markdown语法和Typora/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2019 绛墨铤
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">数据科学</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">自言语</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Markdown</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">VBA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">爬虫</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Oracle</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br>1、请确保node版本大于6.2<br>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br> npm i hexo-generator-json-content --save<br><br>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">很惭愧&lt;br&gt;&lt;br&gt;只做了一点微小的工作&lt;br&gt;谢谢大家</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>